<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIMI NÃ³mina v6 â€” GestiÃ³n de Personal</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;}</style>
<style>
:root{--bg:#FFFFFF;--surface:#F7F9FC;--surface2:#EEF2F7;--surface3:#E3E9F0;--border:#D0D8E5;--border2:#B0BDD0;--text:#0D1B2E;--text2:#3A4F65;--text3:#6E8298;--teal:#325BAC;--teal-dark:#062D70;--teal-light:#E8EFF8;--teal-bg:rgba(50,91,171,.05);--red:#D32F2F;--red-light:#FFF0F0;--red-bg:rgba(211,47,47,.05);--yellow:#E8A100;--yellow-light:#FFF8E1;--blue:#014596;--blue-light:#EAF0FA;--purple:#6A1B9A;--green:#2E7D32;--green-light:#E8F5E9;--font:'Inter',-apple-system,'Segoe UI',system-ui,sans-serif;--mono:'SF Mono','Cascadia Code','Consolas',monospace;--radius:8px;--shadow:0 1px 3px rgba(6,45,112,.08),0 2px 8px rgba(6,45,112,.04);--shadow-lg:0 4px 24px rgba(6,45,112,.12);}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font);background:var(--surface);color:var(--text);min-height:100vh;font-size:13px}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--surface)}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
.login-screen{position:fixed;inset:0;background:linear-gradient(135deg,#062D70 0%,#1A4A9E 50%,#325BAC 100%);display:flex;align-items:center;justify-content:center;z-index:9999}
.login-card{background:#FFF;border-radius:16px;padding:44px 40px;width:400px;max-width:92vw;box-shadow:0 20px 60px rgba(0,0,0,.25);text-align:center}
.login-card .logo{display:none}
.login-card h1{font-size:22px;font-weight:800;color:#062D70;margin-bottom:4px;letter-spacing:-.3px}
.login-card .subtitle{font-size:12px;color:var(--text3);margin-bottom:28px}
.fi{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:9px 13px;font-size:13px;font-family:var(--font);color:var(--text);outline:none;transition:border .2s}
.fi:focus{border-color:var(--teal);box-shadow:0 0 0 3px var(--teal-bg)}
select.fi{cursor:pointer;-webkit-appearance:none}
.fg{display:flex;flex-direction:column;gap:3px;margin-bottom:10px}.fg.full{grid-column:span 2}
.fl{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.btn-login{width:100%;padding:12px;background:var(--teal);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:700;font-family:var(--font);cursor:pointer;margin-top:8px;transition:background .2s}.btn-login:hover{background:var(--teal-dark)}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}
.login-users{margin-top:20px;padding-top:16px;border-top:1px solid var(--border);text-align:left}
.login-users h4{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.lub{display:flex;align-items:center;gap:10px;padding:8px 12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;margin-bottom:6px;transition:all .15s;background:#fff;width:100%;font-family:var(--font)}.lub:hover{border-color:var(--teal);background:var(--teal-bg)}
.lub .av{width:30px;height:30px;border-radius:50%;background:var(--teal-light);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--teal)}
.lub .nm{font-size:12px;font-weight:600}.lub .rl{font-size:10px;color:var(--text3)}
.app{display:flex;min-height:100vh;display:none}
.sidebar{width:240px;background:linear-gradient(180deg,#062D70 0%,#0A3A8A 50%,#114299 100%);color:#fff;display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;box-shadow:4px 0 20px rgba(6,45,112,.15)}
.sh{padding:16px 14px;border-bottom:1px solid rgba(255,255,255,.12)}.sh .sl{display:flex;align-items:center;gap:10px}
.sh .icon{width:36px;height:36px;background:rgba(255,255,255,.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;color:#fff}
.sh .tt{font-size:13px;font-weight:800;color:#fff}.sh .st{font-size:9px;color:rgba(255,255,255,.6);margin-top:1px}
.sn{flex:1;padding:8px 6px;overflow-y:auto}
.ns{font-size:8px;font-weight:700;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:1.2px;padding:12px 10px 4px}
.ni{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:8px;cursor:pointer;color:rgba(255,255,255,.7);font-size:12px;font-weight:500;transition:all .12s;margin-bottom:1px}
.ni:hover{background:rgba(255,255,255,.1);color:#fff}.ni.active{background:rgba(255,255,255,.15);color:#fff;font-weight:600}
.ni svg{width:16px;height:16px;flex-shrink:0}
.nb{margin-left:auto;background:var(--teal);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px}.nb.red{background:var(--red)}
.su{padding:12px 14px;border-top:1px solid rgba(255,255,255,.12);display:flex;align-items:center;gap:8px}
.su .avatar{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff}
.su .info{flex:1;font-size:11px}.su .info .name{font-weight:700;color:#fff}.su .info .role{color:rgba(255,255,255,.5);font-size:9px}
.su .logout{background:none;border:1px solid rgba(255,255,255,.2);border-radius:6px;padding:3px 7px;font-size:9px;color:rgba(255,255,255,.6);cursor:pointer;font-family:var(--font)}.su .logout:hover{background:rgba(211,47,47,.2);color:#ff8a80;border-color:rgba(211,47,47,.4)}
.main{margin-left:240px;flex:1;padding:20px 28px}
.ph{margin-bottom:20px;display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:8px}
.ph>div:first-child{flex:1}.pt{font-size:20px;font-weight:800;letter-spacing:-.5px}.pd{font-size:11px;color:var(--text3);margin-top:2px;font-weight:500}
.kg{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-bottom:20px}
.kc{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;box-shadow:var(--shadow)}
.kl{font-size:9px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.6px;margin-bottom:5px}
.kv{font-size:26px;font-weight:800;font-family:var(--mono);letter-spacing:-1px}
.ks{font-size:10px;color:var(--text3);margin-top:2px;font-weight:500}.ks.pos{color:var(--teal)}.ks.neg{color:var(--red)}.ks.warn{color:var(--yellow)}
.tc{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}
.tt2{padding:10px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.tt2 .title{font-size:13px;font-weight:700;margin-right:auto}
.sb{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 10px;color:var(--text);font-size:11px;font-family:var(--font);width:180px;outline:none;transition:border .2s}.sb:focus{border-color:var(--teal);box-shadow:0 0 0 3px var(--teal-bg)}
.fs{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 9px;color:var(--text);font-size:10px;font-family:var(--font);cursor:pointer;outline:none;-webkit-appearance:none}
.btn{padding:6px 12px;border-radius:8px;font-size:11px;font-weight:600;font-family:var(--font);cursor:pointer;border:none;transition:all .12s;display:inline-flex;align-items:center;gap:4px}
.btn-p{background:var(--teal);color:#fff}.btn-p:hover{background:var(--teal-dark)}
.btn-g{background:var(--bg);color:var(--text2);border:1px solid var(--border)}.btn-g:hover{background:var(--surface)}
.btn-d{background:var(--red-bg);color:var(--red)}.btn-d:hover{background:var(--red-light)}
.btn-e{background:var(--teal-light);color:var(--teal-dark)}.btn-e:hover{background:#B2DFDB}
.btn-sm{padding:3px 8px;font-size:10px}
table{width:100%;border-collapse:collapse}
thead th{padding:8px 10px;text-align:left;font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.7px;background:var(--surface);border-bottom:1px solid var(--border);white-space:nowrap;position:sticky;top:0;z-index:1}
tbody td{padding:8px 10px;font-size:12px;border-bottom:1px solid var(--border);white-space:nowrap}
tbody tr{transition:background .1s;cursor:pointer}tbody tr:hover{background:var(--teal-bg)}
.ts2{max-height:600px;overflow:auto}
.badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:600}
.badge::before{content:'';width:5px;height:5px;border-radius:50%;background:currentColor}
.b-ok{background:var(--teal-light);color:var(--teal-dark)}.b-no{background:var(--red-light);color:var(--red)}.b-lic{background:var(--yellow-light);color:var(--yellow)}.b-bl{background:var(--blue-light);color:var(--blue)}.b-pu{background:#F3E5F5;color:var(--purple)}.b-gn{background:var(--green-light);color:var(--green)}
.mo{position:fixed;inset:0;background:rgba(26,35,50,.45);backdrop-filter:blur(3px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px}
.md{background:var(--bg);border:1px solid var(--border);border-radius:14px;width:100%;max-width:860px;max-height:92vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow-lg)}
.mh{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.mh h2{font-size:15px;font-weight:800}
.mc{background:none;border:none;color:var(--text3);cursor:pointer;font-size:20px;padding:4px;width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center}.mc:hover{background:var(--surface);color:var(--text)}
.mb{padding:20px;overflow-y:auto;flex:1}
.tabs{display:flex;gap:2px;margin-bottom:16px;border-bottom:2px solid var(--border);overflow-x:auto}
.tab{padding:6px 12px;font-size:11px;font-weight:600;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;margin-bottom:-2px;white-space:nowrap}
.tab:hover{color:var(--text)}.tab.active{color:var(--teal);border-bottom-color:var(--teal)}
.cg{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.cc{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
.cc h3{font-size:12px;font-weight:700;margin-bottom:12px}
.br{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.bl{font-size:9px;color:var(--text2);width:110px;text-align:right;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500}
.bt{flex:1;height:20px;background:var(--surface2);border-radius:4px;overflow:hidden;position:relative}
.bf{height:100%;border-radius:4px;transition:width .5s;display:flex;align-items:center;padding-left:6px}
.bf span{font-size:9px;font-weight:700;color:#fff}
.bv{font-size:10px;font-weight:700;width:28px;font-family:var(--mono)}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.sn2{text-align:center;padding:16px;background:linear-gradient(135deg,var(--teal-light),#B2DFDB);border-radius:12px;border:1px solid #B2DFDB}
.sn2 .big{font-size:24px;font-weight:800;font-family:var(--mono);color:var(--teal-dark);letter-spacing:-1px}
.sn2 .det{font-size:10px;color:var(--teal);margin-top:2px}
.sg{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-bottom:20px}
.sc{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
.sc h4{font-size:11px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.sr{display:flex;justify-content:space-between;align-items:center;padding:3px 0;font-size:11px}
.sr .l{color:var(--text2)}.sr .v{font-weight:700;font-family:var(--mono)}
.ai{background:var(--bg);border:1px solid var(--border);border-left:4px solid var(--yellow);border-radius:0 var(--radius) var(--radius) 0;padding:10px 12px;margin-bottom:5px;display:flex;align-items:center;gap:8px;box-shadow:var(--shadow);font-size:12px}
.ai.critical{border-left-color:var(--red)}.ai.info{border-left-color:var(--blue)}.ai.success{border-left-color:var(--teal)}
.ai .at{font-size:10px;color:var(--text3);margin-left:auto;white-space:nowrap}
.du{border:2px dashed var(--border);border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:all .2s;margin-top:8px}.du:hover{border-color:var(--teal);background:var(--teal-bg)}.du input{display:none}
.di{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-top:5px;font-size:11px}
.di .dn{font-weight:600}.di .dm{font-size:9px;color:var(--text3)}
.dtb{display:flex;gap:4px;flex-wrap:wrap;margin-top:5px}
.dtb span{padding:3px 8px;border-radius:14px;font-size:9px;font-weight:600;border:1px solid var(--border);background:var(--bg);cursor:pointer;transition:all .12s}
.dtb span:hover,.dtb span.active{background:var(--teal-light);border-color:var(--teal);color:var(--teal-dark)}
.lg{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;margin-bottom:20px}
.lc{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);border-left:4px solid var(--yellow)}
.lc.expired{border-left-color:var(--red)}.lc.ok{border-left-color:var(--teal)}
.lc .ln{font-size:13px;font-weight:700}.lc .lcg{font-size:10px;color:var(--text2);margin-top:1px}
.lc .ld{display:flex;gap:14px;margin-top:8px;font-size:11px}.lc .ld .lbl{font-size:9px;color:var(--text3);font-weight:600}
.lc .ls{margin-top:8px;font-size:11px;font-weight:700;padding:3px 8px;border-radius:6px;display:inline-block}
.aud{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);font-size:11px}
.aud .dot{width:7px;height:7px;border-radius:50%;background:var(--teal);margin-top:4px;flex-shrink:0}
.cal-g{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-top:8px}
.cal-h{font-size:9px;font-weight:700;color:var(--text3);text-align:center;padding:4px}
.cal-d{text-align:center;padding:6px 3px;border-radius:5px;font-size:11px;min-height:32px;border:1px solid transparent;position:relative}
.cal-d.today{background:var(--teal-light);font-weight:700;border-color:var(--teal)}
.cal-d.has-ev{background:var(--yellow-light);cursor:pointer}.cal-d.has-ev:hover{border-color:var(--yellow)}
.cal-d.empty{color:var(--text3);opacity:.4}
/* VACATION */
.vac-card{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);border-left:4px solid var(--teal)}
.vac-card.pending{border-left-color:var(--yellow)}.vac-card.rejected{border-left-color:var(--red)}
.vac-bar{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-top:6px}
.vac-bar-fill{height:100%;border-radius:4px;background:var(--teal);transition:width .4s}
/* BULK */
.bulk-bar{background:var(--teal-light);border:1px solid var(--teal);border-radius:var(--radius);padding:10px 16px;display:flex;align-items:center;gap:10px;margin-bottom:12px;display:none}
.bulk-bar.show{display:flex}
.bulk-bar .cnt{font-size:12px;font-weight:700;color:var(--teal-dark)}
.cb{width:14px;height:14px;accent-color:var(--teal)}
.toast{position:fixed;bottom:20px;right:20px;background:var(--teal-dark);color:#fff;padding:10px 18px;border-radius:10px;font-size:12px;font-weight:600;z-index:2000;box-shadow:var(--shadow-lg);transform:translateY(80px);opacity:0;transition:all .3s}
.toast.show{transform:translateY(0);opacity:1}.toast.error{background:var(--red)}
.page{display:none;animation:fadeIn .2s}.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.accent-bar{height:3px;background:linear-gradient(90deg,var(--teal),var(--teal-dark),var(--red));position:fixed;top:0;left:0;right:0;z-index:200}
@media print{.sidebar,.accent-bar,.toast,.btn,.tt2,.ph>div:last-child,.bulk-bar{display:none!important}.main{margin-left:0!important;padding:8px!important}.mo{position:static;background:none!important}.md{max-width:100%;max-height:none;box-shadow:none;border:none}}
@media(max-width:900px){.sidebar{display:none}.main{margin-left:0;padding:12px}.fg2{grid-template-columns:1fr}.cg{grid-template-columns:1fr}.kg{grid-template-columns:repeat(2,1fr)}}
/* DARK MODE */
body.dark{--bg:#1A1D23;--surface:#22262E;--surface2:#2A2F38;--surface3:#333842;--border:#3A3F4A;--border2:#4A5060;--text:#E8ECF0;--text2:#A0AABB;--text3:#6B7890;--teal-bg:rgba(0,137,123,.12);--red-bg:rgba(211,47,47,.12);--shadow:0 1px 3px rgba(0,0,0,.2),0 4px 16px rgba(0,0,0,.15);--shadow-lg:0 4px 24px rgba(0,0,0,.3)}
body.dark .login-screen{background:linear-gradient(135deg,#031A40 0%,#062D70 50%,#0A3A8A 100%)}
body.dark .login-card{background:var(--bg);border:1px solid var(--border)}
body.dark .lub{background:var(--surface);border-color:var(--border)}
body.dark .accent-bar{opacity:.7}
body.dark input,body.dark select{background:var(--surface);border-color:var(--border);color:var(--text)}
/* GLOBAL SEARCH */
.gs-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:3000;display:none;align-items:flex-start;justify-content:center;padding-top:15vh}
.gs-overlay.show{display:flex}
.gs-box{background:var(--bg);border:1px solid var(--border);border-radius:14px;width:560px;max-height:70vh;overflow:hidden;box-shadow:var(--shadow-lg)}
.gs-input{width:100%;padding:14px 18px;border:none;border-bottom:1px solid var(--border);font-size:15px;font-family:var(--font);background:transparent;color:var(--text);outline:none}
.gs-results{max-height:50vh;overflow-y:auto;padding:6px}
.gs-item{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:12px;transition:background .1s}
.gs-item:hover,.gs-item.sel{background:var(--teal-bg)}
.gs-item .gs-icon{font-size:16px;width:24px;text-align:center}
.gs-item .gs-main{flex:1}.gs-item .gs-sub{font-size:10px;color:var(--text3)}
.gs-hint{padding:12px;text-align:center;font-size:10px;color:var(--text3)}
/* REPORT */
.rpt-card{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:12px}
.rpt-card h3{font-size:14px;font-weight:800;margin-bottom:12px;color:var(--teal-dark)}
.rpt-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.rpt-stat{text-align:center;padding:10px;background:var(--surface);border-radius:8px}
.rpt-stat .rv{font-size:22px;font-weight:800;font-family:var(--mono)}
.rpt-stat .rl{font-size:9px;color:var(--text3);font-weight:600;text-transform:uppercase}
.trend-up::after{content:'â†‘';color:var(--teal);margin-left:4px;font-weight:800}
.trend-dn::after{content:'â†“';color:var(--red);margin-left:4px;font-weight:800}
.sparkline{display:inline-flex;align-items:flex-end;gap:1px;height:20px;vertical-align:middle}
.sparkline span{width:3px;background:var(--teal);border-radius:1px;min-height:1px}
.dm-toggle{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:12px;color:rgba(255,255,255,.8);font-family:var(--font);transition:all .15s}
.dm-toggle:hover{background:var(--teal-bg);border-color:var(--teal)}
/* PAGINATION */
.pag{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-top:1px solid var(--border);background:var(--surface);font-size:11px}
.pag-info{color:var(--text3);font-weight:500}
.pag-btns{display:flex;align-items:center;gap:3px}
.pag-btn{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:4px 10px;font-size:11px;font-weight:600;cursor:pointer;color:var(--text2);font-family:var(--font);transition:all .12s;min-width:32px;text-align:center}
.pag-btn:hover{background:var(--teal-bg);border-color:var(--teal);color:var(--teal-dark)}
.pag-btn.active{background:var(--teal);color:#fff;border-color:var(--teal)}
.pag-btn:disabled{opacity:.3;cursor:default;background:var(--surface)}
.pag-size{display:flex;align-items:center;gap:4px;color:var(--text3)}
.pag-size select{border:1px solid var(--border);border-radius:6px;padding:3px 6px;font-size:10px;font-family:var(--font);background:var(--bg);color:var(--text);cursor:pointer}
.org-node{display:flex;flex-direction:column;align-items:center;position:relative;padding-top:20px}
.org-node::before{content:'';position:absolute;top:0;border-left:2px solid var(--teal);height:20px}
.org-children{display:flex;gap:0;justify-content:center;position:relative;padding-top:20px}
.org-children::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);border-top:2px solid var(--teal);width:calc(100% - 60px);height:0}
.org-children>.org-node:first-child:last-child::before{display:block}
.org-children>.org-node::before{content:'';position:absolute;top:0;border-left:2px solid var(--teal);height:20px}
.org-box{background:white;border:2px solid var(--teal);border-radius:10px;padding:8px 12px;min-width:120px;max-width:160px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.org-box:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15);border-color:var(--teal-dark)}
.org-box.over{background:var(--teal-bg);border-color:var(--blue)}
.org-box.deficit{border-color:var(--red);background:#fff5f5}
.org-box.surplus{border-color:var(--yellow);background:#fffde7}
.org-box.ok{border-color:var(--teal);background:#f0faf8}
.org-cargo{font-size:10px;font-weight:800;color:var(--teal-dark);line-height:1.2;margin-bottom:3px;text-transform:uppercase}
.org-area{font-size:8px;color:var(--text3);margin-bottom:3px}
.org-dot{font-family:var(--mono);font-size:12px;font-weight:800;letter-spacing:0.5px}
.org-dot.red{color:var(--red)}.org-dot.green{color:var(--teal)}.org-dot.yellow{color:#e6a700}
.org-root>.org-box{border-width:3px;border-color:var(--teal-dark);background:var(--teal-bg)}
.org-root>.org-box .org-cargo{font-size:11px;color:var(--teal-dark)}
.org-actions{position:absolute;top:-8px;right:-8px;display:none;gap:2px}
.org-box:hover .org-actions{display:flex}
.org-abtn{width:18px;height:18px;border-radius:50%;border:1px solid var(--border);background:white;font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1}
.org-abtn:hover{background:var(--teal-bg);border-color:var(--teal)}
</style></head><body>
<div class="accent-bar"></div>
<div class="gs-overlay" id="gs" onclick="if(event.target===this)closeGS()"><div class="gs-box"><input class="gs-input" id="gs-q" placeholder="Buscar colaborador, secciÃ³n, acciÃ³n... (Ctrl+K)" oninput="doGS(this.value)" onkeydown="gsKey(event)"><div class="gs-results" id="gs-r"></div><div class="gs-hint">Esc para cerrar Â· Enter para seleccionar Â· â†‘â†“ navegar</div></div></div>

<div class="login-screen" id="LS">
<div class="login-card">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAIAAAABc2X6AAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAAAnG0lEQVR42s18d3wUVdf/uWW2ZXfTe0J6gRCkJXRCbwIiIF0FLCBirxQRCwg+CgIqIoj0Dop0qaGTAAEhkJ6Q3stusnXm3vePCSFCEtHX5/f+5hMC7M7Mvd+5557yPecMgn/vQAgRQjjnkiQ1fOjk5BQUFBQaGhoYGOTj6+vm6qrT6RRKJQBYrdZao7G8vLygsCAnOzszMzM7O7u6urrhWkIIQkiSJM75vzbJf+UuGGN5ZvJ/XVxcunTp0qtX75iYmPCICG8vL0Ggf3kTm10sKipOS0tNTEw4d/ZsQkJCZWVlA3LOOWPs/x5wY6iOjo5DhgwZPWZs795xXp7ujU+TmFRpsFQazNW1tlqLaBMlAFBQolVRJ63SRa9y1aswJo0vKS4ujT97Zu/evceOHjUYDP8WbPS/EWCMsQw1MjJy+vQXnhk3LjCgVcMJ94qrr6eXXkur+CO7IrPIWFJlqjHZRJsEEgfGAQAwAoKogjhqlF4u6hBvfXSQS+dwt46h7q28nBruk51zb9eunet/+iktLU2GzRj7x0L+DwETQmSoUVFR77zz7rhx4x0c1PJXt7JKD13JPZqQez2j3FhlBokBxkAxUAwYYwwIUP2wHDgAYxwYA5GByIAxIFjvou4Y6j40xn9Yl4C2wfWSUltn2rlj+7Jly+7cudN4Av91wAghhBBjzNPTc+7cuS+8+JKDRg0ARpNl/4XsjcdS4/8oshstQAkoKaUYIcQ55wCccxlhEzNAgBBCAPLJosjAKoIoKfSqPu18nh8cMbJHkFatBIC6OtPatT8uXry4rKwMY8w5/7tLjf7Zwk6dOvWzzz/38/UFgJo684ajqd/vv52WWQ4Ig0YQCOacM/4P5Q4hwAghhOwSA5MdOI8MdZ31VNvnB0fqHVQAkJuX/9H8uZs2bf4HS/03AFNKRVH08vL69ttvx4wZAwCMSZuPpy7aci09owKUlKoF4Jyxf82GIACMESAkmu1gFSPCXOc923nKgHCECADs3r37tddeKykpkSf2LwOWb9q/f//169e3atUKAJIySt9bfeHkpXugoIJaYIz/e0gfsQUIYYzsZjvYxIHdA7+a1aNdsDsA5OTcmzZt6pkzZx4fM3lMd0KSpNmzZ2/ZstXZ2ZlztmxP0pTPj6dlV1G9ChEs/few1ms3YJwTgRCVkJFVsel4qoOadm3j6eTkPHnylLKysoSEBELIvwC4wfYsXbp00aJFGOPyGtOUxcdXbrkuKShVC5LEeIu7EaF/DzYHzjlVCVaJHzudcTu/un8nP61aOXz4cKVSeeLEicfBTB4H7Q8//PDGG28AwO17FUPfP3A+MV9w1nDgrBmwCIASzDjnEucMEEaU4McRAYwRkfUVIN4sbI4xUI3idnLJwYTcfh393B3VvXr18vBwP3jw0F9iJn8pyT/88MOMGTMA4OztwqHv/pZXXCs4qkSJtXAh48CMFiDYSa9SKojFKjKjlROEKQbeElrJZGdmO7NLHCFSb9KaPplxLjgoSoqNu86kd3/Cu5W7LiYm1sPD4+DBg5TSFswDallLLV269P333weAk0l5Iz88aLIxqqJSi2i5yCiB18e0m9A3LMBDz4Hnl9XG3yxYsv16abkJqwXg/M++B+ccEACziDHtvEN89JUGS3JOZUGBARAQjYI1v2kIwaLFrlWS374c0bedHwAsXrx43rx5Legw1ALaWbNmfffddwBwPrlw8Nv7TXZGFKSF4RECxIAAP/DF8EGdWz30bVp+1YB39heU1TGEQJLqlxojoJhSIhotn8zotuDZWPlko8kW/0fB0u3Xz1/Lp1ql1BJmJFolrQIfWz6qe2tvAJgxY8aPP/7YHGbUnHfRp0+fkydPYozv5lb2nL230mijSiIPjKBpwcQYSXXWTR8PfnZApM0uUYIRAsZBYlwUmUZFt5xOfXbOYZ9AF71GUApEYtxgspUbLKZKU59ugae/GiUxzjmXjZAstxM+O7r7aBp1VDUWKwSAMGowg4Qg0SK66ZXnvxsb4ecsSlLfPn3Onz/fpE+CHo1+AMDV1fXGjRs+Pj5VRnPX2XvTsquog0IekmAkSowSzGRZbPykDdbRg8P3LhhqF5lAseyBEFw/RFmN+fWV8XbO17/bX62kAsEAUGe2VxgtM74+1b2dz0eTYwBAYlz2MSXGCMZmmxjzys47mZVELcjCVe+rmu1ILciw62W71to61PXSqjGOWlVeXn6HDu2rqqoA4KHoijwKmDG2devWmJgYAD5h8e8XE/KF+w8YYyQZrVRFRaONY0QpbqwdMEZb5w70dHYABJwDwQgjlFtq/OnwnfnrL3+1/ZpKQda+289Vr8ay6wwgUOykVZpFtnL3zUAvnaujWqsWEEKMc0owY1wpkI7h7hsO3wWCOQDGiNklQBAT5VVQVsttjCqIbK4EtVCSX5NaZhzfJ9TR0TE4OHjXrl2yv90sYFkGpkyZMnfuXABYvu/myk3XBBeNKDKEgCAk1ZhffOaJXz8bGh3ufjIx11Jrk30sgpFkFjtHe340JUYegGB0Lb301WWnlm67VmOyj+4d8un0bq+Pbq9VKzjn6IF1RozzjqHudiat2X9r1S9/XLhV2CbQxdNZIzFOCBIlFuChv1NYfet2kcJBIdkkFUUnvh45a2TbZ+JCDlzMNlZb6v08xgWNIvlWkau7pkukV5s2bVJTU2/duiVH0Q9WpfHacs5dXV2/+vprznlyTvmcHy4SnUqSGEKAAYkG8/dz+386LXbW0pNatXBn8+Su7bzsFSZKMEIIbGK/9r6yTBKMFqy/NPzd/W2DXONXjTmydOTMEdFBXnrG+Z/RAkJAMMIYvT++U8KaCce+fKqVh67/G3sXbUkkGMkqg3OYNSIKKQi3McL4xdXP1JjskaN/vpVVcWvDpNbBLvZqM6UYACTGiE71weqLKbkVnPNly5Y7Ozs/NCJ5SJiXLFnav18/zvn4RcczsyuJWmCcE0Ciwbz586G92vl0fmHnjZTS3SfSrBLfPH9QidFy9WquQqsUbdLMp9u1DXKlBI//9Gj8jYKTK0aP7h3m6KCUGOfsQQzUpLKVJI4QuOrVg2IChvcMnvPjhYS0kjG9QhnnGCMPJ/X6k2k1JcZTq8dW19qGv73frqQHfruNHRTbPx5y9nZhdkaF4KBgjGOKbUZrSonhuQHhOp1OEIRjx441XmTSeHnDw8PX/bSOUrrtVOryjVepo1qSGMVIrDKt+2RI9yivTi/sqLGIgDGILPFqXnxqycZ5A3WOqt9PZyIleXNc+0BP/fSvTybnVF5fO8FVp7aLDCPAGGHcLNSG/V8fDEvc01nz8oi2n2xKvJVTPrJbsM0uqRV0zcHk+dO7tA107vnKHrBLoKSxnf137bqZWlZ78MsR17MqUpKLBa1SkhhVC5lpZZGhLm0D3dq377Bjx47KysqGzYwfOAycz5k7V6VU1pqtH21IRErKGacE2yvqFr8VNzQ2oOvM3bVGG9jEwd0CPnypa1RnvwunM8MmbJo6tM3mxcO40VpRY/n9Wu6+c1nnV4yhGEuMCxSjv+NMI4QEiiXGlQK59O3Y3WezfjpyRykQiTGMINhL22P2Pm6yjX+yddIPzxxZ9OTprVOOX8zp8+re3xYPHz0k0l5RRynmjCMF/WhDosliU6tVH86Z01iqUYMwBwcH376drFarvv315mtLT1EnDQeQympfmNRh5exekc9uzUstC4ry/P7NuDA/x8zcqtbBrsn3ql776kxBjfnrmd3mb7zqoKbVBssvnw7r38FfNl3/OE6QJE4ISkwt6f/2r689HX3xbkl2sZExJkh844LBfu7azzYl7j6Rtnhm9+eGtZk0/3B+lenqmnFPLzh88EQGcVEjQGK1afW8ATOHR9eZzFFtWt+7d0+GSRposTlz5sTFxZks1uf+c7q61k4FItVah/YN2fnRkO6z9qRcy395WuyOBYPP3yoc8eGhjZuu7r6a6+aoXvN+P5NNXLD4xKFVY6YOjBwbF9r3CT/GOcH4fxMYYYwY437u2iFdAg5fvhfs63jxTsnATv6/LRmx6UjKmHf2J90q8mzlvONY6oWbhTsXDRMltnBT4p6FQy+llebkVlOBMA6pRcYXh0Zo1CqT2Xzq5EkZZv3O0Wq1d1NSfX18dp5JnTj/CNWrgXPRaJ09qUNRae3ew3f3LB/VrY3XhE+OnjuS4tHWa8HU2IGd/Pafz7p0t8RuskeEun31co8Gtx7/SzFh41t9s+/GnrOZWiUtLa2dObZ972hvByUhAh385r7UnMqzP443WcTLd4oEgj9YdZ5olYCQaLDs/mLomF7huXl5bVpHmkwmhBCW46khQ4b4+fog4OuOpCCEgXOJceqo+nbtlcvJxZkHX9Ioie/Ideeu5y/5dMitnyd6O6lf/vx460DXQTH+5+4UL3mhm8S4/PMoWsa4KLHm/GEOIElNR5oYIflau8jeHN0+o6CmbbDr2nkDa2qtr6w42/HFXYs2J179edLo/uHdnl5/917l1MGtd5xK5xjL1gwhWHckFSEe0Mp/0KBBsiwTeYUXfvJJm9atU3Ir5qy7wgTCOWCMpGrLmCdbx3875qut12bNOzz5qehDX41UUjJ2wZHVu5JqGPx8LOVcYv737/ZrH+LGGKcEN4GWc1lLY4Q4b4IPQPdVNPuzwWwUkyPOOcbI30O7cM2lQ9fyqo3WqlprVmFN4vnsC1kVez4bVg2w8NPfJb1q3Xv9tp1ONxitCGNOSV6JcVyfYBedmnPYu3cvQohKkuTo6NinT1+E0IHL9+wGi+Ck4ZyLRuvL49p982rvvq/uycyvjt/2rJ+n9s1v4vcdS33j+Zj4lWO8nDX7zmdOXvT7qO5BnEOTm1aOBC7eKfxi/ZUn+4TOHB7dWEpl/KLENh69ExHo0jPKp8knIsMGAJWCKByEG2vG6TVKALidXf7+2ktHDtzp9sruC9+PBQQrvrtw8kZBtUUEjBjnlGJrteng5dy3x7r27ddfp9MZjUYMAF27dnV3cwXghxNygRLOOeOAFOTK3bI2z23pEOaeumtqYkpJ60lb9p1MP/Dt6G9m9y6prLubW/l0z+DzK8c4qIQmqRzGOSB0IbnwqQVHhvcMWb7vj6SMMoxQA/8l/+PtH85V1Ji/3p2051wGQtCk5MsmNCWvakyfUL1GOXHxsQFv7KUCObx4xCcf9E1KzOsxa8/yV3s+M7797cQ8k1UEjOqvIuRQQi4A9/J0j42NrbfDvePiACC/zHAtvRyUlHEOwBHBBqPl5w8HvDL2if5v/vLu1/E2u7T365HDuwS9/t259lO2dpm9p7iirlOYR5MEntlmt4sMAXyyKdFmlXp19FNhdDWtVN7S8vISjKx2ae+5nJi23hqlYv76Kxw4QmC11yefHsTnBAPAW2Par5rdm3OeV1Z3Mj6rw/TtJ5PyFkyJfeuVbkmX7g2bc3DHR4NiuwUwg6UhugQlvZpWVlRhBIC4uLh6wDExsQBwLa2sttIkB0AIELOJ/3m1x+17ldFTtlxPL0cKMnNsu9HdQ5bvu7FqQyLSKRHCsvFATa3G9fRSxrhNlFLyawxGW9Tz2/5ILgny0slpBn4/BSG7BP1m7N52NKW4ylxSacIIFVeaUvMqG0Sg4VBQQjBGCE0fHIn0SovIJy8+XlZjXjyta2gn3+O/p72yIv7kslGhQS7cKsoqgwjYUGG6nl4OADGxXQAA6/X6iIgIALiaXg4Sk3cL4xyphHGfHX/ty9NYrSCUOLqoF03rWlhZt+DnBMFFDSbboE5+ns4O/P4Ga6x1ASCn2Mg4ZwxsdgkIAsYDQlxjI71EiWGMEJKFDpQKGuipBUCCg6LWbLeKTGLcZBXzy+pkKXiUVAGAUT2CXdwciEBK8mr+sytJpaDj+4RiB8WP25PWHrrz9Wu9mFWUz8QIgShdTS8DgIiISAcHBxwcHOzt5QUAf2RVAsaNsz+MAdUpKcVSrXVUr2AXnWrHqfTasjosEA4wfWjkA3yNATMAAKNZPH0zX6Ugzw8KB4vorFNseK+fXqOQaRCT1W4w2UwWOwL44c04fz9He1ntUz0CAzx0BKPDCTkaFW2SjsEIiRJ30ammDAyXDBaiV/18LMVqlwZ08mcYCc6at7+78OJXp5FDPSvEgQPGf2RVAoCPj3dQUBANCQkRBCoxlllUA38O6B+oEIJGdgviHC4kFyGB2OpsbaM8B3ZsxTkn5FHOBHEOI7oGvroqvrrGMn9yzHP9I0JbOdvtbNUvN09cy7tXWmu2i/IedlCQdsFu055s0y7IeUxceH6Zccvx1IyimteeekK2Z00ZZ+AAr42KXrM/2c6hvMR4Pb00yEsPlIiMYwGXVZoRxQ2GACjOKDQwzpQKISQkhAYFBQFAldFcXGkGih8lOOWtH+CpQwjyyuqwgkoW+7wJHSjBosQoedRyAufg66Zd/27/I5ezas32qCC3zzZeWX8oOTLQdVBsq07hHj5uWoFis1XMLTFcuF18/mbhkUtZRrPUq51XkJfuvQkdCW6Wx8YYSYyHeDtNHhzx075bFFBOidHfQycLG+eAhQfLJpNMxZWmmlqrs04dGBREfXx8AaDSYDGYbICb5I0RSMxkscvElVRQ0+vJyHF9wmVPozn6knNw0akmD2xjl1iP1/coEBz88qmoQNeHzoz0dx7UOQAAfk+899o38de7Ba6c3VtWaajFhBjnMHdix41H7ooVpgg/p6KKOrBJWEEfSZVzIKimzlZptDjr1L4+vtjVzQ0AqutsdpskS8ujIgR2VlhRxznMmdBh0MCwdW/1+UtvWfYoOIeJnx/zcFKfXjE2KtBVkrgoMTntJudTJVb/yaCYgD82TD6SmLto21WEgLWUwJF3DQ/2clzwfMykse06hnlcSC4CiT06K84BIWS1idW1VgBwdXOlOp0OAOosIogMUfKoSCOEQGLXM8rGxYWN7BY8sltww6gt+/2U4KSM0st3S7K3PCs7M4SgxiuHGv2xi0wpkH0Lhwybd3D2U9F6jbLlRZZHl4lOADiRVAAYN5lwwAhJIjNZRADQaXVYoVAAgM0ugcz/Pzp1xpFa2HU6w2ITH8prtRzQAkBavuGJEFeBEsYf8LVNHgLFnPPoIDcXnarSaEUIWiheESXOGP8jq3zrqRQAyCqqOXMtD2mEpnOYCICDTWQAoFAq8V/miRnnWEmzc2uGzD3w+dbEge/9cjunHCFogcqQuQ4A2HYyNa+8rsEbaekBMc4BzDYxNbf6i+3XAIBg3FyARQnCGNlE6dkvTs756dLTC4/U1dkxwY+Ts8U2q1V2YgCh5jJdjHGsFuIT8z9ace7UzSI/d11iSsmslWcedYYAQJQYwchsE/u/ta/OZDPU2X65kEkJtotMaqr4hvP6SzBCkz8/1jvaO7fE2O+tfWabKJP+Dz8XDnvOpm89mdo53LNvB78lK8/9kVGBVUKz254DIFBQLJfCYaPRCAAOKgoU8+Zze5xzpYOCqoXe7XycHJRnbxdtOZXB4U/Rrzx1SnBKXlXb57d4umhOfP30N7N6PrPgyK/nMwWKZT6XcS5K9RGyHB5Rgs028ZkFh8/dLNw2f9DRJSO9XR2int9yK7tCNn4Nz4lzjhCsOXx39cFkzmFYbADVKZVKoQUJYpwDxRo1BQCj0YjLK8oBwEmrFBSEsZb0BOMg2qTWrZw5QFWtta6stqC8tl7Nci5KTJ76luMp3V/ZOXNUu20fDbGLbFT34I1zBzz32bFh7+8/kpBTZ7FjhChBlNTjL66sW7Y7KWLixoIy4431E930akniW+cPfmNs+7jZe3747ZbMe4sSt4uMEmy22c8mFVhsEkIQE+EuEtxi7hY450oFdXJQAkBFeTktLCgAAFedytFBUV5pBqGlFC4AD/LSIwDOOau1ffvrrSUvdq9nAgkymm2vLjt9Jin/18XDe7fzEyUmU5CT+0f2auf76YaE6UtPAMK+Hlp/D52Hk7qm1nY3t7LKYA700C2d1XNi/wh5QeSEwxtj2ndv6z3506NHLuV8/05fXzetPNCUxSci/BwdVBQAWnloBQfBbmeye9eMeuBOzgoXnQoACgoLaHZ2NgA461ReLprysjqkIC0pGIRc9Up5ow4Z3vrg5XuY8WnD29bUWg9dzN509G5Ma4/bm5/VqxUNrKWcQGjlrlv3Xn+LTbxyt+R6etn524U/brum89KverVn73Y+Qd6O90OF+j0iS3JMhOftTVPe+Ca++yu7osM9XB1VV28XBfk7r/+w/4zl8QCgVlCVQOy2lvLVIDEvF42TVgkAOdnZNDMz02YXFQIN8dHfTi5pwaHgwAGBQiAA4OemvZtbdfSLEdO++H3v+SxCcZS/89oP+vfr4C+rlsZOGMGIcc4ZqBQ07gnfuCd8FQpsE1l1nW1QTCtvFwdRYgghgv9kpeVkmoKQ1e/0S8uvOpaYW1FjHj2j+1M9Qk7fzJeNnCjxFj0UwAgkkYX6OCKErVZbZmYmzcrKKioqCmjl3y7IZT9jqNnsLyBAwEHeMH2e8Fmy87qXi+b4stF1FrtKQWSKRybxHjW5GCEgwDmIjCGA1QeSt84ZsP1U+tKd1795pRdA01ZaFlTGebifc7ifc4PJSEgpCfDUAUCl0WK22FEL8gwIGGsX7AIABYWF2dnZ2Gg0pqamAkBMuDtQ8hf1RxwqDBYAaBvo6u6o3vB7CuegUQoEY0nichoNtWjSBYIv3y3OL6yx2Zmns2bb8dQ6i10mEpvTOrKAiBITJWazSxijQ5fvDe7sDwCZRQZmsrfg0jDOgZKYMDcASElJMZlMGAASEq4AQKcwd52LWhJZy25yVpFB3hsLn+0896dLMhcjSowQ1LIv1eCczVt/pabGFjtrz9urL5YV1368KYFgZJd4y4VplGDOQSGQ87cLM4tqxsWFAUBiSmkDadHkw5LszNFN0yHMHQASE67UUzxn4+MBwMdN1zncHSxic4EB5xwovplZIXuOo3qEDOjk3++dXwDV65gWPH6ZsqYEf7I54ezle1SnxBRjgqlO9fXWa9tPpykoFiXeZIEbv89sCxRXGC2jPj68eHpXvUbBOD96LQ+EZmt2MEJgFWPD3b1cdAAQHx9fD/jKlSslpeUA6MnYViBJzT0wOTC+mVVRXFlHCBIlvnXOQHdH1RNTt15PL6UE4/uKRJSYPHtZDuVYnxK0ZMfVheuuqJzU9XUKGGGCBJXiuc+PrzlwixJEMEIADRfKzolMXFOCz90qaD9t27TBrZ8f1JpxfiOj7MbdUqymzXmgCCGQpGFdAgCgsLgkMTGxnou3WCydOneOimrjqlf++HuqKPHmpJpSYqkyRYe7tw9xlxjHCE/sF15rsb+98mxCSrG7sybASycnuGXm/X6iFK6llcxcdub7bUlAsGi2c4QAI8lgkawiY4whfPBc1s2ccm9Xh1buje6AEUbIJkqnkwre+e7cd3tuzp/WZc7EzjaRUYI/2phw/WYhVSua1DsIgDGu0gjfzOrurFP99tv+nTt2EEKQXN7z9NNP79u3D4APnnPw+Lks0kylEMFIrLP1jPE/t+xpxrhcU4IxKq4yLd95/eDlHIxx6yCXqEAXXzcHgRKzVbxXajx6JfdGUj5w8ApyCfTSBXrqz90uKiyvmzkiymwVs4sNGYWGgtJaKKsDZ3WQv2NUkIufu06tILUm+70SQ06RgSI0qlfwO+M7uuhUsr+VVVwdPW2HVeLQTARACJIM1qF9Qg4tehIAjRw58sCBA5TS+mSaRqO5m5Lq7+e752z6uLlHqF7VXPUZxkgy2U6tHN23vZ+sluXfssxfSi46d6vwbm5VabUZEEq+V5mXWh7WxnNsXPCwLoFRAS7OOhUAXLpTdDIpb/7k+1VZZtvNjPIzN/OXbr3+5aweGKGU3EqrnTmohGBvfUyER+cIz0bBA6cEj1/0+65Ddx8qZ/rz2mCx1rJvybBRPUJz7uVGtWltsVgAgHLOKaUmk2nrls1z5swZ3jUwLNwtI7sKq2iTSkgW9vfXXrry7RjOkbw/Oa/XST3a+vRo69NwcmFFbf+3fzm1fJS3i7ZBVzPOu7Xxjo30FO9XBmmUQs9on9Ia07gBoa+MiG4mBmYEYxntoSs5u46mUL2ypVUx2yIjPIbGBiKEtmzeZDabZVkmDRo4MzPjpZdnaNQqgaKDpzOIWtGk9uMcqFLIz65UaoW4dr5yZFef8gLgjEsygwMgStxJqwzxc5q16uzwroFatWAXGdQz0gjjeh9H9rH2Xcj6cuf1je8PVFAiLyO7/yPrH4IRB44RLjeYnvzwYJ1FAtIC0YdZnfWLmd1iI71ra+teeGG63BfDOSf1fxFSVVUVHBzUsWPHNq2cd12+V1FehwXStMLnnCjpqYS87u28wnyd7CKTRRrdT/ZhjBAgSlBmYc0TIa5ODsrZ354N8tKF+TnJdS2yUpRPBoSWbL+65UTKno+HejhpZCOHG+kt+XTOgTPAGEYvPHIjuYQ4NFuDiTFiZntEuNt3r/UWKFm//udt27bJ2fAHRS3yFJKTk1966WWNWunppNrzeypRNR9nYgSc7z+fNSDG399d14C5seONELpXYpj/8+X5k2M6hrl/se3qscs5EudqlYAR1FrsGQU1u06nL1x/GVO85cNBzlrV5btF/u46/kjelHPOGBCCZq2M33nwruCobqHAFWPMzLY17/VtF+xRV2eaPHlSTU1NA+vyQKQJIRUVFc7OLt27d4sKcD6fXpqZXk7VzWDmgCk2m8W9ZzK7R3sHeelFiTcuSkIISYz7uGqvppfuOJ0+Y3jbyQMiKMEnr+f9cj7r14vZhy7nXLhdpFaQ18e2f2FoFCV49qozrnp1mwAXxqGx8yOx+gzzez+eX7n5uuCkaSEAJgSLBsvguJDF07oCQsuXL9uzZ0/D8v6Jy5JFTa/XJ9+54+3llZZf1fGlnVYJOIZmlxkjuTRu9Tt9pg5uU08G4T/NlWA06YvfrVZxzdt93fT1vU02u0QIbhCK0mrTKyvORAe7LXw29qE7yGGmySbO+OrUlgN3BEeV2HI5r8RVAr6xbnyIj1NBQWHbtlFGo7Fxtw95SBjMZnNBfv4zzzzj5qh21CsPnUynGkVzEQXnQCgWGf/1RFphjWlQTCuBYFFi6P4CyTZvbK/QtPzqj9ddzC01ajUKJ61KraQYIbvE7t6rXHvw9sINl0f0CP5gfKcGCyc/LNm63MopHzX34LFz2YKTWmwxGqQEiwbLyvf6DuoUgBCaPn16UlKSXLzTbDWtXG65c9eucc88A8DHfnZs7+EUwVktiqzlNiOx2ty1k9/a9/q1DXSVHcyGyEnO+ueWGtYfunMlpcRkkyjFSgUR7Qxx3jHMfeZT0QGe+gf2vFEZ7re/3pyz5lJtnU1wULYgyQBAKbZXmsaPbLNj7iAAtH379kmTJj1aQdx0+bCTk1NSUlKrVq1q6qzdX9t7J72capVSy+MRbK+1OmgV85/t/MbY9moFlQWyvn6j0dKVVZtKqsyMc1e9ytdN+2CjymUe90n2S3eK5q27dPpyLmgUlOIWm0nqy4ejI90vrBij0yhycnI6dOhgMBgebV1rtkC8e/fu8fHxlNL0wuoer+4pq7JQNZVaDOLqWdVaW5sI93fHdxjfL1yjpA1bUQ4PG29deTHtEpO97obPr6eXLt99Y9vJdGaTqFbJ/qr1ixAsmu2eLuqL340N9na02+29evW6cuXKYxWIN24BePHFF9euXQsAV1KLB771q9EsURVpGTNCgDEWzXawiWGhbpP7h43pHdo2yPVxqrIqDOYT1/I2H089kpDHTDakVTYU1P4FWovdUSOc+GZU5zBPAJg2bdqGDRv+RgtAY8yffvrpRx99JLe0DH//N6NJlHuV/rKODiEQzSJYRaJTdgh17RXtHRvpGeHv7OWs0WoEBcWMcZNNrDRYc0oMNzPKz98uupRcUlpsBARIoyAE/+UoDWvr6CAc+s/IHm28AWDhwoWffPLJ327yaIx5xYoVr7/+OgBcTikeNedgSblJ0Clb0GEP989JDCwi2CXACFRU66DQqgWlgOXSBkOdXTTZwC4BxqCiVCANSusvD0qx3WD19nTY/8XwmHBPAFi2bNk777zTclseaZGU4YSQw4cPyy3ufm7aET2Dzt4qLMqrETQKDvxx+ucwAFYQqhawgnCEbDapts5WY7Aaam1mq8QAESWlagVWEMCIcXgcrDLjb68yt4/yOPLlyOhAtwa0jX2Mf9KKJ+uww4cPE0Li4uLc9OoJ/cNyKmr/uFXEKaGUPE7HrBwhySdijBDBmGAsZ5P+/O3jHIRgSWTMaJ00ovXuhUN8XLUA8PHHH8+bN+9xmscfr0GRkFOnThUUFAweMkSrVo6NC3Z31569kW8xWKlakPP9f6+LEOAfNGdijDDGosGid1Asfyvui5e6qhSCxWJ9+eWXV6xY8Zit8o8FWI6Zr169Gh8f37t3bxcX19hIz6d6BuWUGlPTyzgHqqD/APbfhSqZ7cxsH947eOcng4fGBgKg9PSM0aOflqmMx2ybJo85JGOMUpqTk7Nt2zY/P7/o6GgPJ83kAWGRwS4puVUlBTWcAxUIbj7n+g8OBPW9QJLZzky26HD3VW/HLXqxq7ujAwBs3rxl7NgxaWlp/5WG6cY+CQBMnDhh0eIvggIDAaDObN1yIu27X27dSisDAFAr5HT+v9ASLzIw2QBBuwj32U9HTx4QrlEpASAzK2vunDm7du2C/2pLfKN6XixJkouLywcffDDzlVl6nRYAzFbbocs5G4+lnkwqMFdbgGBQUiJgjJDMwMu5smaK6xpq8xDjXLIzsIogMY2zqn8Hv+cHRzzZJUClVABATY1h9ervv/zyy6qqqn/2fov/7WstwsPD33zrrYkTJzk56uWvUnMrjibkHk7IvZpWVllhAlECjIFgoBgIakR4gPzqB845SBxEBhIDxkAgLq6amHCPYbH+Q2JbhfvXe2nV1TXbtm1dvnx5RkYG/L98rcWjSw0AwcHBU6dOnTBhYlhY6AMGr9xwM6P8Wnr5H9mVGYU1RZWm6jqbxSqCxIDdp00IUimpk4PS20Ud6uP4RLBLxzC39iFu3m76hvukpaXv2LH9559/zsnJgf+rF5c0jq4aXk2j0WgGDhw4ZszYPn37+vv5PqTpq42WqlpLda2tziLaRYmj+lfTODoonHUqJ63qocnk5uWfPn1q3969x48fN5vN8H/+apqHYGOMG1SlXq/v3Llzz169YmNiIyJb+/r6qFXKv7yJyWwpLCxMSUlJuHLl/PlzV69eletPZCeXMfb/xcuHHhVyAGi8uxwcHAICAkJCQgICA319fF3d3HQ6nfL+66WMBkN5RXlhQUFOTk5WVlZOTo7JZGqsKWSL+C++Xup/AFF93Fbt9VDDAAAAAElFTkSuQmCC" style="width:80px;height:80px;border-radius:50%;margin-bottom:12px;box-shadow:0 4px 16px rgba(6,45,112,.2)"><h1>SIMI NÃ³mina</h1><div class="subtitle">Centro de DistribuciÃ³n Lo Echevers</div>
<div id="fb-loading" style="display:none;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;font-size:11px;color:#6E8298"><div style="width:12px;height:12px;border:2px solid #325BAC;border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite"></div>Conectando con la base de datos...</div>
<style>@keyframes spin{to{transform:rotate(360deg)}}</style>
<div class="fg"><div class="fl">Usuario</div><input class="fi" id="l-u" placeholder="Ingrese su usuario" onkeydown="if(event.key==='Enter')document.getElementById('l-p').focus()"></div>
<div class="fg"><div class="fl">ContraseÃ±a</div><input class="fi" id="l-p" type="password" placeholder="Ingrese su contraseÃ±a" onkeydown="if(event.key==='Enter')doLogin()"></div>
<button class="btn-login" onclick="doLogin()">Ingresar</button>
<div class="login-error" id="l-e"></div>
<div style="text-align:center;margin-top:16px;font-size:10px;color:var(--text3)">Farmacias del Dr. Simi Chile S.A.<br>Sistema de GestiÃ³n de NÃ³mina v6</div>
</div></div>
<div class="toast" id="toast"></div>
<div class="app" id="app">
<aside class="sidebar">
<div class="sh"><div class="sl"><img src="data:image/png;base64,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" style="width:36px;height:36px;border-radius:50%"><div><div class="tt">SIMI NÃ³mina</div><div class="st">Centro DistribuciÃ³n</div></div></div><div style="display:flex;gap:4px;margin-top:8px"><button class="dm-toggle" onclick="openGS()" title="Ctrl+K">ğŸ” Buscar</button><button class="dm-toggle" onclick="toggleDM()" id="dm-btn">ğŸŒ™</button></div></div>
<nav class="sn" id="nav">
<div class="ns">Principal</div>
<div class="ni active" data-p="dashboard" onclick="nav('dashboard')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg>Dashboard</div>
<div class="ni" data-p="nomina" onclick="nav('nomina')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/></svg>NÃ³mina<span class="nb" id="nc"></span></div>
<div class="ns">AnÃ¡lisis</div>
<div class="ni" data-p="resumen" onclick="nav('resumen')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>DotaciÃ³n</div>
<div class="ni" data-p="rotacion" onclick="nav('rotacion')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg>RotaciÃ³n</div>
<div class="ni" data-p="licencias" onclick="nav('licencias')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>Licencias<span class="nb red" id="lc2">0</span></div>
<div class="ni" data-p="vacaciones" onclick="nav('vacaciones')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Vacaciones</div>
<div class="ns">Registros</div>
<div class="ni" data-p="cambios" onclick="nav('cambios')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/></svg>Cambios</div>
<div class="ni" data-p="bajas" onclick="nav('bajas')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" y1="8" x2="23" y2="13"/></svg>Bajas</div>
<div class="ni" data-p="calendario" onclick="nav('calendario')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Calendario</div>
<div class="ni" data-p="auditoria" onclick="nav('auditoria')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>AuditorÃ­a</div>
<div class="ni" data-p="alertas" onclick="nav('alertas')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>Alertas<span class="nb red" id="ac2">0</span></div>
<div class="ni" data-p="reportes" onclick="nav('reportes')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>Reportes</div>
<div class="ni" data-p="organigrama" onclick="nav('organigrama')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><line x1="5" y1="14" x2="19" y2="14"/><line x1="5" y1="14" x2="5" y2="18"/><line x1="12" y1="14" x2="12" y2="18"/><line x1="19" y1="14" x2="19" y2="18"/></svg>Organigrama</div>
<div class="ni" data-p="config" onclick="nav('config')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>Config</div>
</nav>
<div class="su"><div class="avatar" id="sb-a">AT</div><div class="info"><div class="name" id="sb-n">â€”</div><div class="role" id="sb-r">â€”</div></div><span id="sync-dot" title="Estado de sincronizaciÃ³n" style="width:8px;height:8px;border-radius:50%;background:#4CAF50;flex-shrink:0;margin-right:4px;cursor:default"></span><button class="logout" onclick="doLogout()">Salir</button></div>
</aside>
<main class="main">
<div class="page active" id="page-dashboard"><div class="ph"><div><div class="pt">Dashboard Operacional</div><div class="pd">Farmacias Similares Chile â€” CD Lo Echevers</div></div><div style="display:flex;gap:6px"><button class="btn btn-g btn-sm" onclick="resetData()">âŸ² Reset</button></div></div><div class="kg" id="kpi"></div><div class="cg" id="charts"></div><div id="da"></div></div>
<div class="page" id="page-nomina"><div class="ph"><div><div class="pt">NÃ³mina de Colaboradores</div><div class="pd">Click en fila para ver/editar</div></div><div style="display:flex;gap:6px"><button class="btn btn-p" onclick="openAdd()" id="btn-add">+ Nuevo</button><button class="btn btn-e" onclick="exportXLS()">ğŸ“¥ Excel</button><button class="btn btn-g btn-sm" onclick="exportCSV()">CSV</button><button class="btn btn-g btn-sm" onclick="exportReport()">ğŸ“Š Reporte</button><button class="btn btn-g btn-sm" onclick="window.print()">ğŸ–¨ï¸</button></div></div>
<div class="bulk-bar" id="bulk"><span class="cnt" id="bulk-cnt">0 seleccionados</span><span id="bulk-st"></span><button class="btn btn-e btn-sm" onclick="bulkCap()">Cap.D44 âœ“</button><button class="btn btn-g btn-sm" onclick="clearBulk()">âœ• Cancelar</button></div>
<div class="tc"><div class="tt2"><span class="title" id="nt">Colaboradores</span><input type="text" class="sb" id="s-e" placeholder="Buscar..." oninput="fE()"><select class="fs" id="f-d" onchange="fE()"><option value="">Dptos</option></select><select class="fs" id="f-c" onchange="fE()"><option value="">Cargos</option></select><select class="fs" id="f-j" onchange="fE()"><option value="">Jefaturas</option></select><select class="fs" id="f-s" onchange="fE()"><option value="">Status</option><option>ACTIVO</option><option>LICENCIA</option><option>BAJA</option></select><select class="fs" id="f-tc" onchange="fE()"><option value="">Contrato</option><option>INDEFINIDO</option><option>PLAZO FIJO</option></select></div><div class="ts2"><table><thead><tr><th><input type="checkbox" class="cb" onchange="toggleAll(this)"></th><th>COD</th><th>NOMBRE</th><th>RUT</th><th>DPTO</th><th>CARGO</th><th>PUESTO</th><th>C.COSTO</th><th>LÃNEA</th><th>JEFATURA</th><th>INGRESO</th><th>ANTIGÃœEDAD</th><th>CONTRATO</th><th>STATUS</th></tr></thead><tbody id="etb"></tbody></table></div></div><div class="pag"><div class="pag-info" id="pag-info">â€”</div><div class="pag-size"><span>Filas:</span><select id="pag-sz" onchange="pgSz=parseInt(this.value);pgCur=1;fE()"><option value="25">25</option><option value="50" selected>50</option><option value="100">100</option><option value="9999">Todos</option></select></div><div class="pag-btns" id="pag-btns"></div></div></div>
<div class="page" id="page-resumen"><div class="ph"><div><div class="pt">DotaciÃ³n</div><div class="pd">Diferencias por Ã¡rea â€” Faltan / Sobran</div></div><div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" onclick="openNewCargo()">â• Nueva PosiciÃ³n</button><button class="btn btn-g btn-sm" onclick="openEditAuth()">âœï¸ Necesidad</button></div></div>
<div class="kg" id="rk-dot"></div>
<div id="sg"></div>
<div class="cc" style="margin-top:12px"><h3>Resumen por Cargo</h3><div id="cb2"></div></div></div>
<div class="page" id="page-rotacion"><div class="ph"><div><div class="pt">RotaciÃ³n</div><div class="pd" id="rot-info"></div></div><div style="display:flex;gap:6px;align-items:center"><span style="font-size:10px;color:var(--text3)">AÃ±o:</span><select class="fs" id="ry" onchange="rRot()"></select><span style="font-size:10px;color:var(--text3)">Mes:</span><select class="fs" id="rm" onchange="rRot()"><option value="">Todos</option><option value="01">Enero</option><option value="02">Febrero</option><option value="03">Marzo</option><option value="04">Abril</option><option value="05">Mayo</option><option value="06">Junio</option><option value="07">Julio</option><option value="08">Agosto</option><option value="09">Septiembre</option><option value="10">Octubre</option><option value="11">Noviembre</option><option value="12">Diciembre</option></select></div></div><div class="kg" id="rk"></div><div class="cc" style="margin-bottom:20px"><h3>EvoluciÃ³n Mensual â€” Cantidad y Tasa %</h3><div id="rc" style="overflow-x:auto"></div></div><div class="tc" style="margin-bottom:20px"><div class="tt2"><span class="title">Detalle Mensual</span></div><div class="ts2"><table><thead><tr><th>MES</th><th>BAJAS</th><th>TASA %</th><th>CUBIERTAS</th><th>% COB.</th><th>PENDIENTES</th><th>ACUMULADO</th></tr></thead><tbody id="rmt"></tbody></table></div></div><div class="tc"><div class="tt2"><span class="title">Resumen Anual</span></div><div class="ts2"><table><thead><tr><th>AÃ‘O</th><th>BAJAS</th><th>TASA %</th><th>CUBIERTAS</th><th>% COB.</th><th>PENDIENTES</th><th>PROM. MES</th></tr></thead><tbody id="rt"></tbody></table></div></div></div>
<div class="page" id="page-licencias"><div class="ph"><div><div class="pt">GestiÃ³n de Licencias</div><div class="pd" id="lic-info"></div></div><div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" onclick="openNewLic()">â• Nueva Licencia</button><label class="btn btn-g btn-sm" style="cursor:pointer">ğŸ“§ Importar Correo .msg<input type="file" hidden accept=".msg" onchange="parseMsgLic(this)"></label></div></div><div class="kg" id="lk"></div><div class="lg" id="lg"></div><div class="tc" style="margin-top:16px;margin-bottom:16px"><div class="tt2"><span class="title">ğŸ† Ranking HistÃ³rico de Licencias</span></div><div class="ts2"><table><thead><tr><th>#</th><th>NOMBRE</th><th>CARGO</th><th>DPTO</th><th>LICENCIAS</th><th>DÃAS TOTALES</th><th>PROM. DÃAS</th><th>ÃšLTIMA</th><th>ESTADO</th></tr></thead><tbody id="lr"></tbody></table></div></div><div class="tc" style="margin-top:16px"><div class="tt2"><span class="title">Historial Completo</span><input type="text" class="sb" id="lic-q" placeholder="Buscar..." oninput="rLic()"><select class="fs" id="lic-st" onchange="rLic()"><option value="">Todos</option><option value="activa">ğŸŸ¡ Activa</option><option value="vencida">ğŸ”´ Vencida</option><option value="cerrada">âœ… Cerrada</option></select></div><div class="ts2"><table><thead><tr><th>NOMBRE</th><th>CARGO</th><th>DPTO</th><th>INICIO</th><th>TÃ‰RMINO</th><th>DÃAS</th><th>MOTIVO</th><th>ESTADO</th><th></th></tr></thead><tbody id="lt"></tbody></table></div></div></div>
<div class="page" id="page-vacaciones"><div class="ph"><div><div class="pt">GestiÃ³n de Vacaciones</div><div class="pd">15 dÃ­as hÃ¡biles/aÃ±o â€” Ley 21.561 Chile</div></div><div style="display:flex;gap:6px"><button class="btn btn-p" onclick="openVacReq()">+ Solicitud</button><button class="btn btn-e btn-sm" onclick="exportVac()">ğŸ“¥ Reporte</button></div></div><div class="kg" id="vk"></div><div class="tc"><div class="tt2"><span class="title">Registro de Vacaciones</span><input type="text" class="sb" id="sv" placeholder="Buscar..." oninput="rVac()"><select class="fs" id="fvs" onchange="rVac()"><option value="">Estado</option><option>APROBADA</option><option>PENDIENTE</option><option>RECHAZADA</option></select></div><div class="ts2"><table><thead><tr><th>NOMBRE</th><th>DPTO</th><th>DESDE</th><th>HASTA</th><th>DÃAS</th><th>ESTADO</th><th>SALDO</th><th>ACCIONES</th></tr></thead><tbody id="vt"></tbody></table></div></div></div>
<div class="page" id="page-cambios"><div class="ph"><div><div class="pt">Cambios de Cargo</div></div><div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" onclick="openNewCambio()">â• Nuevo Cambio</button></div></div><div class="kg" id="ck"></div><div class="tc"><div class="tt2"><span class="title">Registros</span><input type="text" class="sb" id="s-c" placeholder="Buscar..." oninput="fC()"><select class="fs" id="fc-yr" onchange="fC()"><option value="">Todos</option></select><select class="fs" id="fc-ds" onchange="fC()"><option value="">Doc: Todos</option><option value="ok">âœ… Completo</option><option value="pend">âš ï¸ Pendiente</option></select></div><div class="ts2"><table><thead><tr><th>FECHA</th><th>COD</th><th>NOMBRE</th><th>DPTO</th><th>ANTERIOR</th><th>NUEVO</th><th>JEFATURA</th><th>DOCS</th><th></th></tr></thead><tbody id="ct"></tbody></table></div></div></div>
<div class="page" id="page-bajas"><div class="ph"><div><div class="pt">Registro de Bajas</div></div><div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" onclick="openNewBaja()">â• Nueva Baja</button></div></div><div class="kg" id="bk"></div><div class="tc"><div class="tt2"><span class="title">Bajas</span><input type="text" class="sb" id="s-b" placeholder="Buscar..." oninput="fB()"><select class="fs" id="fb-yr" onchange="fB()"><option value="">Todos</option></select><select class="fs" id="fbs" onchange="fB()"><option value="">Estado: Todos</option><option>CUBIERTO</option><option>NO CUBIERTO</option></select><select class="fs" id="fb-mot" onchange="fB()"><option value="">Motivo: Todos</option></select><select class="fs" id="fb-ds" onchange="fB()"><option value="">Docs: Todos</option><option value="ok">âœ… Completo</option><option value="pend">âš ï¸ Pendiente</option></select></div><div class="ts2"><table><thead><tr><th>FECHA</th><th>RUT</th><th>NOMBRE</th><th>CARGO</th><th>DPTO</th><th>MOTIVO</th><th>STATUS</th><th>DOCS</th><th></th></tr></thead><tbody id="bt2"></tbody></table></div></div></div>
<div class="page" id="page-calendario"><div class="ph"><div><div class="pt">Calendario</div><div class="pd">CumpleaÃ±os y eventos de tu dotaciÃ³n</div></div><div style="display:flex;gap:6px;align-items:center"><button class="btn btn-g btn-sm" onclick="calN(-1)">â—€</button><span id="cm" style="font-weight:700;font-size:13px;min-width:130px;text-align:center"></span><button class="btn btn-g btn-sm" onclick="calN(1)">â–¶</button></div></div><div class="cg"><div class="cc"><h3 id="ct2">Calendario</h3><div class="cal-g"><div class="cal-h">L</div><div class="cal-h">M</div><div class="cal-h">X</div><div class="cal-h">J</div><div class="cal-h">V</div><div class="cal-h">S</div><div class="cal-h">D</div></div><div class="cal-g" id="cg2"></div></div><div class="cc"><h3>Eventos del Mes</h3><div id="ce"></div><div style="margin-top:12px;border-top:1px solid var(--border);padding-top:12px"><h3 style="margin-bottom:8px">Permisos Especiales â€” Art. 56, 65</h3><div id="cp"></div></div></div></div></div>
<div class="page" id="page-auditoria"><div class="ph"><div><div class="pt">Historial de AuditorÃ­a</div><div class="pd" id="aud-count"></div></div><div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" onclick="exportAudXls()">ğŸ“¥ Exportar Excel</button><button class="btn btn-g btn-sm" onclick="clAud()">ğŸ—‘ï¸ Limpiar</button></div></div><div class="kg" id="auk"></div><div class="tc" style="margin-bottom:16px"><div class="tt2"><span class="title">Filtros</span><input type="text" class="sb" id="aud-q" placeholder="Buscar detalle..." oninput="rAud()"><select class="fs" id="aud-usr" onchange="rAud()"><option value="">Todos los usuarios</option></select><select class="fs" id="aud-act" onchange="rAud()"><option value="">Todas las acciones</option></select><select class="fs" id="aud-per" onchange="rAud()"><option value="">Todo el perÃ­odo</option><option value="hoy">Hoy</option><option value="7d">Ãšltimos 7 dÃ­as</option><option value="30d">Ãšltimos 30 dÃ­as</option><option value="90d">Ãšltimos 90 dÃ­as</option></select></div></div><div id="al" style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);max-height:600px;overflow-y:auto"></div></div>
<div class="page" id="page-alertas"><div class="ph"><div><div class="pt">Centro de Alertas</div></div></div><div id="af"></div></div>
<div class="page" id="page-reportes"><div class="ph"><div><div class="pt">Centro de Reportes</div><div class="pd">Genera reportes con rango de fechas</div></div><div style="display:flex;gap:6px;align-items:center"><span style="font-size:10px;color:var(--text3)">Desde:</span><input type="date" class="fi" id="rp-s" style="width:140px"><span style="font-size:10px;color:var(--text3)">Hasta:</span><input type="date" class="fi" id="rp-e" style="width:140px"><button class="btn btn-p" onclick="genReport()">ğŸ“Š Generar</button><button class="btn btn-g btn-sm" onclick="printReport()">ğŸ–¨ï¸</button></div></div><div id="rpt-out"></div></div>
<div class="page" id="page-valorizacion"><div class="ph"><div><div class="pt">ğŸ’° ValorizaciÃ³n de NÃ³mina</div><div class="pd" id="val-info">Tabulador LogÃ­stica 2026 â€” Costo Empresa por Cargo</div></div><div style="display:flex;gap:6px;flex-wrap:wrap"><select class="fs" id="val-area" onchange="rVal()"><option value="">Todas las Ã¡reas</option></select><select class="fs" id="val-esc" onchange="rVal()"><option value="actual">Actual</option><option value="proy">ProyecciÃ³n 2026</option></select></div></div><div class="kg" id="val-kpi"></div><div class="tc" style="margin-bottom:16px"><div class="tt2"><span class="title">Detalle por Cargo â€” Costo Empresa Mensual</span></div><div class="ts2"><table><thead><tr><th>CARGO</th><th>ÃREA</th><th>S.BASE</th><th>C.VENTAS</th><th>BONOS</th><th>IMPONIBLE</th><th>GRAT</th><th>COSTO EMP.</th><th>QTY</th><th>TOTAL MENSUAL</th></tr></thead><tbody id="val-tb"></tbody></table></div></div><div class="tc" style="margin-bottom:16px"><div class="tt2"><span class="title">ğŸ“Š Resumen por Ãrea</span></div><div class="ts2"><table><thead><tr><th>ÃREA</th><th>PERSONAS</th><th>COSTO MENSUAL</th><th>COSTO ANUAL</th><th>% DEL TOTAL</th></tr></thead><tbody id="val-ta"></tbody></table></div></div><div class="tc" style="margin-bottom:16px"><div class="tt2"><span class="title">ğŸ“ˆ Proyecciones de Aumento</span></div><div id="val-proy"></div></div><div class="tc"><div class="tt2"><span class="title">ğŸš€ Proyectos de ExpansiÃ³n</span><button class="btn btn-p btn-sm" onclick="openNewProject()" style="margin-left:auto">+ Crear Proyecto</button></div><div id="val-exp" style="padding:12px"></div></div></div>
<div class="page" id="page-organigrama"><div class="ph"><div><div class="pt">Organigrama LogÃ­stica</div><div class="pd" id="org-info">Estructura organizacional dinÃ¡mica â€” DotaciÃ³n autorizada vs real</div></div><div style="display:flex;gap:6px;flex-wrap:wrap"><button class="btn btn-p btn-sm" onclick="openOrgAdd()">+ Agregar Cargo</button><button class="btn btn-g btn-sm" onclick="resetOrgChart()">â†» Reset</button><button class="btn btn-e btn-sm" onclick="exportOrgImg()">ğŸ“¥ Exportar</button><select class="fs" id="org-view" onchange="rOrg()"><option value="full">Vista Completa</option><option value="compact">Compacta</option></select></div></div><div class="kg" id="org-kpi"></div><div style="overflow:auto;padding:10px 0"><div id="org-tree" style="display:flex;justify-content:center;min-width:100%"></div></div></div>
<div class="page" id="page-config"><div class="ph"><div><div class="pt">ConfiguraciÃ³n</div><div class="pd">GestiÃ³n de usuario y sistema</div></div></div>
<div class="sg">
<div class="sc"><h4>ğŸ”‘ Cambiar ContraseÃ±a</h4><div class="fg"><div class="fl">Actual</div><input type="password" class="fi" id="pw-c"></div><div class="fg"><div class="fl">Nueva</div><input type="password" class="fi" id="pw-n"></div><div class="fg"><div class="fl">Confirmar</div><input type="password" class="fi" id="pw-r"></div><button class="btn btn-p" onclick="changePw()" style="margin-top:6px">Actualizar</button></div>
<div class="sc"><h4>ğŸ‘¥ Usuarios del Sistema</h4><div style="margin-bottom:8px;font-size:10px;color:var(--text3)">Roles: <strong>ADMIN</strong> = Vista completa + gestiÃ³n usuarios | <strong>SUB</strong> = Vista completa, sin gestiÃ³n usuarios | <strong>GESTIÃ“N</strong> = NÃ³mina completa, sin valorizaciÃ³n | <strong>JEFE</strong> = Solo sus departamentos asignados</div><div id="user-list"></div><button class="btn btn-p btn-sm" onclick="openAddUser()" style="margin-top:10px" id="btn-au">+ Agregar Usuario</button></div>
<div class="sc"><h4>ğŸ’¾ Datos</h4><div class="sr"><span class="l">Colaboradores</span><span class="v" id="cfg-e">0</span></div><div class="sr"><span class="l">Bajas</span><span class="v" id="cfg-b">0</span></div><div class="sr"><span class="l">Cambios</span><span class="v" id="cfg-ch">0</span></div><div class="sr"><span class="l">AuditorÃ­a</span><span class="v" id="cfg-a">0</span></div><div class="sr"><span class="l">Vacaciones</span><span class="v" id="cfg-v">0</span></div><div style="margin-top:10px;display:flex;gap:6px"><button class="btn btn-d btn-sm" onclick="resetData()">âŸ² Reset completo</button><button class="btn btn-e btn-sm" onclick="exportAll()">ğŸ“¦ Backup JSON</button><button class="btn btn-p btn-sm" onclick="document.getElementById('imp-f').click()">ğŸ“‚ Importar</button><input type="file" id="imp-f" accept=".json" style="display:none" onchange="importBackup(this)"></div></div>
</div></div>
</main></div>
<div class="mo" id="modal" style="display:none" onclick="if(event.target===this)clM()"><div class="md"><div class="mh"><h2 id="mt">â€”</h2><button class="mc" onclick="clM()">Ã—</button></div><div class="mb" id="mbd"></div></div></div>
<script>
const SD={"e":[{"i":1,"n":"ALCAYAGA NOVOA JAMES ARMANDO","r":"018.763.899-2","c":"5894","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"UULL","p":"UULL","j":"JAVIER FUENTES","in":"2025-03-25","dir":"JESUS OBRERO, 574","com":"QUILICURA","tel":"","nac":"1993-12-24","ma":"james_15@live.cl","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":2,"n":"ABARCA MARTINEZ OSCAR EDGARDO","r":"011.648.095-6","c":"4350","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2022-06-20","dir":"Alcalde Juan Segundo romo, 0169 Jardin del Sol III, Quilicura","com":"Quilicura","tel":"9-88947228","nac":"1970-12-11","ma":"GALO0169@GMAIL.COM","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":3,"n":"ABARCA MEDINA FRANCISCO MIGUEL","r":"012.853.769-4","c":"5406","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2024-08-01","dir":"Pasaje los pimientos casa NÂ°29","com":"LAMPA","tel":"","nac":"1975-07-04","ma":"pancho35@hotmail.cl","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":4,"n":"ACEVEDO OSSES JUAN LUIS","r":"009.909.617-9","c":"3390","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2019-04-01","dir":"Pasaje Holanda # 3930","com":"CONCHALI","tel":"9-89835858","nac":"1967-04-02","ma":"Juanluis.acevedo@hotmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":5,"n":"ACUÃ‘A VASQUEZ ANDREA SOLANGE","r":"021.039.385-4","c":"5105","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-02-14","dir":"AV. LO MARCOLETA #0748","com":"PUDAHUEL","tel":"940428314","nac":"2002-06-02","ma":"ANDREAXD022@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":6,"n":"AGUILERA HERRERA AROL ANTONIO","r":"018.925.390-7","c":"5630","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2025-11-22","dir":"maitencillo 556 Quilicura","com":"Quilicura","tel":"","nac":"1994-08-31","ma":"aguileraarol@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":7,"n":"AGUILERA MARTINEZ HUGO IGNACIO","r":"018.625.948-3","c":"4622","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"SEREMI","p":"ALMACEN","j":"MARITZA VALENZUELA","in":"2023-03-13","dir":"Valle Batuco Sur pasaje los chewigues casa 13","com":"LAMPA","tel":"9-35120578","nac":"1993-10-30","ma":"hugoignacioaguilera.m@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":8,"n":"AGUILERA MORALES MERCEDES TABITA","r":"011.209.253-6","c":"4031","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2021-06-14","dir":"Estero Colcura NÂº 53, Quilicura, Santiago","com":"QUILICURA","tel":"9-31059297","nac":"1967-07-29","ma":"tabitaaguilera1@gmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":9,"n":"AGUILERA RIQUELME GUILLERMO ERNESTO","r":"011.814.037-0","c":"5795","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2025-02-04","dir":"Los Mercedarios 753, Departamento D-24, Quilicura,","com":"QUILICURA","tel":"","nac":"1971-06-04","ma":"Aguileraguillermo410@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":10,"n":"ALLENDE CORVALAN RODRIGO IGNACIO","r":"021.385.244-8","c":"5715","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2003-09-10","dir":"","com":"","tel":"","nac":"2003-09-10","ma":"Rodriallendecorv7@Gmail.Com","tc":"INDEFINIDO","an":22.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":11,"n":"ALVARADO SANTANA CLAUDIO JAVIER","r":"016.556.215-1","c":"4226","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"UULL","p":"UULL","j":"GABRIEL JARA","in":"2022-03-07","dir":"Salar del Carmen 350, Quilicura","com":"QUILICURA","tel":"9-84156796","nac":"1987-10-06","ma":"claudioal10@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":12,"n":"ALVAREZ CORTES VANESSA FABIOLA","r":"019.801.870-8","c":"3275","d":"CD ISP","ca":"CONTROLADOR","l":"CONTROLADOR","p":"CONTROLADOR","j":"GABRIEL JARA","in":"2018-11-26","dir":"Corona Sueca # 8420, PoblaciÃ³n Santa Corina","com":"PUDAHUEL","tel":"9-56126339","nac":"1997-11-28","ma":"vanessaantonelita013@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":13,"n":"ALVAREZ ULLOA IVAN ANDRES","r":"016.374.343-4","c":"5332","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-06-10","dir":"03 DE MAYO, 2685 DPTO 502","com":"INDEPENDENCIA","tel":"","nac":"2024-07-26","ma":"alvarez.ivan316@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":14,"n":"ARANCIBIA SEPULVEDA MATIAS ALEJANDRO","r":"021.121.971-8","c":"5538","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - ALMACEN","j":"GABRIEL JARA","in":"2024-10-10","dir":"PASAJE OSA MAYOR 532","com":"QUILICURA","tel":"","nac":"2002-09-01","ma":"arancibiamatias451@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":15,"n":"ARAVENA DONOSO JUAN CARLOS","r":"020.496.021-6","c":"5064","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-02-01","dir":"RIO RAHUE, 760","com":"QUIlicura","tel":"","nac":"2000-07-23","ma":"juancarlosaravena2000@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":16,"n":"ARCE CORTEZ CONSTANZA ESTER","r":"019.342.881-9","c":"4504","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2023-01-03","dir":"La Isla casa 1, Av. EspaÃ±a, Batuco","com":"LAMPA","tel":"9-33364481","nac":"1996-05-20","ma":"coniarce16@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":17,"n":"ARIAS CARRASCO RODRIGO ANDRES","r":"019.671.617-3","c":"2853","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2017-10-10","dir":"Pasaje Alaska # 980","com":"PUDAHUEL","tel":"9-44043913","nac":"1997-07-29","ma":"ro9590798@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":18,"n":"AROCA ALVAREZ RONNY OMAR","r":"028.059.438-5","c":"6261","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2025-09-24","dir":"PASAJE 25 DE NOVIEMBRE, 65","com":"LAMPA","tel":"","nac":"1989-01-12","ma":"RONNYAROCAALVAREZ@GMAIL.COM.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":19,"n":"AROS MILLA JEANNETTE ELISA","r":"011.626.645-8","c":"1564","d":"CD ISP","ca":"CONTROLADOR","l":"CONTROLADOR","p":"CONTROLADOR","j":"GABRIEL JARA","in":"2013-05-23","dir":"Rublo Ruso NÂ° 709","com":"PUDAHUEL","tel":"9-59515165","nac":"1970-01-10","ma":"jeannette.aros.milla@gmail.com","tc":"INDEFINIDO","an":12.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":20,"n":"BASSO SILVA JUAN CARLOS","r":"015.389.990-8","c":"6345","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"UULL","p":"UULL","j":"GABRIEL JARA","in":"2025-11-12","dir":"filomena Garate, 1194","com":"QUILICURA","tel":"","nac":"1984-03-01","ma":"Juancarlosbassosilva1984369@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":21,"n":"BENITEZ MENDOZA CARLOS EDUARDO","r":"027.470.149-8","c":"5684","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"ELASTICADO","j":"MARITZA VALENZUELA","in":"2024-12-13","dir":"AVENIDA ISLA DECEPCION, 105","com":"LO PRADO","tel":"","nac":"2001-09-15","ma":"carlos.eduardobenitez15@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":22,"n":"BETANCOURT LORCA SUSANA","r":"015.414.252-5","c":"6405","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-12-04","dir":"CANUTILLAR 460 DEPTO G22 VILLA SAN FERNANDO","com":"QUILICURA","tel":"","nac":"1982-08-17","ma":"","tc":"","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":23,"n":"BLANCO BOROA ROSA DEL CARMEN","r":"007.624.188-0","c":"3007","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2018-01-24","dir":"Jose Miguel Carrera # 047","com":"QUILICURA","tel":"9-73104122","nac":"1955-05-04","ma":"Rosablanco540@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":24,"n":"BLANCO GAUNES AXEL ARIEL","r":"012.290.416-4","c":"4377","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2022-08-01","dir":"Santos Dummmont 815, dpto 2001","com":"RECOLETA","tel":"9-35393537","nac":"1987-08-30","ma":"arielgaunes@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":25,"n":"BUSTAMANTE YAÃ‘EZ CRISTOBAL ROBERTO","r":"021.676.056-5","c":"4828","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"SOPORTE","p":"TRANSPORTE","j":"JAVIER FUENTES","in":"2023-08-07","dir":"pasaje panguipulli, 1361","com":"PUDAHUEL","tel":"","nac":"2004-12-18","ma":"robertoyanez281@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":26,"n":"BUSTOS TORO ROMINA NATALY","r":"016.516.838-0","c":"5647","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-12-03","dir":"Calle Rio Rahue 5191","com":"RENCA","tel":"","nac":"1986-08-17","ma":"bustostororominanataly@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":27,"n":"CALFUQUEO HUENCHULLAN SARA DEL CARMEN","r":"011.989.658-4","c":"3078","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"ELASTICADO","j":"MARITZA VALENZUELA","in":"2018-04-05","dir":"Pasaje Parroquia San Lazaro # 686, Block C, Dpto. 22","com":"QUILICURA","tel":"9-79014348","nac":"1972-03-25","ma":"saraderigo18@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":28,"n":"CAMPOS ZAMBRANO ESTEBAN GUSTAVO","r":"013.445.334-6","c":"6457","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Pasaje Valle del Encanto, 699","com":"LAMPA","tel":"","nac":"1978-06-27","ma":"Estebancamposz78@Gmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":29,"n":"CANALES ARAYA GERARDO RODOLFO","r":"013.083.607-0","c":"3652","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2020-02-05","dir":"Venecia # 6680","com":"LA GRANJA","tel":"9-86427740","nac":"1976-07-31","ma":"rodolfocanalesaraya31@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":30,"n":"CANCINO YAÃ‘EZ CAMILA FERNANDA","r":"019.828.741-5","c":"6392","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2025-12-01","dir":"ANA HANGA KOE, 1280","com":"PUDAHUEL","tel":"","nac":"1997-10-31","ma":"Cancinoyanez.Camila@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":31,"n":"CARDONA GONZALEZ JOHN ANDERSON","r":"024.077.546-8","c":"4905","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"SOPORTE","p":"SOPORTE","j":"JAVIER FUENTES","in":"2023-10-23","dir":"Avda Lazo, 1365 Dpto 1610","com":"san miguel","tel":"9-76733737","nac":"1993-12-20","ma":"johnandersoncardona@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":33,"n":"CARRILLO VASQUEZ NOEMI ALEJANDRA","r":"015.424.072-1","c":"6417","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-12-12","dir":"PASAJE TOKIO, 988","com":"QUILICURA","tel":"","nac":"1982-09-25","ma":"Noemicarrillo1982@Gmail.Com","tc":"","an":2025.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":34,"n":"CASTAÃ‘EDA ECHEVERRI ORLANDO","r":"025.221.518-2","c":"5566","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2024-10-22","dir":"PASAJE PERVEN 1414","com":"LAMPA","tel":"","nac":"1974-06-06","ma":"ORLEANS1983253@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":35,"n":"CASTILLO CESPEDES JAQUELINE ANDREA","r":"014.189.990-2","c":"6418","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-12-12","dir":"Santillana del Mar 0462","com":"QUILICURA","tel":"","nac":"1971-03-12","ma":"Holypatience@Gmail.Com","tc":"","an":2025.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":36,"n":"CASTRO CARRASCO CAMILA ALEJANDRA","r":"020.246.456-4","c":"6389","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2025-12-01","dir":"MANAGUA, 694","com":"QUILICURA","tel":"","nac":"2002-12-09","ma":"Camiicastro2002@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":37,"n":"CASTRO CORDERO LORENZO CRISTIAN","r":"010.739.243-2","c":"3961","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2021-03-01","dir":"Gral. Gambino 4606","com":"CONCHALI","tel":"9-33922923","nac":"1966-05-22","ma":"lcccdtaa@gmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":38,"n":"CASTRO HERRERA ESTEBAN ALEJANDRO","r":"012.903.589-7","c":"5648","d":"CD ISP","ca":"ENCARGADO DE AREA CD","l":"PRE-EMBARQUE","p":"ENCARAGADO DE  AREA CD","j":"GABRIEL JARA","in":"2024-12-03","dir":"Pasaje Managua #694,","com":"QUILICURA","tel":"","nac":"1975-03-01","ma":"estebancastro_@hotmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":39,"n":"CERDA CUMIAN MARCOS ALEJANDRO","r":"017.577.181-6","c":"4095","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2021-11-02","dir":"PEDRO AMENGUAL 1248 VILLA LOS CLAVELES IV","com":"MAIPU","tel":"9-65092897","nac":"1990-06-21","ma":"marcoscerda063@gmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":40,"n":"CIGNA PUNOÃ‘ANCO NICOLAS IGNACIO","r":"019.548.177-6","c":"4979","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2023-12-13","dir":"SOTAQUI, 439","com":"QUILICURA","tel":"","nac":"1997-05-30","ma":"nicolascigna75@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":41,"n":"CODOCEO GONZALEZ SEBASTIAN ERIK","r":"016.392.122-7","c":"4826","d":"CD ISP","ca":"ENCARGADO DE AREA CD","l":"ALMACEN","p":"ENCARGADO DE AREA CD","j":"GABRIEL JARA","in":"2023-08-07","dir":"isla navarino, 499","com":"PUDAHUEL","tel":"","nac":"1986-01-20","ma":"cesv18@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":42,"n":"COLOMA ZAPATA ANA ANGELICA","r":"08.513.948-7","c":"6082","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-06-23","dir":"Pasaje Puerto Elvira #0631","com":"QUILICURA","tel":"","nac":"1969-10-20","ma":"anaangelicacolomazapata@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":43,"n":"CONTRERAS ARRIAGADA ELVIS HUMBERTO","r":"019.558.678-0","c":"5608","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2024-11-12","dir":"corona sueca / gabriela mistral","com":"Pudahuel","tel":"","nac":"1997-01-06","ma":"elvis.contreras.a97@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":44,"n":"CONTRERAS PEREZ BERNARDO ANTONIO","r":"007.629.319-8","c":"4857","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2023-09-14","dir":"Av.Manuel Antonio Matta, 170","com":"QUILICURA","tel":"","nac":"1958-04-30","ma":"ber.contrerasper@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":45,"n":"CORDOVA ALVAREZ ALVARO MARCELINO","r":"016.952.329-0","c":"4157","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2022-01-10","dir":"Mi Esperanza , 2580 depto 140B, Cerrillos","com":"CERRILLOS","tel":"9-31206203","nac":"1988-07-01","ma":"alvarocordovaalvarez@outlook.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":46,"n":"CORTES CORTES JOSE ALEJANDRO","r":"013.424.832-7","c":"5718","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2024-12-20","dir":"","com":"","tel":"","nac":"1978-06-17","ma":"sepultura3000@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":47,"n":"CORTES MACHUCA CLAUDIA VERONICA","r":"015.019.499-7","c":"4034","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2021-06-14","dir":"Pasaje Rupanco NÂº 1336, Pudahuel, Santiago","com":"PUDAHUEL","tel":"9-35224226","nac":"1982-03-26","ma":"candy_82_@hotmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":48,"n":"DAVILA AGUILAR CLAUDIO DANIEL","r":"011.491.324-3","c":"4333","d":"CD SEREMI - INSUMOS","ca":"ASISTENTE","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2022-06-06","dir":"El Maiten, 551, Quilicura","com":"QUILICURA","tel":"9-59280058","nac":"1969-11-15","ma":"cdavila1969@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":49,"n":"DAVILA GONZALEZ PAMELA KARINA","r":"017.255.367-2","c":"5708","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"SOPORTE 1BIT","p":"SOPORTE 1BIT","j":"JAVIER FUENTES","in":"2024-12-20","dir":"DEL FERROCARRIL, 7539","com":"MAIPU","tel":"","nac":"1989-12-13","ma":"davila.pamela.k@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":50,"n":"DIAZ GOMEZ CRISTIAN GABRIEL","r":"016.345.031-3","c":"2957","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2017-12-11","dir":"Isla Nueva # 637","com":"LO PRADO","tel":"9-45093391","nac":"1986-04-02","ma":"elduguebeats@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":51,"n":"DIAZ HUIRIQUEO ALEX ANTONIO","r":"020.693.974-5","c":"5893","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"INVENTARIO","p":"INVENTARIO","j":"ANGEL TRAIPE","in":"2025-03-25","dir":"Proton 4912, EstaciÃ³n Centra, Santiago","com":"ESTACION CENTRAL","tel":"","nac":"2001-04-19","ma":"Huiriqueo123@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":52,"n":"DONOSO ARAVENA DAVID ALEXANDER","r":"021.381.413-3","c":"6520","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"SEREMI","p":"ELASTICADO","j":"","in":"2026-02-06","dir":"Av. Carrascal 5019","com":"QUINTA NORMAL","tel":"","nac":"2003-09-03","ma":"Donosod52@Gmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":53,"n":"DONOSO MADRID LUIS ESTEBAN","r":"018.851.495-2","c":"3304","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2019-01-02","dir":"Miguel de Atero # 2781","com":"QUINTA NORMAL","tel":"9-78445204","nac":"1995-02-16","ma":"luisestebandonoso16@gmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":54,"n":"DURAN RIVAS MARJORIE ALEJANDRA","r":"013.032.617-k","c":"3865","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2020-10-19","dir":"viana nÂ°1626","com":"CERRO NAVIA","tel":"9-44450564","nac":"1976-08-31","ma":"graciosa7933@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":55,"n":"DURUZ SALGADO MICHEL ALEXANDRE","r":"016.008.691-2","c":"5306","d":"ADM-XD","ca":"CHOFER","l":"TRANSPORTE","p":"CHOFER (XD)","j":"JAVIER FUENTES","in":"2024-05-27","dir":"Pasaje Fresia 01672, Coronel","com":"CONCEPCION","tel":"","nac":"1989-03-20","ma":"michel.duruz@virginiogomez.cl","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":56,"n":"ESPINOZA CONCHA ALEXIS IVAN","r":"018.811.964-6","c":"5312","d":"ADM-XD","ca":"AUXILIAR DE BODEGA","l":"XD CONCEPCION","p":"AUXILIAR DE BODEGA","j":"JAVIER FUENTES","in":"2024-06-03","dir":"Camino Ã±onguen 27, ConcepciÃ³n","com":"CONCEPCION","tel":"","nac":"1995-01-06","ma":"alexis.espinozaconcha@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":57,"n":"ESPINOZA ESPINOZA SERGIO ALEJANDRO","r":"016.266.870-6","c":"3593","d":"CD SEREMI - INSUMOS","ca":"COORDINADOR DE LOGISTICA","l":"INSUMOS","p":"COORDINADOR DE LOGISTICA CD (INSUMOS)","j":"MARITZA VALENZUELA","in":"2019-12-16","dir":"Silverio Villanueva # 5485","com":"MAIPÃš","tel":"9-57714685","nac":"1985-10-14","ma":"sergioespinozae@live.cl","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":58,"n":"ESTOBAR ALEGRIA MARCO ANTONIO","r":"015.821.398-2","c":"6022","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2025-05-27","dir":"ANDES, 9157","com":"PUDAHUEL","tel":"","nac":"1984-09-24","ma":"marcoestobar4@gmail.com","tc":"INDEFINIDO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":59,"n":"FUENTEALBA MACHUCA LUIS SEBASTIAN","r":"019.196.006-8","c":"4609","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"SOPORTE","p":"UULL","j":"JAVIER FUENTES","in":"2023-03-06","dir":"Elisa saval prado 21","com":"QUILICURA","tel":"9-85222674","nac":"1995-06-28","ma":"sebastianfuentealba.24@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":60,"n":"FUENTES ESPINOZA PEDRO WLADIMIR","r":"016.601.749-1","c":"5593","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-11-06","dir":"LogroÃ±o #4838, Conchali, Santiago","com":"CONCHALI","tel":"","nac":"1988-01-01","ma":"pedrowladimirfuentesespinoza@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":61,"n":"FUENTES HERMOSILLA JAVIER EDGARDO","r":"017.570.363-2","c":"6117","d":"ADM-TRANSPORTE","ca":"JEFE DE AREA CD","l":"TRANSPORTE","p":"JEFE DE AREA CD (transporte)","j":"DAGOBERTO SANHUEZA","in":"2025-07-10","dir":"VICENTE REYES , 7","com":"MAIPU","tel":"9-4569695","nac":"1990-04-27","ma":"0","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":62,"n":"GAETE FERRADA BENJAMIN IGNACIO","r":"021.820.501-1","c":"6423","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - ALMACEN","j":"GABRIEL JARA","in":"2025-12-12","dir":"Parinacota #515, Dpto B11","com":"QUILICURA","tel":"","nac":"2005-04-01","ma":"Benjinappa@Gmail.Com","tc":"","an":0.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":63,"n":"Gallardo Vergara Mauricio Andres","r":"008.535.178-8","c":"4822","d":"CD MANTENCION","ca":"AUXILIAR DE MANTENCION","l":"CEDIS","p":"AUXILIAR DE MANTENCION","j":"DAGOBERTO SANHUEZA","in":"2023-08-02","dir":"0","com":"0","tel":"0","nac":"00:00:00","ma":"0","tc":"","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":64,"n":"GALLEGUILLOS RIQUELME VICENTE IGNACIO","r":"022.352.844-9","c":"5895","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-03-25","dir":"Pasaje Bach 187, Quilicura","com":"QUILICURA","tel":"","nac":"2007-03-17","ma":"Vichogalleguillos02@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00027"},{"i":65,"n":"GARCIA GARCES SILVIA ISABEL","r":"013.106.889-1","c":"3302","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2019-01-02","dir":"Eliza Alvarez # 517","com":"QUILICURA","tel":"9-90852705","nac":"1976-08-16","ma":"garciagarcessilvia@gmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":66,"n":"GARCIA SOTO ANDRE EMILIO","r":"020.258.200-1","c":"5461","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-09-03","dir":"LAUTARO, 146 VILLA ICALMA","com":"CONCEPCION","tel":"","nac":"2000-01-10","ma":"ndrgarciasoto@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":67,"n":"GESSEL ASCENCIO VERONICA ELIZABETH","r":"015.351.478-K","c":"5628","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"CONTROLADOR","p":"CONTROLADOR","j":"GABRIEL JARA","in":"2025-11-22","dir":"Julio Duran Neuman, 0147","com":"QUILICURA","tel":"","nac":"1982-09-22","ma":"vgelizabeth.2005@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":68,"n":"GOMEZ GOMEZ MIGUEL ERNESTO","r":"027.072.489-2","c":"6028","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-06-02","dir":"poniente las torres 105","com":"quilicura","tel":"","nac":"1998-01-24","ma":"Miguelgomez240198@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":69,"n":"GOMEZ HURTADO JOSE FABIAN","r":"025.185.111-5","c":"4871","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2023-09-25","dir":"IÃ±aki #1721","com":"QUILICURA","tel":"9-39485846","nac":"1992-04-23","ma":"josegomezhurtado0423@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":70,"n":"GONZALEZ BECERRA DIEGO IGNACIO","r":"018.746.326-2","c":"5411","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-08-01","dir":"San Luis NÂ° 530, Dpto A-14,","com":"QUILICURA","tel":"","nac":"1995-10-20","ma":"diegogonzalezbe@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":71,"n":"GONZALEZ CORTES LORNA JOHANNA","r":"014.152.215-9","c":"4969","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2023-12-06","dir":"Pedro riveros, 1940, depto 32 torre F, Quilicura","com":"QUILICURA","tel":"9-67280642","nac":"1981-06-22","ma":"gonzalezlonra@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":72,"n":"GONZALEZ INOSTROZA LUIS ORLANDO","r":"010.004.442-0","c":"3048","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2018-03-05","dir":"Volcan Llaima # 349","com":"QUILICURA","tel":"9-46749917","nac":"1966-03-31","ma":"lgonzalez@farmaciasdoctorsimi.cl","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":73,"n":"GONZALEZ LOBOS CECILIA MARJORIE","r":"018.097.000-2","c":"4813","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2023-08-01","dir":"vucuÃ±a mackenna, 1562 dpto 111","com":"RENCA","tel":"","nac":"1992-04-28","ma":"sofiapulgar68@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":74,"n":"GONZALEZ MORALES INES DEL ROSARIO","r":"011.122.178-2","c":"4135","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2021-12-20","dir":"Las Violetas # 260 depto 31 Block B Quilicura","com":"QUILICURA","tel":"9-84219292","nac":"1967-02-24","ma":"inesgm2402@gmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":75,"n":"GONZALEZ SILVA DIEGO RICHARDS","r":"016.831.525-2","c":"6416","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2025-12-12","dir":"Gumercindo Vargas 1224","com":"CERRO NAVIA","tel":"","nac":"1988-04-29","ma":"Diego.Richards.Gsx@Gmail.Com","tc":"","an":0.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":76,"n":"GUERRA BLANCO ISAIAS JACOB","r":"017.424.952-0","c":"4878","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2023-10-02","dir":"Estero Ablemo, 077","com":"QUILICURA","tel":"","nac":"1989-09-30","ma":"guerrablancoisaiasjacob@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":77,"n":"GUTIERREZ GATICA MARIA ALEJANDRA","r":"013.683.863-6","c":"6461","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Pasaje Perven, 1414","com":"LAMPA","tel":"","nac":"1979-10-13","ma":"Alejag2009@Hotmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":78,"n":"GUTIERREZ TORO FELIPE ENRIQUE","r":"020.127.864-3","c":"4244","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2022-03-21","dir":"Alfredo lobos, 2741, recoleta","com":"RECOLETA","tel":"9-57159884","nac":"1998-12-14","ma":"gutierrestorofelipe@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":79,"n":"HERNANDEZ MONTANO JOSE MANUEL","r":"016.956.118-4","c":"3573","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2019-11-25","dir":"Avenida San Luis # 394, Dpto. 19, Brisas del Valle","com":"LAMPA","tel":"9-76133140","nac":"1989-03-04","ma":"Manuelhernandezm1989@gmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":80,"n":"HERNANDEZ RIVANO LEANDRO RODRIGO","r":"019.984.118-1","c":"6370","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2025-11-20","dir":"AV. LA MARINA, 2447","com":"PEDRO AGUIRRE CERDA","tel":"","nac":"1998-06-30","ma":"zleoc2327@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":81,"n":"HERRERA TAPIA DAVID NATANAEL","r":"019.094.165-5","c":"5251","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2024-05-02","dir":"SAN PABLO, 9190 DPTO 104","com":"PUDAHUEL","tel":"","nac":"1995-05-24","ma":"david.herrera.tapia@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":83,"n":"JARA PINTO GABRIEL ANDRES","r":"018.882.231-2","c":"2145","d":"CD ISP","ca":"JEFE DE AREA CD","l":"JEFE DE AREA CD","p":"JEFE DE AREA CD","j":"ANGEL TRAIPE","in":"2015-08-03","dir":"Valle Batuco Norte #2641 dep 23c","com":"PEDRO AGUIRRE CERDA","tel":"9-51683905","nac":"1994-09-28","ma":"gabrieljara5@gmail.com","tc":"INDEFINIDO","an":10.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":84,"n":"JARA ROCHA CRISTOPHER ALEXIE","r":"016.167.252-1","c":"3624","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2020-01-13","dir":"Psj Parque de las Flores # 2321","com":"PUENTE ALTO","tel":"9-95825350","nac":"1985-04-25","ma":"cristopher.jara25@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":85,"n":"LABRAÃ‘A TOBAR OCTAVIO MAURICIO","r":"013.245.252-0","c":"4825","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2023-08-07","dir":"blanco fombona, 2164 dpto 209","com":"INDEPENDENCIA","tel":"931233500","nac":"1977-09-13","ma":"omlabrana.77@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":87,"n":"LANAU AGUILAR JORGE ENRIQUE","r":"027.065.636-6","c":"6278","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2025-10-06","dir":"SAN PABLO, 4050","com":"QUINTA NORMAL","tel":"","nac":"1980-11-28","ma":"JLANAU@GMAIL.COM","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":88,"n":"LARA ZUÃ‘IGA MATIAS IGNACIO","r":"019.636.264-9","c":"5234","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2024-04-19","dir":"VOLCAN QUETRUPILLA, 0390","com":"QUILICURA","tel":"","nac":"2024-05-20","ma":"MIGNACIO.LARA.Z@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":89,"n":"LEON ACUÃ‘A RAFAEL ALEJANDRO","r":"011.131.144-7","c":"6519","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"","in":"2026-02-06","dir":"Estero Codegua 0122","com":"QUILICURA","tel":"","nac":"1967-08-20","ma":"R.Leonacuna@Gmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":90,"n":"LEON TRUJILLO GENESIS FRANCISCA","r":"018.676.113-8","c":"5408","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-08-01","dir":"Alcalde Mario Riquelme NÂ° 250,","com":"LAMPA","tel":"","nac":"1994-05-02","ma":"ALEXLEONTRUJILLO1996@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":91,"n":"LIEMPI MILLANAO ALEX RODRIGO","r":"021.198.057-5","c":"6105","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2025-07-04","dir":"NELSON CASTRO GONZALEZ, 581","com":"QUILICURA","tel":"","nac":"2002-12-23","ma":"Liempialex23@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":92,"n":"LLANCA CHIGUAY JOSE IGNACIO","r":"021.129.193-1","c":"5331","d":"CD ISP","ca":"ASISTENTE","l":"WMS","p":"WMS","j":"ANGEL TRAIPE","in":"2024-06-10","dir":"","com":"","tel":"","nac":"","ma":"","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":93,"n":"LOBOS MONTES JOSE LUIS","r":"020.034.321-2","c":"4925","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - ALMACEN","j":"GABRIEL JARA","in":"2023-11-06","dir":"Puerto Antofagasta, 835","com":"QUILICURA","tel":"","nac":"1998-12-06","ma":"joselobos674@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":94,"n":"LOPEZ CASTRO JUAN JOSE","r":"018.950.131-5","c":"6404","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-12-04","dir":"RIGOBERTO JARA 0256","com":"QUILICURA","tel":"","nac":"1995-04-15","ma":"","tc":"","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":95,"n":"LOPEZ HIDALGO CLAUDIO MATIAS","r":"021.333.943-5","c":"6112","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-07-23","dir":"LAUTARO, 7949","com":"SAN PEDRO DE LA PAZ","tel":"","nac":"2003-06-30","ma":"Claudio.Lops77@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":96,"n":"LORENZO TREJO HAYDEE NELLY","r":"025.591.747-1","c":"5682","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-12-13","dir":"JUAREZ LARGA, 743","com":"RECOLETA","tel":"","nac":"1973-06-14","ma":"haydeelorenzo167@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":97,"n":"LOUIS  WILSON","r":"025.938.447-8","c":"2591","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2017-01-25","dir":"Doctor Vargas Salsedo # 1652","com":"CERRILLOS","tel":"9-84935825","nac":"1985-02-25","ma":"wilsonjoseph2222@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":98,"n":"LOZANO ALARCON CARLOS JOHANAN","r":"022.106.704-5","c":"6027","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-06-02","dir":"pasaje leo, 0533 Quilicura","com":"Quilicura","tel":"","nac":"2025-04-26","ma":"Lozanoc676@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":99,"n":"LUARTE CALDERON MAXIMILIANO ALFREDO","r":"021.764.884-k","c":"5354","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-07-01","dir":"Estero nifre, 0206","com":"QUILICURA","tel":"","nac":"2005-01-24","ma":"maximiliano.luarte1@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":100,"n":"MACHUCA GONALEZ DEYANIRA ALEJANDRA","r":"021.229.473-K","c":"5061","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-09-23","dir":"","com":"","tel":"","nac":"","ma":"","tc":"PLAZO FIJO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":101,"n":"MANCILLA TOLEDO JUAN CARLOS","r":"007.417.885-5","c":"5685","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-12-13","dir":"AMERCIO VESPUCIO N 1456","com":"QUILICURA","tel":"","nac":"1958-09-17","ma":"jcmancilla1@hotmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":102,"n":"MARTIN ARROYO MAURICIO ALEXANDER","r":"018.423.076-3","c":"6458","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"El Crepusculo 637","com":"QUILICURA","tel":"","nac":"1992-09-06","ma":"Martinmauricio9206@Gmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":103,"n":"MARTINEZ CARCAMO VICTOR MANUEL","r":"014.256.903-5","c":"4858","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2023-09-14","dir":"Recife, 1064","com":"QUILICURA","tel":"","nac":"1974-06-16","ma":"victorioso74@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":104,"n":"MARTINEZ HERNANDEZ JORGE HERNAN","r":"010.485.413-3","c":"3243","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"CONTROLADOS","j":"GABRIEL JARA","in":"2018-10-08","dir":"LISZT #3055, VILLA LAS FLORES","com":"SAN JOAQUÃN","tel":"9-97177538","nac":"1969-06-01","ma":"jhmartinezh91@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":105,"n":"MATTA MUÃ‘OZ MAX ALONSO","r":"020.042.454-9","c":"4446","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2022-10-25","dir":"RIO MAYO, 556","com":"CERRILLOS","tel":"9-42137566","nac":"1999-01-13","ma":"ignacio.matta23@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":106,"n":"MATURANA MARTINEZ JAVIER","r":"020.211.551-9","c":"6403","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"VOLANTE","j":"MARITZA VALENZUELA","in":"2025-12-04","dir":"DIAGONAL JOSE MARIA CAROP, 3005","com":"RECOLETA","tel":"","nac":"2000-05-04","ma":"","tc":"","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":107,"n":"MATUS ESCOBAR ALEXIS ALBERTO","r":"018.664.683-5","c":"5380","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2024-07-17","dir":"PASAJE EXEQUIEL, 1340","com":"MAIPÃš","tel":"922482126","nac":"1994-01-07","ma":"matusdamian545@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":108,"n":"MENA ESCOBAR LAURA ANDREA","r":"014.906.959-3","c":"4015","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2021-06-01","dir":"Oriente NÂº 140, Quilicura","com":"QUILICURA","tel":"9-59596130","nac":"1981-11-30","ma":"laureana_mena@hotmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":109,"n":"MERINO GONZALEZ WILLIAMS MAXIMILIANO","r":"015.221.433-2","c":"5452","d":"ADM-XD","ca":"GUARDIA","l":"XD CONCEPCION","p":"GUARDIA SEGURIDAD","j":"JAVIER FUENTES","in":"2024-09-02","dir":"Pasaje, 17 731 , San Pedro de la Paz","com":"CONCEPCION","tel":"","nac":"1982-06-29","ma":"MERINOGONZALEZ82@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":110,"n":"MILLA PEREZ DOMINIQUE ANGELICA","r":"021.212.814-7","c":"6317","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2025-10-24","dir":"ESCULTOR VIRGGINIO ARIAS, 2168","com":"PADRE HURTADO","tel":"","nac":"2003-01-12","ma":"Domimilla12@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":111,"n":"MIRANDA AVALOS BRANDON ESTEBAN","r":"019.754.430-9","c":"5409","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-08-01","dir":"San Lorenzo NÂ° 100, Lampa,","com":"LAMPA","tel":"","nac":"1997-11-21","ma":"brandon.mirandava@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":112,"n":"MIRANDA LEIVA EMERSON FABIAN","r":"021.392.180-0","c":"5267","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-05-10","dir":"PASAJE HUINCAY, 757","com":"QUILICURA","tel":"","nac":"2003-09-12","ma":"emersonleiva622@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":113,"n":"MONTES LEIVA SILVIA DEL CARMEN","r":"013.375.533-0","c":"4319","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2022-06-01","dir":"isla Navarino, 493 Pudahuel","com":"Pudahuel","tel":"9-83260094","nac":"1978-03-17","ma":"silviamontesl17@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":114,"n":"MONTOYA VELOSO KEVIN DANISIO","r":"020.258.177-3","c":"6465","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Pasaje Bugambilias 879, San Pedro de la Paz","com":"CONCEPCION","tel":"","nac":"2000-02-02","ma":"Profesor.Kevinmontoya@Gmail.Com","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00006"},{"i":115,"n":"MORAGA LIZAMA JAVIER IGNACIO","r":"019.108.606-6","c":"5969","d":"ADM-XD","ca":"ENCARGADO DE AREA CD","l":"XD CONCEPCION","p":"ENCARGADO DE AREA CD (XD)","j":"JAVIER FUENTES","in":"2025-05-05","dir":"Valentin Letelier 184 penco","com":"PENCO","tel":"9-34345398","nac":"","ma":"ignacio.mlizama@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":116,"n":"MORALES YAÃ‘EZ ARACELLI JAVIERA","r":"019.885.071-3","c":"3299","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PICKING","j":"MARITZA VALENZUELA","in":"2019-01-02","dir":"Cabo de Hornos # 1401","com":"RENCA","tel":"9-30524318","nac":"1998-06-26","ma":"aracellimorales122@gmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":117,"n":"MOYA AGUILERA GERMAN PABLO","r":"009.604.133-0","c":"5379","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2024-07-17","dir":"ISLA SAN AMBROSIO, 0861, LA GRANJA","com":"LA GRANJA","tel":"9-73509554","nac":"1962-11-10","ma":"germanpablomoya51@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":118,"n":"MUÃ‘OZ CARDENAS RUBEN EMMANUEL","r":"017.739.740-7","c":"5410","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-08-01","dir":"Parroquia Sagrada Familia NÂ° 699, Dpto 321","com":"QUILICURA","tel":"","nac":"1991-10-03","ma":"rubens.240@hotmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":119,"n":"NAVARRETE CARRILLO NATALY KATIUSKA","r":"018.614.761-8","c":"5233","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-04-19","dir":"TUCAPEL, 5245 VILLA SARMIENTO","com":"RENCA","tel":"","nac":"1994-04-05","ma":"NATA.X@LIVE.CL","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":120,"n":"NAVARRETE QUEUPIL MATIAS ISRAEL","r":"020.330.058-1","c":"5168","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-03-18","dir":"JORGE INOSTROZA NORTE, 515","com":"HUECHURABA","tel":"","nac":"1999-12-24","ma":"matiasnavarrete1904@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":121,"n":"NAVARRETE ZUÃ‘IGA PABLO DANIEL","r":"015.923.424-K","c":"4735","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2023-06-09","dir":"CALLE AFRICA, 692","com":"QUILICURA","tel":"9-79180906","nac":"1984-11-25","ma":"pablonavarretez36@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":122,"n":"NOVA ALARCON WALTER ALEJANDRO","r":"016.084.278-4","c":"4700","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2023-05-18","dir":"","com":"","tel":"","nac":"","ma":"","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":123,"n":"NUÃ‘EZ FONSECA FABIAN ANDRES","r":"017.108.830-5","c":"4801","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2023-07-24","dir":"CHIPANA, 585","com":"QUILICURA","tel":"","nac":"1988-08-31","ma":"fabi.nunez88@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":124,"n":"NUÃ‘EZ VERA IGNACIO NICOLAS","r":"016.923.703-4","c":"3342","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2018-12-17","dir":"Padre Lorenzo Eiting NÂº5751-B","com":"QUINTA NORMAL","tel":"9-36498566","nac":"1988-07-21","ma":"obrita811@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":125,"n":"OLIVARES BIZAMA RODOLFO MAURICIO","r":"020.100.196-K","c":"5939","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2025-04-15","dir":"DESPASAR 993, QUILICURA","com":"QUILICURA","tel":"","nac":"1999-05-15","ma":"Olivaressrodolfo22@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":126,"n":"OLIVARES MATTA LUIS FELIPE","r":"019.819.692-4","c":"5623","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-11-20","dir":"Rigoberto Jara #0161, Dpto C404","com":"QUILICURA","tel":"","nac":"1987-12-29","ma":"skulldorso25@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":127,"n":"ORELLANA ESCOBAR JUAN CARLOS","r":"010.370.943-1","c":"3767","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2020-06-15","dir":"Calle Rivas VicuÃ±a # 1214, Dpto. 604, Edificio Rengo","com":"QUINTA NORMAL","tel":"9-57733368","nac":"1965-10-04","ma":"lucason458@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":128,"n":"ORELLANA MENDEZ BASTIAN DAVID","r":"020.280.411-K","c":"3774","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2020-06-16","dir":"Nuevo Porvenir Parcela # 18, Sitio 2","com":"LAMPA","tel":"9-50818634","nac":"2000-05-07","ma":"orellanamendez1810@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":129,"n":"OYARCE VARAS BENJAMIN DUVANT","r":"020.785.802-1","c":"6493","d":"ADM-TRANSPORTE","ca":"ANALISTA","l":"INVENTARIO","p":"INVENTARIO","j":"ANGEL TRAIPE","in":"2026-01-23","dir":"","com":"","tel":"","nac":"","ma":"","tc":"","an":-1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":130,"n":"PACHECO ILLESCA ALVARO RUBEN","r":"017.768.652-2","c":"1621","d":"ADM-TRANSPORTE","ca":"ANALISTA","l":"ABASTECIMIENTO","p":"ABASTECIMIENTO","j":"DAGOBERTO SANHUEZA","in":"2013-08-01","dir":"Coilaco NÂº 8422","com":"PUDAHUEL","tel":"9-73916558","nac":"1991-02-24","ma":"arpy_225@hotmail.com","tc":"INDEFINIDO","an":12.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":131,"n":"PALACIOS CALDERON ISAAC JOSE","r":"021.057.159-0","c":"4273","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2022-04-11","dir":"pasaje leo, 0533 Quilicura","com":"Quilicura","tel":"9-44704591","nac":"2002-10-08","ma":"cristobalpalacio666@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":132,"n":"PARRA ROMERO MACARENA FRANCESCA","r":"019.752.338-7","c":"4778","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2023-07-10","dir":"Jazmines #5346","com":"CONCHALI","tel":"","nac":"1997-07-30","ma":"macarenaparra21@hotmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":133,"n":"PEÃ‘AILILLO RIVAS BASTIAN EDUARDO","r":"019.756.035-5","c":"4047","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"TRANSPORTE","p":"TRANSPORTE","j":"JAVIER FUENTES","in":"2021-07-19","dir":"EL TALHUEN 31","com":"QUILICURA","tel":"9-79865529","nac":"1998-02-12","ma":"bastianpenailillo79@gmail.com","tc":"INDEFINIDO","an":4.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":134,"n":"PERERIRA LARA JAVIER EDUARDO","r":"018.111.691-9","c":"5301","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-05-27","dir":"Guillermo Holley 60, Dpto 82, Penco","com":"CONCEPCION","tel":"","nac":"1992-11-21","ma":"javierpereira643@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":135,"n":"PEREZ CASTRO MARCELA ALEJANDRA","r":"012.664.157-5","c":"3376","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2019-03-12","dir":"Volcan Osorno # 1311","com":"RENCA","tel":"9-98434678","nac":"1974-01-31","ma":"la_marchi@live.cl","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":136,"n":"PEREZ LORCA MOISES IGNACIO","r":"022.067.171-2","c":"6398","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2025-12-04","dir":"PSJ. BAHIA 5790,","com":"conchali","tel":"","nac":"2006-03-05","ma":"","tc":"","an":-2025.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":137,"n":"PEREZ MENA MATIAS NICOLAS","r":"019.547.107-k","c":"5864","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - ALMACEN","j":"GABRIEL JARA","in":"2025-03-11","dir":"los australianos, 0246","com":"QUILICURA","tel":"","nac":"1997-04-02","ma":"","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":138,"n":"PEREZ MORALES CONSTANZA ANDREA","r":"021.330.726-6","c":"6462","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Larapinta Poniente, 3298","com":"LAMPA","tel":"","nac":"2003-07-03","ma":"Cony.Andreaa22@Gmail.Com","tc":"","an":-2026.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":139,"n":"PEREZ PEÃ‘A JOSE ALBERTO","r":"018.621.187-1","c":"2869","d":"CD ISP","ca":"ANALISTA","l":"WMS","p":"WMS","j":"DAGOBERTO SANHUEZA","in":"2017-10-20","dir":"Williams Rebolledo # 2905","com":"MAIPÃš","tel":"9-42626251","nac":"1994-04-29","ma":"jos3perez72@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":140,"n":"PONCE HERNANDEZ THOMAS IGNACIO","r":"021.077.687-7","c":"5830","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2025-02-13","dir":"PAULA JARAQUEMADA, 3020","com":"LO PRADO","tel":"","nac":"2002-07-23","ma":"Matiasperezmena@Gmail.Com","tc":"","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":141,"n":"PULIDO PIÃ‘ANGO NESTOR JOSE","r":"026.035.226-1","c":"6456","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Juan MartÃ­nez De Rozas, 2375","com":"SANTIAGO CENTRO","tel":"","nac":"1984-08-29","ma":"Nestorjosepulido@Gmail.Com","tc":"","an":-2026.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":142,"n":"QUEZADA PARRA JOSE FELICIANO","r":"017.336.216-1","c":"6408","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2025-12-04","dir":"PSJ NELSON CASTRO GONZALEZ 580","com":"QUILICURA","tel":"","nac":"1989-07-20","ma":"","tc":"","an":-2025.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":143,"n":"QUIJADA CONTRERAS TATIANA MELISSA","r":"020.100.947-2","c":"5570","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"00:00:00","dir":"GENERAL SAN MARTIN, 435","com":"QUILICURA","tel":"","nac":"1999-09-20","ma":"MELISSA.QUIJADA.CONTRERAS@GMAIL.COM","tc":"INDEFINIDO","an":125.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":144,"n":"QUILAMAN GAETE JOSE ALFREDO","r":"012.461.543-7","c":"3044","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2018-03-07","dir":"Luis Lazarini # 8123","com":"CERRO NAVIA","tel":"9-91613230","nac":"1973-10-04","ma":"jose.Quilaman1973@gmail.com","tc":"INDEFINIDO","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":145,"n":"QUILAQUEO NUÃ‘EZ MARIA ISABEL VALERIA","r":"019.062.818-3","c":"3701","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"TRANSPORTE","p":"TRANSPORTE","j":"JAVIER FUENTES","in":"2020-03-23","dir":"JosÃ© JoaquÃ­n Perez # 8943","com":"CERRO NAVIA","tel":"9-75790709","nac":"1995-05-19","ma":"maria.isabel.valeria@hotmail.es","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":146,"n":"Quintero Orozco Edgar Enrique","r":"025.984.356-1","c":"3139","d":"CD MANTENCION","ca":"AUXILIAR DE MANTENCION","l":"CEDIS","p":"AUXILIAR DE MANTENCION","j":"DAGOBERTO SANHUEZA","in":"2018-06-01","dir":"0","com":"0","tel":"0","nac":"00:00:00","ma":"0","tc":"","an":7.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":147,"n":"RAMIREZ RUBIO JAVIER IGNACIO","r":"019.162.079-8","c":"6106","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - ALMACEN","j":"GABRIEL JARA","in":"2025-07-04","dir":"PASAJE QUELHUE, 1205","com":"MAIPU","tel":"","nac":"1995-06-26","ma":"Javramirez06@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":149,"n":"RETAMAL OLIVARES YERKO JAVIER","r":"020.334.208-K","c":"4284","d":"CD SEREMI - INSUMOS","ca":"OPERADOR DE APILADOR ELECTRICO","l":"SEREMI","p":"OPERADOR DE APILADOR ELECTRICO","j":"MARITZA VALENZUELA","in":"2022-04-25","dir":"Manitoba, 8491 Pudahuel","com":"PUDAHUEL","tel":"9-57949739","nac":"2000-01-04","ma":"yerkoretamal.o@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":150,"n":"REYES VEGA VERONICA DEL CARMEN","r":"017.151.750-8","c":"","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2026-01-15","dir":"Psj Hernan Torres, 651","com":"QUILICURA","tel":"","nac":"1989-05-27","ma":"Reyesverito14@Gmail.Com","tc":"","an":-2026.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00005"},{"i":152,"n":"RIQUELME MARDONES ALBERTO ANDRES","r":"022.337,372-0","c":"6385","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2025-12-01","dir":"HUINCAY, 762","com":"QUILICURA","tel":"","nac":"2007-02-21","ma":"Riquelmealberto2102@Gmail.Com","tc":"PLAZO FIJO","an":-2025.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":153,"n":"RIQUELME PUEBLA TOMAS RODRIGO","r":"022.304.429-8","c":"6424","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2025-12-12","dir":"Alcaldesa Elisa Ãlvarez 547","com":"QUILICURA","tel":"","nac":"2007-01-11","ma":"Riquelmetomas250@Gmail.Com","tc":"","an":-2025.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":154,"n":"RIQUELME SALINAS JONATHAN ALEXIS","r":"019.584.650-2","c":"6316","d":"ADM-TRANSPORTE","ca":"ASISTENTE","l":"INVENTARIO","p":"INVENTARIO","j":"ANGEL TRAIPE","in":"2025-10-24","dir":"talinay, 678","com":"QUILICURA","tel":"","nac":"1997-03-22","ma":"Riquelme31Dsp@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":155,"n":"RIVAS AGUERO SYLVIA PAOLA","r":"011.974.021-5","c":"5061","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-02-01","dir":"COMBATE NAVAL, 1566 RENCA","com":"RENCA","tel":"","nac":"1972-04-07","ma":"paolarivasag@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":156,"n":"RIVERA SEPULVEDA MANUEL IGNACIO","r":"019.288.036-K","c":"6479","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2026-01-23","dir":"El Rosal 489","com":"PADRE HURTADO","tel":"","nac":"1995-11-06","ma":"","tc":"","an":-2026.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":157,"n":"RIVERA VARELA RICARDO EDDIE","r":"008.536.379-4","c":"3847","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2020-10-05","dir":"pasaje del surco 034, villa la casona","com":"QUILICURA","tel":"9-93913592","nac":"1964-03-01","ma":"rr0249722@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":158,"n":"RIVEROS GUTIERREZ KATHERINE","r":"013.674.916-1","c":"4280","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2022-04-18","dir":"El Matal, 1341 Lampa Chacabuco","com":"LAMPA","tel":"9-20011054","nac":"1979-04-30","ma":"katherinerivero44@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":159,"n":"ROCHA VERGARA VICTOR MANUEL","r":"020.533.735-0","c":"4827","d":"ADM-TRANSPORTE","ca":"ANALISTA","l":"ABASTECIMIENTO","p":"ABASTECIMIENTO","j":"DAGOBERTO SANHUEZA","in":"2023-08-07","dir":"pasaje rio lebu, 742 Quilicura","com":"QUILICURA","tel":"","nac":"2000-11-02","ma":"victorrv.2a@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":161,"n":"RODRIGUEZ VERGARA NICOLAS ADIEL","r":"018.809.709-K","c":"5302","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2024-05-27","dir":"Pasaje 6 6315, San Pedro de la Paz","com":"CONCEPCION","tel":"","nac":"1994-01-01","ma":"Nikolasadiel6@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":162,"n":"ROJAS DUARTE OSCAR MAURICIO","r":"010.876.563-1","c":"5167","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-03-18","dir":"PASAJE ESTERO PICHACHEN, 56","com":"Quilicura","tel":"","nac":"1965-07-17","ma":"OSCARROJASDUARTE65@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":163,"n":"ROJAS PINO JUAN CARLOS","r":"010.537.556-5","c":"5494","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2024-09-23","dir":"PASAJE PUENTE ALTO, 3037","com":"CONCHALI","tel":"","nac":"1966-01-30","ma":"jkarlos_39@yahoo.es","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":164,"n":"ROJAS SILVA ALEXIS LEONARDO","r":"009.122.848-3","c":"5707","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2024-12-19","dir":"","com":"","tel":"","nac":"1978-04-04","ma":"guerorojas@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":165,"n":"ROMERO ROJAS NICOLAS ABRAHAM","r":"018.863.642-k","c":"","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"SEREMI","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2025-12-02","dir":"","com":"","tel":"","nac":"","ma":"","tc":"","an":-2025.0,"cap":"","st":"ACTIVO","cc":"AD-00004"},{"i":166,"n":"RUMINOT FIERRO DAMIAN ANDRES","r":"018.388.269-4","c":"5981","d":"ADM-XD","ca":"CHOFER","l":"TRANSPORTE","p":"CHOFER (XD)","j":"JAVIER FUENTES","in":"2025-05-07","dir":"MORAVIA 1970, HUALPEN","com":"HUALPEN","tel":"","nac":"1992-12-02","ma":"Damianevelynf02@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":168,"n":"SALAS DIAZ ANA MARIA","r":"014.219.093-1","c":"3314","d":"CD SEREMI - INSUMOS","ca":"ENCARGADO DE AREA CD","l":"LINEA SEREMI","p":"ENCARGADO DE AREA CD (PICKING)","j":"MARITZA VALENZUELA","in":"2019-01-14","dir":"Jose Miguel Neira # 83, Casa 29","com":"QUILICURA","tel":"9-93357583","nac":"1978-01-06","ma":"ana-salas32@hotmail.es","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":169,"n":"SALAS PEÃ‘A PATRICIO HERNAN","r":"013.557.037-k","c":"3849","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA E INSUMOS","l":"INSUMOS","p":"INSUMOS","j":"MARITZA VALENZUELA","in":"2020-10-05","dir":"pasaje tegualda block 1451, dto 207","com":"RENCA","tel":"9-44168868","nac":"1978-11-15","ma":"patriciosalas2017@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":170,"n":"SALINAS CERDA BRIAN ANDRES","r":"020.033.995-9","c":"5120","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"UULL","p":"UULL","j":"GABRIEL JARA","in":"2024-02-23","dir":"Lo Marcoleta, 0716","com":"Quilicura","tel":"","nac":"1998-09-28","ma":"brian_andres6@outlook.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":171,"n":"SANCHEZ OLMOS FELIPE IGNACIO","r":"019.285.298-6","c":"5381","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"UULL","p":"UULL","j":"JAVIER FUENTES","in":"2024-07-17","dir":"NARACAIBO, 5687 POBLACION JUANITA AGUIRRE","com":"CONCHALI","tel":"","nac":"1996-10-02","ma":"fefelipeolmos118@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":172,"n":"SANCHEZ SALINAS JOCELYN NICOLE","r":"018.441.301-9","c":"4339","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2022-06-13","dir":"Rigoberto jara, 0191 Dpto B402 Quilicura","com":"Quilicura","tel":"9-50823536","nac":"1993-03-13","ma":"jocyy.nicolee@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":173,"n":"SANCHEZ VASQUEZ JAIME ANDRES","r":"018.909.015-3","c":"5595","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2024-11-06","dir":"San Juan Valdes #9657, Pudahuel, Santiago","com":"PUDAHUEL","tel":"","nac":"1995-02-01","ma":"jaime01sanchez95@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":174,"n":"SANDOVAL SANDOVAL MARIA MERCEDES","r":"008.818.653-2","c":"1404","d":"CD SEREMI - INSUMOS","ca":"CONTROLADOR","l":"AUDITORIA","p":"CONTROL DE PESO","j":"MARITZA VALENZUELA","in":"2012-11-07","dir":"Corona Sueca # 8420","com":"PUDAHUEL","tel":"9-35261116","nac":"1961-04-22","ma":"Mercedessandoval952@gmail.com","tc":"INDEFINIDO","an":13.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":175,"n":"SANDOVAL VASQUEZ JAVIER RODRIGO","r":"020.738.550-6","c":"6042","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-06-04","dir":"LOS CARRERA, 296","com":"CONCEPCION","tel":"","nac":"2001-07-17","ma":"Javitoxx2001@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":176,"n":"SANHUEZA KURTE DAGOBERTO ESTEBAN","r":"017.580.183-9","c":"2769","d":"ADM-TRANSPORTE","ca":"SUBGERENTE LOGISTICA","l":"SUBGERENTE LOGISTICA","p":"SUBGERENTE LOGISTICA","j":"DAGOBERTO SANHUEZA","in":"2017-08-03","dir":"Puerto Velero # 129, Villa El Arrayan","com":"MAIPÃš","tel":"9-57785378","nac":"1990-10-30","ma":"dag.sanhueza@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":177,"n":"SANZANA CORNEJO JONATHAN ALEJANDRO","r":"020.835.732-8","c":"5863","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-03-11","dir":"Tulahuen 0437, Quilicura, Santiago","com":"QUILICURA","tel":"","nac":"2001-09-04","ma":"Jonathan.Sanzana01@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00027"},{"i":178,"n":"SEGURA MANRIQUEZ CHRISTOPHER GUILLERMO","r":"018.149.725-4","c":"5872","d":"ADM-XD","ca":"PEONETA","l":"XD CONCEPCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2025-03-13","dir":"Juan de la Cosa 721,","com":"CONCEPCION","tel":"","nac":"1992-05-27","ma":"Cg.Segura27@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":179,"n":"SEPULVEDA RAMIREZ JOSE LUIS","r":"015.480.391-2","c":"3428","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2019-05-13","dir":"La Rayuela # 19001","com":"LAMPA","tel":"9-81767728","nac":"1982-01-29","ma":"joseluissepulveda253@gmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":180,"n":"SEQUEIRA GONZALEZ JAVIER IGNACIO","r":"021.051.957-2","c":"4945","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2023-11-22","dir":"Los carpatos, 735","com":"QUILICURA","tel":"","nac":"2003-02-28","ma":"javierignaciosequeira@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":181,"n":"SILVA CALDERON JONATHAN ANTONIO","r":"017.313.602-1","c":"4846","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2023-09-04","dir":"Avenida Einstein, 0467","com":"RECOLETA","tel":"","nac":"1989-11-18","ma":"jonasilvacalderon@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":182,"n":"SILVA GALLARDO RAUL HERNAN","r":"014.547.172-9","c":"5333","d":"ADM-TRANSPORTE","ca":"CHOFER","l":"DISTRIBUCION","p":"CONDUCTOR","j":"JAVIER FUENTES","in":"2024-06-10","dir":"Los Alamos, 630","com":"QUILICURA","tel":"","nac":"2024-08-12","ma":"raul.silvagallardo@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00027"},{"i":183,"n":"SILVA PEÃ‘A JAIME IGNACIO","r":"017.615.870-0","c":"5305","d":"ADM-XD","ca":"CHOFER","l":"TRANSPORTE","p":"CHOFER (XD)","j":"JAVIER FUENTES","in":"2024-05-27","dir":"Tongoy 49, Talcahuano","com":"TALCAHUANO","tel":"","nac":"1991-06-19","ma":"jaimesilva1906@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00026"},{"i":184,"n":"SOTO CEA REINALDO HERNAN","r":"019.094.287-2","c":"3902","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2020-12-09","dir":"pasaje la llareta 9064","com":"CERRO NAVIA","tel":"9-44369568","nac":"1995-05-20","ma":"reinaldo.dcc91@gmail.com","tc":"INDEFINIDO","an":5.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":185,"n":"SOTO VILCHES SOLANGE ELIZABETH","r":"018.836.745-3","c":"2541","d":"ADM-TRANSPORTE","ca":"COORDINADOR DE DISTRIBUCION","l":"TRANSPORTE","p":"COORDINADOR DE DISTRIBUCION","j":"JAVIER FUENTES","in":"2016-11-02","dir":"La Costa # 7892, Renca, Santiago","com":"RENCA","tel":"9-94374211","nac":"1994-08-07","ma":"soto.vilches@gmail.com","tc":"INDEFINIDO","an":9.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":186,"n":"TAPIA CORNEJO FELIPEÂ IGNACIO","r":"021.300.690-8","c":"4607","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"SEREMI","p":"ALMACEN","j":"MARITZA VALENZUELA","in":"2023-03-06","dir":"Puerto Fonk #0561","com":"QUILICURA","tel":"9-20325629","nac":"2003-05-20","ma":"felipe.tapia7726@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":187,"n":"TORRES APONTE ANDREA ALEJANDRA DE JESUS","r":"026.809.960-3","c":"5565","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"PICKING","j":"GABRIEL JARA","in":"2024-10-22","dir":"Venecia #1635","com":"INDEPENDENCIA","tel":"","nac":"1999-05-21","ma":"ANDREALJN9@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":188,"n":"TORRES RETAMAL DIEGO ESTEBAN","r":"021.670.635-8","c":"5848","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"ELASTICADO","j":"MARITZA VALENZUELA","in":"2025-03-04","dir":"Rapelcillo 727, Quilicura,","com":"QUILICURA","tel":"","nac":"2004-09-14","ma":"Torres.2004Diegoo@Gmail.Com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"},{"i":189,"n":"TRAIMA JELDREZ LEONARDO CARLOS","r":"020.813.217-2","c":"4197","d":"ADM-TRANSPORTE","ca":"PEONETA","l":"DISTRIBUCION","p":"PEONETA","j":"JAVIER FUENTES","in":"2022-02-14","dir":"Ismael BriceÃ±o NÂ°1501, Sa Pablo , Torre F, Depto. 33,","com":"QUILICURA","tel":"9-75587439","nac":"2001-10-07","ma":"leo.traima1234@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00027"},{"i":190,"n":"TRAIPE PINOCHET ANGEL ANTONIO","r":"015.509.263-7","c":"2870","d":"ADM-TRANSPORTE","ca":"JEFE DE OPERACIONES LOGISTICAS","l":"DISTRIBUCION","p":"JEFE DE OPERACIONES LOGISTICAS","j":"DAGOBERTO SANHUEZA","in":"2017-10-23","dir":"Perez Ferire, 1819 dpto32, Santiago","com":"SANTIAGO","tel":"9-52211637","nac":"1982-10-31","ma":"atraipe@live.cl","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":191,"n":"URRA SEPULVEDA JOSE IGNACIO","r":"020.335.500-9","c":"4646","d":"CD ISP","ca":"OPERADOR DE APILADOR ELECTRICO","l":"ALMACEN","p":"OPERADOR DE APILADOR ELECTRICO","j":"GABRIEL JARA","in":"2023-04-03","dir":"Isla Escocia #8713","com":"PUDAHUEL","tel":"9-34994553","nac":"2000-04-11","ma":"joseignaciourra254@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":192,"n":"VALDES CANO JUAN MIGUEL","r":"017.664.050-2","c":"4750","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"ALMACEN","p":"ISP - REPONEDOR","j":"GABRIEL JARA","in":"2023-06-20","dir":"El durazno, 17","com":"ESTACION CENTRAL","tel":"9-88062702","nac":"1990-11-27","ma":"j.valdescano@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":193,"n":"VALENCIA VASQUEZ JOSUE JACOB","r":"021.616.803-8","c":"5322","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","l":"INVENTARIO","p":"INVENTARIO","j":"ANGEL TRAIPE","in":"2024-06-05","dir":"Pasaje Rio MaullÃ­n #757","com":"QUILICURA","tel":"","nac":"1992-12-19","ma":"josuevalencia9315@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":194,"n":"VALENZUELA LOPEZ JUAN FRANCISCO","r":"020.227.672-5","c":"4272","d":"ADM-TRANSPORTE","ca":"Ingeniero de Procesos y Mejora Continua","l":"DISTRIBUCION","p":"Ingeniero de Procesos y Mejora Continua","j":"DAGOBERTO SANHUEZA","in":"2022-04-11","dir":"coinco, 260 Quilicura","com":"Quilicura","tel":"9-53715000","nac":"2000-01-23","ma":"juanvalenzuelalope17@gmail.com","tc":"INDEFINIDO","an":3.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":195,"n":"VALENZUELA PALMA KEVIN PATRICIO","r":"020.331.891-k","c":"6391","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"LINEA SEREMI","p":"PRE EMB","j":"MARITZA VALENZUELA","in":"2025-12-01","dir":"LAS CLARISAS, 0773","com":"QUILICURA","tel":"","nac":"2000-03-22","ma":"Kvalenzuelapalma@Gmail.Com","tc":"PLAZO FIJO","an":-2025.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":196,"n":"VALENZUELA QUEVEDO ANDRES MAXIMILIANO","r":"019.233.479-9","c":"4643","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"PRE-EMBARQUE","p":"PRE EMB","j":"GABRIEL JARA","in":"2023-04-03","dir":"Av. Zapadores 366","com":"Recoleta","tel":"9-22105386","nac":"1995-10-17","ma":"andresquevedom122@gmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":197,"n":"VALENZUELA ROJAS MARITZA FERNANDA","r":"017.337.775-4","c":"2884","d":"CD SEREMI - INSUMOS","ca":"JEFE DE AREA CD","l":"JEFE DE AREA CD","p":"JEFE DE AREA CD","j":"ANGEL TRAIPE","in":"2017-11-02","dir":"San Antonio Block 349, Dpto. 32","com":"QUILICURA","tel":"9-72335733","nac":"1989-10-26","ma":"maritzavalenzuelarojas@gmail.com","tc":"INDEFINIDO","an":8.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":198,"n":"VALLADARES ZAMUDIO CRISTIAN FERNANDO","r":"015.601.801-5","c":"3418","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","l":"SEREMI","p":"VOLANTE","j":"MARITZA VALENZUELA","in":"2019-05-02","dir":"Cauquenes # 1090","com":"RECOLETA","tel":"9-45229958","nac":"1983-06-05","ma":"negrito-lokito83@hotmail.com","tc":"INDEFINIDO","an":6.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":199,"n":"VASQUEZ ARISTIZABAL JHOAN DANILO","r":"027.530.820-K","c":"4944","d":"CD SEREMI - INSUMOS","ca":"OPERADOR DE APILADOR ELECTRICO","l":"SEREMI","p":"OPERADOR DE APILADOR ELECTRICO","j":"MARITZA VALENZUELA","in":"2023-11-22","dir":"Mercenarios, 1650 dpto 06","com":"CONCHALI","tel":"","nac":"1994-09-14","ma":"danivas82@hotmail.com","tc":"INDEFINIDO","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":200,"n":"Veas Gatica Aquiles Ernesto","r":"016.799.653-1","c":"4907","d":"CD MANTENCION","ca":"SUPERVISOR","l":"CEDIS","p":"SUPERVISOR","j":"DAGOBERTO SANHUEZA","in":"2023-10-23","dir":"0","com":"0","tel":"0","nac":"00:00:00","ma":"","tc":"","an":2.0,"cap":"Pendiente","st":"ACTIVO","cc":"AD-00004"},{"i":201,"n":"VENEGAS TRONCOSO MICHAEL NICOLAS","r":"018.629.600-1","c":"5072","d":"ADM-TRANSPORTE","ca":"ANALISTA","l":"SOPORTE","p":"SOPORTE","j":"JAVIER FUENTES","in":"2024-02-07","dir":"PASAJE MINCHA #723","com":"QUILICURA","tel":"942283712","nac":"1994-05-26","ma":"MICHAEL.VENEGAS.T.94@GMAIL.COM","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":202,"n":"VILLALON CAÃ‘OPAN FRANCISCO","r":"016.087.133-4","c":"5192","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-04-02","dir":"JOSE SANTIAGO ALDUNATE, 3222","com":"RENCA","tel":"","nac":"1986-02-03","ma":"fco.villalon.c@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":204,"n":"VILLELA GALLARDO DANIELA MARGARITA","r":"013.237.628-k","c":"3428","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2024-05-02","dir":"RIQUELME, 856 B","com":"PUDAHUEL","tel":"","nac":"1977-06-09","ma":"villelagallardo@gmail.com","tc":"INDEFINIDO","an":1.0,"cap":"NoRealizar","st":"ACTIVO","cc":"AD-00004"},{"i":205,"n":"ZUÃ‘IGA ROJAS ALEJANDRO ABRAHAM","r":"017.942.464-9","c":"5896","d":"CD ISP","ca":"AUXILIAR DE BODEGA","l":"Mesanina ISP","p":"ELASTICADO","j":"GABRIEL JARA","in":"2025-03-25","dir":"MANUAL ANTONIO MATTA, 819 DPTO 206","com":"QUILICURA","tel":"","nac":"1991-04-17","ma":"zunigaalejandro210@gmail.com","tc":"PLAZO FIJO","an":0.0,"cap":"Realizado","st":"ACTIVO","cc":"AD-00004"}],"b":[{"f":"2023-08-01","s":"CUBIERTO","r":"013.832.210-6","n":"SOTO CANALES CLAUDIA CAROLINA","c":"JEFE DE AREA CD","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"011.489.695-0","n":"FARIAS CARVALLO GUILLERMO ANTONIO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"020.986.098-8","n":"GALLEGOS RUBILAR CARLOS DAVID","c":"","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"012.994.976-7","n":"BARRIGA LEIVA YENIS ANDREA","c":"45097","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"012.638.104-2","n":"ARAYA RODRIGUEZ ANDREA ALEJANDRA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-11-01","s":"CUBIERTO","r":"018.610.976-7","n":"ROMERO ROJAS SEBASTIÃN ALEJANDRO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-11-01","s":"CUBIERTO","r":"017.230.332-3","n":"SEPULVEDA VEGA JONATHAN JESUS","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-11-01","s":"CUBIERTO","r":"020.288.118-1","n":"CUEVAS GALLARDO FELIPE IGNACIO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-11-01","s":"CUBIERTO","r":"019.360.338-6","n":"NAVARRO ROZAS NICOLAS GONZALO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-11-01","s":"CUBIERTO","r":"009.471.612-8","n":"CASTILLO CORTES JEANNETE VIRGINIA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-12-11","s":"CUBIERTO","r":"026.604.888-2","n":"TORREALBA BASTIDAS JUAN OMAR","c":"ENCARGADO DE AREA","m":""},{"f":"2023-12-01","s":"CUBIERTO","r":"011.856.550-9","n":"GALLARDO PAOLA BEATRIZ","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-12-01","s":"CUBIERTO","r":"017.730.402-6","n":"TEJO GALAZ ROSA ESTER","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-12-01","s":"CUBIERTO","r":"021.145.932-9","n":"RODRIGUEZ COTRINA ARACELI MARGOT","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-01-01","s":"CUBIERTO","r":"021.192.089-0","n":"VASQUEZ VICENCIO ALONDRA CONSTANZA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-01-01","s":"CUBIERTO","r":"010.509.820-0","n":"FICA KIESSLING BEATRIZ DEL CARMEN","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-01-01","s":"CUBIERTO","r":"018.422.725-8","n":"ORELLANA ORELLANA HECTOR ALEJANDRO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-01-01","s":"CUBIERTO","r":"011.866.776-K","n":"CORTES PEREIRA LUIS MARCELO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"019.818.988-K","n":"ALEXIS IGNACIO CORTES RODRIGUEZ","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"021.122.364-2","n":"LIZAMA LARA ANGEL CRISTOBAL","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"020.330.476-5","n":"ASTETE BRAVO MATIAS IGNACIO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"021.687.290-8","n":"SALAS VARGAS CARLOS ALBERTO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"019.700.102-K","n":"GARCIA SEPULVEDA JORGE NICOLAS","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"019.671.381-6","n":"ARENAS DEL PEZO BASTIAN ALEXIS","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-03-01","s":"CUBIERTO","r":"018.875.428-7","n":"IVAN ALEXIS CID LEAL","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"018.838.426-9","n":"RODRIGUEZ LINCOPAN GABRIELA FERNANDA","c":"ANALISTA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"016.373.134-7","n":"GARRIDO GARRIDO MARIA ELENA","c":"ASISTENTE","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"019.093.944-8","n":"ALEXANDER VALDEBENITO GONZALEZ","c":"TRANSPORTE","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"021.219.197-3","n":"MOISES ABRAHAM FOQUET CARRASCO","c":"AUXILIAR DE BODEGA (OP. ELECTRICO)","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"021.308.882-3","n":"JORGE ANDRES BUSTAMANTE GONZALEZ","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"021.281.999-9","n":"DEMIAN JAVIER DIAZ ORTEGA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"021.164.173-8","n":"SOLIS ACUÃ‘A BASTIAN IGNACIO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"015.899.267-1","n":"PABLO CESAR VILLANUEVA CARTER","c":"AUXILIAR DE BODEGA (OP. ELECTRICO)","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"013.677.307-0","n":"LETICIA JANETT GUERRA GORMAZ","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-05-01","s":"CUBIERTO","r":"018.598.793-0","n":"GUISSELLE ESTER ANCAMIL QUIROGA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-06-01","s":"CUBIERTO","r":"016.031.619-5","n":"KATHERINE GABRIELA GONZALEZ NECOCHEA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-06-01","s":"CUBIERTO","r":"020.466.539-7","n":"CRISTOPHER ALEJANDRO CATALAN MEZA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-07-01","s":"CUBIERTO","r":"012.201.290-5","n":"MATOS PEREZ PAMELA CATHERINE","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-07-01","s":"CUBIERTO","r":"008.339.368-8","n":"MOLINA MUÃ‘OZ CECILIA YANITZA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-07-01","s":"CUBIERTO","r":"011.137.050-8","n":"JIMENA DEL PILAR FERNANDEZ VARAS","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-07-01","s":"CUBIERTO","r":"010.809.801-5","n":"LOPEZ MUÃ‘OZ RUTH REBECA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-08-01","s":"CUBIERTO","r":"017.505.007-8","n":"URIBE CARRASCO ERIK DANIEL","c":"CHOFER","m":""},{"f":"2023-08-01","s":"CUBIERTO","r":"025.407.716-K","n":"CHARLES  GARRY","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-08-01","s":"CUBIERTO","r":"021.788.839-5","n":"TORO HUERAVIL JENNIFER CRISTINA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-09-01","s":"CUBIERTO","r":"020.110.750-4","n":"CARVAJAL MORALES JESSICA LORETO","c":"","m":""},{"f":"2023-09-01","s":"CUBIERTO","r":"021.416.102-8","n":"GALLARDO SOTO ALVARO ANDRES","c":"","m":""},{"f":"2023-09-01","s":"CUBIERTO","r":"018.673.490-4","n":"PIZARRO PEÃ‘A CHRISTOPHER KEVIN","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-09-01","s":"CUBIERTO","r":"010.649.423-1","n":"ESPINOZA VILLANUEVA GUSTAVO ALEJANDRO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"010.574.836-1","n":"MUÃ‘OZ SUAREZ CLAUDIO ENRIQUE","c":"43397","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"018.086.060-6","n":"CONCHA ROJAS LISSETTE ANGELICA","c":"42899","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"026.578.388-0","n":"GEDEON  JEAN OLAPH","c":"43591","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"024.999.397-2","n":"MENDAÃ‘A RODRIGUEZ FRANCISCO JAVIER","c":"chofer","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"020.160.750-7","n":"ROJAS CASSIO MONSERRAT ESPERANZA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"020.579.371-2","n":"MENDEZ NOVOA BAIRON FERNANDO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"016.951.097-0","n":"VASQUEZ PALMA NICOLE STEPHANIE","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"018.863.273-4","n":"RÃOS DOMÃNGUEZ CINTHIA MACARENA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"013.443.726-K","n":"VENEGAS ESCOBAR CLAUDIA ANDREA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2023-10-01","s":"CUBIERTO","r":"019.340.533-9","n":"SARMIENTO HUINCA ISSAC EDUARDO","c":"AUXILIAR DE BODEGA","m":""},{"f":"2023-10-01","s":"CUBIERTO","r":"018.089.380-6","n":"DEL VALLE ARIAS RUTH RACHEL","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-04-01","s":"CUBIERTO","r":"018.612.094-9","n":"ADASME SALAS JOCELYN VALESKA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-04-01","s":"CUBIERTO","r":"0","n":"CLAUDIO GOMEZ","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-05-01","s":"CUBIERTO","r":"015.874.200-4","n":"RAMIREZ BECERRA JONATHAN ESTEBAN","c":"peoneta","m":"DESPIDO"},{"f":"2024-05-01","s":"CUBIERTO","r":"019.956.601-6","n":"GONZALEZ HUENTENAO MOISES ALEJANDRO","c":"asistente","m":"DESPIDO"},{"f":"2024-05-01","s":"CUBIERTO","r":"013.464.726-4","n":"PAVEZ FLORES DAVID ANTONIO","c":"Chofer","m":"DESPIDO"},{"f":"2024-02-01","s":"CUBIERTO","r":"017.579.840-4","n":"QUIROZ TAPIA NOLASCO DAVID","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"018.915.296-5","n":"BECERRA GAETE CAMILA CONSTANZA","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"020.289.835-1","n":"YESSENIA SCARLETT DE LAS MERCE GARAY ESCOBAR","c":"AUXILIAR DE BODEGA","m":""},{"f":"2024-02-01","s":"CUBIERTO","r":"020.187.418-1","n":"IBAÃ‘EZ MORALES CRISTIAN ALBERTO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-03-01","s":"CUBIERTO","r":"019.241.418-0","n":"MUÃ‘OZ DURAN MANUEL ANDRES","c":"APILADOR ELECTRICO","m":"NO CONCURRENCIA"},{"f":"2024-03-01","s":"CUBIERTO","r":"020.916.451-5","n":"ALFARO HUEQUELEF CAMILA ANDREA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-03-01","s":"CUBIERTO","r":"020.916.451-5","n":"ALFARO HUEQUELEF CAMILA ANDREA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-03-01","s":"CUBIERTO","r":"016.966.488-9","n":"CARTES BURGOS FERNANDO ANDRES","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-03-01","s":"CUBIERTO","r":"019.544.222-3","n":"MOLINA MOLINA ARACELY TAMARA","c":"AUXILIAR DE BODEGA","m":"NO CONCURRENCIA"},{"f":"2024-03-01","s":"CUBIERTO","r":"019.995.521-7","n":"CALDERON EYZAGUIRRE ALAN JAVIER","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-03-01","s":"CUBIERTO","r":"021.130.240-4","n":"ARISMENDI CUEVAS BASTIAN EDUARDO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-03-01","s":"CUBIERTO","r":"020.116.404-4","n":"ARROYO VILLAGRAN ALEXA POULETTE","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-04-01","s":"CUBIERTO","r":"017.285.359-5","n":"COLOIHUIL MILLAN ALLISON TIARE","c":"AUXILIAR DE BODEGA","m":"NO CONCURRENCIA"},{"f":"2024-04-01","s":"CUBIERTO","r":"019.803.336-7","n":"CALDERON PUGA AXEL FRANCISCO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-04-01","s":"CUBIERTO","r":"020.130.348-6","n":"ORTEGA FUENZALIDA ALLISON ROCIO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-05-01","s":"CUBIERTO","r":"014.139.861-K","n":"CONTRERAS OYANEDER PHILIP WLADIMIR","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-05-01","s":"CUBIERTO","r":"015.416.036-1","n":"PEÃ‘ALOZA ROJAS ELIZABETH MARGOT","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-05-01","s":"CUBIERTO","r":"021.641.188-9","n":"COLLIPAL ORELLANA VALENTINA JOHANA PAZ","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-06-01","s":"CUBIERTO","r":"013.477.495-9","n":"SUAZO IBAÃ‘EZ JUAN FRANCISCO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-06-01","s":"CUBIERTO","r":"021.038.628-9","n":"NIETO OJEDA FRANCISCO ESTEBAN","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-06-01","s":"CUBIERTO","r":"018.835.129-8","n":"FLORES EPUYAO GERALD DAVID","c":"PEONETA","m":"RENUNCIA"},{"f":"2024-06-01","s":"CUBIERTO","r":"018.617.057-1","n":"CASTILLO ESPINOZA OSVALDO ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-06-01","s":"CUBIERTO","r":"019.560.878-4","n":"RETAMALES VARAS RODRIGO FERNANDO","c":"PEONETA","m":"DESPIDO"},{"f":"2024-06-01","s":"CUBIERTO","r":"020.551.038-9","n":"NORAMBUENA GODOY DIEGO ELIAS","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-06-01","s":"CUBIERTO","r":"015.540.284-9","n":"CONTRERAS SALAS JUAN JESUS","c":"ENCARGADO DE AREA","m":"RENUNCIA"},{"f":"2024-06-01","s":"CUBIERTO","r":"013.238.141-0","n":"CARRASCO PEREZ MARCELA ELISA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-07-01","s":"CUBIERTO","r":"019.757.519-0","n":"RODRIGUEZ Ã‘ANCULEF JAVIERA PAZ","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-07-01","s":"CUBIERTO","r":"020.497.746-1","n":"MUÃ‘OZ RAMIREZ ALAN ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-07-01","s":"CUBIERTO","r":"015.784.068-1","n":"DROGUET MARTINEZ ANDREA CECILIA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-07-01","s":"CUBIERTO","r":"021.199.684-6","n":"CACERES BARRIGA FRANCESCA RAQUEL","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-07-01","s":"CUBIERTO","r":"014.149.185-7","n":"KUHN RODRIGUEZ PATRICIO RAUL","c":"CHOFER","m":"NO RENOVACION"},{"f":"2024-07-01","s":"CUBIERTO","r":"018.421.851-8","n":"HERRERA MADRID FELIPE ANTONIO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"021.806.511-2","n":"ABARCA SANTIAGO JASON KEVIN","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-08-01","s":"CUBIERTO","r":"020.488.122-7","n":"GUEVERA SABANDO DIEGO ERNESTO","c":"PEONETA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"020.197.824-6","n":"MUÃ‘OZ ALMENDRO JAN DANILO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"017.569.220-7","n":"ACEVEDO AGUILAR RODRIGO ALEXSANDER","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"018.597.739-0","n":"PAREDES GONZALEZ TAMARA ANDREA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"018.849.737-3","n":"ARRIAGADA SEPULVEDA YESSENIA STHEPANIE","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-08-01","s":"CUBIERTO","r":"019.065.272-6","n":"SEPULVEDA ASTUDILLO SEBASTIAN","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-08-01","s":"CUBIERTO","r":"018.084.078-8","n":"TORO ARQUEROS CRISTINA ANDREA","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-08-01","s":"CUBIERTO","r":"019.885.967-2","n":"ALVARO ARIEL BUSTOS PINO","c":"asistente","m":"DESPIDO"},{"f":"2024-08-01","s":"CUBIERTO","r":"019.828.741-5","n":"CANCINO YAÃ‘EZ CAMILA FERNANDEZ","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-09-01","s":"CUBIERTO","r":"015.798.556-6","n":"VASQUEZ VARGAS CYNTHIA ANDREA","c":"asistente","m":"DESPIDO"},{"f":"2024-09-01","s":"CUBIERTO","r":"013.295.843-2","n":"ARAYA LUNA MANUEL ISAAC","c":"CHOFER","m":"no concurrencia"},{"f":"2024-09-01","s":"CUBIERTO","r":"013.655.391-7","n":"CRUZ VALDES RAFAEL ALEX","c":"AUXILIAR DE BODEGA","m":"CAMBIO DE AREA"},{"f":"2024-09-01","s":"CUBIERTO","r":"020.328.100-5","n":"JARA GARRIDO CAMILA ALEJADRA","c":"AUXILIAR DE BODEGA","m":"CAMBIO DE AREA"},{"f":"2024-09-01","s":"CUBIERTO","r":"013.033.351-6","n":"BARRA DONOSO PAOLA ALEJANDRA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-09-01","s":"CUBIERTO","r":"027.241.469-6","n":"GONZALEZ FERNANDEZ DEYSI DAYANA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-09-01","s":"CUBIERTO","r":"023.228.698-9","n":"POMPEEMAYER MUCÃ‘OZ GIANPAUL","c":"INGENIERO DE PROCESOS Y MC","m":"NO RENOVACION"},{"f":"2024-09-01","s":"CUBIERTO","r":"019.757.843-3","n":"ALVAREZ CERDA MAXIMILIANO ESTEBAN","c":"ASISTENTE","m":"NO RENOVACION"},{"f":"2024-09-01","s":"CUBIERTO","r":"017.336.782-1","n":"CONTRERAS VERA CRISTOBAL ANDRES","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-10-01","s":"CUBIERTO","r":"020.190.728-4","n":"VARGAS CEPEDA FELIPE IGNACIO","c":"PEONETA","m":"NO RENOVACION"},{"f":"2024-10-01","s":"CUBIERTO","r":"013.907.338-K","n":"PEREZ PASTORIZA ALFREDO VALENTINO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-10-01","s":"CUBIERTO","r":"013.032.005-8","n":"ABARZUA DIAZ GERMAN ANTONIO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-10-01","s":"CUBIERTO","r":"020.022.451-5","n":"CONTRERAS FUENTES STHEPHANIE DANIELA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-10-01","s":"CUBIERTO","r":"020.538.200-3","n":"MORALES GUTIERREZ VALENTINA BEATRIZ","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-10-01","s":"CUBIERTO","r":"015.453.746-5","n":"TAPIA PAILAHUEQUE DANIEL ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-11-01","s":"CUBIERTO","r":"018.093.477-4","n":"ROMERO ALFARO MATIAS PABLO","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2024-11-01","s":"CUBIERTO","r":"021.218.164-1","n":"GONZALEZ NUÃ‘EZ DIEGO JESUS","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-11-01","s":"CUBIERTO","r":"018.093.974-1","n":"SOBARZO SALDIAS DIEGO PABLO","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2024-11-01","s":"CUBIERTO","r":"016.711.439-3","n":"BRICEÃ‘O GUTIERREZ RICARDO ANDRES","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2024-11-01","s":"CUBIERTO","r":"019.233.626-0","n":"YAÃ‘EZ CESPEDES FELIPE ALBERTO","c":"ADMINISTRATIVO","m":"no concurrencia"},{"f":"2024-11-01","s":"CUBIERTO","r":"016.546.358-7","n":"CONTRERAS OSSES ANDRES ISAIAS","c":"CONDUCTOR","m":"NO RENOVACION"},{"f":"2024-11-01","s":"CUBIERTO","r":"016.978.687-9","n":"PALUMBO DELGADO TANIA KARIM","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-11-01","s":"CUBIERTO","r":"010.528.360-1","n":"GOMEZ CALFUÃ‘ANCO JUAN HUMBERTO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-11-01","s":"CUBIERTO","r":"008.277.630-3","n":"CERDA FERNANDEZ RICARDO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2024-12-01","s":"CUBIERTO","r":"015.410.146-2","n":"JOFRE MORENO EVELYN GINA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-12-01","s":"CUBIERTO","r":"021.699.356-K","n":"FIGUEROA ARAYA BENJAMIEN RODRIGO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-12-01","s":"CUBIERTO","r":"018.676.112-K","n":"LEON TRUJILLO ALEXANDRA PAOLA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2024-12-01","s":"CUBIERTO","r":"018.097.529-2","n":"German DomingoÂ MillapanÂ Araya","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2024-12-01","s":"CUBIERTO","r":"020.958.771-8","n":"LLAUPI VASQUEZ RAUL IGNACIO","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2024-12-01","s":"CUBIERTO","r":"011.487.176-1","n":"SOTOMAYOR SEIGNERE OCTAVIO ARMANDO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-12-01","s":"CUBIERTO","r":"016.561.839-1","n":"ROJAS ARANEDA ANGELICA MARIA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2024-12-01","s":"CUBIERTO","r":"015.607.376-8","n":"ARAYA JOFRE ELIZABETH ALEJANDRA","c":"ENCARGADO DE AREA","m":"DESPIDO"},{"f":"2025-01-01","s":"CUBIERTO","r":"020.922.170-5","n":"MONTECINOS CALDERON DARLYN TIARE","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-01-01","s":"CUBIERTO","r":"013.566.695-5","n":"GUZMAN ZURITA FRANCESCA DE LOURDES","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-01-01","s":"CUBIERTO","r":"020.962.484-2","n":"LUCERO DEL CANTO EDMARA JEISSY","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-01-01","s":"CUBIERTO","r":"019.356.690-1","n":"FLORES LANCHIPA BARBARA GABRIEL","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-01-01","s":"CUBIERTO","r":"020.886.055-0","n":"ACEVEDO VEGA FRANCO GABRIEL ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-01-01","s":"CUBIERTO","r":"021.192.089-0","n":"VASQUEZ VICENCIO ALONDRA CONSTANZA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-01-01","s":"CUBIERTO","r":"022.065.443-5","n":"CARRASCO FARIAS EDUARDO ANDRES","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-02-01","s":"CUBIERTO","r":"016.027.890-0","n":"GUERRERO GOMEZ ADELA LOURDES","c":"JEFE DE AREA CD","m":"DESPIDO"},{"f":"2025-02-01","s":"CUBIERTO","r":"020.466.539-7","n":"CATALAN MEZA CHRISTOPHER ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-02-01","s":"CUBIERTO","r":"020.828.086-4","n":"ORTIZ RODRIGUEZ CARLA MACARENA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-02-01","s":"CUBIERTO","r":"022.065.469-9","n":"CARRASCO FARIAS CRISTOBAL IGNACIO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-02-01","s":"CUBIERTO","r":"010.816.190-6","n":"MORALES ORELLANA JOSE LUIS","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-02-01","s":"CUBIERTO","r":"017.372.978-2","n":"CORDERO PARRAGUEZ JONATHAN ALEXANDER","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-02-01","s":"CUBIERTO","r":"021.641.825-5","n":"LANDERO ARRIAGADA CONSTANZA ANAIS ESTER","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-02-01","s":"CUBIERTO","r":"024.015.847-7","n":"HENRIQUEZ VERGARA VICENTE","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-02-01","s":"CUBIERTO","r":"019.800.831-1","n":"VALDES MARTINEZ ANDREE IGNACIO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2025-02-01","s":"CUBIERTO","r":"018.230.153-1","n":"PEÃ‘A CHAPARRO MARIA JOSE","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-03-01","s":"CUBIERTO","r":"018.099.059-3","n":"CORDERO PARRAGUEZ NICOLAS ORLANDO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-03-01","s":"CUBIERTO","r":"017.909.441-K","n":"AREVALO TAPIA DIEGO ALONSO","c":"peoneta","m":"RENUNCIA"},{"f":"2025-03-01","s":"CUBIERTO","r":"016.796.237-8","n":"JORQUERA ARAVENA FABIAN ALEXIS","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-03-01","s":"CUBIERTO","r":"019.544.271-1","n":"GARRIDO DONOSO RODRIGO ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-04-01","s":"CUBIERTO","r":"018.841.295-5","n":"OPITZ MUÃ‘OZ MATIAS SEBASTIAN","c":"ADMINISTRATIVO","m":"CAMBIO DE AREA"},{"f":"2025-04-01","s":"CUBIERTO","r":"019.291.526-0","n":"BARRERA GUAJARDO NICOLE CAMILA","c":"ADMINISTRATIVO","m":"DESPIDO"},{"f":"2025-04-01","s":"CUBIERTO","r":"019.883.954-K","n":"ORELLANA CERDA ISAAC PATRICIO","c":"ENCARGADO DE AREA","m":"DESPIDO"},{"f":"2025-04-01","s":"CUBIERTO","r":"019.546.612-2","n":"CAMUS RAMOS JUAN IGNACIO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2025-04-01","s":"CUBIERTO","r":"021.257.582-8","n":"MILLAPI VERGARA CARLA VALENTINA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-04-01","s":"CUBIERTO","r":"022.162.869-9","n":"TORRES DONOSOS ALEX IGNACIO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-04-01","s":"CUBIERTO","r":"015.665.556-2","n":"MEDINA PEREIRA JOCELYN DEL PILAR","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-04-01","s":"CUBIERTO","r":"013.563.903-6","n":"GONZALEZ ROJAS CAROL YEIMI","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-04-01","s":"CUBIERTO","r":"018.614.263-2","n":"DIAZ ESPINOZA FRANCISCO ANDRES","c":"PEONETA","m":"DESPIDO"},{"f":"2025-04-01","s":"CUBIERTO","r":"021.589.559-9","n":"RIQUELME MARDONES ANTONIA MARIANA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-04-01","s":"CUBIERTO","r":"022.028.373-9","n":"ESPARZA SERRANO MARTIN ANTONIO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-05-01","s":"CUBIERTO","r":"019.834.374-9","n":"BULNES FLORES DIEGO YAMIL","c":"ENCARGADO DE AREA","m":"NO RENOVACION"},{"f":"2025-05-01","s":"CUBIERTO","r":"018.074.589-0","n":"HUERTA MARTINEZ INGRID JUDITH","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-05-01","s":"CUBIERTO","r":"020.201.417-8","n":"LABBE NAVARRO SEBASTIAN NICOLAS","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-05-01","s":"CUBIERTO","r":"020.237.713-0","n":"BARRA VALDES FELIPE IGNACIO","c":"APILADOR ELECTRICO","m":"DESPIDO"},{"f":"2025-05-01","s":"CUBIERTO","r":"018.092.321-7","n":"LABRA SALINAS SEBASTIAN FELIPE","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-06-01","s":"CUBIERTO","r":"008.821.239-8","n":"MARTINEZ SOTO JOSE JAIME","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-06-01","s":"CUBIERTO","r":"017.085.421-7","n":"SAAVEDRA MORALES NATALIA PAZ","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-06-01","s":"CUBIERTO","r":"012.653.456-6","n":"LE-BRETON DIAZ CECILIA ROSA","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-07-01","s":"CUBIERTO","r":"017.765.729-8","n":"ROJAS HERRERA GABRIEL MAURICIO","c":"ENCARGADO DE AREA","m":"DESPIDO"},{"f":"2025-07-01","s":"CUBIERTO","r":"016.915.374-4","n":"MEDINA ARRIAGADA FELIPE ESTEBAN","c":"JEFE DE AREA CD","m":"NO RENOVACION"},{"f":"2025-07-01","s":"CUBIERTO","r":"016.789.640-5","n":"PAEZ PAINIAN JAIME EDUADO","c":"CHOFER","m":"DESPIDO"},{"f":"2025-07-01","s":"CUBIERTO","r":"021.786.711-8","n":"ROMERO ALVEAR EMILIO ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-08-01","s":"NO CUBIERTO","r":"020.937.496-K","n":"GONZALEZ GUTIERREZ JOAQUIN EDUARDO","c":"ADMINISTRATIVO","m":"RENUNCIA"},{"f":"2025-08-01","s":"CUBIERTO","r":"015.894.743-9","n":"FLORES VERA MARCELA ALEJANDRA","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-08-01","s":"CUBIERTO","r":"021.148.328-8","n":"CUBILLOS SERRANO JAVIER ALEXANDER","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-09-01","s":"CUBIERTO","r":"020.332.683-1","n":"ELGUETA QUILAQUEO IGNACIO ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-09-01","s":"NO CUBIERTO","r":"024.590.602-1","n":"CACERES NICOLAS ALEJO","c":"CHOFER","m":"NO RENOVACION"},{"f":"2025-10-01","s":"NO CUBIERTO","r":"018.907.868-4","n":"GARCIA FUENTES JOAQUIN IGNACIO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-10-01","s":"CUBIERTO","r":"019.409.899-5","n":"KAYIZA VALDES IGNACIO ANTONIO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-10-01","s":"NO CUBIERTO","r":"027.794.456-1","n":"PINALES MARTE CRISTIAN ALBERTO","c":"AUXILIAR DE BODEGA","m":"RENUNCIA"},{"f":"2025-10-01","s":"NO CUBIERTO","r":"010.519.982-1","n":"PARRA LEFIÃ‘ANCO CELESTINA DEL CARMEN","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"2025-11-01","s":"NO CUBIERTO","r":"021.132.167-9","n":"COLOMA RAMIREZ MAXIMILIANO ANDRES","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"2025-11-01","s":"NO CUBIERTO","r":"019.062.918-K","n":"GONZALEZ OPAZO CRISTOPHER ANDRES","c":"ADMINISTRATIVO","m":"DESPIDO"},{"f":"2025-11-01","s":"NO CUBIERTO","r":"020.394.765-8","n":"ARANCIBIA MARQUEZ JAVIERA BEATRIZ","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-11-01","s":"NO CUBIERTO","r":"020.434.735-2","n":"SILVA SANHUEZA JESUS ALEJANDRO","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"2025-11-01","s":"NO CUBIERTO","r":"020.789.879-1","n":"VALDES JARAMILLO YANIRA BELEN","c":"AUXILIAR DE BODEGA","m":"NO RENOVACION"},{"f":"","s":"","r":"021.618.427-0","n":"BELTRAN NEIRA MAXIMILIANO","c":"AUXILIAR DE BODEGA","m":"DESPIDO"},{"f":"","s":"","r":"018.946.591-2","n":"CALDERON GONZALEZ FRANCISCO PATRICIO","c":"","m":""},{"f":"","s":"","r":"021.648.869-5","n":"CARRILLO FUENZALIDA DAVID ANTONIO","c":"","m":""},{"f":"","s":"","r":"022.366.257-9","n":"CARVAJAR ESCOBEDO MATIAS DANIEL","c":"","m":""},{"f":"","s":"","r":"018.838.251-7","n":"LOPEZ SUAZO MAURICIO ANDRES","c":"","m":""},{"f":"","s":"","r":"016.220.671-0","n":"SALAZAR CARRASCO DANIEL FRANCISCO","c":"","m":""},{"f":"","s":"","r":"019.740.977-0","n":"RUIZ CARRIZO NICOLAS ALEJANDRO","c":"","m":"RENUNCIA"},{"f":"2026-01-01","s":"","r":"019.882.078-4","n":"VEGA DONOSO JUAN FRANCISCO","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"","s":"","r":"021.192.089-0","n":"VASQUEZ VICENCIO ALONDRA CONSTANZA","c":"","m":""},{"f":"","s":"","r":"019.812.387-0","n":"PRIETO URRUTIA MATIAS ALBERTO","c":"","m":""},{"f":"","s":"","r":"016.787.063-5","n":"JARA PEREZ JOSE ANTONIO","c":"AUXILIAR DE BODEGA","m":"no concurrencia"},{"f":"","s":"","r":"019.746.411-9","n":"GUTIERREZ ORELLANA BASTIAN ANDRES","c":"","m":""},{"f":"","s":"","r":"015.201.710-3","n":"RAMIREZ NICUMAN CORINA DEL CARMEN","c":"","m":""}],"ch":[{"f":"2023-11-01","c":"4810","r":"019.818.988-K","n":"ALEXIS IGNACIO CORTES RODRIGUEZ","d":"TRANSPORTE","ca":"AUXILIAR","nc":"PEONETA","j":"MARITZA"},{"f":"2023-11-01","c":"4273","r":"021.057.159-0","n":"PALACIOS CALDERON ISAAC JOSE","d":"TRANSPORTE","ca":"AUXILIAR","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2023-12-01","c":"3829","r":"019.241.418-0","n":"MUÃ‘OZ DURAN MANUEL ANDRES","d":"ALMACEN","ca":"AUXILIAR","nc":"Op Apilador Electrico (GRUA)","j":"JUAN VALENZUELA"},{"f":"2023-12-01","c":"4827","r":"020.533.735-0","n":"ROCHA VERGARA VICTOR MANUEL","d":"ALMACEN","ca":"AUXILIAR","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2023-12-01","c":"4716","r":"019.746.411-9","n":"GUTIERREZ ORELLANA BASTIAN ANDRES","d":"ALMACEN","ca":"ASISTENTE","nc":"ANALISTA","j":"ANGEL TRAIPE"},{"f":"2024-02-01","c":"4570","r":"015.540.284-9","n":"CONTRERAS SALAS JUAN JESUS","d":"ADM-TRANSPORTE","ca":"ASISTENTE","nc":"ENCARGADO DE AREA CD","j":"ANGEL TRAIPE"},{"f":"2024-02-01","c":"4486","r":"019.291.526-0","n":"BARRERA GUAJARDO NICOLE CAMILA","d":"ADM-TRANSPORTE","ca":"REVISOR","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2024-02-01","c":"4828","r":"021.676.056-5","n":"BUSTAMANTE YAÃ‘EZ CRISTOBAL ROBERTO","d":"ADM-TRANSPORTE","ca":"AUXILIAR","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2024-02-01","c":"4609","r":"019.196.006-8","n":"FUENTEALBA MACHUCA LUIS SEBASTIAN","d":"ADM-TRANSPORTE","ca":"REVISOR","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2024-03-01","c":"4878","r":"017.424.952-0","n":"GUERRA BLANCO ISAIAS JACOB","d":"ALMACEN","ca":"AUXILIAR","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2024-03-01","c":"4890","r":"020.937.496-K","n":"GONZALEZ GUTIERREZ JOAQUIN EDUARDO","d":"ALMACEN","ca":"AUXILIAR","nc":"ASISTENTE DE BODEGA","j":"ANGEL TRAIPE"},{"f":"2024-03-01","c":"4683","r":"020.237.713-0","n":"BARRA VALDES FELIPE IGNACIO","d":"ALMACEN","ca":"AUXILIAR","nc":"APILADOR ELECTRICO (GRUA)","j":"ADELA GUERRERO"},{"f":"2024-05-01","c":"4826","r":"016.392.122-7","n":"CODOCEO GONZALEZ SEBASTIAN ERIK","d":"ALMACEN","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"ADELA GUERRERO"},{"f":"2024-05-01","c":"3314","r":"014.219.093-1","n":"SALAS DIAZ ANA MARIA","d":"CD SEREMI - INSUMOS","ca":"CONTROLADOR","nc":"ENCARGADO DE AREA CD","j":"GABRIEL JARA"},{"f":"2024-06-01","c":"4180","r":"019.064.621-1","n":"RETAMAL FERNANDEZ CAMILA VALENTINA","d":"ALMACEN","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"ADELA GUERRERO"},{"f":"2024-06-01","c":"2853","r":"019.671.617-3","n":"ARIAS CARRASCO RODRIGO ANDRES","d":"ADM-TRANSPORTE","ca":"PEONETA","nc":"CHOFER","j":"ANGEL TRAIPE"},{"f":"2024-07-01","c":"5150","r":"019.883.954-K","n":"ORELLANA CERDA ISAAC PATRICIO","d":"ALMACEN","ca":"AUXILIAR DE BODEGA","nc":"ENCARGADO DE AREA CD","j":"ADELA GUERRERO"},{"f":"2024-07-01","c":"4846","r":"017.313.602-1","n":"SILVA CALDERON JONATHAN ANTONIO","d":"ADM-TRANSPORTE","ca":"CHOFER","nc":"ENCARGADO DE AREA CD","j":"ANGEL TRAIPE"},{"f":"2024-08-01","c":"5168","r":"020.330.058-1","n":"NAVARRETE QUEUPIL MATIAS ISRAEL","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2024-08-01","c":"5267","r":"021.392.180-0","n":"MIRANDA LEIVA EMERSON FABIAN","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2024-08-01","c":"4181","r":"015.607.376-8","n":"ARAYA JOFRE ELIZABETH ALEJANDRA","d":"CD ISP","ca":"AUXILIAR DE BODEGA","nc":"ENCARGADO DE AREA CD","j":"ADELA GUERRERO"},{"f":"2024-11-01","c":"5065","r":"018.629.600-1","n":"MICHAELL NICOLAS VENEGAS TRONCOSO","d":"","ca":"AUXILIAR DE BODEGA","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2024-11-01","c":"4700","r":"016.084.278-4","n":"NOVA ALARCON WALTER ALEJANDRO","d":"","ca":"REVISOR","nc":"CHOFER","j":"ANGEL TRAIPE"},{"f":"2024-11-01","c":"4646","r":"020.335.500-9","n":"URRA SEPULVEDA JOSE IGNACIO","d":"","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"ADELA GUERRERO"},{"f":"2024-12-01","c":"4272","r":"020.227.672-5","n":"VALENZUELA LOPEZ JUAN FRANCISCO","d":"","ca":"ENCARGADO DE AREA","nc":"Ingeniero de Procesos y Mejora Continua","j":"DAGOBERTO SANHUEZA"},{"f":"2024-12-01","c":"4180","r":"019.064.621-1","n":"RETAMAL FERNANDEZ CAMILA VALENTINA","d":"","ca":"APILADOR ELECTRICO (GRUA)","nc":"ENCARGADO DE AREA CD","j":"GABRIEL JARA"},{"f":"2025-01-01","c":"3624","r":"016.167.252-1","n":"JARA ROCHA CRISTOPHER ALEXIE","d":"","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"GABRIEL JARA"},{"f":"2025-01-01","c":"5380","r":"018.664.683-5","n":"MATUS ESCOBAR ALEXIS ALBERTO","d":"","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"GABRIEL JARA"},{"f":"2025-01-01","c":"2884","r":"017.337.775-4","n":"VALENZUELA ROJAS MARITZA FERNANDA","d":"","ca":"COORDINADOR DE DISTRIBUCION","nc":"SUPERVISOR DE DISTRIBUCION","j":"ANGEL TRAIPE"},{"f":"2025-02-01","c":"4826","r":"016.392.122-7","n":"CODOCEO GONZALEZ SEBASTIAN ERIK","d":"CD ISP","ca":"APILADOR ELECTRICO (GRUA)","nc":"ENCARGADO DE AREA CD","j":"GABRIEL JARA"},{"f":"2025-02-01","c":"5593","r":"016.601.749-1","n":"FUENTES ESPINOZA PEDRO WLADIMIR","d":"TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2025-05-01","c":"4846","r":"017.313.602-1","n":"SILVA CALDERON JONATHAN ANTONIO","d":"ADM-TRANSPORTE","ca":"ENCARGADO DE AREA CD","nc":"CHOFER","j":"ANGEL TRAIPE"},{"f":"2025-05-01","c":"3593","r":"016.266.870-6","n":"ESPINOZA ESPINOZA SERGIO ALEJANDRO","d":"CD SEREMI - INSUMOS","ca":"ENCARGADO DE AREA CD (INSUMOS)","nc":"COORDINADOR DE DISTRIBUCION","j":"ANGEL TRAIPE"},{"f":"2025-05-01","c":"5571","r":"019.062.918-K","n":"GONZALEZ OPAZO CRISTOPHER ANDRES","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","nc":"ASISTENTE DE BODEGA","j":"ANGEL TRAIPE"},{"f":"2025-05-01","c":"4945","r":"021.051.957-2","n":"SEQUEIRA GONZALEZ JAVIER IGNACIO","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2025-05-01","c":"5354","r":"021.764.884-k","n":"LUARTE CALDERON MAXIMILIANO ALFREDO","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"ANGEL TRAIPE"},{"f":"2025-07-01","c":"5234","r":"019.636.264-9","n":"LARA ZUÃ‘IGA MATIAS IGNACIO","d":"ALMACEN","ca":"AUXILIAR DE BODEGA","nc":"APILADOR ELECTRICO (GRUA)","j":"ANGEL TRAIPE"},{"f":"2025-09-01","c":"5863","r":"020.835.732-8","n":"SANZANA CORNEJO JONATHAN ALEJANDRO","d":"ADM-TRANSPORTE","ca":"AUXILIAR DE BODEGA","nc":"PEONETA","j":"JAVIER FUENTES"},{"f":"2025-09-01","c":"4333","r":"011.491.324-3","n":"DAVILA AGUILAR CLAUDIO DANIEL","d":"CD SEREMI - INSUMOS","ca":"AUXILIAR DE BODEGA","nc":"ASISTENTE DE DISTRIBUCION","j":"MATIAS QUINTANILLA"},{"f":"2025-12-01","c":"4827","r":"020.533.735-0","n":"ROCHA VERGARA VICTOR MANUEL","d":"ADM-TRANSPORTE","ca":"ASISTENTE","nc":"ANALISTA","j":"ANGEL TRAIPE"},{"f":"2025-12-01","c":"5331","r":"021.1291.93-1","n":"LLANCA CHIGUAY JOSE IGNACIO","d":"","ca":"REVISOR","nc":"ASISTENTE","j":"ANGEL TRAIPE"},{"f":"2026-01-01","c":"2541","r":"018.836.745-3","n":"SOTO VILCHES SOLANGE ELIZABETH","d":"","ca":"ANALISTA","nc":"COORDINADOR DE DISTRIBUCION","j":"ANGEL TRAIPE"},{"f":"2026-01-01","c":"2884","r":"017.337.775-4","n":"VALENZUELA ROJAS MARITZA FERNANDA","d":"","ca":"SUPERVISOR DE DISTRIBUCION","nc":"JEFE DE AREA CD","j":"DAGOBERTO SANHUEZA"},{"f":"2026-01-01","c":"3652","r":"013.083.607-0","n":"CANALES ARAYA GERARDO RODOLFO","d":"","ca":"AUXILIAR","nc":"APILADOR ELECTRICO (GRUA)","j":"ANGEL TRAIPE"}]};
const USERS_DEF={atraipe:{name:'Angel Traipe',ini:'AT',role:'ADMIN',pass:'1234',filter:null,title:'Jefe Operaciones LogÃ­sticas'},gjara:{name:'Gabriel Jara',ini:'GJ',role:'JEFE',pass:'1234',filter:['CD ISP'],title:'Jefe Ãrea â€” CD ISP'},mvalenzuela:{name:'Maritza Valenzuela',ini:'MV',role:'JEFE',pass:'1234',filter:['CD SEREMI - INSUMOS'],title:'Jefe Ãrea â€” SEREMI/Insumos'},jfuentes:{name:'Javier Fuentes',ini:'JF',role:'JEFE',pass:'1234',filter:['ADM-TRANSPORTE'],title:'Jefe Ãrea â€” ADM-Transporte'},dsanhueza:{name:'Dagoberto Sanhueza',ini:'DS',role:'SUB',pass:'1234',filter:null,title:'Subgerente LogÃ­stica'},pdavila:{name:'Pamela DÃ¡vila',ini:'PD',role:'GESTION',pass:'1234',filter:null,title:'GestiÃ³n de NÃ³mina'}};
let U=null,E=[],B=[],CH=[],docs={},lics={},licHist=[],audit=[],auth={},authDC={},vac=[],chDocs={},bajDocs={},permisos=[],USERS={},orgChart=null;
let cM=new Date().getMonth(),cY=new Date().getFullYear(),sel=new Set();
const DT=['Contrato','Anexo','CapacitaciÃ³n','EvaluaciÃ³n','Licencia MÃ©dica','AmonestaciÃ³n','Otro'];
const MN=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const PERMISOS_LEGALES=[
{id:'MAT',cat:'LEGAL',nombre:'Matrimonio y/o UniÃ³n Civil',dias:5,tipo:'hÃ¡biles',goce:'CON GOCE',art:'Art. 56',legal:'Art. 56 CÃ³digo del Trabajo â€” 5 dÃ­as hÃ¡biles continuos, adicional al feriado anual, independientemente del tiempo de servicio.',docs:'Certificado de matrimonio o uniÃ³n civil'},
{id:'FALL_PAD',cat:'LEGAL',nombre:'Fallecimiento Padre/Madre/Hermano(a)',dias:4,tipo:'hÃ¡biles',goce:'CON GOCE',art:'Art. 56',legal:'Art. 56 â€” 4 dÃ­as hÃ¡biles desde el dÃ­a del fallecimiento, adicional al feriado anual.',docs:'Certificado de defunciÃ³n'},
{id:'FALL_HIJ_GEST',cat:'LEGAL',nombre:'Fallecimiento Hijo en GestaciÃ³n',dias:7,tipo:'hÃ¡biles',goce:'CON GOCE',art:'Art. 56',legal:'Art. 56 â€” 7 dÃ­as hÃ¡biles, adicional al feriado anual.',docs:'Certificado de defunciÃ³n'},
{id:'FALL_HIJO',cat:'LEGAL',nombre:'Fallecimiento de un Hijo',dias:10,tipo:'corridos',goce:'CON GOCE',art:'Art. 56',legal:'Art. 56 â€” 10 dÃ­as corridos de permiso pagado, adicional al feriado anual.',docs:'Certificado de defunciÃ³n'},
{id:'FALL_CONY',cat:'LEGAL',nombre:'Fallecimiento CÃ³nyuge/Conviviente Civil',dias:7,tipo:'corridos',goce:'CON GOCE',art:'Art. 56',legal:'Art. 56 â€” 7 dÃ­as corridos desde el dÃ­a del fallecimiento, adicional al feriado anual.',docs:'Certificado de defunciÃ³n'},
{id:'PAT',cat:'LEGAL',nombre:'Permiso Paterno (Nacimiento)',dias:5,tipo:'hÃ¡biles/distribuidos',goce:'CON GOCE',art:'Art. 65 TÃ­tulo X',legal:'Art. 65 â€” 5 dÃ­as desde el momento del parto, continuos excluyendo descanso semanal, o distribuidos dentro del primer mes.',docs:'Certificado de nacimiento'},
{id:'CUMPLE',cat:'EMPRESA',nombre:'CumpleaÃ±os del Trabajador',dias:1,tipo:'hÃ¡biles',goce:'CON GOCE',art:'Beneficio Empresa',legal:'1 dÃ­a si el cumpleaÃ±os cae en dÃ­a laboral. Uso desde el dÃ­a o hasta 7 dÃ­as continuos siguientes, autorizado por Jefatura. No canjeable si cae en dÃ­a no laboral.',docs:''},
{id:'FALL_PAD_EMP',cat:'EMPRESA',nombre:'Fallecimiento Padre/Madre/Hermano(a) â€” Adicional Empresa',dias:2,tipo:'hÃ¡biles',goce:'CON GOCE',art:'Beneficio Empresa',legal:'2 dÃ­as hÃ¡biles adicionales a los 4 dÃ­as legales (Art. 56), dependiendo de ubicaciÃ³n geogrÃ¡fica.',docs:'Certificado de defunciÃ³n'},
{id:'SIN_GOCE',cat:'SIN GOCE',nombre:'Permiso Sin Goce de Sueldo',dias:0,tipo:'variable',goce:'SIN GOCE',art:'Convenio',legal:'Permiso sin remuneraciÃ³n, acordado entre trabajador y empleador.',docs:''}
];

// DA: dotaciÃ³n autorizada por dpto|cargo|puesto (desde Excel RESUMEN - Necesidad 2025)
const DA={'ADM-TRANSPORTE|ANALISTA|SOPORTE':1,'ADM-TRANSPORTE|ANALISTA|INVENTARIO':1,'ADM-TRANSPORTE|ANALISTA|ABASTECIMIENTO':2,'CD ISP|ANALISTA|WMS':1,'ADM-TRANSPORTE|ASISTENTE|ABASTECIMIENTO':1,'CD SEREMI - INSUMOS|ASISTENTE|INSUMOS':1,'ADM-TRANSPORTE|ASISTENTE|INVENTARIO':1,'ADM-TRANSPORTE|ASISTENTE|SOPORTE':1,'ADM-TRANSPORTE|ASISTENTE|SOPORTE 1BIT':1,'ADM-TRANSPORTE|ASISTENTE|TRANSPORTE':3,'ADM-TRANSPORTE|ASISTENTE|UULL':1,'CD ISP|ASISTENTE|WMS':1,'ADM-TRANSPORTE|AUXILIAR DE BODEGA|INVENTARIO':2,'ADM-TRANSPORTE|AUXILIAR DE BODEGA|UULL':6,'ADM-XD|AUXILIAR DE BODEGA|AUXILIAR DE BODEGA':2,'CD ISP|AUXILIAR DE BODEGA|ISP - REPONEDOR':7,'CD ISP|AUXILIAR DE BODEGA|ISP - ALMACEN':5,'CD ISP|AUXILIAR DE BODEGA|PICKING':21,'CD ISP|AUXILIAR DE BODEGA|ELASTICADO':20,'CD ISP|AUXILIAR DE BODEGA|PRE EMB':11,'CD ISP|AUXILIAR DE BODEGA|VOLANTE':3,'CD ISP|AUXILIAR DE BODEGA|CONTROLADOS':1,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA|ALMACEN':3,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA|PICKING':5,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA|ELASTICADO':4,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA|PRE EMB':6,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA|VOLANTE':1,'CD SEREMI - INSUMOS|AUXILIAR DE BODEGA E INSUMOS|INSUMOS':5,'CD MANTENCION|AUXILIAR DE MANTENCION|AUXILIAR DE MANTENCION':2,'ADM-TRANSPORTE|CHOFER|CONDUCTOR':11,'ADM-XD|CHOFER|CHOFER (XD)':3,'CD ISP|CONTROLADOR|CONTROLADOR':2,'CD SEREMI - INSUMOS|CONTROLADOR|CONTROL DE PESO':1,'ADM-TRANSPORTE|COORDINADOR DE DISTRIBUCION|COORDINADOR DE DISTRIBUCION':1,'CD SEREMI - INSUMOS|COORDINADOR DE LOGISTICA|COORDINADOR DE LOGISTICA CD (INSUMOS)':1,'ADM-XD|ENCARGADO DE AREA CD|ENCARGADO DE AREA CD (XD)':1,'CD ISP|ENCARGADO DE AREA CD|ENCARGADO DE AREA CD (PICKING)':1,'CD ISP|ENCARGADO DE AREA CD|ENCARGADO DE AREA CD (ALMACEN)':1,'CD ISP|ENCARGADO DE AREA CD|ENCARGADO DE AREA CD (PRE EMB)':1,'CD SEREMI - INSUMOS|ENCARGADO DE AREA CD|ENCARGADO DE AREA CD (PICKING)':1,'ADM-TRANSPORTE|Ingeniero de Procesos y Mejora Continua|Ingeniero de Procesos y Mejora Continua':1,'ADM-TRANSPORTE|JEFE DE AREA CD|JEFE DE AREA CD (transporte)':1,'CD ISP|JEFE DE AREA CD|JEFE DE AREA CD':1,'CD SEREMI - INSUMOS|JEFE DE AREA CD|JEFE DE AREA CD':1,'ADM-TRANSPORTE|JEFE DE OPERACIONES LOGISTICAS|JEFE DE OPERACIONES LOGISTICAS':1,'CD ISP|OPERADOR DE APILADOR ELECTRICO|OPERADOR DE APILADOR ELECTRICO':5,'CD SEREMI - INSUMOS|OPERADOR DE APILADOR ELECTRICO|OPERADOR DE APILADOR ELECTRICO':1,'ADM-TRANSPORTE|PEONETA|PEONETA':22,'ADM-XD|PEONETA|PEONETA':6,'ADM-TRANSPORTE|SUBGERENTE LOGISTICA|SUBGERENTE LOGISTICA':1,'CD MANTENCION|SUPERVISOR|SUPERVISOR':1};
// authDC: dotaciÃ³n por dpto|cargo|puesto â€” clave triple
function initAuthDC(){
// Si authDC ya tiene claves triple (2 pipes), solo merge nuevas entradas de DA
if(typeof authDC==='object'&&Object.keys(authDC).length>0&&Object.keys(authDC).some(k=>(k.match(/\|/g)||[]).length===2)){
// Auto-merge: agregar entradas de DA que no existan en authDC
Object.entries(DA).forEach(([k,v])=>{if(!(k in authDC))authDC[k]=v;});
return;}
// Migrar desde DA (que ya viene en formato triple)
authDC={...DA};
}
// getAuth: obtener autorizado. Soporta filtro por dpto, cargo, puesto
function getAuth(cargo,dpto,puesto){
let s=0;Object.entries(authDC).forEach(([k,v])=>{const p=k.split('|');
if(dpto&&cargo&&puesto){if(k===dpto+'|'+cargo+'|'+puesto)s+=v;}
else if(dpto&&cargo){if(p[0]===dpto&&p[1]===cargo)s+=v;}
else if(dpto){if(p[0]===dpto)s+=v;}
else if(cargo&&puesto){if(p[1]===cargo&&p[2]===puesto)s+=v;}
else if(cargo){if(p[1]===cargo)s+=v;}
else{s+=v;}
});return s;}
// getAuthTotal: total autorizado, filtrable por dpto (o array de dptos para vis)
function getAuthTotal(dpto){let s=0;const dptos=Array.isArray(dpto)?dpto:dpto?[dpto]:null;
Object.entries(authDC).forEach(([k,v])=>{const d=k.split('|')[0];if(!dptos||dptos.includes(d))s+=v;});return s;}
// getAuthVis: total autorizado filtrado por visibilidad del usuario actual
function getAuthVis(){if(!U||!U.filter)return getAuthTotal(null);return getAuthTotal(U.filter);}
let selDocType='Contrato';
let pgCur=1,pgSz=50;
let proyectos=[];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE CONFIG â€” REEMPLAZA CON TUS CREDENCIALES
// ObtÃ©n estos datos en: https://console.firebase.google.com
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyAhxi1Emv0rFE7cUJkDOMc35BJVaOGPvo0",
  authDomain:        "nomina-logistica-chile.firebaseapp.com",
  databaseURL:       "https://nomina-logistica-chile-default-rtdb.firebaseio.com",
  projectId:         "nomina-logistica-chile",
  storageBucket:     "nomina-logistica-chile.firebasestorage.app",
  messagingSenderId: "48868020671",
  appId:             "1:48868020671:web:af35d1da7ca746da27110a",
  measurementId:     "G-PFDJPGCPXG"
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let _db = null;
let _fbListener = null;
let _fbReady = false;

function _initFirebase() {
  try {
    if (!firebase.apps || !firebase.apps.length) {
      firebase.initializeApp(FIREBASE_CONFIG);
    }
    _db = firebase.database();
    return true;
  } catch(e) {
    console.warn('Firebase no disponible:', e);
    return false;
  }
}

function _applyData(d) {
  E=d.E||[];B=d.B||[];CH=d.CH||[];docs=d.docs||{};lics=d.lics||{};
  licHist=d.licHist||[];audit=d.audit||[];auth=d.auth||{};authDC=d.authDC||{};
  vac=d.vac||[];chDocs=d.chDocs||{};bajDocs=d.bajDocs||{};permisos=d.permisos||[];
  proyectos=d.proyectos||[];orgChart=d.orgChart||null;
  USERS=d.USERS||JSON.parse(JSON.stringify(USERS_DEF));
  let merged=false;
  Object.entries(USERS_DEF).forEach(([uid,def])=>{if(!USERS[uid]){USERS[uid]=JSON.parse(JSON.stringify(def));merged=true;}});
  return merged;
}

function _getDataObj(){
  return {E,B,CH,docs,lics,licHist,audit,auth,authDC,vac,chDocs,bajDocs,permisos,proyectos,USERS,orgChart};
}

function save() {
  const data = _getDataObj();
  // Siempre guarda en localStorage como respaldo
  try { localStorage.setItem('simi_v6', JSON.stringify(data)); } catch(e){}
  // Guarda en Firebase si estÃ¡ disponible
  if (_db && _fbReady) {
    _db.ref('simi_v6').set(data).catch(err => {
      console.warn('Error guardando en Firebase:', err);
      _updateSyncIcon(false);
    });
  }
}

function _loadFromLocalStorage(cb) {
  const s = localStorage.getItem('simi_v6');
  if (s) { try { const merged = _applyData(JSON.parse(s)); if(merged) save(); return cb(true); } catch(e){} }
  cb(false);
}

function load(cb) {
  if (!_db) { _loadFromLocalStorage(cb); return; }
  _db.ref('simi_v6').once('value').then(snap => {
    const d = snap.val();
    if (d) {
      const merged = _applyData(d);
      if (merged) save();
      cb(true);
    } else {
      _loadFromLocalStorage(cb);
    }
  }).catch(err => {
    console.warn('Firebase offline, usando localStorage:', err);
    _updateSyncIcon(false);
    _loadFromLocalStorage(cb);
  });
}

function _startRealtime() {
  if (!_db) return;
  if (_fbListener) { try { _db.ref('simi_v6').off('value', _fbListener); } catch(e){} }
  _fbListener = _db.ref('simi_v6').on('value', snap => {
    const d = snap.val();
    if (d && U && _fbReady) {
      // Evitar re-aplicar si el cambio fue nuestro (pequeÃ±a ventana de tiempo)
      _applyData(d);
      initAuthDC();
      refreshAll();
      _updateSyncIcon(true);
    }
  }, err => { console.warn('Error listener Firebase:', err); _updateSyncIcon(false); });
}

function _updateSyncIcon(online) {
  const el = document.getElementById('sync-dot');
  if (el) { el.style.background = online ? '#4CAF50' : '#FF5722'; el.title = online ? 'ğŸŸ¢ Sincronizado con Firebase' : 'ğŸ”´ Sin conexiÃ³n (guardado local)'; }
}

function resetData() {
  if (!confirm('Â¿Resetear TODOS los datos al original?\nEsto borrarÃ¡ tambiÃ©n Firebase.')) return;
  try { localStorage.removeItem('simi_v6'); } catch(e){}
  if (_db) { _db.ref('simi_v6').remove().then(()=>{ initData(true); }).catch(()=>{ initData(true); }); }
  else initData(true);
}

function initData(forceReset) {
  const loadingEl = document.getElementById('fb-loading');
  if (loadingEl) loadingEl.style.display = 'flex';

  const afterLoad = (found) => {
    if (!found || forceReset) {
      E=SD.e.map(e=>({id:e.i,nombre:e.n,rut:e.r,cod:e.c,dpto:e.d,cargo:e.ca,linea:e.l,puesto:e.p,jefatura:e.j,ingreso:e.in,direccion:e.dir,comuna:e.com,telefono:e.tel,nacimiento:e.nac,mail:e.ma,tipoContrato:e.tc,antiguedad:e.an,capacitacion:e.cap,status:e.st,ccosto:e.cc}));
      B=SD.b.map(b=>({fecha:b.f,status:b.s,rut:b.r,nombre:b.n,cargo:b.c,motivo:b.m}));
      CH=SD.ch.map(c=>({desde:c.f,cod:c.c,rut:c.r,nombre:c.n,dpto:c.d,cargoAnterior:c.ca,nuevoCargo:c.nc,jefatura:c.j}));
      docs={};lics={};audit=[];auth={};authDC={...DA};vac=[];USERS=JSON.parse(JSON.stringify(USERS_DEF));
      save();
    } else { initAuthDC(); }
    if (loadingEl) loadingEl.style.display = 'none';
    _fbReady = true;
    _startRealtime();
    initOrgChart();
    checkSession();
    if (forceReset) { refreshAll(); toast('Datos reseteados'); }
  };

  const firebaseOk = _initFirebase();
  if (firebaseOk) { load(afterLoad); }
  else { _loadFromLocalStorage(afterLoad); if (loadingEl) loadingEl.style.display = 'none'; }
}
function fN(n){return Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');}
function aa(action,detail){audit.unshift({user:U?U.name:'Sistema',time:new Date().toISOString(),action,detail});if(audit.length>300)audit.length=300;save();}
function doLogin(){const u=document.getElementById('l-u').value.toLowerCase().trim(),p=document.getElementById('l-p').value,le=document.getElementById('l-e');
if(!u){le.textContent='Ingrese su usuario';le.style.display='block';return;}
if(!p){le.textContent='Ingrese su contraseÃ±a';le.style.display='block';return;}
if(!USERS[u]){le.textContent='Usuario "'+u+'" no existe. Contacte al administrador.';le.style.display='block';return;}
if(USERS[u].pass!==p){le.textContent='ContraseÃ±a incorrecta';le.style.display='block';return;}
le.style.display='none';loginAs(u);}
function loginAs(uid){U={...USERS[uid],uid};localStorage.setItem('simi_u6',uid);document.getElementById('LS').style.display='none';document.getElementById('app').style.display='flex';document.getElementById('sb-a').textContent=U.ini;document.getElementById('sb-n').textContent=U.name;document.getElementById('sb-r').textContent=U.title;document.getElementById('btn-add').style.display=U.role==='JEFE'?'none':'';document.getElementById('btn-au').style.display=U.role==='ADMIN'?'':'none';
var oldNv=document.getElementById('nav-val');if(oldNv)oldNv.remove();var oldNs=document.getElementById('ns-val');if(oldNs)oldNs.remove();
if(VAL_USERS.includes(uid)){var cfgNi=document.querySelector('[data-p="config"]');if(cfgNi){var nsH=document.createElement('div');nsH.className='ns';nsH.id='ns-val';nsH.textContent='Confidencial';cfgNi.parentNode.insertBefore(nsH,cfgNi);var nv=document.createElement('div');nv.className='ni';nv.id='nav-val';nv.setAttribute('data-p','valorizacion');nv.onclick=function(){nav('valorizacion')};nv.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>ValorizaciÃ³n ğŸ”’';cfgNi.parentNode.insertBefore(nv,cfgNi);}}
aa('LOGIN',U.name+' ingresÃ³');refreshAll();}
function doLogout(){aa('LOGOUT',(U?U.name:'?')+' cerrÃ³ sesiÃ³n');save();localStorage.removeItem('simi_u6');U=null;document.getElementById('app').style.display='none';document.getElementById('LS').style.display='flex';document.getElementById('l-u').value='';document.getElementById('l-p').value='';document.getElementById('l-e').style.display='none';}
function checkSession(){const u=localStorage.getItem('simi_u6');if(u&&USERS[u])loginAs(u);}
function vis(){return(!U||!U.filter)?E:E.filter(e=>U.filter.includes(e.dpto));}
function sen(d){if(!d||d==='nan')return{y:0,m:0,d:0,t:'N/A'};const dt=new Date(d),n=new Date();let y=n.getFullYear()-dt.getFullYear(),m=n.getMonth()-dt.getMonth(),dd2=n.getDate()-dt.getDate();if(dd2<0){m--;dd2+=new Date(n.getFullYear(),n.getMonth(),0).getDate();}if(m<0){y--;m+=12;}return{y,m,d:dd2,t:y+'a '+m+'m'};}
function fd(d){return(!d||d==='nan')?'â€”':d.substring(0,10);}
function toast(m,e){const t=document.getElementById('toast');t.textContent=m;t.className='toast'+(e?' error':'')+' show';setTimeout(()=>t.className='toast',3000);}
function nav(p){if(p==='valorizacion'&&(!U||!VAL_USERS.includes(U.uid))){toast('â›” Sin acceso a ValorizaciÃ³n',1);return;}document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.ni').forEach(x=>x.classList.remove('active'));document.getElementById('page-'+p).classList.add('active');const n=document.querySelector('[data-p="'+p+'"]');if(n)n.classList.add('active');}
function nid(){return E.length?Math.max(...E.map(e=>e.id))+1:1;}
function clM(){document.getElementById('modal').style.display='none';}
function ddF(d){return Math.ceil((new Date(d)-new Date())/864e5);}
function wdBetween(s,e){let c=0;const d=new Date(s);const end=new Date(e);while(d<=end){const dow=d.getDay();if(dow!==0&&dow!==6)c++;d.setDate(d.getDate()+1);}return c;}
function vacDays(emp){const sn=sen(emp.ingreso);return 15+(sn.y>=15?Math.floor((sn.y-15)/3)+1:0);}
function vacUsed(rut){return vac.filter(v=>v.rut===rut&&v.status==='APROBADA').reduce((s,v)=>s+v.dias,0);}
function dl(content,name,type){const b=new Blob([content],{type});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=name;a.click();}
function exportCSV(){const d=getF();let c='COD,NOMBRE,RUT,DPTO,CARGO,PUESTO,CCOSTO,LINEA,JEFATURA,INGRESO,CONTRATO,STATUS,TEL,EMAIL,COMUNA\n';d.forEach(e=>{c+=`${e.cod},"${e.nombre}",${e.rut},"${e.dpto}","${e.cargo}","${e.puesto}","${e.ccosto||''}","${e.linea||''}","${e.jefatura}",${e.ingreso},${e.tipoContrato},${e.status},"${e.telefono||''}","${e.mail||''}","${e.comuna||''}"\n`;});dl(c,'nomina_'+new Date().toISOString().slice(0,10)+'.csv','text/csv');toast('ğŸ“¥ CSV');}
function exportXLS(){
const data=vis();const ac=data.filter(e=>e.status==='ACTIVO');const li=data.filter(e=>e.status==='LICENCIA');const bj=data.filter(e=>e.status==='BAJA');
const fecha=new Date().toLocaleDateString('es-CL');
const cols=['COD','NOMBRE','RUT','DEPARTAMENTO','CARGO','PUESTO','C.COSTO','LÃNEA','JEFATURA','INGRESO','ANTIGÃœEDAD','TIPO CONTRATO','STATUS','DIRECCIÃ“N','COMUNA','TELÃ‰FONO','EMAIL','NACIMIENTO','CAPACITACIÃ“N D44','LICENCIA INICIO','LICENCIA TÃ‰RMINO','LICENCIA MOTIVO','VACACIONES DERECHO','VACACIONES USADAS','VACACIONES SALDO'];
function esc(v){return String(v||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function cell(v,t,s){t=t||'String';return'<Cell'+(s?' ss:StyleID="'+s+'"':'')+'><Data ss:Type="'+t+'">'+esc(v)+'</Data></Cell>';}
let xml='<?xml version="1.0" encoding="UTF-8"?>\n<?mso-application progid="Excel.Sheet"?>\n';
xml+='<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel">\n';
xml+='<Styles>\n';
xml+='<Style ss:ID="Default"><Font ss:FontName="Calibri" ss:Size="10"/></Style>\n';
xml+='<Style ss:ID="title"><Font ss:FontName="Calibri" ss:Size="14" ss:Bold="1" ss:Color="#062D70"/></Style>\n';
xml+='<Style ss:ID="sub"><Font ss:FontName="Calibri" ss:Size="10" ss:Color="#666666"/></Style>\n';
xml+='<Style ss:ID="hdr"><Font ss:FontName="Calibri" ss:Size="9" ss:Bold="1" ss:Color="#FFFFFF"/><Interior ss:Color="#062D70" ss:Pattern="Solid"/><Alignment ss:Horizontal="Center" ss:Vertical="Center" ss:WrapText="1"/><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#FFFFFF"/></Borders></Style>\n';
xml+='<Style ss:ID="act"><Font ss:FontName="Calibri" ss:Size="9" ss:Color="#1B5E20"/><Interior ss:Color="#E8F5E9" ss:Pattern="Solid"/></Style>\n';
xml+='<Style ss:ID="lic"><Font ss:FontName="Calibri" ss:Size="9" ss:Color="#E65100"/><Interior ss:Color="#FFF3E0" ss:Pattern="Solid"/></Style>\n';
xml+='<Style ss:ID="baj"><Font ss:FontName="Calibri" ss:Size="9" ss:Color="#B71C1C"/><Interior ss:Color="#FFEBEE" ss:Pattern="Solid"/></Style>\n';
xml+='<Style ss:ID="num"><NumberFormat ss:Format="#,##0"/></Style>\n';
xml+='<Style ss:ID="date"><NumberFormat ss:Format="dd/mm/yyyy"/></Style>\n';
xml+='<Style ss:ID="row"><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#E0E0E0"/></Borders></Style>\n';
xml+='<Style ss:ID="kpi"><Font ss:FontName="Calibri" ss:Size="11" ss:Bold="1" ss:Color="#062D70"/><Interior ss:Color="#E3F2FD" ss:Pattern="Solid"/><Alignment ss:Horizontal="Center"/></Style>\n';
xml+='<Style ss:ID="kpl"><Font ss:FontName="Calibri" ss:Size="9" ss:Color="#666666"/><Interior ss:Color="#E3F2FD" ss:Pattern="Solid"/><Alignment ss:Horizontal="Center"/></Style>\n';
xml+='</Styles>\n';
// --- HOJA NÃ“MINA ---
xml+='<Worksheet ss:Name="NÃ³mina Completa">\n<Table>\n';
xml+='<Column ss:Width="45"/><Column ss:Width="200"/><Column ss:Width="95"/><Column ss:Width="130"/><Column ss:Width="180"/><Column ss:Width="130"/><Column ss:Width="80"/><Column ss:Width="90"/><Column ss:Width="130"/><Column ss:Width="80"/><Column ss:Width="75"/><Column ss:Width="90"/><Column ss:Width="70"/><Column ss:Width="180"/><Column ss:Width="100"/><Column ss:Width="95"/><Column ss:Width="180"/><Column ss:Width="80"/><Column ss:Width="55"/><Column ss:Width="80"/><Column ss:Width="80"/><Column ss:Width="120"/><Column ss:Width="60"/><Column ss:Width="60"/><Column ss:Width="60"/>\n';
// Title row
xml+='<Row ss:Height="28"><Cell ss:StyleID="title"><Data ss:Type="String">NÃ“MINA â€” Farmacias Similares Chile S.A.</Data></Cell></Row>\n';
xml+='<Row ss:Height="18"><Cell ss:StyleID="sub"><Data ss:Type="String">Centro de DistribuciÃ³n Lo Echevers â€” Generado: '+fecha+'</Data></Cell></Row>\n';
// KPI row
xml+='<Row ss:Height="8"></Row>\n';
xml+='<Row ss:Height="22">';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Total</Data></Cell>';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Activos</Data></Cell>';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Licencias</Data></Cell>';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Bajas</Data></Cell>';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Necesidad</Data></Cell>';
xml+='<Cell ss:StyleID="kpl"><Data ss:Type="String">Diferencia</Data></Cell>';
xml+='</Row>\n';
var totAuth=getAuthVis();var diff2=ac.length-totAuth;
xml+='<Row ss:Height="24">';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="Number">'+data.length+'</Data></Cell>';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="Number">'+ac.length+'</Data></Cell>';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="Number">'+li.length+'</Data></Cell>';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="Number">'+bj.length+'</Data></Cell>';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="Number">'+totAuth+'</Data></Cell>';
xml+='<Cell ss:StyleID="kpi"><Data ss:Type="String">'+(diff2>0?'+'+diff2:diff2)+'</Data></Cell>';
xml+='</Row>\n';
xml+='<Row ss:Height="8"></Row>\n';
// Header
xml+='<Row ss:Height="28">';cols.forEach(c2=>{xml+=cell(c2,'String','hdr');});xml+='</Row>\n';
// Data rows
data.forEach(e=>{
const sn2=sen(e.ingreso);const l2=lics[e.rut]||{};const vd=vacDays(e),vu=vacUsed(e.rut);
const stStyle=e.status==='ACTIVO'?'act':e.status==='LICENCIA'?'lic':'baj';
xml+='<Row ss:Height="20">';
xml+=cell(e.cod,'String','row');
xml+=cell(e.nombre,'String','row');
xml+=cell(e.rut,'String','row');
xml+=cell(e.dpto,'String','row');
xml+=cell(e.cargo,'String','row');
xml+=cell(e.puesto,'String','row');
xml+=cell(e.ccosto||'','String','row');
xml+=cell(e.linea||'','String','row');
xml+=cell(e.jefatura,'String','row');
xml+=cell(e.ingreso||'','String','row');
xml+=cell(sn2.t,'String','row');
xml+=cell(e.tipoContrato,'String','row');
xml+=cell(e.status,'String',stStyle);
xml+=cell(e.direccion||'','String','row');
xml+=cell(e.comuna||'','String','row');
xml+=cell(e.telefono||'','String','row');
xml+=cell(e.mail||'','String','row');
xml+=cell(e.nacimiento||'','String','row');
xml+=cell(e.capacitacion||'','String','row');
xml+=cell(l2.start||'','String','row');
xml+=cell(l2.end||'','String','row');
xml+=cell(l2.motivo||'','String','row');
xml+=cell(vd,'Number','row');
xml+=cell(vu,'Number','row');
xml+=cell(vd-vu,'Number','row');
xml+='</Row>\n';
});
xml+='</Table>\n';
xml+='<WorksheetOptions xmlns="urn:schemas-microsoft-com:office:excel"><FreezePanes/><FrozenNoSplit/><SplitHorizontal>8</SplitHorizontal><TopRowBottomPane>8</TopRowBottomPane></WorksheetOptions>\n';
xml+='</Worksheet>\n';
// --- HOJA DOTACIÃ“N ---
xml+='<Worksheet ss:Name="DotaciÃ³n por Puesto">\n<Table>\n';
xml+='<Column ss:Width="140"/><Column ss:Width="180"/><Column ss:Width="150"/><Column ss:Width="70"/><Column ss:Width="70"/><Column ss:Width="70"/>\n';
xml+='<Row ss:Height="28"><Cell ss:StyleID="title"><Data ss:Type="String">DOTACIÃ“N POR PUESTO</Data></Cell></Row>\n';
xml+='<Row ss:Height="18"><Cell ss:StyleID="sub"><Data ss:Type="String">Necesidad 2025 vs NÃ³mina Actual â€” '+fecha+'</Data></Cell></Row>\n';
xml+='<Row ss:Height="8"></Row>\n';
xml+='<Row ss:Height="24">'+['DEPARTAMENTO','CARGO','PUESTO','NECESIDAD','ACTUAL','DIFERENCIA'].map(h2=>cell(h2,'String','hdr')).join('')+'</Row>\n';
const visDptos2=U&&U.filter?U.filter:null;
const byDCP2={};ac.forEach(e=>{const k=e.dpto+'|'+e.cargo+'|'+e.puesto;byDCP2[k]=(byDCP2[k]||0)+1;});
Object.entries(authDC).forEach(([k,v])=>{if(v>0&&!byDCP2[k]){const d=k.split('|')[0];if(visDptos2&&!visDptos2.includes(d))return;byDCP2[k]=0;}});
Object.entries(byDCP2).sort((a,b)=>a[0].localeCompare(b[0])).forEach(([k,act])=>{
const p=k.split('|');const aut=authDC[k]||0;const df=act-aut;const st2=df<0?'baj':df>0?'lic':'act';
xml+='<Row ss:Height="18">';
xml+=cell(p[0],'String','row');xml+=cell(p[1],'String','row');xml+=cell(p[2],'String','row');
xml+=cell(aut,'Number','row');xml+=cell(act,'Number','row');
xml+=cell(df>0?'+'+df:String(df),'String',st2);
xml+='</Row>\n';
});
xml+='</Table>\n</Worksheet>\n';
// --- HOJA BAJAS ---
xml+='<Worksheet ss:Name="Bajas">\n<Table>\n';
xml+='<Column ss:Width="85"/><Column ss:Width="200"/><Column ss:Width="95"/><Column ss:Width="180"/><Column ss:Width="100"/><Column ss:Width="200"/>\n';
xml+='<Row ss:Height="28"><Cell ss:StyleID="title"><Data ss:Type="String">REGISTRO DE BAJAS</Data></Cell></Row>\n';
xml+='<Row ss:Height="8"></Row>\n';
xml+='<Row ss:Height="24">'+['FECHA','NOMBRE','RUT','CARGO','STATUS','MOTIVO'].map(h2=>cell(h2,'String','hdr')).join('')+'</Row>\n';
B.forEach(b=>{xml+='<Row ss:Height="18">';
xml+=cell(b.fecha||'','String','row');xml+=cell(b.nombre,'String','row');xml+=cell(b.rut,'String','row');
xml+=cell(b.cargo,'String','row');xml+=cell(b.status,'String','baj');xml+=cell(b.motivo||'','String','row');
xml+='</Row>\n';});
xml+='</Table>\n</Worksheet>\n';
// --- HOJA CAMBIOS ---
xml+='<Worksheet ss:Name="Cambios de Cargo">\n<Table>\n';
xml+='<Column ss:Width="85"/><Column ss:Width="60"/><Column ss:Width="95"/><Column ss:Width="200"/><Column ss:Width="120"/><Column ss:Width="180"/><Column ss:Width="180"/><Column ss:Width="130"/>\n';
xml+='<Row ss:Height="28"><Cell ss:StyleID="title"><Data ss:Type="String">HISTORIAL DE CAMBIOS</Data></Cell></Row>\n';
xml+='<Row ss:Height="8"></Row>\n';
xml+='<Row ss:Height="24">'+['FECHA','COD','RUT','NOMBRE','DPTO','CARGO ANTERIOR','NUEVO CARGO','JEFATURA'].map(h2=>cell(h2,'String','hdr')).join('')+'</Row>\n';
CH.forEach(c2=>{xml+='<Row ss:Height="18">';
xml+=cell(c2.desde||'','String','row');xml+=cell(c2.cod,'String','row');xml+=cell(c2.rut,'String','row');
xml+=cell(c2.nombre,'String','row');xml+=cell(c2.dpto||'','String','row');
xml+=cell(c2.cargoAnterior,'String','row');xml+=cell(c2.nuevoCargo,'String','row');xml+=cell(c2.jefatura||'','String','row');
xml+='</Row>\n';});
xml+='</Table>\n</Worksheet>\n';
xml+='</Workbook>';
dl(xml,'nomina_completa_'+new Date().toISOString().slice(0,10)+'.xls','application/vnd.ms-excel');
toast('ğŸ“¥ Excel descargado');
}
function exportAll(){dl(JSON.stringify({E,B,CH,docs,lics,audit,auth,vac,USERS},null,2),'backup_simi_'+new Date().toISOString().slice(0,10)+'.json','application/json');toast('ğŸ“¦ Backup');}
function exportReport(){const v=vis(),ac=v.filter(e=>e.status==='ACTIVO');let r='REPORTE NÃ“MINA - '+new Date().toLocaleDateString('es-CL')+'\n'+'='.repeat(50)+'\nTotal: '+v.length+' | Activos: '+ac.length+'\n\nPOR DPTO:\n';const dp={};ac.forEach(e=>{dp[e.dpto]=(dp[e.dpto]||0)+1;});Object.entries(dp).sort((a,b)=>b[1]-a[1]).forEach(([d,c])=>r+='  '+d+': '+c+'\n');dl(r,'reporte_'+new Date().toISOString().slice(0,10)+'.txt','text/plain');toast('ğŸ“Š Reporte');}
function exportVac(){let c='NOMBRE,RUT,DPTO,DESDE,HASTA,DÃAS,ESTADO\n';vac.forEach(v=>{const e=E.find(x=>x.rut===v.rut);if(e)c+=`"${e.nombre}",${e.rut},"${e.dpto}",${v.start},${v.end},${v.dias},${v.status}\n`;});dl(c,'vacaciones_'+new Date().toISOString().slice(0,10)+'.csv','text/csv');toast('ğŸ“¥ Vacaciones');}

// DASHBOARD
function rDash(){const v=vis(),ac=v.filter(e=>e.status==='ACTIVO'),li=v.filter(e=>e.status==='LICENCIA'),pf=ac.filter(e=>e.tipoContrato==='PLAZO FIJO');
const totAct=ac.length,totAuthG=getAuthVis();
const vp=vac.filter(v2=>v2.status==='PENDIENTE').length;
// Sparkline data: bajas by month (last 12)
const now=new Date(),bSpark=[];for(let i=11;i>=0;i--){const d2=new Date(now.getFullYear(),now.getMonth()-i,1);const k=d2.toISOString().slice(0,7);bSpark.push(B.filter(b=>b.fecha&&b.fecha.startsWith(k)).length);}
// Vacation days this year
const thisYr=now.getFullYear().toString();const vacYr=vac.filter(x=>x.status==='APROBADA'&&x.start&&x.start.startsWith(thisYr)).reduce((s,x)=>s+x.dias,0);
document.getElementById('kpi').innerHTML=`<div class="kc"><div class="kl">NÃ³mina</div><div class="kv" style="color:var(--teal)">${v.length}</div><div class="ks pos">${ac.length} activos</div></div><div class="kc"><div class="kl">Licencias</div><div class="kv" style="color:var(--yellow)">${li.length}</div><div class="ks warn">Activas</div></div><div class="kc"><div class="kl">Plazo Fijo</div><div class="kv" style="color:var(--blue)">${pf.length}</div><div class="ks">${ac.length?Math.round(pf.length/ac.length*100):0}%</div></div><div class="kc"><div class="kl">Bajas 12m ${spark(bSpark)}</div><div class="kv" style="color:var(--red)">${bSpark.reduce((a,b)=>a+b,0)}</div><div class="ks">Ãšltimos 12 meses</div></div><div class="kc"><div class="kl">DotaciÃ³n</div><div class="kv" style="color:${totAct>totAuthG?'var(--yellow)':totAct<totAuthG?'var(--red)':'var(--teal)'}">${totAct}/${totAuthG}</div><div class="ks">${totAct>totAuthG?'Sobre +'+(totAct-totAuthG):totAct<totAuthG?'Faltan '+(totAuthG-totAct):'Completa'}</div></div><div class="kc"><div class="kl">Vac. ${thisYr}</div><div class="kv" style="color:var(--green)">${vacYr}d</div><div class="ks">${vp} pendientes</div></div>`;
const dp={};ac.forEach(e=>{dp[e.dpto]=(dp[e.dpto]||0)+1;});const jf={};ac.forEach(e=>{if(e.jefatura)jf[e.jefatura]=(jf[e.jefatura]||0)+1;});
const md=Math.max(...Object.values(dp),1),mj=Math.max(...Object.values(jf),1);
document.getElementById('charts').innerHTML=`<div class="cc"><h3>Por Departamento</h3>${Object.entries(dp).sort((a,b)=>b[1]-a[1]).map(([d,v2])=>`<div class="br"><div class="bl">${d}</div><div class="bt"><div class="bf" style="width:${v2/md*100}%;background:var(--teal)"><span>${v2}</span></div></div></div>`).join('')}</div><div class="cc"><h3>Por Jefatura</h3>${Object.entries(jf).sort((a,b)=>b[1]-a[1]).map(([j,v2])=>`<div class="br"><div class="bl">${j}</div><div class="bt"><div class="bf" style="width:${v2/mj*100}%;background:var(--blue)"><span>${v2}</span></div></div></div>`).join('')}</div>`;}

// EMPLOYEES TABLE
function getF(){const v=vis(),q=(document.getElementById('s-e').value||'').toLowerCase(),d=document.getElementById('f-d').value,c=document.getElementById('f-c').value,j=document.getElementById('f-j').value,s=document.getElementById('f-s').value,tc=document.getElementById('f-tc').value;return v.filter(e=>{if(q&&!`${e.nombre} ${e.rut} ${e.cargo} ${e.cod} ${e.puesto} ${e.ccosto||''} ${e.linea||''}`.toLowerCase().includes(q))return 0;if(d&&e.dpto!==d)return 0;if(c&&e.cargo!==c)return 0;if(j&&e.jefatura!==j)return 0;if(s&&e.status!==s)return 0;if(tc&&e.tipoContrato!==tc)return 0;return 1;});}
function rET(data){document.getElementById('etb').innerHTML=data.map(e=>{const s=sen(e.ingreso);const sb=e.status==='ACTIVO'?'b-ok':e.status==='BAJA'?'b-no':'b-lic';const ck=sel.has(e.id)?'checked':'';return`<tr><td onclick="event.stopPropagation()"><input type="checkbox" class="cb" data-id="${e.id}" ${ck} onchange="togSel(${e.id},this.checked)"></td><td onclick="openEmp(${e.id})" style="font-family:var(--mono);font-size:10px;color:var(--text3)">${e.cod}</td><td onclick="openEmp(${e.id})"><strong>${e.nombre}</strong></td><td onclick="openEmp(${e.id})" style="font-family:var(--mono);font-size:10px">${e.rut}</td><td onclick="openEmp(${e.id})">${e.dpto}</td><td onclick="openEmp(${e.id})">${e.cargo}</td><td onclick="openEmp(${e.id})">${e.puesto}</td><td onclick="openEmp(${e.id})" style="font-family:var(--mono);font-size:10px;color:var(--text3)">${e.ccosto||''}</td><td onclick="openEmp(${e.id})" style="font-size:10px">${e.linea||''}</td><td onclick="openEmp(${e.id})">${e.jefatura}</td><td onclick="openEmp(${e.id})">${fd(e.ingreso)}</td><td onclick="openEmp(${e.id})" style="font-family:var(--mono);font-size:10px">${s.t}</td><td onclick="openEmp(${e.id})"><span class="badge ${e.tipoContrato==='INDEFINIDO'?'b-ok':'b-bl'}">${e.tipoContrato||'â€”'}</span></td><td onclick="openEmp(${e.id})"><span class="badge ${sb}">${e.status}</span></td></tr>`;}).join('');}
function fE(){pgCur=1;rPage();}
function rPage(){const all=getF();const total=all.length;const pages=Math.ceil(total/pgSz)||1;if(pgCur>pages)pgCur=pages;const start=(pgCur-1)*pgSz,end=Math.min(start+pgSz,total);const page=all.slice(start,end);rET(page);document.getElementById('pag-info').textContent='Mostrando '+(start+1)+'-'+end+' de '+total;
let pb='<button class="pag-btn" onclick="pgCur=1;rPage()" '+(pgCur===1?'disabled':'')+'>Â«</button><button class="pag-btn" onclick="pgCur=Math.max(1,pgCur-1);rPage()" '+(pgCur===1?'disabled':'')+'>â€¹</button>';
const maxP=7;let sp=Math.max(1,pgCur-3),ep=Math.min(pages,sp+maxP-1);sp=Math.max(1,ep-maxP+1);
for(let i=sp;i<=ep;i++)pb+='<button class="pag-btn'+(i===pgCur?' active':'')+'" onclick="pgCur='+i+';rPage()">'+i+'</button>';
pb+='<button class="pag-btn" onclick="pgCur=Math.min('+pages+',pgCur+1);rPage()" '+(pgCur===pages?'disabled':'')+'>â€º</button><button class="pag-btn" onclick="pgCur='+pages+';rPage()" '+(pgCur===pages?'disabled':'')+'>Â»</button>';
document.getElementById('pag-btns').innerHTML=pb;document.getElementById('nt').textContent='Colaboradores ('+total+')';}
function togSel(id,c){if(c)sel.add(id);else sel.delete(id);updBulk();}
function toggleAll(cb){const data=getF();if(cb.checked)data.forEach(e=>sel.add(e.id));else sel.clear();updBulk();fE();}
function updBulk(){const n=sel.size;document.getElementById('bulk-cnt').textContent=n+' seleccionados';document.getElementById('bulk').classList.toggle('show',n>0);const isA=U&&(U.role==='ADMIN'||U.role==='SUB'||U.role==='GESTION');document.getElementById('bulk-st').innerHTML=isA?'<button class="btn btn-p btn-sm" onclick="bulkStatus(\'ACTIVO\')">â†’ Activo</button> <button class="btn btn-sm" style="background:var(--yellow-light);color:var(--yellow)" onclick="bulkStatus(\'LICENCIA\')">â†’ Licencia</button> <button class="btn btn-d btn-sm" onclick="bulkStatus(\'BAJA\')">â†’ Baja</button>':'';}
function clearBulk(){sel.clear();updBulk();fE();}
function bulkStatus(st){if(U&&U.role==='JEFE'){toast('Sin permiso para cambiar status',1);return;}if(!sel.size)return;if(!confirm('Â¿Cambiar '+sel.size+' a '+st+'?'))return;let cnt=0;sel.forEach(id=>{const e=E.find(x=>x.id===id);if(e){if(st==='BAJA'&&e.status!=='BAJA')B.push({fecha:new Date().toISOString().slice(0,10),status:'NO CUBIERTO',rut:e.rut,nombre:e.nombre,cargo:e.cargo,motivo:'Baja masiva'});e.status=st;cnt++;}});aa('BULK','â†’ '+st+': '+cnt);sel.clear();save();refreshAll();toast('âœ… '+cnt+' actualizados');}
function bulkCap(){if(!sel.size)return;let cnt=0;sel.forEach(id=>{const e=E.find(x=>x.id===id);if(e){e.capacitacion='Realizado';cnt++;}});aa('BULK','Cap.D44 âœ“: '+cnt);sel.clear();save();refreshAll();toast('âœ… Cap.D44');}

// ADD EMPLOYEE
function openAdd(){document.getElementById('mt').textContent='Nuevo Colaborador';const ds=[...new Set(E.map(e=>e.dpto))].filter(Boolean).sort(),cs=[...new Set(E.map(e=>e.cargo))].filter(Boolean).sort(),js=[...new Set(E.map(e=>e.jefatura))].filter(Boolean).sort(),ccs=[...new Set(E.map(e=>e.ccosto).filter(Boolean))].sort(),lns=[...new Set(E.map(e=>e.linea).filter(Boolean))].sort();document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg"><div class="fl">Nombre *</div><input class="fi" id="n-n" placeholder="APELLIDO NOMBRE"></div><div class="fg"><div class="fl">RUT *</div><input class="fi" id="n-r" placeholder="12.345.678-9"></div><div class="fg"><div class="fl">COD</div><input class="fi" id="n-cd"></div><div class="fg"><div class="fl">Dpto *</div><select class="fi" id="n-d">'+ds.map(d=>'<option>'+d+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Cargo *</div><select class="fi" id="n-cg">'+cs.map(c=>'<option>'+c+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Puesto</div><input class="fi" id="n-p"></div><div class="fg"><div class="fl">C.Costo</div><input class="fi" id="n-cc" list="dl-cc" placeholder="AD-00004"><datalist id="dl-cc">'+ccs.map(c=>'<option value="'+c+'">').join('')+'</datalist></div><div class="fg"><div class="fl">LÃ­nea</div><input class="fi" id="n-ln" list="dl-ln"><datalist id="dl-ln">'+lns.map(l=>'<option value="'+l+'">').join('')+'</datalist></div><div class="fg"><div class="fl">Jefatura</div><select class="fi" id="n-j">'+js.map(j=>'<option>'+j+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Contrato</div><select class="fi" id="n-tc"><option>PLAZO FIJO</option><option>INDEFINIDO</option></select></div><div class="fg"><div class="fl">Ingreso *</div><input type="date" class="fi" id="n-i" value="'+new Date().toISOString().slice(0,10)+'"></div><div class="fg"><div class="fl">Nacimiento</div><input type="date" class="fi" id="n-nc"></div><div class="fg full"><div class="fl">DirecciÃ³n</div><input class="fi" id="n-dir"></div><div class="fg"><div class="fl">Comuna</div><input class="fi" id="n-cm"></div><div class="fg"><div class="fl">Tel</div><input class="fi" id="n-t"></div><div class="fg full"><div class="fl">Email</div><input class="fi" id="n-m"></div></div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveNew()">âœ… Registrar</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';document.getElementById('modal').style.display='flex';}
function saveNew(){const n=document.getElementById('n-n').value.trim(),r=document.getElementById('n-r').value.trim();if(!n||!r){toast('Nombre y RUT obligatorios',1);return;}if(E.some(e=>e.rut===r)){toast('RUT ya existe',1);return;}E.push({id:nid(),nombre:n,rut:r,cod:document.getElementById('n-cd').value.trim(),ccosto:document.getElementById('n-cc').value.trim()||'AD-00004',dpto:document.getElementById('n-d').value,cargo:document.getElementById('n-cg').value,linea:document.getElementById('n-ln').value.trim(),puesto:document.getElementById('n-p').value.trim(),jefatura:document.getElementById('n-j').value,tipoContrato:document.getElementById('n-tc').value,ingreso:document.getElementById('n-i').value,nacimiento:document.getElementById('n-nc').value,direccion:document.getElementById('n-dir').value.trim(),comuna:document.getElementById('n-cm').value.trim(),telefono:document.getElementById('n-t').value.trim(),mail:document.getElementById('n-m').value.trim(),status:'ACTIVO',capacitacion:'Pendiente',antiguedad:0});aa('ALTA','Nuevo: '+n);save();clM();refreshAll();toast('âœ… Registrado');}

// EMPLOYEE DETAIL
function openEmp(id){const e=E.find(x=>x.id===id);if(!e)return;const sn=sen(e.ingreso),ec=CH.filter(c=>c.rut===e.rut),li=lics[e.rut]||{},dc=docs[e.rut]||[],vd=vacDays(e),vu=vacUsed(e.rut),vs=vd-vu;const isA=U&&(U.role==='ADMIN'||U.role==='SUB'||U.role==='GESTION');const isJefe=U&&U.role==='JEFE';
let chH='';if(ec.length)chH='<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border)"><strong style="font-size:11px;color:var(--teal-dark)">ğŸ“‹ Cambios</strong><table style="margin-top:4px"><thead><tr><th>Fecha</th><th>Anterior</th><th>Nuevo</th></tr></thead><tbody>'+ec.map(c=>'<tr><td>'+fd(c.desde)+'</td><td>'+c.cargoAnterior+'</td><td style="color:var(--teal);font-weight:600">'+c.nuevoCargo+'</td></tr>').join('')+'</tbody></table></div>';
document.getElementById('mt').textContent=e.nombre;
const dds=[...new Set(E.map(x=>x.dpto))].filter(Boolean).sort();
const ccs=[...new Set(E.map(x=>x.cargo))].filter(Boolean).sort();
const jjs=[...new Set(E.map(x=>x.jefatura))].filter(Boolean).sort();
const pps=[...new Set(E.map(x=>x.puesto))].filter(Boolean).sort();
const lls=[...new Set(E.map(x=>x.linea))].filter(Boolean).sort();
document.getElementById('mbd').innerHTML='<div class="tabs"><div class="tab active" onclick="stab(this,\'ti\')">Info</div><div class="tab" onclick="stab(this,\'te\')">Editar</div>'+(isA?'<div class="tab" onclick="stab(this,\'ts\')">Status</div>':'')+'<div class="tab" onclick="stab(this,\'td\')">Docs ('+dc.length+')</div><div class="tab" onclick="stab(this,\'tv\')">Vacaciones</div><div class="tab" onclick="stab(this,\'tp\')">Permisos</div></div>'+
'<div id="ti"><div class="sn2"><div class="big">'+sn.y+'a '+sn.m+'m '+sn.d+'d</div><div class="det">Desde '+fd(e.ingreso)+'</div></div><div class="fg2" style="margin-top:12px"><div class="fg"><div class="fl">COD</div><div style="font-family:var(--mono);font-weight:600">'+e.cod+'</div></div><div class="fg"><div class="fl">RUT</div><div style="font-family:var(--mono)">'+e.rut+'</div></div><div class="fg"><div class="fl">Dpto</div><div>'+e.dpto+'</div></div><div class="fg"><div class="fl">Cargo</div><div style="font-weight:600">'+e.cargo+'</div></div><div class="fg"><div class="fl">Puesto</div><div>'+e.puesto+'</div></div><div class="fg"><div class="fl">C.Costo</div><div style="font-family:var(--mono);font-size:11px">'+(e.ccosto||'â€”')+'</div></div><div class="fg"><div class="fl">LÃ­nea</div><div>'+(e.linea||'â€”')+'</div></div><div class="fg"><div class="fl">Jefatura</div><div>'+e.jefatura+'</div></div><div class="fg"><div class="fl">Contrato</div><span class="badge '+(e.tipoContrato==='INDEFINIDO'?'b-ok':'b-bl')+'">'+(e.tipoContrato||'â€”')+'</span></div><div class="fg"><div class="fl">Cap.D44</div><span class="badge '+(e.capacitacion==='Realizado'?'b-ok':e.capacitacion==='Pendiente'?'b-lic':'b-pu')+'">'+(e.capacitacion||'â€”')+'</span></div><div class="fg"><div class="fl">Tel</div><div>'+(e.telefono||'â€”')+'</div></div><div class="fg"><div class="fl">Email</div><div style="font-size:10px;word-break:break-all">'+(e.mail||'â€”')+'</div></div><div class="fg full"><div class="fl">DirecciÃ³n</div><div>'+(e.direccion||'â€”')+(e.comuna?', '+e.comuna:'')+'</div></div><div class="fg"><div class="fl">Nacimiento</div><div>'+fd(e.nacimiento)+'</div></div><div class="fg"><div class="fl">Vacaciones</div><div style="font-weight:700">'+vs+'d restantes <span style="font-size:10px;color:var(--text3)">('+vd+' der, '+vu+' usados)</span></div></div></div>'+chH+'<div style="margin-top:10px"><button class="btn btn-g btn-sm" onclick="window.print()">ğŸ–¨ï¸ Imprimir</button></div></div>'+
'<div id="te" style="display:none"><div class="fg2"><div class="fg"><div class="fl">Dpto / Bodega</div><select class="fi" id="ed-d">'+dds.map(d=>'<option'+(d===e.dpto?' selected':'')+'>'+d+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Puesto</div><select class="fi" id="ed-p">'+pps.map(p=>'<option'+(p===e.puesto?' selected':'')+'>'+p+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Centro Costo</div><input class="fi" id="ed-cc" value="'+(e.ccosto||'')+'"></div><div class="fg"><div class="fl">LÃ­nea</div><select class="fi" id="ed-ln">'+lls.map(l=>'<option'+(l===e.linea?' selected':'')+'>'+l+'</option>').join('')+'</select></div>'+(isA?'<div class="fg"><div class="fl">Cargo âœ±</div><select class="fi" id="ed-c">'+ccs.map(c=>'<option'+(c===e.cargo?' selected':'')+'>'+c+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Jefatura âœ±</div><select class="fi" id="ed-j">'+jjs.map(j=>'<option'+(j===e.jefatura?' selected':'')+'>'+j+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Contrato âœ±</div><select class="fi" id="ed-tc"><option'+(e.tipoContrato==='INDEFINIDO'?' selected':'')+'>INDEFINIDO</option><option'+(e.tipoContrato==='PLAZO FIJO'?' selected':'')+'>PLAZO FIJO</option></select></div><div class="fg"><div class="fl">Cap.D44 âœ±</div><select class="fi" id="ed-cp"><option'+(e.capacitacion==='Realizado'?' selected':'')+'>Realizado</option><option'+(e.capacitacion==='Pendiente'?' selected':'')+'>Pendiente</option><option'+(e.capacitacion==='NoRealizar'?' selected':'')+'>NoRealizar</option></select></div>':'<div class="fg"><div class="fl">Cargo</div><div style="font-size:12px;font-weight:600">'+e.cargo+'</div><input type="hidden" id="ed-c" value="'+e.cargo+'"></div><div class="fg"><div class="fl">Jefatura</div><div style="font-size:12px">'+e.jefatura+'</div><input type="hidden" id="ed-j" value="'+e.jefatura+'"></div><div class="fg"><div class="fl">Contrato</div><div style="font-size:12px">'+e.tipoContrato+'</div><input type="hidden" id="ed-tc" value="'+e.tipoContrato+'"></div><div class="fg"><div class="fl">Cap.D44</div><div style="font-size:12px">'+e.capacitacion+'</div><input type="hidden" id="ed-cp" value="'+e.capacitacion+'"></div>')+'<div class="fg full"><div class="fl">DirecciÃ³n</div><input class="fi" id="ed-dir" value="'+(e.direccion||'')+'"></div><div class="fg"><div class="fl">Comuna</div><input class="fi" id="ed-cm" value="'+(e.comuna||'')+'"></div><div class="fg"><div class="fl">Tel</div><input class="fi" id="ed-tel" value="'+(e.telefono||'')+'"></div><div class="fg full"><div class="fl">Email</div><input class="fi" id="ed-ml" value="'+(e.mail||'')+'"></div></div>'+(isA?'<div style="margin-top:4px;font-size:9px;color:var(--text3)">âœ± Solo Admin/Subgerente</div>':'')+'<div style="margin-top:10px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveEmp('+e.id+')">ğŸ’¾ Guardar</button><button class="btn btn-g" onclick="clM()">Cancelar</button>'+(isA?'<button class="btn btn-d" style="margin-left:auto" onclick="delEmp('+e.id+')">ğŸ—‘ï¸ Baja</button>':'')+'</div></div>'+
'<div id="ts" style="display:none"><div class="fg2"><div class="fg"><div class="fl">Status</div><select class="fi" id="st-s" onchange="togL()"><option'+(e.status==='ACTIVO'?' selected':'')+'>ACTIVO</option><option'+(e.status==='LICENCIA'?' selected':'')+'>LICENCIA</option><option'+(e.status==='BAJA'?' selected':'')+'>BAJA</option></select></div><div class="fg"><div class="fl">Motivo</div><input class="fi" id="st-m" value="'+(li.motivo||'')+'" placeholder="Motivo..."></div><div class="fg" id="ls-g"><div class="fl">Inicio Lic.</div><input type="date" class="fi" id="st-ls" value="'+(li.start||'')+'"></div><div class="fg" id="le-g"><div class="fl">TÃ©rmino Lic.</div><input type="date" class="fi" id="st-le" value="'+(li.end||'')+'"></div></div><div id="la" style="margin-top:10px"></div><div style="margin-top:10px"><button class="btn btn-p" onclick="saveSt('+e.id+')">ğŸ’¾ Actualizar</button></div></div>'+
'<div id="td" style="display:none"><div class="du" onclick="document.getElementById(\'df'+e.id+'\').click()"><input type="file" id="df'+e.id+'" onchange="upDoc('+e.id+',this)" multiple><div style="font-size:18px">ğŸ“</div><div style="font-size:11px;font-weight:600;color:var(--teal)">Click para subir</div></div><div style="margin-top:6px"><div class="fl">Tipo</div><div class="dtb">'+DT.map((t,i)=>'<span class="'+(i===0?'active':'')+'" onclick="selDocType=\''+t+'\';this.parentElement.querySelectorAll(\'span\').forEach(b=>b.classList.remove(\'active\'));this.classList.add(\'active\')">'+t+'</span>').join('')+'</div></div><div id="dl'+e.id+'" style="margin-top:6px">'+renderDocList(dc,e.rut)+'</div></div>'+
'<div id="tv" style="display:none"><div style="background:var(--teal-bg);border:1px solid var(--teal);border-radius:10px;padding:14px;margin-bottom:12px"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:10px;color:var(--teal);font-weight:600">SALDO VACACIONES</div><div style="font-size:28px;font-weight:800;color:var(--teal-dark);font-family:var(--mono)">'+vs+'d</div></div><div style="text-align:right;font-size:11px;color:var(--text2)"><div>Derecho: '+vd+'d/aÃ±o</div><div>Usados: '+vu+'d</div><div>AntigÃ¼edad: '+sn.y+'a</div></div></div><div class="vac-bar" style="margin-top:8px"><div class="vac-bar-fill" style="width:'+(vd?vu/vd*100:0)+'%;background:'+(vs<=3?'var(--red)':vs<=5?'var(--yellow)':'var(--teal)')+'"></div></div></div>'+
vac.filter(v=>v.rut===e.rut).sort((a,b)=>b.start.localeCompare(a.start)).map(v=>'<div class="di" style="margin-bottom:4px"><div style="flex:1"><div class="dn">'+fd(v.start)+' â†’ '+fd(v.end)+' ('+v.dias+'d)</div><div class="dm">'+(v.nota||'')+'</div></div><span class="badge '+(v.status==='APROBADA'?'b-ok':v.status==='PENDIENTE'?'b-lic':'b-no')+'">'+v.status+'</span></div>').join('')+
'<div style="margin-top:10px"><button class="btn btn-p btn-sm" onclick="clM();openVacFor(\''+e.rut+'\')">+ Solicitar Vacaciones</button></div></div>'+
'<div id="tp" style="display:none">'+buildPermisosTab(e)+'</div>';
document.getElementById('st-le').addEventListener('change',calcLA);if(li.end)calcLA();togL();document.getElementById('modal').style.display='flex';}
function renderDocList(dc,rut){const canDel=U&&(U.role==='ADMIN'||U.role==='SUB'||U.role==='GESTION');return dc.length?dc.map((d,i)=>'<div class="di"><span style="font-size:14px">'+(d.type==='Contrato'?'ğŸ“„':'ğŸ“')+'</span><div style="flex:1"><div class="dn">'+d.name+'</div><div class="dm">'+d.type+' â€” '+d.date+' â€” '+d.size+'</div></div>'+(canDel?'<button style="background:none;border:none;color:var(--text3);cursor:pointer" onclick="delDoc(\''+rut+'\','+i+')">Ã—</button>':'')+'</div>').join(''):'<div style="font-size:10px;color:var(--text3);padding:6px">Sin documentos</div>';}
function stab(el,id){el.parentElement.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');['ti','te','ts','td','tv','tp'].forEach(t=>{const x=document.getElementById(t);if(x)x.style.display=t===id?'block':'none';});if(id==='ts')togL();}
function togL(){const s=document.getElementById('st-s').value==='LICENCIA';document.getElementById('ls-g').style.display=s?'':'none';document.getElementById('le-g').style.display=s?'':'none';}
function calcLA(){const v=document.getElementById('st-le').value;if(!v)return;const d=ddF(v),el=document.getElementById('la');if(d<0)el.innerHTML='<div class="ai critical">ğŸ”´ <strong>VENCIDA</strong> hace '+Math.abs(d)+' dÃ­as</div>';else if(d<=7)el.innerHTML='<div class="ai">âš ï¸ Termina en <strong>'+d+' dÃ­as</strong></div>';else el.innerHTML='<div class="ai success">âœ… Vigente '+d+' dÃ­as</div>';}
function saveEmp(id){const e=E.find(x=>x.id===id),oC=e.cargo,oD=e.dpto,oP=e.puesto,oL=e.linea;e.dpto=document.getElementById('ed-d').value;e.cargo=document.getElementById('ed-c').value;e.puesto=document.getElementById('ed-p').value;e.jefatura=document.getElementById('ed-j').value;e.tipoContrato=document.getElementById('ed-tc').value;e.capacitacion=document.getElementById('ed-cp').value;e.ccosto=document.getElementById('ed-cc').value;e.linea=document.getElementById('ed-ln').value;e.direccion=document.getElementById('ed-dir').value;e.comuna=document.getElementById('ed-cm').value;e.telefono=document.getElementById('ed-tel').value;e.mail=document.getElementById('ed-ml').value;if(oC!==e.cargo){CH.push({desde:new Date().toISOString().slice(0,10),cod:e.cod,rut:e.rut,nombre:e.nombre,dpto:e.dpto,cargoAnterior:oC,nuevoCargo:e.cargo,jefatura:e.jefatura});aa('CAMBIO',e.nombre+': '+oC+' â†’ '+e.cargo);}else if(oD!==e.dpto){aa('TRASLADO',e.nombre+': '+oD+' â†’ '+e.dpto);}else if(oP!==e.puesto||oL!==e.linea){var mov=[];if(oP!==e.puesto)mov.push('Puesto: '+oP+' â†’ '+e.puesto);if(oL!==e.linea)mov.push('LÃ­nea: '+oL+' â†’ '+e.linea);aa('MOVIMIENTO',e.nombre+': '+mov.join(', '));}else aa('EDICIÃ“N',e.nombre);save();clM();refreshAll();toast('âœ… Guardado');}
function saveSt(id){if(U&&U.role==='JEFE'){toast('Sin permiso para cambiar status',1);return;}const e=E.find(x=>x.id===id),ns=document.getElementById('st-s').value;if(ns==='BAJA'&&e.status!=='BAJA'){B.push({fecha:new Date().toISOString().slice(0,10),status:'NO CUBIERTO',rut:e.rut,nombre:e.nombre,cargo:e.cargo,motivo:document.getElementById('st-m').value||'Sin especificar'});aa('BAJA',e.nombre);}if(ns==='LICENCIA'){lics[e.rut]={start:document.getElementById('st-ls').value,end:document.getElementById('st-le').value,motivo:document.getElementById('st-m').value};aa('LICENCIA',e.nombre);}else if(e.status==='LICENCIA'&&ns!=='LICENCIA'){aa('REINTEGRO',e.nombre);delete lics[e.rut];}e.status=ns;save();clM();refreshAll();toast('âœ… Status');}
function delEmp(id){if(U&&U.role==='JEFE'){toast('Sin permiso',1);return;}const e=E.find(x=>x.id===id);if(!confirm('Â¿Dar de baja a '+e.nombre+'?'))return;e.status='BAJA';B.push({fecha:new Date().toISOString().slice(0,10),status:'NO CUBIERTO',rut:e.rut,nombre:e.nombre,cargo:e.cargo,motivo:'Baja sistema'});aa('BAJA',e.nombre);save();clM();refreshAll();toast('Baja');}
function upDoc(id,inp){const e=E.find(x=>x.id===id);if(!docs[e.rut])docs[e.rut]=[];Array.from(inp.files).forEach(f=>{const r=new FileReader();r.onload=function(){docs[e.rut].push({name:f.name,type:selDocType,date:new Date().toISOString().slice(0,10),size:(f.size/1024).toFixed(0)+' KB',data:r.result});aa('DOC',f.name+' â†’ '+e.nombre);save();toast('ğŸ“ '+f.name);};r.readAsDataURL(f);});}
function delDoc(rut,i){if(U&&U.role==='JEFE'){toast('Sin permiso para eliminar documentos',1);return;}if(!confirm('Â¿Eliminar?'))return;docs[rut].splice(i,1);save();toast('Eliminado');}

// RESUMEN â€” DotaciÃ³n: solo diferencias agrupadas por Ã¡rea
function rRes(){const visAc=vis().filter(e=>e.status==='ACTIVO');
const visDptos=U&&U.filter?U.filter:null;
// Build puesto-level counts
const byDCP={};visAc.forEach(e=>{const k=e.dpto+'|'+e.cargo+'|'+e.puesto;byDCP[k]=(byDCP[k]||0)+1;});
// Add projected from authDC
Object.entries(authDC).forEach(([k,v])=>{if(v>0&&!byDCP[k]){const d=k.split('|')[0];if(visDptos&&!visDptos.includes(d))return;byDCP[k]=0;}});
// Build full list
const all=Object.entries(byDCP).map(([k,actual])=>{const p=k.split('|');const aut=authDC[k]||0;return{key:k,dpto:p[0],cargo:p[1],puesto:p[2],actual,aut,diff:actual-aut};});
const withDiff=all.filter(x=>x.diff!==0);
const bajo=withDiff.filter(x=>x.diff<0);const sobre=withDiff.filter(x=>x.diff>0);const ok2=all.filter(x=>x.diff===0);
const totAct=visAc.length;const totAuth=visDptos?getAuthTotal(visDptos):getAuthTotal(null);
const deficit=bajo.reduce((s,x)=>s+Math.abs(x.diff),0);const exceso=sobre.reduce((s,x)=>s+x.diff,0);
// KPIs
document.getElementById('rk-dot').innerHTML='<div class="kc"><div class="kl">Actual</div><div class="kv" style="color:var(--teal)">'+totAct+'</div></div><div class="kc"><div class="kl">Necesidad</div><div class="kv">'+totAuth+'</div></div><div class="kc"><div class="kl">Diferencia</div><div class="kv" style="color:'+(totAct-totAuth<0?'var(--red)':totAct-totAuth>0?'var(--yellow)':'var(--teal)')+'">'+(totAct-totAuth>0?'+'+(totAct-totAuth):totAct-totAuth)+'</div></div><div class="kc"><div class="kl">Faltan</div><div class="kv" style="color:var(--red)">'+deficit+'</div><div class="ks neg">'+bajo.length+' posiciones</div></div><div class="kc"><div class="kl">Sobran</div><div class="kv" style="color:var(--yellow)">'+exceso+'</div><div class="ks">'+sobre.length+' posiciones</div></div><div class="kc"><div class="kl">En DotaciÃ³n</div><div class="kv" style="color:var(--teal)">'+ok2.length+'</div></div>';
// Group differences by department
const dptos=[...new Set(withDiff.map(x=>x.dpto))].sort();
let h='';
if(withDiff.length===0){h='<div class="cc" style="text-align:center;padding:30px;color:var(--teal)"><div style="font-size:36px;margin-bottom:8px">âœ…</div><div style="font-size:16px;font-weight:700">DotaciÃ³n completa</div><div style="font-size:12px;color:var(--text3);margin-top:4px">Todas las posiciones estÃ¡n cubiertas</div></div>';}
else{
dptos.forEach(dpto=>{
const items=withDiff.filter(x=>x.dpto===dpto).sort((a,b)=>a.diff-b.diff);
const dptoFaltan=items.filter(x=>x.diff<0).reduce((s,x)=>s+Math.abs(x.diff),0);
const dptoSobran=items.filter(x=>x.diff>0).reduce((s,x)=>s+x.diff,0);
const dptoAct=all.filter(x=>x.dpto===dpto).reduce((s,x)=>s+x.actual,0);
const dptoNec=all.filter(x=>x.dpto===dpto).reduce((s,x)=>s+x.aut,0);
h+='<div class="cc" style="margin-bottom:12px;border-left:3px solid var(--teal)">';
h+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><div><h3 style="margin:0;font-size:14px">'+dpto+'</h3><div style="font-size:11px;color:var(--text3)">'+dptoAct+' actual / '+dptoNec+' necesidad</div></div><div style="display:flex;gap:10px">';
if(dptoFaltan>0)h+='<span style="font-size:13px;font-weight:800;color:var(--red)">-'+dptoFaltan+'</span>';
if(dptoSobran>0)h+='<span style="font-size:13px;font-weight:800;color:var(--yellow)">+'+dptoSobran+'</span>';
h+='</div></div>';
h+='<table style="width:100%;font-size:11px"><thead><tr><th style="text-align:left;padding:4px 8px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">PUESTO</th><th style="text-align:left;padding:4px 8px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">CARGO</th><th style="text-align:center;padding:4px 8px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">ACTUAL</th><th style="text-align:center;padding:4px 8px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">NECESID.</th><th style="text-align:center;padding:4px 8px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">DIF</th></tr></thead><tbody>';
items.forEach(x=>{
const clr=x.diff<0?'var(--red)':'var(--yellow)';
const icon=x.diff<0?'â¬‡':'â¬†';
h+='<tr style="cursor:pointer;border-bottom:1px solid var(--border)" onclick="openDotDet(\''+x.key.replace(/'/g,"\\\\'")+'\')" onmouseover="this.style.background=\'var(--surface)\'" onmouseout="this.style.background=\'\'">';
h+='<td style="padding:6px 8px;font-weight:600">'+x.puesto+(x.actual===0?' <span style="font-size:9px;color:var(--yellow)">PROYECTADO</span>':'')+'</td>';
h+='<td style="padding:6px 8px;color:var(--text2)">'+x.cargo+'</td>';
h+='<td style="padding:6px 8px;text-align:center;font-family:var(--mono)">'+x.actual+'</td>';
h+='<td style="padding:6px 8px;text-align:center;font-family:var(--mono)">'+x.aut+'</td>';
h+='<td style="padding:6px 8px;text-align:center;font-weight:800;color:'+clr+'">'+icon+' '+(x.diff>0?'+'+x.diff:x.diff)+'</td>';
h+='</tr>';});
h+='</tbody></table></div>';});}
document.getElementById('sg').innerHTML=h;
// Bar chart by cargo
const allC2={};visAc.forEach(e=>{allC2[e.cargo]=(allC2[e.cargo]||0)+1;});
const visAuthByCargo={};Object.entries(authDC).forEach(([k,v])=>{const p=k.split('|');if(visDptos&&!visDptos.includes(p[0]))return;visAuthByCargo[p[1]]=(visAuthByCargo[p[1]]||0)+v;});
const mx=Math.max(...Object.values(allC2).map(v=>v),...Object.values(visAuthByCargo).map(v=>v),1);
document.getElementById('cb2').innerHTML=Object.entries(allC2).sort((a,b)=>b[1]-a[1]).map(([c,a2])=>{const n=visAuthByCargo[c]||a2,d2=a2-n,dc=d2>0?'color:var(--teal)':d2<0?'color:var(--red)':'color:var(--text3)';return'<div class="br"><div class="bl" title="'+c+'">'+c+'</div><div class="bt"><div class="bf" style="width:'+a2/mx*100+'%;background:var(--teal)"><span>'+a2+'</span></div>'+(n!==a2?'<div style="position:absolute;top:0;height:100%;border-right:2px dashed var(--red);left:'+n/mx*100+'%"></div>':'')+'</div><div class="bv" style="'+dc+'">'+(d2>0?'+'+d2:d2)+'</div></div>';}).join('');}

function openDotDet(key){const p=key.split('|');const dpto=p[0],cargo=p[1],puesto=p[2];
const ac=vis().filter(e=>e.status==='ACTIVO'&&e.dpto===dpto&&e.cargo===cargo&&e.puesto===puesto);
const aut=authDC[key]||0;const diff=ac.length-aut;
document.getElementById('mt').textContent=puesto+' â€” Detalle';
let h='<div style="display:flex;gap:12px;margin-bottom:16px"><div class="rpt-stat" style="flex:1"><div class="rv" style="color:var(--teal)">'+ac.length+'</div><div class="rl">Actual</div></div><div class="rpt-stat" style="flex:1"><div class="rv">'+aut+'</div><div class="rl">Necesidad</div></div><div class="rpt-stat" style="flex:1"><div class="rv" style="color:'+(diff<0?'var(--red)':diff>0?'var(--yellow)':'var(--teal)')+'">'+(diff>0?'+'+diff:diff)+'</div><div class="rl">Diferencia</div></div></div>';
h+='<div style="margin-bottom:8px;font-size:11px;color:var(--text2)"><strong>Departamento:</strong> '+dpto+' | <strong>Cargo:</strong> '+cargo+' | <strong>Puesto:</strong> '+puesto+'</div>';
if(ac.length>0){h+='<table style="width:100%"><thead><tr><th>NOMBRE</th><th>LÃNEA</th><th>C.COSTO</th><th>JEFATURA</th><th>INGRESO</th><th>CONTRATO</th></tr></thead><tbody>';
ac.sort((a,b)=>a.nombre.localeCompare(b.nombre)).forEach(e=>{h+='<tr style="cursor:pointer" onclick="clM();openEmp('+e.id+')"><td><strong>'+e.nombre+'</strong></td><td>'+(e.linea||'â€”')+'</td><td style="font-family:var(--mono);font-size:10px">'+(e.ccosto||'')+'</td><td>'+e.jefatura+'</td><td>'+fd(e.ingreso)+'</td><td><span class="badge '+(e.tipoContrato==='INDEFINIDO'?'b-ok':'b-bl')+'">'+e.tipoContrato+'</span></td></tr>';});
h+='</tbody></table>';}else{h+='<div style="text-align:center;padding:20px;color:var(--text3)">ğŸ“‹ PosiciÃ³n proyectada â€” Sin colaboradores asignados</div>';}
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';}

function openEditAuth(){const dv='';
document.getElementById('mt').textContent='DotaciÃ³n â€” Necesidad por Puesto';
const visDptos=U&&U.filter?U.filter:null;
const ds=[...new Set(vis().filter(e=>e.status==='ACTIVO').map(e=>e.dpto))].filter(Boolean).sort();
let h='<div style="margin-bottom:12px"><select class="fi" id="ea-d" onchange="renderAuthEdit()" style="width:auto"><option value="">Todos los dptos</option>'+ds.map(d=>'<option'+(d===dv?' selected':'')+'>'+d+'</option>').join('')+'</select></div><div id="ea-list" style="max-height:55vh;overflow:auto"></div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveAuth()">ğŸ’¾ Guardar</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('mbd').innerHTML=h;
renderAuthEdit();
document.getElementById('modal').style.display='flex';}

function renderAuthEdit(){const dv=document.getElementById('ea-d').value;
const ac=vis().filter(e=>e.status==='ACTIVO');
const visDptos=U&&U.filter?U.filter:null;
// Build actual counts by triple key
const byDCP={};ac.forEach(e=>{const k=e.dpto+'|'+e.cargo+'|'+e.puesto;byDCP[k]=(byDCP[k]||0)+1;});
// Add projected from authDC
Object.entries(authDC).forEach(([k,v])=>{if(v>0&&!byDCP[k]){const p=k.split('|');if(visDptos&&!visDptos.includes(p[0]))return;byDCP[k]=0;}});
// Filter by selected dpto
let keys=Object.keys(byDCP).sort();
if(dv)keys=keys.filter(k=>k.startsWith(dv+'|'));
document.getElementById('ea-list').innerHTML='<div style="display:grid;grid-template-columns:1fr 90px 60px 50px 50px;gap:4px;font-size:9px;font-weight:700;color:var(--text3);padding:0 0 6px;position:sticky;top:0;background:var(--bg);z-index:1"><span>PUESTO</span><span>DPTO</span><span style="text-align:center">NECESID.</span><span style="text-align:center">ACTUAL</span><span style="text-align:center">DIF</span></div>'+keys.map(k=>{const p=k.split('|');const act2=byDCP[k]||0;const au=authDC[k]||0;const df=act2-au;const dc=df<0?'color:var(--red)':df>0?'color:var(--teal)':'color:var(--text3)';const sid=k.replace(/[\s|]/g,'_');
return'<div style="display:grid;grid-template-columns:1fr 90px 60px 50px 50px;gap:4px;align-items:center;padding:3px 0;border-bottom:1px solid var(--border)"><div><span style="font-size:11px;font-weight:600">'+p[2]+'</span><div style="font-size:9px;color:var(--text3)">'+p[1]+'</div></div><span style="font-size:9px;color:var(--text3)">'+p[0].replace('CD ','').replace('ADM-','')+'</span><input type="number" class="fi" style="width:60px;text-align:center;padding:4px" data-key="'+k+'" value="'+au+'" min="0" oninput="previewAuthDiff(this,'+act2+')"><span style="text-align:center;font-family:var(--mono);font-size:11px">'+act2+'</span><span style="text-align:center;font-weight:700;font-size:11px;'+dc+'" id="ad-'+sid+'">'+(df>0?'+'+df:df)+'</span></div>';}).join('');}

function previewAuthDiff(inp,actual){const k=inp.getAttribute('data-key');const sid=k.replace(/[\s|]/g,'_');const el=document.getElementById('ad-'+sid);if(!el)return;const au=parseInt(inp.value)||0;const df=actual-au;el.textContent=df>0?'+'+df:df;el.style.color=df<0?'var(--red)':df>0?'var(--teal)':'var(--text3)';}

function saveAuth(){
const inputs=document.querySelectorAll('#ea-list input[data-key]');
inputs.forEach(inp=>{const k=inp.getAttribute('data-key');const v=parseInt(inp.value)||0;authDC[k]=v;});
aa('CONFIG','DotaciÃ³n actualizada');save();clM();refreshAll();toast('âœ… DotaciÃ³n guardada');}

function openNewCargo(){document.getElementById('mt').textContent='â• Agregar Nuevo Cargo / Proyecto';
const ac=vis().filter(e=>e.status==='ACTIVO');
const ds=[...new Set(ac.map(e=>e.dpto))].filter(Boolean).sort();
const cgs=[...new Set([...ac.map(e=>e.cargo),...Object.entries(authDC).map(([k])=>k.split('|')[1])])].filter(Boolean).sort();
const pus=[...new Set([...ac.map(e=>e.puesto),...Object.entries(authDC).map(([k])=>k.split('|')[2])])].filter(Boolean).sort();
let h='<div style="padding:12px;background:var(--teal-bg);border-radius:var(--radius);border:1px solid var(--teal);margin-bottom:16px;font-size:11px;color:var(--teal)"><strong>â„¹ï¸ Agregar posiciones proyectadas</strong> â€” Define puestos y dotaciÃ³n necesaria antes de contratar. AparecerÃ¡n como "PROYECTADO" en la dotaciÃ³n.</div>';
h+='<div class="fg2">';
h+='<div class="fg"><div class="fl">Departamento *</div><select class="fi" id="nc-d">'+ds.map(d=>'<option>'+d+'</option>').join('')+'</select></div>';
h+='<div class="fg"><div class="fl">Cargo *</div><input class="fi" id="nc-c" list="nc-clist" placeholder="Escribir o seleccionar"><datalist id="nc-clist">'+cgs.map(c=>'<option value="'+c+'">').join('')+'</datalist></div>';
h+='<div class="fg"><div class="fl">Puesto *</div><input class="fi" id="nc-pu" list="nc-pulist" placeholder="Ej: PICKING, ALMACEN"><datalist id="nc-pulist">'+pus.map(p=>'<option value="'+p+'">').join('')+'</datalist></div>';
h+='<div class="fg"><div class="fl">Necesidad *</div><input type="number" class="fi" id="nc-a" min="1" value="1" style="width:80px;text-align:center"></div>';
h+='</div>';
// Show current projected positions
const visDptos=U&&U.filter?U.filter:null;
const projected=[];
Object.entries(authDC).forEach(([k,v])=>{if(v>0){const p=k.split('|');if(visDptos&&!visDptos.includes(p[0]))return;const hasEmp=ac.some(e=>e.dpto===p[0]&&e.cargo===p[1]&&e.puesto===p[2]);if(!hasEmp)projected.push({key:k,dpto:p[0],cargo:p[1],puesto:p[2],aut:v});}});
if(projected.length>0){
h+='<div style="margin-top:16px;border-top:1px solid var(--border);padding-top:12px"><div class="fl" style="margin-bottom:8px">ğŸ“‹ Posiciones Proyectadas ('+projected.length+')</div>';
h+='<div style="display:grid;grid-template-columns:90px 1fr 1fr 50px 40px;gap:4px;font-size:9px;font-weight:700;color:var(--text3);padding-bottom:4px"><span>DPTO</span><span>CARGO</span><span>PUESTO</span><span style="text-align:center">NEC.</span><span></span></div>';
projected.sort((a,b)=>a.dpto.localeCompare(b.dpto)||a.cargo.localeCompare(b.cargo)).forEach(p=>{
h+='<div style="display:grid;grid-template-columns:90px 1fr 1fr 50px 40px;gap:4px;align-items:center;padding:4px 0;border-bottom:1px solid var(--border);font-size:11px"><span style="font-size:9px">'+p.dpto+'</span><span>'+p.cargo+'</span><span style="font-weight:600">'+p.puesto+'</span><span style="text-align:center;font-family:var(--mono);font-weight:700;color:var(--yellow)">'+p.aut+'</span><button class="btn btn-g btn-sm" style="padding:2px 6px;font-size:10px" onclick="delProjectedCargo(\''+p.key.replace(/'/g,"\\'")+'\')">ğŸ—‘</button></div>';});
h+='</div>';}
h+='<div style="margin-top:16px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveNewCargo()">ğŸ’¾ Agregar</button><button class="btn btn-g" onclick="clM()">Cerrar</button></div>';
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';}

function saveNewCargo(){const dpto=document.getElementById('nc-d').value;
const cargo=document.getElementById('nc-c').value.trim().toUpperCase();
const puesto=document.getElementById('nc-pu').value.trim().toUpperCase();
const aut=parseInt(document.getElementById('nc-a').value)||0;
if(!cargo){toast('Ingrese nombre del cargo',1);return;}
if(!puesto){toast('Ingrese nombre del puesto',1);return;}
if(aut<1){toast('Necesidad debe ser al menos 1',1);return;}
const key=dpto+'|'+cargo+'|'+puesto;
const existing=authDC[key]||0;
if(existing>0){if(!confirm('Ya existe "'+puesto+'" con '+existing+' necesidad. Â¿Actualizar a '+aut+'?'))return;}
authDC[key]=aut;
aa('CONFIG','PosiciÃ³n proyectada: '+cargo+'/'+puesto+' ('+aut+') en '+dpto);
save();toast('âœ… PosiciÃ³n agregada: '+puesto+' en '+dpto+' â€” Necesidad: '+aut);
openNewCargo();}

function delProjectedCargo(key){const p=key.split('|');if(!confirm('Â¿Eliminar posiciÃ³n proyectada "'+p[2]+'" ('+p[1]+') de '+p[0]+'?'))return;
delete authDC[key];
aa('CONFIG','PosiciÃ³n proyectada eliminada: '+p[2]+' de '+p[0]);
save();refreshAll();toast('ğŸ—‘ PosiciÃ³n eliminada');
openNewCargo();}


// ROTACION
function rRot(){
// Base: dotaciÃ³n autorizada o activos
const dotBase=E.filter(e=>e.status==='ACTIVO').length+B.length;
const dotAct=E.filter(e=>e.status==='ACTIVO').length;
// Populate year filter
const sel2=document.getElementById('ry'),yrV=sel2.value;
const yrs=[...new Set(B.map(b=>b.fecha?b.fecha.slice(0,4):'').filter(Boolean))].sort().reverse();
sel2.innerHTML='<option value="">Todos</option>'+yrs.map(y=>'<option'+(y===yrV?' selected':'')+'>'+y+'</option>').join('');
const yr=sel2.value,mv=document.getElementById('rm').value;
const allB=B.filter(b=>b.fecha&&b.fecha!=='nan');
let fb=allB.slice();
if(yr)fb=fb.filter(b=>b.fecha.startsWith(yr));
if(mv)fb=fb.filter(b=>b.fecha.substring(5,7)===mv);
const tot=fb.length,cub=fb.filter(b=>b.status==='CUBIERTO').length,pend=tot-cub;
// Tasa = Bajas / DotaciÃ³n base Ã— 100
const tasa=dotBase>0?(tot/dotBase*100):0;
const tasaCob=tot>0?(cub/tot*100):0;
const periodoTxt=yr?(mv?MN[parseInt(mv)-1]+' '+yr:yr):'HistÃ³rico';
document.getElementById('rot-info').textContent='DotaciÃ³n base: '+dotBase+' | Activos: '+dotAct+' | FÃ³rmula: Bajas Ã· DotaciÃ³n Ã— 100';
// KPIs
document.getElementById('rk').innerHTML='<div class="kc"><div class="kl">Tasa RotaciÃ³n</div><div class="kv" style="color:'+(tasa>30?'var(--red)':tasa>15?'var(--yellow)':'var(--teal)')+'">'+tasa.toFixed(1)+'%</div><div style="font-size:10px;color:var(--text3)">'+periodoTxt+'</div></div><div class="kc"><div class="kl">Total Bajas</div><div class="kv" style="color:var(--red)">'+tot+'</div><div style="font-size:10px;color:var(--text3)">personas</div></div><div class="kc"><div class="kl">Cubiertas</div><div class="kv" style="color:var(--teal)">'+cub+'</div><div style="font-size:10px;color:var(--text3)">'+tasaCob.toFixed(0)+'% reposiciÃ³n</div></div><div class="kc"><div class="kl">Pendientes</div><div class="kv" style="color:'+(pend>0?'var(--red)':'var(--teal)')+'">'+pend+'</div><div style="font-size:10px;color:var(--text3)">'+(tot>0?((pend/tot)*100).toFixed(0):0)+'% sin cubrir</div></div>';
// Monthly breakdown
const byM={};fb.forEach(b=>{const k=b.fecha.substring(0,7);if(!byM[k])byM[k]={t:0,c:0};byM[k].t++;if(b.status==='CUBIERTO')byM[k].c++;});
const ms=Object.keys(byM).sort();
const mn2={'01':'Ene','02':'Feb','03':'Mar','04':'Abr','05':'May','06':'Jun','07':'Jul','08':'Ago','09':'Sep','10':'Oct','11':'Nov','12':'Dic'};
// SVG Chart with dual info (bars for qty, line for %)
if(ms.length>1){
const vals=ms.map(m=>byM[m].t);
const pcts=ms.map(m=>dotBase>0?(byM[m].t/dotBase*100):0);
const mxV=Math.max(...vals,1);const mxP=Math.max(...pcts,1);
const W=Math.max(ms.length*72,600),H=220,pad={t:35,r:50,b:40,l:45};
const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
const bW=Math.min(30,cW/ms.length*0.6);
// Grid
let svg='';const steps=5;
for(let i=0;i<=steps;i++){const y=pad.t+i*(cH/steps);const val=Math.round(mxV-(i*mxV/steps));svg+='<line x1="'+pad.l+'" y1="'+y+'" x2="'+(W-pad.r)+'" y2="'+y+'" stroke="var(--border)" stroke-dasharray="3,3"/><text x="'+(pad.l-6)+'" y="'+(y+3)+'" fill="var(--text3)" font-size="9" text-anchor="end" font-family="var(--mono)">'+val+'</text>';}
// Right axis (%)
for(let i=0;i<=steps;i++){const y=pad.t+i*(cH/steps);const val=(mxP-(i*mxP/steps)).toFixed(1);svg+='<text x="'+(W-pad.r+6)+'" y="'+(y+3)+'" fill="var(--red)" font-size="8" text-anchor="start" font-family="var(--mono)">'+val+'%</text>';}
// Bars
const pts=[];
ms.forEach((m,i)=>{
const x=pad.l+(i+0.5)*(cW/ms.length);
const bh=(byM[m].t/mxV)*cH;
const py=pad.t+cH-(pcts[i]/mxP)*cH;
pts.push({x,py,pct:pcts[i]});
svg+='<rect x="'+(x-bW/2)+'" y="'+(pad.t+cH-bh)+'" width="'+bW+'" height="'+bh+'" fill="var(--teal)" rx="3" opacity="0.7"/>';
svg+='<text x="'+x+'" y="'+(pad.t+cH-bh-4)+'" fill="var(--text)" font-size="10" font-weight="700" text-anchor="middle" font-family="var(--mono)">'+byM[m].t+'</text>';
svg+='<text x="'+x+'" y="'+(H-5)+'" fill="var(--text3)" font-size="9" text-anchor="middle" font-family="var(--mono)">'+mn2[m.slice(5)]+(ms.length>12?"'"+m.slice(2,4):'')+'</text>';
});
// Line for %
if(pts.length>1){const lineD=pts.map((p,i)=>((i===0?'M':'L')+p.x+','+p.py)).join(' ');
svg+='<path d="'+lineD+'" fill="none" stroke="var(--red)" stroke-width="2" stroke-linejoin="round" stroke-dasharray="6,3"/>';
pts.forEach(p=>{svg+='<circle cx="'+p.x+'" cy="'+p.py+'" r="3" fill="var(--red)" stroke="white" stroke-width="1.5"/><text x="'+p.x+'" y="'+(p.py-8)+'" fill="var(--red)" font-size="8" font-weight="700" text-anchor="middle" font-family="var(--mono)">'+p.pct.toFixed(1)+'%</text>';});}
// Legend
svg+='<rect x="'+pad.l+'" y="4" width="10" height="10" fill="var(--teal)" rx="2" opacity="0.7"/><text x="'+(pad.l+14)+'" y="13" fill="var(--text2)" font-size="9">Cantidad</text>';
svg+='<line x1="'+(pad.l+80)+'" y1="9" x2="'+(pad.l+100)+'" y2="9" stroke="var(--red)" stroke-width="2" stroke-dasharray="4,2"/><text x="'+(pad.l+104)+'" y="13" fill="var(--red)" font-size="9">Tasa %</text>';
document.getElementById('rc').innerHTML='<svg width="'+W+'" height="'+H+'" style="display:block;margin:0 auto">'+svg+'</svg>';
}else if(ms.length===1){
const m=ms[0],d=byM[m],pct=dotBase>0?(d.t/dotBase*100).toFixed(1):0;
document.getElementById('rc').innerHTML='<div style="text-align:center;padding:20px"><div style="font-size:36px;font-weight:800;color:var(--teal);font-family:var(--mono)">'+d.t+' bajas</div><div style="font-size:20px;font-weight:700;color:var(--red);margin-top:4px">'+pct+'% tasa</div><div style="font-size:12px;color:var(--text3);margin-top:4px">'+(mn2[m.slice(5)]||'')+' '+m.slice(0,4)+'</div></div>';
}else{document.getElementById('rc').innerHTML='<div style="text-align:center;padding:20px;color:var(--text3)">Sin datos para el perÃ­odo</div>';}
// Monthly detail table
let acc=0;
document.getElementById('rmt').innerHTML=ms.map(m=>{const d=byM[m];acc+=d.t;const pct=dotBase>0?(d.t/dotBase*100).toFixed(1):0;const cobP=d.t>0?(d.c/d.t*100).toFixed(0):'-';
return'<tr><td><strong>'+(mn2[m.slice(5)]||'')+' '+m.slice(0,4)+'</strong></td><td style="font-family:var(--mono)">'+d.t+'</td><td style="font-family:var(--mono);color:'+(parseFloat(pct)>5?'var(--red)':parseFloat(pct)>2.5?'var(--yellow)':'var(--teal)')+'">'+pct+'%</td><td style="font-family:var(--mono);color:var(--teal)">'+d.c+'</td><td style="font-family:var(--mono)">'+cobP+'%</td><td style="font-family:var(--mono);color:var(--red)">'+(d.t-d.c)+'</td><td style="font-family:var(--mono);color:var(--text3)">'+acc+'</td></tr>';}).join('')||'<tr><td colspan="7" style="text-align:center;color:var(--text3)">Sin datos</td></tr>';
// Year summary table
const byYr={};allB.forEach(b=>{const y=b.fecha.slice(0,4);if(!byYr[y])byYr[y]={t:0,c:0,months:new Set()};byYr[y].t++;byYr[y].months.add(b.fecha.slice(5,7));if(b.status==='CUBIERTO')byYr[y].c++;});
document.getElementById('rt').innerHTML=Object.entries(byYr).sort().reverse().map(([y,d])=>{const r=dotBase>0?(d.t/dotBase*100).toFixed(1):'0';const cobP=d.t>0?(d.c/d.t*100).toFixed(0):'0';const promM=(d.t/Math.max(d.months.size,1)).toFixed(1);
return'<tr><td><strong>'+y+'</strong></td><td style="font-family:var(--mono)">'+d.t+'</td><td style="font-family:var(--mono);color:'+(parseFloat(r)>30?'var(--red)':parseFloat(r)>15?'var(--yellow)':'var(--teal)')+'"><span class="badge '+(parseFloat(r)>30?'b-no':parseFloat(r)>15?'b-lic':'b-ok')+'">'+r+'%</span></td><td style="font-family:var(--mono);color:var(--teal)">'+d.c+'</td><td style="font-family:var(--mono)">'+cobP+'%</td><td style="font-family:var(--mono);color:var(--red)">'+(d.t-d.c)+'</td><td style="font-family:var(--mono);color:var(--text3)">'+promM+'</td></tr>';}).join('');}

// LICENCIAS
const MOTIVOS_LIC=['LICENCIA MÃ‰DICA','LICENCIA MATERNAL','LICENCIA PATERNAL','ACCIDENTE LABORAL','ACCIDENTE TRAYECTO','ENFERMEDAD PROFESIONAL','PERMISO SIN GOCE','LICENCIA MUTUAL','OTRO'];

const VAL_USERS=['atraipe','dsanhueza'];
const TABULADOR=[{"cargo":"ANALISTA","cc":"AD-00004","area":"DISTRIBUCION (ALMACEN)","sbase":675000,"cventas":202500,"bcumpl":40000,"balmacen":95000,"bruta":0,"seguro":21154,"timponible":1033654,"grat":197917,"cempresa":1231571,"liq":985257},{"cargo":"ANALISTA","cc":"AD0004","area":"DISTRIBUCION","sbase":675000,"cventas":202500,"bcumpl":40000,"balmacen":95000,"bruta":70000,"seguro":24950,"timponible":1107450,"grat":209396,"cempresa":1316846,"liq":1053477},{"cargo":"ASISTENTE","cc":"AD-00004","area":"DISTRIBUCION (ALMACEN)","sbase":565950,"cventas":169785,"bcumpl":0,"balmacen":122000,"bruta":0,"seguro":21154,"timponible":878889,"grat":197917,"cempresa":1076806,"liq":861445},{"cargo":"ASISTENTE","cc":"AD0004","area":"DISTRIBUCION","sbase":565950,"cventas":169785,"bcumpl":0,"balmacen":122000,"bruta":40000,"seguro":24950,"timponible":922685,"grat":209396,"cempresa":1132081,"liq":905665},{"cargo":"AUXILIAR DE BODEGA","cc":"AD0004","area":"DISTRIBUCION","sbase":539000,"cventas":161700,"bcumpl":0,"balmacen":122000,"bruta":40000,"seguro":24950,"timponible":887650,"grat":209396,"cempresa":1097046,"liq":877637},{"cargo":"AUXILIAR DE MANTENCION","cc":"AD0004","area":"DISTRIBUCION","sbase":593824,"cventas":0,"bcumpl":140000,"balmacen":0,"bruta":120000,"seguro":24950,"timponible":878774,"grat":209396,"cempresa":1088170,"liq":870536},{"cargo":"CHOFER","cc":"AD0027","area":"TRANSPORTES","sbase":623960,"cventas":187188,"bcumpl":0,"balmacen":122000,"bruta":0,"seguro":24950,"timponible":958098,"grat":209396,"cempresa":1167494,"liq":933995},{"cargo":"CONTROLADOR","cc":"AD0004","area":"DISTRIBUCION","sbase":565950,"cventas":169785,"bcumpl":0,"balmacen":122000,"bruta":0,"seguro":24950,"timponible":882685,"grat":209396,"cempresa":1092081,"liq":873665},{"cargo":"COORDINADOR DE DISTRIBUCION","cc":"AD0004","area":"DISTRIBUCION","sbase":738584,"cventas":221575,"bcumpl":190000,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1320109,"grat":209396,"cempresa":1529505,"liq":1223604},{"cargo":"ENCARGADO DE AREA CD","cc":"AD0004","area":"DISTRIBUCION","sbase":655158,"cventas":196547,"bcumpl":70000,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1091655,"grat":209396,"cempresa":1301051,"liq":1040841},{"cargo":"ENCARGADO DE AREA CD","cc":"AD0027","area":"TRANSPORTES","sbase":655158,"cventas":196547,"bcumpl":0,"balmacen":145000,"bruta":150000,"seguro":24950,"timponible":1171655,"grat":209396,"cempresa":1381051,"liq":1104841},{"cargo":"GUARDIA","cc":"AD0027","area":"TRANSPORTES","sbase":529000,"cventas":158700,"bcumpl":0,"balmacen":56250,"bruta":111000,"seguro":24950,"timponible":879900,"grat":209396,"cempresa":1089296,"liq":871437},{"cargo":"INGENIERO DE PROCESOS Y MEJORA CONTINUA","cc":"AD0004","area":"DISTRIBUCION","sbase":900000,"cventas":270000,"bcumpl":70000,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1409950,"grat":209396,"cempresa":1619346,"liq":1295477},{"cargo":"JEFE DE AREA CD","cc":"AD0004","area":"DISTRIBUCION","sbase":1232000,"cventas":369600,"bcumpl":150000,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1921550,"grat":209396,"cempresa":2130946,"liq":1704757},{"cargo":"JEFE DE OPERACIONES LOGISTICAS","cc":"AD0004","area":"DISTRIBUCION","sbase":1600000,"cventas":480000,"bcumpl":600000,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":2849950,"grat":209396,"cempresa":3059346,"liq":2447477},{"cargo":"JEFE DE TRANSPORTE","cc":"AD0027","area":"TRANSPORTES","sbase":1232000,"cventas":369600,"bcumpl":0,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1771550,"grat":209396,"cempresa":1980946,"liq":1584757},{"cargo":"OPERADOR APILADOR ELECTRICO","cc":"AD0004","area":"DISTRIBUCION","sbase":594002,"cventas":178201,"bcumpl":70000,"balmacen":120170,"bruta":70000,"seguro":24950,"timponible":1057323,"grat":209396,"cempresa":1266719,"liq":1013375},{"cargo":"PEONETA","cc":"AD0027","area":"TRANSPORTES","sbase":565950,"cventas":169785,"bcumpl":0,"balmacen":122000,"bruta":0,"seguro":24950,"timponible":882685,"grat":209396,"cempresa":1092081,"liq":873665},{"cargo":"SUPERVISOR DE OPERACIONES","cc":"AD0004","area":"DISTRIBUCION","sbase":899622,"cventas":269887,"bcumpl":0,"balmacen":145000,"bruta":0,"seguro":24950,"timponible":1339459,"grat":209396,"cempresa":1548855,"liq":1239084},{"cargo":"SUPERVISOR MANTENCION","cc":"AD0004","area":"DISTRIBUCION","sbase":991760,"cventas":0,"bcumpl":200000,"balmacen":0,"bruta":200000,"seguro":24950,"timponible":1416710,"grat":209396,"cempresa":1626106,"liq":1300885},{"cargo":"RECEPCIONISTA","cc":"","area":"OTROS","sbase":0,"cventas":0,"bcumpl":0,"balmacen":0,"bruta":0,"seguro":24950,"timponible":24950,"grat":209396,"cempresa":234346,"liq":187477},{"cargo":"AUXILIAR DE ASEO","cc":"","area":"OTROS","sbase":0,"cventas":0,"bcumpl":0,"balmacen":0,"bruta":0,"seguro":24950,"timponible":24950,"grat":209396,"cempresa":234346,"liq":187477}];
const PROYECCIONES=[{"cargo":"AUXILIAR DE BODEGA","sb_act":350000,"ce_act":710396,"sb_p1":380000,"ce_p1":749396,"sb_p2":400000,"ce_p2":775396},{"cargo":"PEONETA","sb_act":381282,"ce_act":751063,"sb_p1":381282,"ce_p1":751063,"sb_p2":430000,"ce_p2":814396},{"cargo":"CONTROLADOR","sb_act":396164,"ce_act":770409,"sb_p1":396164,"ce_p1":770409,"sb_p2":450000,"ce_p2":840396},{"cargo":"CHOFER","sb_act":444829,"ce_act":833674,"sb_p1":444829,"ce_p1":833674,"sb_p2":490000,"ce_p2":892396},{"cargo":"ASISTENTE","sb_act":455566,"ce_act":810632,"sb_p1":455566,"ce_p1":810632,"sb_p2":500000,"ce_p2":868396},{"cargo":"ANALISTA","sb_act":552859,"ce_act":947113,"sb_p1":552859,"ce_p1":947113,"sb_p2":590000,"ce_p2":995396},{"cargo":"COORDINADOR","sb_act":659450,"ce_act":1135681,"sb_p1":659450,"ce_p1":1135681,"sb_p2":700000,"ce_p2":1188396},{"cargo":"SUPERVISOR","sb_act":803234,"ce_act":1322600,"sb_p1":803234,"ce_p1":1322600,"sb_p2":840000,"ce_p2":1370396}];
// Proyectos de expansiÃ³n â€” dinÃ¡micos, almacenados en localStorage

function rLic(){
// Auto check done in refreshAll
const today=new Date().toISOString().slice(0,10);
const qV=(document.getElementById('lic-q').value||'').toLowerCase();
const stV=document.getElementById('lic-st').value;

// Build combined list: active + history
const allLic=[];
Object.entries(lics).forEach(([rut,l])=>{const e=E.find(x=>x.rut===rut);if(e)allLic.push({...l,rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,id:e.id,active:e.status==='LICENCIA',closed:false});});
licHist.forEach(h=>{const e=E.find(x=>x.rut===h.rut);allLic.push({...h,id:e?e.id:0,active:false,closed:true});});

// Active licenses
const actLics=allLic.filter(l=>l.active);
const vencidas=actLics.filter(l=>l.end&&l.end<today);
const pronto=actLics.filter(l=>l.end&&ddF(l.end)>=0&&ddF(l.end)<=7);
const sinFecha=actLics.filter(l=>!l.end);
const totalDias=actLics.reduce((s,l)=>{if(l.start&&l.end){const d=Math.ceil((new Date(l.end)-new Date(l.start))/864e5)+1;return s+(d>0?d:0);}return s;},0);

document.getElementById('lic-info').textContent=actLics.length+' licencias activas | '+licHist.length+' histÃ³ricas';

// KPIs
document.getElementById('lk').innerHTML='<div class="kc"><div class="kl">Activas</div><div class="kv" style="color:var(--yellow)">'+actLics.length+'</div><div style="font-size:10px;color:var(--text3)">'+totalDias+' dÃ­as totales</div></div><div class="kc"><div class="kl">Vencidas</div><div class="kv" style="color:var(--red)">'+vencidas.length+'</div><div style="font-size:10px;color:var(--text3)">requieren reintegro</div></div><div class="kc"><div class="kl">Vence en 7d</div><div class="kv" style="color:var(--yellow)">'+pronto.length+'</div><div style="font-size:10px;color:var(--text3)">retorno prÃ³ximo</div></div><div class="kc"><div class="kl">Sin Fecha TÃ©rmino</div><div class="kv" style="color:var(--text3)">'+sinFecha.length+'</div><div style="font-size:10px;color:var(--text3)">sin control</div></div>';
document.getElementById('lc2').textContent=actLics.length;

// Active cards
document.getElementById('lg').innerHTML=actLics.length?actLics.sort((a,b)=>{if(!a.end)return 1;if(!b.end)return-1;return ddF(a.end)-ddF(b.end);}).map(l=>{
const d2=l.end?ddF(l.end):null;
const dias=l.start&&l.end?Math.ceil((new Date(l.end)-new Date(l.start))/864e5)+1:0;
const trans=l.start?Math.ceil((new Date()-new Date(l.start))/864e5):0;
const stT=d2===null?'Sin fecha tÃ©rmino':d2<0?'VENCIDA hace '+Math.abs(d2)+' dÃ­as':d2===0?'VENCE HOY':d2<=3?'âš ï¸ Vence en '+d2+' dÃ­as':d2<=7?'Vence en '+d2+' dÃ­as':'Vigente â€” '+d2+' dÃ­as restantes';
const stC=d2===null?'var(--text3)':d2<0?'var(--red)':d2<=3?'var(--red)':d2<=7?'var(--yellow)':'var(--teal)';
const retorno=l.end?fd(l.end):'â€”';
return'<div class="lc" style="border-left:4px solid '+stC+';cursor:pointer" onclick="openLicDetail(\''+l.rut+'\')"><div style="display:flex;justify-content:space-between;align-items:flex-start"><div><div class="ln">'+l.nombre+'</div><div class="lcg">'+l.cargo+' â€” '+l.dpto+'</div></div><div style="text-align:right"><div style="font-size:9px;color:var(--text3)">DÃ­a '+trans+' de '+dias+'</div><div style="width:60px;height:4px;background:var(--border);border-radius:2px;margin-top:2px"><div style="width:'+(dias>0?Math.min(trans/dias*100,100):0)+'%;height:100%;background:'+stC+';border-radius:2px"></div></div></div></div><div class="ld"><div><div class="lbl">Inicio</div>'+fd(l.start)+'</div><div><div class="lbl">TÃ©rmino</div>'+fd(l.end)+'</div><div><div class="lbl">Retorno</div><strong style="color:'+stC+'">'+retorno+'</strong></div><div><div class="lbl">Motivo</div>'+(l.motivo||'â€”')+'</div></div><div class="ls" style="background:'+stC+'15;color:'+stC+'">'+stT+'</div></div>';}).join(''):'<div style="padding:16px;color:var(--text3);text-align:center">Sin licencias activas</div>';

// History table (active + closed)
let filtered=allLic;
if(qV)filtered=filtered.filter(l=>(l.nombre+' '+l.cargo+' '+l.dpto+' '+(l.motivo||'')).toLowerCase().includes(qV));
if(stV==='activa')filtered=filtered.filter(l=>l.active);
if(stV==='vencida')filtered=filtered.filter(l=>l.active&&l.end&&l.end<today);
if(stV==='cerrada')filtered=filtered.filter(l=>l.closed);

// Ranking histÃ³rico
const ranking={};
allLic.forEach(l=>{if(!l.rut)return;if(!ranking[l.rut])ranking[l.rut]={rut:l.rut,nombre:l.nombre,cargo:l.cargo,dpto:l.dpto,id:l.id||0,count:0,dias:0,last:'',active:false};
ranking[l.rut].count++;
const d=l.start&&l.end?Math.ceil((new Date(l.end)-new Date(l.start))/864e5)+1:0;
if(d>0)ranking[l.rut].dias+=d;
if(l.start&&l.start>ranking[l.rut].last)ranking[l.rut].last=l.start;
if(l.active)ranking[l.rut].active=true;
// Update name/cargo from current employee
const emp=E.find(x=>x.rut===l.rut);if(emp){ranking[l.rut].nombre=emp.nombre;ranking[l.rut].cargo=emp.cargo;ranking[l.rut].dpto=emp.dpto;ranking[l.rut].id=emp.id;}});
const rkArr=Object.values(ranking).sort((a,b)=>b.count-a.count||b.dias-a.dias);
document.getElementById('lr').innerHTML=rkArr.length?rkArr.map((r,i)=>{
const prom=r.count>0?(r.dias/r.count).toFixed(0):'â€”';
const medal=i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':String(i+1);
const rowColor=r.count>=5?'background:var(--red-bg)':r.count>=3?'background:var(--yellow-light)':'';
return'<tr style="cursor:pointer;'+rowColor+'" onclick="'+(r.id?'openEmp('+r.id+')':'')+'"><td style="text-align:center;font-size:14px">'+medal+'</td><td><strong>'+r.nombre+'</strong></td><td>'+r.cargo+'</td><td>'+r.dpto+'</td><td style="font-family:var(--mono);font-weight:700;text-align:center"><span style="background:var(--red);color:white;padding:2px 8px;border-radius:10px;font-size:12px">'+r.count+'</span></td><td style="font-family:var(--mono);text-align:center;font-weight:700;color:'+(r.dias>60?'var(--red)':r.dias>30?'var(--yellow)':'var(--text)')+'">'+r.dias+'d</td><td style="font-family:var(--mono);text-align:center">'+prom+'d</td><td style="font-family:var(--mono);font-size:10px">'+fd(r.last)+'</td><td>'+(r.active?'<span class="badge b-lic">EN LICENCIA</span>':'<span class="badge b-ok">ACTIVO</span>')+'</td></tr>';}).join(''):'<tr><td colspan="9" style="text-align:center;color:var(--text3)">Sin datos histÃ³ricos â€” registre licencias para generar el ranking</td></tr>';

// History table
document.getElementById('lt').innerHTML=filtered.sort((a,b)=>(b.start||'').localeCompare(a.start||'')).map(l=>{
const d2=l.end?ddF(l.end):null;
const dias=l.start&&l.end?Math.ceil((new Date(l.end)-new Date(l.start))/864e5)+1:'â€”';
let stBadge='';
if(l.closed)stBadge='<span class="badge b-ok">âœ… Cerrada</span>';
else if(!l.end)stBadge='<span class="badge b-pu">âšª Sin fecha</span>';
else if(l.end<today)stBadge='<span class="badge b-no">ğŸ”´ Vencida '+Math.abs(d2)+'d</span>';
else if(d2<=7)stBadge='<span class="badge b-lic">ğŸŸ¡ Vence '+d2+'d</span>';
else stBadge='<span class="badge b-bl">ğŸŸ¢ Vigente '+d2+'d</span>';
return'<tr style="cursor:pointer" onclick="'+(l.active?'openLicDetail(\''+l.rut+'\')':l.id?'openEmp('+l.id+')':'')+'"><td><strong>'+l.nombre+'</strong></td><td>'+l.cargo+'</td><td>'+l.dpto+'</td><td>'+fd(l.start)+'</td><td>'+fd(l.end)+'</td><td style="font-family:var(--mono)">'+dias+'</td><td>'+(l.motivo||'â€”')+'</td><td>'+stBadge+'</td><td onclick="event.stopPropagation()">'+(l.active?'<button class="btn btn-g btn-sm" onclick="reintegrar(\''+l.rut+'\')" title="Reintegrar">â†©</button>':'')+'</td></tr>';}).join('')||'<tr><td colspan="9" style="text-align:center;color:var(--text3)">Sin registros</td></tr>';}

function openNewLic(){document.getElementById('mt').textContent='Registrar Licencia MÃ©dica';
const ac=E.filter(e=>e.status==='ACTIVO'||e.status==='LICENCIA').sort((a,b)=>a.nombre.localeCompare(b.nombre));
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg full"><div class="fl">Colaborador *</div><select class="fi" id="nl-e" onchange="fillLicInfo()">'+ac.map(e=>'<option value="'+e.id+'"'+(e.status==='LICENCIA'?' style="color:var(--yellow)"':'')+'>'+e.nombre+' â€” '+e.cargo+(e.status==='LICENCIA'?' [EN LICENCIA]':'')+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Tipo / Motivo *</div><select class="fi" id="nl-m">'+MOTIVOS_LIC.map(m=>'<option>'+m+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Fecha Inicio *</div><input type="date" class="fi" id="nl-s" value="'+new Date().toISOString().slice(0,10)+'" onchange="calcLicDays()"></div><div class="fg"><div class="fl">Fecha TÃ©rmino *</div><input type="date" class="fi" id="nl-e2" onchange="calcLicDays()"></div><div class="fg"><div class="fl">DÃ­as de Licencia</div><div id="nl-d" style="font-size:20px;font-weight:800;color:var(--yellow);font-family:var(--mono)">â€”</div></div><div class="fg"><div class="fl">Fecha Retorno Esperado</div><div id="nl-r" style="font-size:14px;font-weight:700;color:var(--teal)">â€”</div></div><div class="fg full"><div class="fl">ObservaciÃ³n</div><input class="fi" id="nl-obs" placeholder="NÂ° folio, mÃ©dico tratante, etc."></div></div><div id="nl-warn" style="margin-top:8px"></div><div style="margin-top:6px;padding:10px;background:var(--yellow-light);border-radius:var(--radius);font-size:11px;color:var(--yellow)">âš ï¸ Al registrar, el colaborador cambiarÃ¡ a status <strong>LICENCIA</strong>. Al vencer el tÃ©rmino, se reintegrarÃ¡ automÃ¡ticamente a <strong>ACTIVO</strong>.</div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveLic()">ğŸ’¾ Registrar Licencia</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
fillLicInfo();document.getElementById('modal').style.display='flex';}

function fillLicInfo(){const id=parseInt(document.getElementById('nl-e').value);const e=E.find(x=>x.id===id);if(!e)return;
const warn=document.getElementById('nl-warn');
if(e.status==='LICENCIA'&&lics[e.rut]){warn.innerHTML='<div class="ai critical">âš ï¸ Este colaborador ya tiene licencia activa ('+fd(lics[e.rut].start)+' â†’ '+fd(lics[e.rut].end)+'). Al registrar una nueva, la anterior se cerrarÃ¡ y archivarÃ¡.</div>';}else{warn.innerHTML='';}}

function calcLicDays(){const s=document.getElementById('nl-s').value,e=document.getElementById('nl-e2').value;
if(!s||!e){document.getElementById('nl-d').textContent='â€”';document.getElementById('nl-r').textContent='â€”';return;}
const dias=Math.ceil((new Date(e)-new Date(s))/864e5)+1;
document.getElementById('nl-d').textContent=dias>0?dias+'d':'Rango invÃ¡lido';
const ret=new Date(e);ret.setDate(ret.getDate()+1);
const dow=ret.getDay();if(dow===0)ret.setDate(ret.getDate()+1);if(dow===6)ret.setDate(ret.getDate()+2);
document.getElementById('nl-r').textContent=dias>0?fd(ret.toISOString().slice(0,10))+' ('+['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'][ret.getDay()]+')':'â€”';}

function saveLic(){const id=parseInt(document.getElementById('nl-e').value),e=E.find(x=>x.id===id);
if(!e){toast('Selecciona colaborador',1);return;}
const motivo=document.getElementById('nl-m').value,inicio=document.getElementById('nl-s').value,termino=document.getElementById('nl-e2').value,obs=document.getElementById('nl-obs').value.trim();
if(!inicio||!termino){toast('Fechas obligatorias',1);return;}
if(termino<inicio){toast('TÃ©rmino debe ser posterior al inicio',1);return;}
// If already on license, close previous
if(e.status==='LICENCIA'&&lics[e.rut]){const prev=lics[e.rut];
licHist.push({rut:e.rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,start:prev.start,end:prev.end,motivo:prev.motivo,retorno:new Date().toISOString().slice(0,10),autoClose:false,obs:'Cerrada por nueva licencia'});
aa('LIC_CIERRE',e.nombre+' â€” Licencia anterior cerrada');delete lics[e.rut];}
// Create new
lics[e.rut]={start:inicio,end:termino,motivo,obs};
e.status='LICENCIA';
const dias=Math.ceil((new Date(termino)-new Date(inicio))/864e5)+1;
aa('LICENCIA',e.nombre+' â€” '+motivo+' ('+dias+'d: '+fd(inicio)+' â†’ '+fd(termino)+')');
save();clM();refreshAll();toast('âœ… Licencia registrada â€” '+e.nombre);}

function openLicDetail(rut){const l=lics[rut];if(!l)return;const e=E.find(x=>x.rut===rut);if(!e)return;
const d2=l.end?ddF(l.end):null;
const dias=l.start&&l.end?Math.ceil((new Date(l.end)-new Date(l.start))/864e5)+1:0;
const trans=l.start?Math.ceil((new Date()-new Date(l.start))/864e5):0;
const stC=d2===null?'var(--text3)':d2<0?'var(--red)':d2<=7?'var(--yellow)':'var(--teal)';
document.getElementById('mt').textContent='Licencia â€” '+e.nombre;
let h='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px"><div style="padding:12px;border-radius:var(--radius);background:var(--surface)"><div style="font-size:10px;color:var(--text3);font-weight:700">COLABORADOR</div><div style="font-size:16px;font-weight:700;margin-top:4px">'+e.nombre+'</div><div style="font-size:11px;color:var(--text3)">'+e.cargo+' â€” '+e.dpto+'</div></div><div style="padding:12px;border-radius:var(--radius);background:var(--surface);border-left:4px solid '+stC+'"><div style="font-size:10px;color:var(--text3);font-weight:700">ESTADO</div><div style="font-size:16px;font-weight:700;color:'+stC+';margin-top:4px">'+(d2===null?'Sin fecha':d2<0?'VENCIDA '+Math.abs(d2)+'d':d2===0?'VENCE HOY':'Vigente '+d2+'d')+'</div><div style="font-size:11px;color:var(--text3)">DÃ­a '+trans+' de '+dias+'</div></div></div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px;margin-bottom:16px"><div class="rpt-stat"><div class="rl">Inicio</div><div class="rv" style="font-size:14px">'+fd(l.start)+'</div></div><div class="rpt-stat"><div class="rl">TÃ©rmino</div><div class="rv" style="font-size:14px;color:'+stC+'">'+fd(l.end)+'</div></div><div class="rpt-stat"><div class="rl">DÃ­as Total</div><div class="rv" style="font-size:14px">'+dias+'</div></div><div class="rpt-stat"><div class="rl">Motivo</div><div class="rv" style="font-size:12px">'+l.motivo+'</div></div></div>';
if(l.obs)h+='<div style="padding:8px;margin-bottom:12px;background:var(--bg2);border-radius:var(--radius);font-size:11px">ğŸ“ '+l.obs+'</div>';
// Progress bar
const pct=dias>0?Math.min(trans/dias*100,100):0;
h+='<div style="margin-bottom:16px"><div style="display:flex;justify-content:space-between;font-size:10px;margin-bottom:4px"><span>Progreso</span><span style="font-weight:700">'+pct.toFixed(0)+'%</span></div><div style="height:8px;background:var(--border);border-radius:4px"><div style="width:'+pct+'%;height:100%;background:'+stC+';border-radius:4px;transition:width .3s"></div></div></div>';
// History for this person
const prevLics=licHist.filter(lh=>lh.rut===rut);
if(prevLics.length){h+='<div style="font-weight:700;font-size:12px;margin-bottom:6px;color:var(--text2)">ğŸ“‹ Licencias Anteriores ('+prevLics.length+')</div><div style="margin-bottom:12px">';
prevLics.sort((a,b)=>(b.start||'').localeCompare(a.start||'')).forEach(pl=>{const pd=pl.start&&pl.end?Math.ceil((new Date(pl.end)-new Date(pl.start))/864e5)+1:'?';
h+='<div style="padding:6px 10px;margin-bottom:4px;background:var(--surface);border-radius:6px;font-size:11px;display:flex;justify-content:space-between;align-items:center"><span>'+fd(pl.start)+' â†’ '+fd(pl.end)+' ('+pd+'d) â€” '+(pl.motivo||'â€”')+'</span><span class="badge b-ok" style="font-size:9px">Cerrada</span></div>';});h+='</div>';}
// Actions
h+='<div style="display:flex;gap:6px;flex-wrap:wrap">';
if(d2!==null&&d2<0){h+='<button class="btn btn-p btn-sm" onclick="reintegrar(\''+rut+'\');clM()">â†© Reintegrar (vencida)</button>';}
h+='<button class="btn btn-g btn-sm" onclick="extenderLic(\''+rut+'\')">ğŸ“… Extender / Nueva Licencia</button>';
h+='<button class="btn btn-g btn-sm" onclick="reintegrar(\''+rut+'\');clM()">â†© Reintegrar Ahora</button>';
h+='<button class="btn btn-g btn-sm" onclick="clM();openEmp('+e.id+')">ğŸ‘¤ Ver Ficha</button>';
h+='<button class="btn btn-g btn-sm" onclick="clM()">Cerrar</button></div>';
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';}

function extenderLic(rut){const l=lics[rut];if(!l)return;const e=E.find(x=>x.rut===rut);if(!e)return;
// Close current in modal and open new license form
clM();
setTimeout(()=>{openNewLic();
// Pre-select the employee
const sel=document.getElementById('nl-e');
for(let i=0;i<sel.options.length;i++){if(sel.options[i].value===String(e.id)){sel.selectedIndex=i;break;}}
fillLicInfo();
// Set start as day after current end
if(l.end){const ns=new Date(l.end);ns.setDate(ns.getDate()+1);document.getElementById('nl-s').value=ns.toISOString().slice(0,10);}
},200);}

function reintegrar(rut){const e=E.find(x=>x.rut===rut);if(!e)return;
if(e.status!=='LICENCIA'){toast(e.nombre+' no estÃ¡ en licencia',1);return;}
if(!confirm('Â¿Reintegrar a '+e.nombre+'? CambiarÃ¡ a ACTIVO.')){return;}
const l=lics[rut];
if(l){licHist.push({rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,start:l.start,end:l.end,motivo:l.motivo,retorno:new Date().toISOString().slice(0,10),autoClose:false});delete lics[rut];}
e.status='ACTIVO';
aa('REINTEGRO',e.nombre+' â€” Reintegrado manualmente');
save();refreshAll();toast('âœ… '+e.nombre+' reintegrado a ACTIVO');}

function parseMsgLic(inp){const f=inp.files[0];if(!f){return;}
inp.value='';
const reader=new FileReader();
reader.onload=function(){
try{
const buf=new Uint8Array(reader.result);
// Extract UTF-16LE text from .msg binary
let txt='';
for(let i=0;i<buf.length-1;i++){
const ch=buf[i]|buf[i+1]<<8;
if((ch>=0x20&&ch<=0x7E)||ch===0x0A||ch===0x0D||(ch>=0xC0&&ch<=0x017F)){txt+=String.fromCharCode(ch);i++;}
else if(txt.length>0&&txt[txt.length-1]!=='\n'){txt+='';}
}
// Also try UTF-8 extraction as fallback
let txt8='';
try{const dec=new TextDecoder('utf-8',{fatal:false});txt8=dec.decode(buf);}catch(e2){}
const fullTxt=txt+'\n'+txt8;
console.log('MSG parsed text:',fullTxt.substring(0,500));

// Parse fields from Dr. Simi email template
const parsed={nombre:'',rut:'',inicio:'',termino:'',retorno:'',dias:'',motivo:'LICENCIA MÃ‰DICA'};

// Name: "colaborador/a NOMBRE con RUT" or from subject "LICENCIA MÃ‰DICA - Name"
let nm=fullTxt.match(/colaborador(?:\/a)?\s+([A-ZÃÃ‰ÃÃ“ÃšÃ‘a-zÃ¡Ã©Ã­Ã³ÃºÃ±\s]+?)\s+con\s+RUT/i);
if(nm)parsed.nombre=nm[1].trim();
if(!parsed.nombre){nm=fullTxt.match(/LICENCIA\s+M[EÃ‰]DICA\s*[-â€“â€”]\s*([A-ZÃÃ‰ÃÃ“ÃšÃ‘a-zÃ¡Ã©Ã­Ã³ÃºÃ±\s]+?)[\r\n\x00]/i);if(nm)parsed.nombre=nm[1].trim();}

// RUT
let rt=fullTxt.match(/RUT\s+(\d{1,2}[\.\d]*\d{3,}-[\dkK])/i);
if(rt)parsed.rut=rt[1].replace(/\./g,'');
if(!parsed.rut){rt=fullTxt.match(/(\d{7,8}-[\dkK])/);if(rt)parsed.rut=rt[1];}

// Dates DD-MM-YYYY format
const dates=fullTxt.match(/(\d{2})-(\d{2})-(\d{4})/g)||[];
const isoD=dates.map(d=>{const p=d.split('-');return p[2]+'-'+p[1]+'-'+p[0];});
// Find by context
const iniMatch=fullTxt.match(/[Ii]nicio\s+(?:de\s+)?licencia[\s\S]{0,30}?(\d{2})-(\d{2})-(\d{4})/);
if(iniMatch)parsed.inicio=iniMatch[3]+'-'+iniMatch[2]+'-'+iniMatch[1];
else if(isoD[0])parsed.inicio=isoD[0];

const terMatch=fullTxt.match(/[Tt][eÃ©]rmino\s+(?:de\s+)?licencia[\s\S]{0,30}?(\d{2})-(\d{2})-(\d{4})/);
if(terMatch)parsed.termino=terMatch[3]+'-'+terMatch[2]+'-'+terMatch[1];
else if(isoD[1])parsed.termino=isoD[1];

const retMatch=fullTxt.match(/[Rr]etorno[\s\S]{0,30}?(\d{2})-(\d{2})-(\d{4})/);
if(retMatch)parsed.retorno=retMatch[3]+'-'+retMatch[2]+'-'+retMatch[1];
else if(isoD[2])parsed.retorno=isoD[2];

// Days
const diasMatch=fullTxt.match(/[Tt]otal\s+de\s+d[iÃ­]as[\s\S]{0,20}?(\d{1,3})/);
if(diasMatch)parsed.dias=diasMatch[1];

// Detect type from subject
if(fullTxt.match(/MATERNAL/i))parsed.motivo='LICENCIA MATERNAL';
else if(fullTxt.match(/PATERNAL/i))parsed.motivo='LICENCIA PATERNAL';
else if(fullTxt.match(/ACCIDENTE\s+LABORAL/i))parsed.motivo='ACCIDENTE LABORAL';
else if(fullTxt.match(/ACCIDENTE\s+TRAYECTO/i))parsed.motivo='ACCIDENTE TRAYECTO';
else if(fullTxt.match(/MUTUAL/i))parsed.motivo='LICENCIA MUTUAL';

// Match employee
let empMatch=null;
const cleanRut=r=>r.replace(/\./g,'').replace(/\s/g,'');
if(parsed.rut){const pr=cleanRut(parsed.rut);empMatch=E.find(e=>cleanRut(e.rut)===pr);}
if(!empMatch&&parsed.nombre){const nm2=parsed.nombre.toUpperCase().trim();empMatch=E.find(e=>e.nombre.toUpperCase()===nm2)||E.find(e=>{const parts=nm2.split(/\s+/);return parts.length>=2&&e.nombre.toUpperCase().includes(parts[0])&&e.nombre.toUpperCase().includes(parts[1]);})||E.find(e=>nm2.includes(e.nombre.split(' ')[0]?.toUpperCase()));}

// Show confirmation modal
document.getElementById('mt').textContent='ğŸ“§ Licencia desde Correo';
let h='<div style="padding:12px;background:var(--teal-bg);border-radius:var(--radius);border:1px solid var(--teal);margin-bottom:16px"><div style="font-size:11px;font-weight:700;color:var(--teal)">âœ… Datos extraÃ­dos del correo: '+f.name+'</div></div>';
h+='<div class="fg2">';
h+='<div class="fg full"><div class="fl">Colaborador'+(empMatch?' âœ… Encontrado':'  âš ï¸ No encontrado en nÃ³mina')+'</div>';
if(empMatch){h+='<select class="fi" id="ml-e">';
E.filter(e=>e.status==='ACTIVO'||e.status==='LICENCIA').sort((a,b)=>a.nombre.localeCompare(b.nombre)).forEach(e=>{h+='<option value="'+e.id+'"'+(e.id===empMatch.id?' selected':'')+'>'+e.nombre+' â€” '+e.cargo+'</option>';});
h+='</select>';}else{h+='<select class="fi" id="ml-e">';
E.filter(e=>e.status==='ACTIVO'||e.status==='LICENCIA').sort((a,b)=>a.nombre.localeCompare(b.nombre)).forEach(e=>{h+='<option value="'+e.id+'">'+e.nombre+' â€” '+e.cargo+'</option>';});
h+='</select><div style="font-size:10px;color:var(--red);margin-top:2px">Nombre: '+parsed.nombre+' | RUT: '+parsed.rut+' â€” Seleccione manualmente</div>';}
h+='</div>';
h+='<div class="fg"><div class="fl">Motivo</div><select class="fi" id="ml-m">'+MOTIVOS_LIC.map(m=>'<option'+(m===parsed.motivo?' selected':'')+'>'+m+'</option>').join('')+'</select></div>';
h+='<div class="fg"><div class="fl">Inicio</div><input type="date" class="fi" id="ml-s" value="'+parsed.inicio+'"></div>';
h+='<div class="fg"><div class="fl">TÃ©rmino</div><input type="date" class="fi" id="ml-t" value="'+parsed.termino+'"></div>';
h+='<div class="fg"><div class="fl">DÃ­as</div><div style="font-size:20px;font-weight:800;color:var(--yellow);font-family:var(--mono)">'+(parsed.dias||'â€”')+'d</div></div>';
h+='<div class="fg"><div class="fl">Retorno</div><div style="font-size:14px;font-weight:700;color:var(--teal)">'+(parsed.retorno?fd(parsed.retorno):'â€”')+'</div></div>';
h+='<div class="fg full"><div class="fl">ObservaciÃ³n</div><input class="fi" id="ml-obs" value="Importado desde correo: '+f.name.replace(/'/g,'')+'"></div>';
h+='</div>';
// Data summary
h+='<div style="margin-top:8px;padding:8px;background:var(--surface);border-radius:var(--radius);font-size:10px;color:var(--text3);font-family:var(--mono)">Datos parseados â†’ Nombre: '+parsed.nombre+' | RUT: '+parsed.rut+' | Inicio: '+parsed.inicio+' | TÃ©rmino: '+parsed.termino+' | Retorno: '+parsed.retorno+' | DÃ­as: '+parsed.dias+'</div>';
h+='<div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveMsgLic()">ğŸ’¾ Registrar Licencia</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';
}catch(err){console.error(err);toast('Error al leer archivo .msg: '+err.message,1);}
};reader.readAsArrayBuffer(f);}

function saveMsgLic(){const id=parseInt(document.getElementById('ml-e').value),e=E.find(x=>x.id===id);
if(!e){toast('Selecciona colaborador',1);return;}
const motivo=document.getElementById('ml-m').value,inicio=document.getElementById('ml-s').value,termino=document.getElementById('ml-t').value,obs=document.getElementById('ml-obs').value.trim();
if(!inicio||!termino){toast('Fechas obligatorias',1);return;}
if(e.status==='LICENCIA'&&lics[e.rut]){const prev=lics[e.rut];
licHist.push({rut:e.rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,start:prev.start,end:prev.end,motivo:prev.motivo,retorno:new Date().toISOString().slice(0,10),autoClose:false,obs:'Cerrada por nueva licencia (correo)'});
aa('LIC_CIERRE',e.nombre+' â€” Licencia anterior cerrada');delete lics[e.rut];}
lics[e.rut]={start:inicio,end:termino,motivo,obs};
e.status='LICENCIA';
const dias=Math.ceil((new Date(termino)-new Date(inicio))/864e5)+1;
aa('LICENCIA',e.nombre+' â€” '+motivo+' ('+dias+'d: '+fd(inicio)+' â†’ '+fd(termino)+') [Importado correo]');
save();clM();refreshAll();toast('âœ… Licencia registrada desde correo â€” '+e.nombre);}

// VACACIONES
function openVacReq(){openVacFor('');}
function openVacFor(rut){document.getElementById('mt').textContent='Solicitud de Vacaciones';const ac=vis().filter(e=>e.status==='ACTIVO').sort((a,b)=>a.nombre.localeCompare(b.nombre));
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg full"><div class="fl">Colaborador *</div><select class="fi" id="vr-e" onchange="updVacInfo()">'+ac.map(e=>'<option value="'+e.rut+'"'+(e.rut===rut?' selected':'')+'>'+e.nombre+' â€” '+e.dpto+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Desde *</div><input type="date" class="fi" id="vr-s" onchange="calcVacDays()"></div><div class="fg"><div class="fl">Hasta *</div><input type="date" class="fi" id="vr-e2" onchange="calcVacDays()"></div><div class="fg"><div class="fl">DÃ­as hÃ¡biles</div><div id="vr-d" style="font-size:20px;font-weight:800;color:var(--teal);font-family:var(--mono)">â€”</div></div><div class="fg"><div class="fl">Saldo disponible</div><div id="vr-sal" style="font-size:14px;font-weight:700">â€”</div></div><div class="fg full"><div class="fl">Nota</div><input class="fi" id="vr-n" placeholder="ObservaciÃ³n..."></div></div><div id="vr-warn" style="margin-top:8px"></div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveVac()">âœ… Registrar</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';updVacInfo();document.getElementById('modal').style.display='flex';}
function updVacInfo(){const rut=document.getElementById('vr-e').value,e=E.find(x=>x.rut===rut);if(!e)return;const vd2=vacDays(e),vu2=vacUsed(rut);document.getElementById('vr-sal').innerHTML=(vd2-vu2)+'d <span style="font-size:10px;color:var(--text3)">('+vd2+' der, '+vu2+' usados)</span>';}
function calcVacDays(){const s=document.getElementById('vr-s').value,e=document.getElementById('vr-e2').value;if(!s||!e)return;const d=wdBetween(s,e);document.getElementById('vr-d').textContent=d+'d';const rut=document.getElementById('vr-e').value,emp=E.find(x=>x.rut===rut);if(emp){const sal=vacDays(emp)-vacUsed(rut);document.getElementById('vr-warn').innerHTML=d>sal?'<div class="ai critical">âš ï¸ Excede saldo ('+sal+'d)</div>':'';}}
function saveVac(){const rut=document.getElementById('vr-e').value,s=document.getElementById('vr-s').value,e=document.getElementById('vr-e2').value;if(!s||!e){toast('Fechas obligatorias',1);return;}const d=wdBetween(s,e);if(d<=0){toast('Rango invÃ¡lido',1);return;}const emp=E.find(x=>x.rut===rut);vac.push({rut,start:s,end:e,dias:d,status:'APROBADA',nota:document.getElementById('vr-n').value,fecha:new Date().toISOString().slice(0,10)});aa('VACACIONES',emp.nombre+': '+d+'d ('+s+' â†’ '+e+')');save();clM();refreshAll();toast('âœ… Vacaciones');setTimeout(()=>exportVacXlsx(vac.length-1),500);}
function rVac(){const q=(document.getElementById('sv').value||'').toLowerCase(),st=document.getElementById('fvs').value;const rows=vac.map(v=>{const e=E.find(x=>x.rut===v.rut);return e?{...v,nombre:e.nombre,dpto:e.dpto,id:e.id,derecho:vacDays(e),usado:vacUsed(e.rut)}:null;}).filter(Boolean).filter(v=>{if(q&&!(v.nombre+' '+v.dpto).toLowerCase().includes(q))return 0;if(st&&v.status!==st)return 0;return 1;}).sort((a,b)=>b.start.localeCompare(a.start));
const totD=rows.filter(v=>v.status==='APROBADA').reduce((s,v)=>s+v.dias,0);
document.getElementById('vk').innerHTML='<div class="kc"><div class="kl">Solicitudes</div><div class="kv">'+vac.length+'</div></div><div class="kc"><div class="kl">DÃ­as Otorgados</div><div class="kv" style="color:var(--teal)">'+totD+'</div></div><div class="kc"><div class="kl">Pendientes</div><div class="kv" style="color:var(--yellow)">'+vac.filter(v2=>v2.status==='PENDIENTE').length+'</div></div><div class="kc"><div class="kl">Este Mes</div><div class="kv" style="color:var(--blue)">'+vac.filter(v2=>v2.start&&v2.start.startsWith(new Date().toISOString().slice(0,7))).length+'</div></div>';
document.getElementById('vt').innerHTML=rows.map((v,idx)=>{const sal=v.derecho-v.usado;const origIdx=vac.findIndex(x=>x.rut===v.rut&&x.start===v.start&&x.end===v.end);return'<tr onclick="openEmp('+v.id+')"><td><strong>'+v.nombre+'</strong></td><td>'+v.dpto+'</td><td>'+fd(v.start)+'</td><td>'+fd(v.end)+'</td><td style="font-family:var(--mono)">'+v.dias+'</td><td><span class="badge '+(v.status==='APROBADA'?'b-ok':v.status==='PENDIENTE'?'b-lic':'b-no')+'">'+v.status+'</span></td><td style="font-family:var(--mono);'+(sal<=3?'color:var(--red)':'')+'">'+ sal+'d</td><td onclick="event.stopPropagation()"><button class="btn btn-d btn-sm" onclick="exportVacXlsx('+origIdx+')" title="Descargar Excel">ğŸ“¥</button> <button class="btn btn-d btn-sm" onclick="delVac('+origIdx+')">Ã—</button></td></tr>';}).join('');}
function delVac(i){if(i<0||!confirm('Â¿Eliminar?'))return;vac.splice(i,1);aa('VAC_DEL','Vacaciones eliminadas');save();refreshAll();toast('Eliminado');}

// CAMBIOS/BAJAS
function chKey(c){return(c.rut||'')+'_'+(c.desde||'')+'_'+(c.nuevoCargo||'').replace(/\s/g,'_');}
function chDocStatus(c){const k=chKey(c),d=chDocs[k];if(!d)return{anexo:false,cap:false,complete:false};return{anexo:!!d.anexo,cap:!!d.cap,complete:!!d.anexo&&!!d.cap};}
function rCam(d){
// KPIs
const total=CH.length,withDocs=CH.filter(c=>chDocStatus(c).complete).length,pendDocs=total-withDocs;
const thisYr=new Date().getFullYear().toString(),thisYrC=CH.filter(c=>c.desde&&c.desde.startsWith(thisYr)).length;
document.getElementById('ck').innerHTML='<div class="kc"><div class="kl">Total Cambios</div><div class="kv" style="color:var(--teal)">'+total+'</div></div><div class="kc"><div class="kl">'+thisYr+'</div><div class="kv" style="color:var(--blue)">'+thisYrC+'</div></div><div class="kc"><div class="kl">Docs Completos</div><div class="kv" style="color:var(--teal)">'+withDocs+'</div></div><div class="kc"><div class="kl">Docs Pendientes</div><div class="kv" style="color:'+(pendDocs>0?'var(--red)':'var(--teal)')+'">'+pendDocs+'</div></div>';
// Year filter populate
const yrSel=document.getElementById('fc-yr'),yrV=yrSel.value;
const yrs=[...new Set(CH.map(c=>c.desde?c.desde.slice(0,4):'').filter(Boolean))].sort().reverse();
yrSel.innerHTML='<option value="">Todos</option>'+yrs.map(y=>'<option'+(y===yrV?' selected':'')+'>'+y+'</option>').join('');
// Table
document.getElementById('ct').innerHTML=d.sort((a,b)=>(b.desde||'').localeCompare(a.desde||'')).map(c=>{const ds=chDocStatus(c);const dcI=ds.complete?'<span class="badge b-ok" title="Anexo âœ… Cap âœ…">âœ… Completo</span>':'<span class="badge b-no" title="'+(ds.anexo?'':'Anexo âŒ ')+(ds.cap?'':'Cap âŒ')+'">âš ï¸ Pendiente</span>';return'<tr style="cursor:pointer" onclick="openCambioDetail(\''+chKey(c).replace(/'/g,"\\\\'")+'\')" title="Click para ver detalle y subir docs"><td>'+fd(c.desde)+'</td><td style="font-family:var(--mono);font-size:10px;color:var(--text3)">'+c.cod+'</td><td><strong>'+c.nombre+'</strong></td><td>'+c.dpto+'</td><td>'+c.cargoAnterior+'</td><td style="color:var(--teal);font-weight:700">'+c.nuevoCargo+'</td><td>'+c.jefatura+'</td><td>'+dcI+'</td><td onclick="event.stopPropagation()"><button class="btn btn-d btn-sm" onclick="genCambioRpt(\''+chKey(c).replace(/'/g,"\\\\'")+'\')" title="Generar reporte">ğŸ“„</button></td></tr>';}).join('');}
function fC(){const q=(document.getElementById('s-c').value||'').toLowerCase(),yr=document.getElementById('fc-yr').value,ds=document.getElementById('fc-ds').value;
let d=CH;if(q)d=d.filter(c=>(c.nombre+' '+c.cargoAnterior+' '+c.nuevoCargo+' '+c.dpto).toLowerCase().includes(q));
if(yr)d=d.filter(c=>c.desde&&c.desde.startsWith(yr));
if(ds==='ok')d=d.filter(c=>chDocStatus(c).complete);
if(ds==='pend')d=d.filter(c=>!chDocStatus(c).complete);
rCam(d);}

function openNewCambio(){document.getElementById('mt').textContent='Nuevo Cambio de Cargo';
const ac=E.filter(e=>e.status==='ACTIVO').sort((a,b)=>a.nombre.localeCompare(b.nombre));
const cargos=[...new Set(E.map(e=>e.cargo))].filter(Boolean).sort();
const dptos=[...new Set(E.map(e=>e.dpto))].filter(Boolean).sort();
const jefs=[...new Set(E.map(e=>e.jefatura))].filter(Boolean).sort();
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg full"><div class="fl">Colaborador *</div><select class="fi" id="nc-e" onchange="fillCambioData()">'+ac.map(e=>'<option value="'+e.id+'">'+e.nombre+' â€” '+e.cargo+' ('+e.dpto+')</option>').join('')+'</select></div><div class="fg"><div class="fl">Fecha Cambio *</div><input type="date" class="fi" id="nc-f" value="'+new Date().toISOString().slice(0,10)+'"></div><div class="fg"><div class="fl">Cargo Actual</div><div id="nc-ca" class="fi" style="background:var(--bg2);pointer-events:none">â€”</div></div><div class="fg"><div class="fl">Dpto Actual</div><div id="nc-da" class="fi" style="background:var(--bg2);pointer-events:none">â€”</div></div><div class="fg"><div class="fl">Nuevo Cargo *</div><input class="fi" id="nc-nc" list="dl-cargos" placeholder="Nuevo cargo..."><datalist id="dl-cargos">'+cargos.map(c=>'<option value="'+c+'">').join('')+'</datalist></div><div class="fg"><div class="fl">Nuevo Dpto</div><input class="fi" id="nc-nd" list="dl-dptos" placeholder="(mismo si vacÃ­o)"><datalist id="dl-dptos">'+dptos.map(d=>'<option value="'+d+'">').join('')+'</datalist></div><div class="fg"><div class="fl">Nueva Jefatura</div><input class="fi" id="nc-nj" list="dl-jefs" placeholder="(misma si vacÃ­o)"><datalist id="dl-jefs">'+jefs.map(j=>'<option value="'+j+'">').join('')+'</datalist></div><div class="fg"><div class="fl">Nuevo Puesto</div><input class="fi" id="nc-np" placeholder="(mismo si vacÃ­o)"></div></div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveCambio()">ğŸ’¾ Registrar Cambio</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
fillCambioData();document.getElementById('modal').style.display='flex';}

function fillCambioData(){const id=parseInt(document.getElementById('nc-e').value);const e=E.find(x=>x.id===id);if(!e)return;
document.getElementById('nc-ca').textContent=e.cargo;document.getElementById('nc-da').textContent=e.dpto;
document.getElementById('nc-nj').placeholder=e.jefatura||'(misma si vacÃ­o)';document.getElementById('nc-np').placeholder=e.puesto||'(mismo si vacÃ­o)';}

function saveCambio(){const id=parseInt(document.getElementById('nc-e').value),e=E.find(x=>x.id===id);
if(!e){toast('Selecciona colaborador',1);return;}
const fecha=document.getElementById('nc-f').value,nc=document.getElementById('nc-nc').value.trim();
if(!fecha||!nc){toast('Fecha y nuevo cargo obligatorios',1);return;}
const nd=document.getElementById('nc-nd').value.trim(),nj=document.getElementById('nc-nj').value.trim(),np=document.getElementById('nc-np').value.trim();
const cambio={desde:fecha,cod:e.cod,rut:e.rut,nombre:e.nombre,dpto:nd||e.dpto,cargoAnterior:e.cargo,nuevoCargo:nc,jefatura:nj||e.jefatura};
CH.push(cambio);
// Update employee
const oldCargo=e.cargo,oldDpto=e.dpto;
e.cargo=nc;if(nd)e.dpto=nd;if(nj)e.jefatura=nj;if(np)e.puesto=np;
aa('CAMBIO',e.nombre+': '+oldCargo+' â†’ '+nc+(nd&&nd!==oldDpto?' | Dpto: '+oldDpto+' â†’ '+nd:''));
save();clM();refreshAll();toast('âœ… Cambio registrado');}

function openCambioDetail(key){const c=CH.find(x=>chKey(x)===key);if(!c)return;
const ds=chDocStatus(c),d=chDocs[key]||{};const e=E.find(x=>x.rut===c.rut);
document.getElementById('mt').textContent='Cambio â€” '+c.nombre;
let h='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px"><div class="rpt-stat"><div class="rl">Fecha</div><div class="rv" style="font-size:16px">'+fd(c.desde)+'</div></div><div class="rpt-stat"><div class="rl">COD</div><div class="rv" style="font-size:16px;font-family:var(--mono)">'+c.cod+'</div></div></div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px"><div style="padding:12px;border-radius:var(--radius);background:var(--red-bg);border:1px solid var(--border)"><div style="font-size:10px;color:var(--text3);font-weight:700">CARGO ANTERIOR</div><div style="font-size:14px;font-weight:700;margin-top:4px">'+c.cargoAnterior+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">'+c.dpto+' â€” '+c.jefatura+'</div></div><div style="padding:12px;border-radius:var(--radius);background:var(--teal-bg);border:1px solid var(--border)"><div style="font-size:10px;color:var(--text3);font-weight:700">NUEVO CARGO</div><div style="font-size:14px;font-weight:700;color:var(--teal);margin-top:4px">'+c.nuevoCargo+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">'+(e?e.dpto:c.dpto)+' â€” '+(e?e.jefatura:c.jefatura)+'</div></div></div>';
// Documents section
h+='<div style="font-weight:700;font-size:12px;margin-bottom:8px;color:var(--text2)">ğŸ“ DOCUMENTOS REQUERIDOS</div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">';
// Anexo
h+='<div style="padding:12px;border-radius:var(--radius);border:1px solid '+(ds.anexo?'var(--teal)':'var(--red)')+';background:'+(ds.anexo?'var(--teal-bg)':'var(--red-bg)')+'"><div style="font-size:11px;font-weight:700">'+(ds.anexo?'âœ…':'âŒ')+' Anexo Descriptivo de Cargo</div>';
if(ds.anexo){h+='<div style="font-size:10px;color:var(--text3);margin-top:4px">ğŸ“„ '+d.anexo.name+' <span style="color:var(--teal)">'+fd(d.anexo.date)+'</span></div><div style="margin-top:6px"><a href="'+d.anexo.data+'" download="'+d.anexo.name+'" class="btn btn-g btn-sm" onclick="event.stopPropagation()">â¬‡ Descargar</a> <button class="btn btn-d btn-sm" onclick="delChDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'anexo'"+')">Ã—</button></div>';}else{h+='<div style="margin-top:6px"><label class="btn btn-p btn-sm" style="cursor:pointer">ğŸ“¤ Subir Anexo<input type="file" hidden onchange="uploadChDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'anexo'"+',this)"></label></div>';}
h+='</div>';
// CapacitaciÃ³n
h+='<div style="padding:12px;border-radius:var(--radius);border:1px solid '+(ds.cap?'var(--teal)':'var(--red)')+';background:'+(ds.cap?'var(--teal-bg)':'var(--red-bg)')+'"><div style="font-size:11px;font-weight:700">'+(ds.cap?'âœ…':'âŒ')+' CapacitaciÃ³n Firmada</div>';
if(ds.cap){h+='<div style="font-size:10px;color:var(--text3);margin-top:4px">ğŸ“„ '+d.cap.name+' <span style="color:var(--teal)">'+fd(d.cap.date)+'</span></div><div style="margin-top:6px"><a href="'+d.cap.data+'" download="'+d.cap.name+'" class="btn btn-g btn-sm" onclick="event.stopPropagation()">â¬‡ Descargar</a> <button class="btn btn-d btn-sm" onclick="delChDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'cap'"+')">Ã—</button></div>';}else{h+='<div style="margin-top:6px"><label class="btn btn-p btn-sm" style="cursor:pointer">ğŸ“¤ Subir CapacitaciÃ³n<input type="file" hidden onchange="uploadChDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'cap'"+',this)"></label></div>';}
h+='</div></div>';
// Report button
h+='<div style="display:flex;gap:6px"><button class="btn btn-g" onclick="genCambioRpt(\''+key.replace(/'/g,"\\\\'")+'\')" >ğŸ“„ Generar Reporte</button>'+(e?'<button class="btn btn-g" onclick="clM();openEmp('+e.id+')">ğŸ‘¤ Ver Ficha</button>':'')+'<button class="btn btn-g" onclick="clM()">Cerrar</button></div>';
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';}

function uploadChDoc(key,type,inp){const f=inp.files[0];if(!f)return;if(f.size>5*1024*1024){toast('MÃ¡x 5MB',1);return;}
const r=new FileReader();r.onload=function(){if(!chDocs[key])chDocs[key]={};chDocs[key][type]={name:f.name,data:r.result,date:new Date().toISOString().slice(0,10)};
const c=CH.find(x=>chKey(x)===key);aa('DOC_CAMBIO','Subido '+type+' para '+(c?c.nombre:key));save();openCambioDetail(key);toast('âœ… Documento subido');};r.readAsDataURL(f);}

function delChDoc(key,type){if(!confirm('Â¿Eliminar documento?'))return;if(chDocs[key])delete chDocs[key][type];save();openCambioDetail(key);toast('Documento eliminado');}

function genCambioRpt(key){const c=CH.find(x=>chKey(x)===key);if(!c){toast('Cambio no encontrado',1);return;}
const e=E.find(x=>x.rut===c.rut);const ds=chDocStatus(c);
const w=window.open('','_blank','width=800,height=600');
w.document.write('<html><head><title>Reporte Cambio - '+c.nombre+'</title><style>body{font-family:Arial,sans-serif;padding:40px;color:#333}h1{color:#00897B;font-size:20px;border-bottom:2px solid #00897B;padding-bottom:8px}h2{font-size:14px;color:#666;margin-top:24px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:16px 0}.box{padding:12px;border:1px solid #ddd;border-radius:8px}.lbl{font-size:10px;color:#999;font-weight:700;text-transform:uppercase}.val{font-size:14px;font-weight:600;margin-top:4px}.arrow{text-align:center;font-size:24px;color:#00897B;padding:8px}.status{padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700;display:inline-block}.ok{background:#e8f5e9;color:#2e7d32}.no{background:#fce4ec;color:#c62828}@media print{body{padding:20px}}</style></head><body>');
w.document.write('<div style="display:flex;justify-content:space-between;align-items:center"><h1>Reporte de Cambio de Cargo</h1><div style="text-align:right;font-size:11px;color:#999">Dr. Simi â€” Centro de DistribuciÃ³n<br>Fecha: '+fd(new Date().toISOString().slice(0,10))+'</div></div>');
w.document.write('<div class="grid"><div class="box"><div class="lbl">Colaborador</div><div class="val">'+c.nombre+'</div></div><div class="box"><div class="lbl">RUT</div><div class="val">'+(c.rut||'â€”')+'</div></div><div class="box"><div class="lbl">COD</div><div class="val">'+c.cod+'</div></div><div class="box"><div class="lbl">Fecha Efectiva</div><div class="val">'+fd(c.desde)+'</div></div></div>');
w.document.write('<h2>Cambio de Cargo</h2><div class="grid"><div class="box" style="border-left:4px solid #ef5350"><div class="lbl">Cargo Anterior</div><div class="val">'+c.cargoAnterior+'</div></div><div class="box" style="border-left:4px solid #00897B"><div class="lbl">Nuevo Cargo</div><div class="val" style="color:#00897B">'+c.nuevoCargo+'</div></div></div>');
w.document.write('<div class="grid"><div class="box"><div class="lbl">Departamento</div><div class="val">'+(e?e.dpto:c.dpto)+'</div></div><div class="box"><div class="lbl">Jefatura</div><div class="val">'+(e?e.jefatura:c.jefatura)+'</div></div></div>');
w.document.write('<h2>Estado DocumentaciÃ³n</h2><table style="width:100%;border-collapse:collapse;margin-top:8px"><tr style="background:#f5f5f5"><th style="text-align:left;padding:8px;font-size:11px">DOCUMENTO</th><th style="text-align:center;padding:8px;font-size:11px">ESTADO</th><th style="text-align:left;padding:8px;font-size:11px">FECHA</th></tr>');
const dd=chDocs[key]||{};
w.document.write('<tr><td style="padding:8px;border-bottom:1px solid #eee">Anexo Descriptivo de Cargo</td><td style="text-align:center;padding:8px;border-bottom:1px solid #eee"><span class="status '+(ds.anexo?'ok':'no')+'">'+(ds.anexo?'âœ… Subido':'âŒ Pendiente')+'</span></td><td style="padding:8px;border-bottom:1px solid #eee">'+(dd.anexo?fd(dd.anexo.date):'â€”')+'</td></tr>');
w.document.write('<tr><td style="padding:8px;border-bottom:1px solid #eee">CapacitaciÃ³n Firmada</td><td style="text-align:center;padding:8px;border-bottom:1px solid #eee"><span class="status '+(ds.cap?'ok':'no')+'">'+(ds.cap?'âœ… Subido':'âŒ Pendiente')+'</span></td><td style="padding:8px;border-bottom:1px solid #eee">'+(dd.cap?fd(dd.cap.date):'â€”')+'</td></tr></table>');
w.document.write('<div style="margin-top:40px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;text-align:center"><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">Colaborador</div></div><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">Jefatura Directa</div></div><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">RRHH / Operaciones</div></div></div>');
w.document.write('</body></html>');w.document.close();w.print();}
const MOTIVOS_BAJA=['RENUNCIA','DESPIDO','NO RENOVACION','NO CONCURRENCIA','CAMBIO DE AREA','MUTUO ACUERDO','JUBILACION','FALLECIMIENTO','TERMINO PROYECTO','OTRO'];
function bjKey(b){return(b.rut||'')+'_'+(b.fecha||'');}
function bjDocStatus(b){const k=bjKey(b),d=bajDocs[k];if(!d)return{finiquito:false,carta:false,complete:false};return{finiquito:!!d.finiquito,carta:!!d.carta,complete:!!d.finiquito&&!!d.carta};}
function rBaj(d){
const total=B.length,cub=B.filter(b=>b.status==='CUBIERTO').length,noCub=B.filter(b=>b.status==='NO CUBIERTO').length;
const withDocs=B.filter(b=>bjDocStatus(b).complete).length;
document.getElementById('bk').innerHTML='<div class="kc"><div class="kl">Total Bajas</div><div class="kv" style="color:var(--red)">'+total+'</div></div><div class="kc"><div class="kl">Cubiertas</div><div class="kv" style="color:var(--teal)">'+cub+'</div></div><div class="kc"><div class="kl">No Cubiertas</div><div class="kv" style="color:var(--red)">'+noCub+'</div></div><div class="kc"><div class="kl">Docs Pendientes</div><div class="kv" style="color:'+(total-withDocs>0?'var(--yellow)':'var(--teal)')+'">'+(total-withDocs)+'</div></div>';
// Populate filters
const yrSel=document.getElementById('fb-yr'),yrV=yrSel.value;
const yrs=[...new Set(B.map(b=>b.fecha?b.fecha.slice(0,4):'').filter(Boolean))].sort().reverse();
yrSel.innerHTML='<option value="">Todos</option>'+yrs.map(y=>'<option'+(y===yrV?' selected':'')+'>'+y+'</option>').join('');
const motSel=document.getElementById('fb-mot'),motV=motSel.value;
const mots=[...new Set(B.map(b=>b.motivo).filter(Boolean))].sort();
motSel.innerHTML='<option value="">Motivo: Todos</option>'+mots.map(m=>'<option'+(m===motV?' selected':'')+'>'+m+'</option>').join('');
document.getElementById('bt2').innerHTML=d.sort((a,b)=>(b.fecha||'').localeCompare(a.fecha||'')).map(b=>{const ds=bjDocStatus(b);const dcI=ds.complete?'<span class="badge b-ok">âœ…</span>':'<span class="badge b-no">âš ï¸</span>';return'<tr style="cursor:pointer" onclick="openBajaDetail(\''+bjKey(b).replace(/'/g,"\\\\'")+'\')" title="Click para ver detalle"><td>'+fd(b.fecha)+'</td><td style="font-family:var(--mono);font-size:10px">'+b.rut+'</td><td><strong>'+b.nombre+'</strong></td><td>'+b.cargo+'</td><td>'+(b.dpto||'â€”')+'</td><td>'+(b.motivo||'â€”')+'</td><td><span class="badge '+(b.status==='CUBIERTO'?'b-ok':'b-no')+'">'+b.status+'</span></td><td>'+dcI+'</td><td onclick="event.stopPropagation()"><button class="btn btn-d btn-sm" onclick="genBajaRpt(\''+bjKey(b).replace(/'/g,"\\\\'")+'\')" title="Reporte">ğŸ“„</button></td></tr>';}).join('');}
function fB(){const q=(document.getElementById('s-b').value||'').toLowerCase(),s=document.getElementById('fbs').value,yr=document.getElementById('fb-yr').value,mot=document.getElementById('fb-mot').value,ds=document.getElementById('fb-ds').value;
let d=B;if(q)d=d.filter(b=>(b.nombre+' '+b.rut+' '+(b.cargo||'')).toLowerCase().includes(q));
if(s)d=d.filter(b=>b.status===s);if(yr)d=d.filter(b=>b.fecha&&b.fecha.startsWith(yr));
if(mot)d=d.filter(b=>b.motivo===mot);
if(ds==='ok')d=d.filter(b=>bjDocStatus(b).complete);if(ds==='pend')d=d.filter(b=>!bjDocStatus(b).complete);
rBaj(d);}

function openNewBaja(){document.getElementById('mt').textContent='Registrar Nueva Baja';
const ac=E.filter(e=>e.status==='ACTIVO').sort((a,b)=>a.nombre.localeCompare(b.nombre));
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg full"><div class="fl">Colaborador *</div><select class="fi" id="nb-e" onchange="fillBajaData()">'+ac.map(e=>'<option value="'+e.id+'">'+e.nombre+' â€” '+e.cargo+' ('+e.dpto+')</option>').join('')+'</select></div><div class="fg"><div class="fl">Fecha Baja *</div><input type="date" class="fi" id="nb-f" value="'+new Date().toISOString().slice(0,10)+'"></div><div class="fg"><div class="fl">Motivo *</div><select class="fi" id="nb-m"><option value="">Seleccione...</option>'+MOTIVOS_BAJA.map(m=>'<option>'+m+'</option>').join('')+'</select></div><div class="fg"><div class="fl">Cargo</div><div id="nb-ca" class="fi" style="background:var(--bg2);pointer-events:none">â€”</div></div><div class="fg"><div class="fl">Departamento</div><div id="nb-dp" class="fi" style="background:var(--bg2);pointer-events:none">â€”</div></div><div class="fg"><div class="fl">Jefatura</div><div id="nb-jf" class="fi" style="background:var(--bg2);pointer-events:none">â€”</div></div><div class="fg full"><div class="fl">ObservaciÃ³n</div><input class="fi" id="nb-obs" placeholder="Nota adicional..."></div></div><div style="margin-top:6px;padding:10px;background:var(--red-bg);border-radius:var(--radius);font-size:11px;color:var(--red)">âš ï¸ Al registrar la baja, el colaborador cambiarÃ¡ a status <strong>BAJA</strong> y se actualizarÃ¡ la dotaciÃ³n automÃ¡ticamente.</div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveBaja()">ğŸ’¾ Registrar Baja</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
fillBajaData();document.getElementById('modal').style.display='flex';}
function fillBajaData(){const id=parseInt(document.getElementById('nb-e').value);const e=E.find(x=>x.id===id);if(!e)return;document.getElementById('nb-ca').textContent=e.cargo;document.getElementById('nb-dp').textContent=e.dpto;document.getElementById('nb-jf').textContent=e.jefatura||'â€”';}
function saveBaja(){const id=parseInt(document.getElementById('nb-e').value),e=E.find(x=>x.id===id);
if(!e){toast('Selecciona colaborador',1);return;}
const fecha=document.getElementById('nb-f').value,motivo=document.getElementById('nb-m').value,obs=document.getElementById('nb-obs').value.trim();
if(!fecha){toast('Fecha obligatoria',1);return;}if(!motivo){toast('Selecciona motivo',1);return;}
B.push({fecha,status:'NO CUBIERTO',rut:e.rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,jefatura:e.jefatura,motivo,obs});
e.status='BAJA';
aa('BAJA',e.nombre+' â€” '+motivo+(obs?' ('+obs+')':''));
save();clM();refreshAll();toast('âœ… Baja registrada â€” '+e.nombre);}

function openBajaDetail(key){const b=B.find(x=>bjKey(x)===key);if(!b)return;
const ds=bjDocStatus(b),d=bajDocs[key]||{};const e=E.find(x=>x.rut===b.rut);
document.getElementById('mt').textContent='Baja â€” '+b.nombre;
let h='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px"><div class="rpt-stat"><div class="rl">Fecha</div><div class="rv" style="font-size:16px">'+fd(b.fecha)+'</div></div><div class="rpt-stat"><div class="rl">Motivo</div><div class="rv" style="font-size:14px;color:var(--red)">'+b.motivo+'</div></div><div class="rpt-stat"><div class="rl">Status</div><div class="rv"><span class="badge '+(b.status==='CUBIERTO'?'b-ok':'b-no')+'">'+b.status+'</span></div></div></div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px"><div class="rpt-stat"><div class="rl">Cargo</div><div class="rv">'+b.cargo+'</div></div><div class="rpt-stat"><div class="rl">Departamento</div><div class="rv">'+(b.dpto||'â€”')+'</div></div><div class="rpt-stat"><div class="rl">Jefatura</div><div class="rv">'+(b.jefatura||'â€”')+'</div></div></div>';
if(b.obs)h+='<div style="padding:8px;margin-bottom:12px;background:var(--bg2);border-radius:var(--radius);font-size:11px">ğŸ“ '+b.obs+'</div>';
// Status change
h+='<div style="display:flex;gap:8px;margin-bottom:16px;align-items:center"><span style="font-size:11px;font-weight:700">Cambiar estado:</span><select class="fs" id="bd-st"><option'+(b.status==='NO CUBIERTO'?' selected':'')+'>NO CUBIERTO</option><option'+(b.status==='CUBIERTO'?' selected':'')+'>CUBIERTO</option></select><button class="btn btn-g btn-sm" onclick="updBajaStatus(\''+key.replace(/'/g,"\\\\'")+'\')" >ğŸ’¾ Actualizar</button></div>';
// Documents
h+='<div style="font-weight:700;font-size:12px;margin-bottom:8px;color:var(--text2)">ğŸ“ DOCUMENTOS</div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">';
h+='<div style="padding:12px;border-radius:var(--radius);border:1px solid '+(ds.finiquito?'var(--teal)':'var(--red)')+';background:'+(ds.finiquito?'var(--teal-bg)':'var(--red-bg)')+'"><div style="font-size:11px;font-weight:700">'+(ds.finiquito?'âœ…':'âŒ')+' Finiquito</div>';
if(ds.finiquito){h+='<div style="font-size:10px;color:var(--text3);margin-top:4px">ğŸ“„ '+d.finiquito.name+' <span style="color:var(--teal)">'+fd(d.finiquito.date)+'</span></div><div style="margin-top:6px"><a href="'+d.finiquito.data+'" download="'+d.finiquito.name+'" class="btn btn-g btn-sm" onclick="event.stopPropagation()">â¬‡</a> <button class="btn btn-d btn-sm" onclick="delBjDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'finiquito'"+')">Ã—</button></div>';}else{h+='<div style="margin-top:6px"><label class="btn btn-p btn-sm" style="cursor:pointer">ğŸ“¤ Subir<input type="file" hidden onchange="uploadBjDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'finiquito'"+',this)"></label></div>';}
h+='</div>';
h+='<div style="padding:12px;border-radius:var(--radius);border:1px solid '+(ds.carta?'var(--teal)':'var(--red)')+';background:'+(ds.carta?'var(--teal-bg)':'var(--red-bg)')+'"><div style="font-size:11px;font-weight:700">'+(ds.carta?'âœ…':'âŒ')+' Carta Aviso / NotificaciÃ³n</div>';
if(ds.carta){h+='<div style="font-size:10px;color:var(--text3);margin-top:4px">ğŸ“„ '+d.carta.name+' <span style="color:var(--teal)">'+fd(d.carta.date)+'</span></div><div style="margin-top:6px"><a href="'+d.carta.data+'" download="'+d.carta.name+'" class="btn btn-g btn-sm" onclick="event.stopPropagation()">â¬‡</a> <button class="btn btn-d btn-sm" onclick="delBjDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'carta'"+')">Ã—</button></div>';}else{h+='<div style="margin-top:6px"><label class="btn btn-p btn-sm" style="cursor:pointer">ğŸ“¤ Subir<input type="file" hidden onchange="uploadBjDoc(\''+key.replace(/'/g,"\\\\'")+'\',' +"'carta'"+',this)"></label></div>';}
h+='</div></div>';
h+='<div style="display:flex;gap:6px"><button class="btn btn-g" onclick="genBajaRpt(\''+key.replace(/'/g,"\\\\'")+'\')">ğŸ“„ Reporte</button>'+(e?'<button class="btn btn-g" onclick="clM();openEmp('+e.id+')">ğŸ‘¤ Ficha</button>':'')+'<button class="btn btn-g" onclick="clM()">Cerrar</button></div>';
document.getElementById('mbd').innerHTML=h;document.getElementById('modal').style.display='flex';}

function updBajaStatus(key){const b=B.find(x=>bjKey(x)===key);if(!b)return;b.status=document.getElementById('bd-st').value;aa('BAJA_UPD',b.nombre+' â†’ '+b.status);save();openBajaDetail(key);refreshAll();toast('âœ… Status actualizado');}
function uploadBjDoc(key,type,inp){const f=inp.files[0];if(!f)return;if(f.size>5*1024*1024){toast('MÃ¡x 5MB',1);return;}const r=new FileReader();r.onload=function(){if(!bajDocs[key])bajDocs[key]={};bajDocs[key][type]={name:f.name,data:r.result,date:new Date().toISOString().slice(0,10)};const b=B.find(x=>bjKey(x)===key);aa('DOC_BAJA','Subido '+type+' para '+(b?b.nombre:key));save();openBajaDetail(key);toast('âœ… Documento subido');};r.readAsDataURL(f);}
function delBjDoc(key,type){if(!confirm('Â¿Eliminar documento?'))return;if(bajDocs[key])delete bajDocs[key][type];save();openBajaDetail(key);toast('Documento eliminado');}
function genBajaRpt(key){const b=B.find(x=>bjKey(x)===key);if(!b){toast('No encontrado',1);return;}const ds=bjDocStatus(b),dd=bajDocs[key]||{};
const w=window.open('','_blank','width=800,height=600');
w.document.write('<html><head><title>Baja - '+b.nombre+'</title><style>body{font-family:Arial,sans-serif;padding:40px;color:#333}h1{color:#D32F2F;font-size:20px;border-bottom:2px solid #D32F2F;padding-bottom:8px}h2{font-size:14px;color:#666;margin-top:24px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:16px 0}.box{padding:12px;border:1px solid #ddd;border-radius:8px}.lbl{font-size:10px;color:#999;font-weight:700;text-transform:uppercase}.val{font-size:14px;font-weight:600;margin-top:4px}.st{padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700;display:inline-block}.ok{background:#e8f5e9;color:#2e7d32}.no{background:#fce4ec;color:#c62828}@media print{body{padding:20px}}</style></head><body>');
w.document.write('<div style="display:flex;justify-content:space-between;align-items:center"><h1>Registro de Baja de Personal</h1><div style="text-align:right;font-size:11px;color:#999">Dr. Simi â€” Centro de DistribuciÃ³n<br>'+fd(new Date().toISOString().slice(0,10))+'</div></div>');
w.document.write('<div class="grid"><div class="box"><div class="lbl">Colaborador</div><div class="val">'+b.nombre+'</div></div><div class="box"><div class="lbl">RUT</div><div class="val">'+b.rut+'</div></div><div class="box"><div class="lbl">Cargo</div><div class="val">'+b.cargo+'</div></div><div class="box"><div class="lbl">Departamento</div><div class="val">'+(b.dpto||'â€”')+'</div></div><div class="box"><div class="lbl">Fecha Baja</div><div class="val">'+fd(b.fecha)+'</div></div><div class="box" style="border-left:4px solid #D32F2F"><div class="lbl">Motivo</div><div class="val" style="color:#D32F2F">'+b.motivo+'</div></div></div>');
if(b.obs)w.document.write('<div style="padding:12px;background:#f5f5f5;border-radius:8px;margin:16px 0"><div class="lbl">ObservaciÃ³n</div><div style="margin-top:4px">'+b.obs+'</div></div>');
w.document.write('<h2>Estado ReposiciÃ³n</h2><div style="margin:8px 0"><span class="st '+(b.status==='CUBIERTO'?'ok':'no')+'">'+b.status+'</span></div>');
w.document.write('<h2>DocumentaciÃ³n</h2><table style="width:100%;border-collapse:collapse;margin-top:8px"><tr style="background:#f5f5f5"><th style="text-align:left;padding:8px;font-size:11px">DOCUMENTO</th><th style="text-align:center;padding:8px;font-size:11px">ESTADO</th><th style="text-align:left;padding:8px;font-size:11px">FECHA</th></tr><tr><td style="padding:8px;border-bottom:1px solid #eee">Finiquito</td><td style="text-align:center;padding:8px;border-bottom:1px solid #eee"><span class="st '+(ds.finiquito?'ok':'no')+'">'+(ds.finiquito?'Subido':'Pendiente')+'</span></td><td style="padding:8px;border-bottom:1px solid #eee">'+(dd.finiquito?fd(dd.finiquito.date):'â€”')+'</td></tr><tr><td style="padding:8px;border-bottom:1px solid #eee">Carta Aviso</td><td style="text-align:center;padding:8px;border-bottom:1px solid #eee"><span class="st '+(ds.carta?'ok':'no')+'">'+(ds.carta?'Subido':'Pendiente')+'</span></td><td style="padding:8px;border-bottom:1px solid #eee">'+(dd.carta?fd(dd.carta.date):'â€”')+'</td></tr></table>');
w.document.write('<div style="margin-top:40px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;text-align:center"><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">Jefatura Directa</div></div><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">RRHH</div></div><div><div style="border-top:1px solid #333;padding-top:8px;font-size:11px">Gerencia</div></div></div></body></html>');
w.document.close();w.print();}

// CALENDARIO
function calN(dir){cM+=dir;if(cM>11){cM=0;cY++;}if(cM<0){cM=11;cY--;}rCal();}
function rCal(){document.getElementById('cm').textContent=MN[cM]+' '+cY;document.getElementById('ct2').textContent=MN[cM]+' '+cY;
const first=new Date(cY,cM,1),lastDay=new Date(cY,cM+1,0).getDate();let sd=first.getDay();sd=sd===0?6:sd-1;
const today=new Date(),isT=(d)=>today.getDate()===d&&today.getMonth()===cM&&today.getFullYear()===cY;
const myE=vis().filter(e=>e.status==='ACTIVO');
const ev=[],mm=String(cM+1).padStart(2,'0');
myE.forEach(e=>{if(e.nacimiento&&e.nacimiento!=='nan'&&e.nacimiento!=='00:00:00'&&e.nacimiento.slice(5,7)===mm){const day=parseInt(e.nacimiento.slice(8,10));if(day>=1&&day<=31)ev.push({day,type:'ğŸ‚',text:e.nombre,color:'var(--purple)',rut:e.rut,id:e.id,isBday:true});}});
myE.filter(e=>e.tipoContrato==='PLAZO FIJO'&&e.ingreso).forEach(e=>{const ing=new Date(e.ingreso),s6=new Date(ing);s6.setMonth(s6.getMonth()+6);if(s6.getMonth()===cM&&s6.getFullYear()===cY)ev.push({day:s6.getDate(),type:'ğŸ“‹',text:e.nombre+' â€” 6m contrato',color:'var(--blue)',id:e.id});});
Object.entries(lics).forEach(([rut,l])=>{if(l.end){const le=new Date(l.end);if(le.getMonth()===cM&&le.getFullYear()===cY){const e=myE.find(x=>x.rut===rut);if(e)ev.push({day:le.getDate(),type:'ğŸ¥',text:e.nombre+' â€” Fin lic.',color:'var(--red)',id:e.id});}}});
vac.filter(v=>v.status==='APROBADA'&&v.start).forEach(v=>{const ds=new Date(v.start);if(ds.getMonth()===cM&&ds.getFullYear()===cY){const e=myE.find(x=>x.rut===v.rut);if(e)ev.push({day:ds.getDate(),type:'ğŸ–ï¸',text:e.nombre+' â€” Vacaciones',color:'var(--green)',id:e.id});}});
permisos.filter(p=>p.fecha&&p.fecha.slice(5,7)===mm&&p.fecha.slice(0,4)===String(cY)).forEach(p=>{const e=E.find(x=>x.rut===p.rut);const icon=(p.tipoId==='CUMPLE'||p.tipo==='CUMPLEAÃ‘OS')?'ğŸ':(p.goce||'')==='SIN GOCE'?'ğŸ”´':'ğŸ“‹';const clr=(p.goce||'')==='SIN GOCE'?'var(--red)':'var(--teal)';ev.push({day:parseInt(p.fecha.slice(8,10)),type:icon,text:(e?e.nombre:'?')+' â€” '+(p.tipo||'Permiso')+(p.dias?' ('+p.dias+'d)':''),color:clr,id:e?e.id:0});});
const ebd={};ev.forEach(e=>{if(!ebd[e.day])ebd[e.day]=[];ebd[e.day].push(e);});
let h='';for(let i=0;i<sd;i++)h+='<div class="cal-d empty"></div>';
for(let d=1;d<=lastDay;d++){const td=isT(d)?' today':'';const e2=ebd[d];h+='<div class="cal-d'+td+(e2?' has-ev':'')+'"'+(e2?' title="'+e2.map(e=>e.text).join('\n')+'"':'')+'>'+d+(e2?'<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);display:flex;gap:1px">'+e2.slice(0,3).map(e=>'<div style="width:4px;height:4px;border-radius:50%;background:'+e.color+'"></div>').join('')+'</div>':'')+'</div>';}
document.getElementById('cg2').innerHTML=h;
// Events list with actions
document.getElementById('ce').innerHTML=ev.sort((a,b)=>a.day-b.day).map(e=>{let acts='';
if(e.isBday){acts='<button class="btn btn-g btn-sm" onclick="event.stopPropagation();openBdayBenefit('+e.id+')" title="Beneficio cumpleaÃ±os">ğŸ</button><button class="btn btn-g btn-sm" onclick="event.stopPropagation();openPermiso('+e.id+',\'CUMPLEAÃ‘OS\')" title="DÃ­a permiso cumpleaÃ±os">ğŸ“</button>';}
return'<div class="ai" style="border-left-color:'+e.color+';cursor:pointer" onclick="'+(e.id?'openEmp('+e.id+')':'')+'"><span>'+e.type+'</span><span style="flex:1">'+e.text+'</span><span class="at">DÃ­a '+e.day+'</span>'+acts+'</div>';}).join('')||'<div style="font-size:11px;color:var(--text3);padding:8px">Sin eventos</div>';
// Permisos section
const monthPermisos=permisos.filter(p=>p.fecha&&p.fecha.slice(5,7)===mm&&p.fecha.slice(0,4)===String(cY));
let ph='<button class="btn btn-p btn-sm" onclick="openPermisoGen()" style="margin-bottom:8px">â• Nuevo Permiso</button>';
if(monthPermisos.length){ph+=monthPermisos.map(p=>{const e=E.find(x=>x.rut===p.rut);const origIdx=permisos.indexOf(p);
const goceColor=(p.goce||'')==='SIN GOCE'?'var(--red)':'var(--teal)';
const icon=p.tipoId==='CUMPLE'||p.tipo==='CUMPLEAÃ‘OS'?'ğŸ':(p.goce||'')==='SIN GOCE'?'ğŸ”´':'ğŸŸ¢';
return'<div class="ai" style="border-left-color:'+goceColor+'"><span>'+icon+'</span><span style="flex:1"><strong>'+(e?e.nombre:'?')+'</strong> â€” '+(p.tipo||'Permiso')+(p.dias?' ('+p.dias+'d)':'')+'<br><span style="font-size:9px;color:var(--text3)">'+(p.goce||'CON GOCE')+' '+(p.art||'')+'</span></span><span class="at">'+fd(p.fecha)+(p.end&&p.end!==p.fecha?'<br>â†’'+fd(p.end):'')+'</span><button class="btn btn-d btn-sm" onclick="event.stopPropagation();exportPermisoXlsx('+origIdx+')" title="Excel">ğŸ“¥</button><button class="btn btn-d btn-sm" onclick="event.stopPropagation();delPermiso('+origIdx+')">Ã—</button></div>';}).join('');}else{ph+='<div style="font-size:11px;color:var(--text3)">Sin permisos este mes</div>';}
document.getElementById('cp').innerHTML=ph;}

function openPermisoGen(){document.getElementById('mt').textContent='Registrar Permiso Especial';
const ac=vis().filter(e=>e.status==='ACTIVO').sort((a,b)=>a.nombre.localeCompare(b.nombre));
const legalOpts=PERMISOS_LEGALES.map(p=>'<option value="'+p.id+'" data-dias="'+p.dias+'" data-tipo="'+p.tipo+'" data-goce="'+p.goce+'">'+p.nombre+(p.dias?' ('+p.dias+'d '+p.tipo+')':'')+'</option>').join('');
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg full"><div class="fl">Colaborador *</div><select class="fi" id="pm-e">'+ac.map(e=>'<option value="'+e.rut+'">'+e.nombre+' â€” '+e.cargo+' ('+e.dpto+')</option>').join('')+'</select></div>'+
'<div class="fg full"><div class="fl">Tipo de Permiso *</div><select class="fi" id="pm-t" onchange="onPermisoTipoChange()">'+legalOpts+'</select></div>'+
'<div id="pm-legal-info" style="margin:4px 0;padding:10px;background:var(--teal-bg);border:1px solid var(--teal);border-radius:8px;font-size:11px"></div>'+
'<div class="fg"><div class="fl">Goce</div><div id="pm-goce-display" style="font-weight:700;color:var(--teal);font-size:13px">CON GOCE</div></div>'+
'<div class="fg"><div class="fl">DÃ­as</div><div id="pm-dias-display" style="font-weight:800;font-size:18px;font-family:var(--mono);color:var(--teal)">5</div></div>'+
'<div class="fg"><div class="fl">Fecha Inicio *</div><input type="date" class="fi" id="pm-f" value="'+new Date().toISOString().slice(0,10)+'" onchange="calcPermisoDates()"></div>'+
'<div class="fg"><div class="fl">Fecha TÃ©rmino</div><input type="date" class="fi" id="pm-f2" onchange="calcPermisoDias()"></div>'+
'<div class="fg full"><div class="fl">ObservaciÃ³n</div><input class="fi" id="pm-obs" placeholder="Nota..."></div>'+
'<div class="fg full"><div class="fl">Documento Respaldo</div><div id="pm-doc-req" style="font-size:10px;color:var(--text3)"></div></div>'+
'</div>'+
'<div style="margin-top:14px;display:flex;gap:6px;flex-wrap:wrap">'+
'<button class="btn btn-p" onclick="savePermisoLegal()">ğŸ’¾ Registrar</button>'+
'<button class="btn btn-e" onclick="savePermisoLegalXlsx()">ğŸ“¥ Registrar + Excel</button>'+
'<button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('modal').style.display='flex';onPermisoTipoChange();}

function openPermiso(id,tipo){openPermisoGen();const e=E.find(x=>x.id===id);if(e){document.getElementById('pm-e').value=e.rut;document.getElementById('pm-t').value=tipo==='CUMPLEAÃ‘OS'?'CUMPLE':tipo||'CUMPLE';onPermisoTipoChange();if(e.nacimiento&&e.nacimiento!=='nan'){const bd=new Date().getFullYear()+e.nacimiento.slice(4);document.getElementById('pm-f').value=bd;calcPermisoDates();}}}

function openBdayBenefit(id){const e=E.find(x=>x.id===id);if(!e)return;
document.getElementById('mt').textContent='ğŸ‚ Beneficio de CumpleaÃ±os';
const edad=e.nacimiento&&e.nacimiento!=='nan'?new Date().getFullYear()-parseInt(e.nacimiento.slice(0,4)):'?';
const bdStr=e.nacimiento&&e.nacimiento!=='nan'?fd(new Date().getFullYear()+e.nacimiento.slice(4)):'â€”';
document.getElementById('mbd').innerHTML='<div style="text-align:center;padding:16px"><div style="font-size:48px">ğŸ‚</div><div style="font-size:20px;font-weight:800;color:var(--teal);margin:8px 0">'+e.nombre+'</div><div style="color:var(--text3)">Cumple '+edad+' aÃ±os â€” '+bdStr+'</div><div style="margin-top:4px;font-size:12px">'+e.cargo+' â€” '+e.dpto+'</div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0"><div style="padding:16px;text-align:center;border-radius:var(--radius);background:var(--teal-bg);border:1px solid var(--border);cursor:pointer" onclick="clM();regBdayPermiso('+e.id+')"><div style="font-size:24px">ğŸ“</div><div style="font-size:12px;font-weight:700;margin-top:4px">DÃ­a de Permiso</div><div style="font-size:10px;color:var(--text3)">Registrar y generar formato</div></div><div style="padding:16px;text-align:center;border-radius:var(--radius);background:var(--yellow-bg,#fff8e1);border:1px solid var(--border);cursor:pointer" onclick="printBdayCard('+e.id+')"><div style="font-size:24px">ğŸ</div><div style="font-size:12px;font-weight:700;margin-top:4px">Tarjeta CumpleaÃ±os</div><div style="font-size:10px;color:var(--text3)">Generar tarjeta PDF</div></div></div><div style="display:flex;gap:6px;justify-content:center"><button class="btn btn-g" onclick="clM()">Cerrar</button></div>';
document.getElementById('modal').style.display='flex';}

function regBdayPermiso(id){const e=E.find(x=>x.id===id);if(!e)return;
const bd=e.nacimiento&&e.nacimiento!=='nan'?new Date().getFullYear()+e.nacimiento.slice(4):new Date().toISOString().slice(0,10);
const pl=PERMISOS_LEGALES.find(p=>p.id==='CUMPLE');
permisos.push({rut:e.rut,tipo:'CumpleaÃ±os del Trabajador',tipoId:'CUMPLE',fecha:bd,end:bd,dias:1,goce:'CON GOCE',legal:pl?pl.legal:'',art:'Beneficio Empresa',cat:'EMPRESA',obs:'Beneficio dÃ­a de cumpleaÃ±os',reg:new Date().toISOString().slice(0,10)});
aa('PERMISO',e.nombre+' â€” DÃ­a cumpleaÃ±os '+fd(bd));save();refreshAll();
setTimeout(()=>exportPermisoXlsx(permisos.length-1),400);toast('âœ… Permiso registrado');}

function onPermisoTipoChange(){
const sel=document.getElementById('pm-t');const id=sel.value;
const pl=PERMISOS_LEGALES.find(p=>p.id===id);if(!pl)return;
document.getElementById('pm-legal-info').innerHTML='<div style="font-weight:700;color:var(--teal);margin-bottom:4px">ğŸ“‹ '+pl.art+'</div><div>'+pl.legal+'</div>'+(pl.docs?'<div style="margin-top:4px;color:var(--red)">ğŸ“ Requiere: '+pl.docs+'</div>':'');
document.getElementById('pm-goce-display').textContent=pl.goce;
document.getElementById('pm-goce-display').style.color=pl.goce==='SIN GOCE'?'var(--red)':'var(--teal)';
const diasEl=document.getElementById('pm-dias-display');
if(pl.dias>0){diasEl.textContent=pl.dias;calcPermisoDates();}else{diasEl.textContent='â€”';}
document.getElementById('pm-doc-req').textContent=pl.docs||'No requiere';
const f2=document.getElementById('pm-f2');
if(pl.id==='SIN_GOCE'){f2.removeAttribute('readonly');f2.style.opacity='1';}else{f2.style.opacity='0.6';}}
function calcPermisoDates(){const sel=document.getElementById('pm-t');const id=sel.value;
const pl=PERMISOS_LEGALES.find(p=>p.id===id);if(!pl||pl.dias<=0)return;
const start=document.getElementById('pm-f').value;if(!start)return;
let d=new Date(start+'T12:00:00'),count=0,dias=pl.dias;
if(pl.tipo==='corridos'){d.setDate(d.getDate()+dias-1);}else{while(count<dias){if(count>0)d.setDate(d.getDate()+1);const dow=d.getDay();if(dow!==0&&dow!==6)count++;else if(count===0)count++;}}
document.getElementById('pm-f2').value=d.toISOString().slice(0,10);}
function calcPermisoDias(){const s=document.getElementById('pm-f').value,e=document.getElementById('pm-f2').value;
if(!s||!e)return;const dias=wdBetween(s,e);document.getElementById('pm-dias-display').textContent=dias;}
function savePermisoLegal(){const rut=document.getElementById('pm-e').value,tid=document.getElementById('pm-t').value;
const fecha=document.getElementById('pm-f').value,end=document.getElementById('pm-f2').value;
const obs=document.getElementById('pm-obs').value.trim();
if(!fecha){toast('Fecha obligatoria',1);return;}
const pl=PERMISOS_LEGALES.find(p=>p.id===tid);
const dias=pl&&pl.dias>0?pl.dias:(end?wdBetween(fecha,end):1);
permisos.push({rut,tipo:pl?pl.nombre:tid,tipoId:tid,fecha,end:end||fecha,dias,goce:pl?pl.goce:'CON GOCE',legal:pl?pl.legal:'',art:pl?pl.art:'',cat:pl?pl.cat:'',obs,reg:new Date().toISOString().slice(0,10)});
const e=E.find(x=>x.rut===rut);aa('PERMISO',(e?e.nombre:'?')+' â€” '+(pl?pl.nombre:tid)+' '+dias+'d');save();clM();refreshAll();toast('âœ… Permiso registrado');}
function savePermisoLegalXlsx(){const rut=document.getElementById('pm-e').value,tid=document.getElementById('pm-t').value;
const fecha=document.getElementById('pm-f').value,end=document.getElementById('pm-f2').value;
const obs=document.getElementById('pm-obs').value.trim();
if(!fecha){toast('Fecha obligatoria',1);return;}
const pl=PERMISOS_LEGALES.find(p=>p.id===tid);
const dias=pl&&pl.dias>0?pl.dias:(end?wdBetween(fecha,end):1);
permisos.push({rut,tipo:pl?pl.nombre:tid,tipoId:tid,fecha,end:end||fecha,dias,goce:pl?pl.goce:'CON GOCE',legal:pl?pl.legal:'',art:pl?pl.art:'',cat:pl?pl.cat:'',obs,reg:new Date().toISOString().slice(0,10)});
const e=E.find(x=>x.rut===rut);aa('PERMISO',(e?e.nombre:'?')+' â€” '+(pl?pl.nombre:tid)+' '+dias+'d');save();clM();refreshAll();
toast('âœ… Permiso registrado');setTimeout(()=>exportPermisoXlsx(permisos.length-1),400);}
function savePermiso(){savePermisoLegal();}
function savePermisoAndPrint(){savePermisoLegalXlsx();}
function exportPermisoXlsx(idx){
const p=permisos[idx];if(!p)return;const e=E.find(x=>x.rut===p.rut);if(!e)return;
function fDD(d){if(!d)return'';const pp=d.split('-');return pp[2]+'-'+pp[1]+'-'+pp[0];}
const endD=p.end||p.fecha;const retDate=new Date(endD+'T12:00:00');retDate.setDate(retDate.getDate()+1);
while(retDate.getDay()===0||retDate.getDay()===6)retDate.setDate(retDate.getDate()+1);
const retorno=fDD(retDate.toISOString().slice(0,10));
const dias=p.dias||1;const isSinGoce=(p.goce||'')=='SIN GOCE';
const titleText=isSinGoce?'PERMISO SIN GOCE':'PERMISO CON GOCE DE SUELDO';
const hdrText=isSinGoce?'PERMISO SIN GOCE':'PERMISO LEGAL CON GOCE';
const bgColor=isSinGoce?'#FFD700':'#87CEEB';
const nombrePermiso=p.tipo||'';const legalRef=p.legal||'';
let extraRows='';
if(!isSinGoce){extraRows='<tr><td class="lbl">NOMBRE PERMISO</td><td colspan="3" class="pname">'+nombrePermiso+'</td></tr>';}
if(legalRef){extraRows+='<tr><td class="lbl">BASE LEGAL:</td><td colspan="3" class="val" style="font-size:9pt;color:#444">'+legalRef+'</td></tr>';}
const html='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">'+
'<head><meta charset="UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Permiso</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->'+
'<style>td,th{font-family:Arial;font-size:12pt;vertical-align:middle;mso-number-format:"\\@"}.title{font-size:14pt;font-weight:bold;background:#FFFF00;border:2px solid #000;padding:6px 10px}.cod{font-size:14pt;font-weight:bold;border:2px solid #000;text-align:center}.lbl{font-weight:bold;border:1px solid #000;padding:4px 8px;width:180px}.val{border:1px solid #000;padding:4px 8px}.hdr{font-weight:bold;background:'+bgColor+';border:2px solid #000;padding:6px 10px}.dias-lbl{font-weight:bold;border:1px solid #000;padding:4px 8px}.dias-val{font-weight:bold;font-size:14pt;border:1px solid #000;text-align:center}.fecha-lbl{font-weight:bold;border:1px solid #000;text-align:center;padding:4px 8px}.fecha-val{border:1px solid #000;text-align:center;padding:4px 8px}.firma{text-align:center;font-size:10pt;padding-top:30px;border:none}.firma-label{text-align:center;font-weight:bold;font-size:10pt;border:none}.pname{font-size:11pt;font-weight:bold;border:2px solid #000;padding:6px 10px;background:#F0F0F0}</style></head><body>'+
'<table><col width="180"><col width="200"><col width="160"><col width="160">'+
'<tr><td colspan="3" class="title">'+titleText+'</td><td class="cod">'+(e.cod||'')+'</td></tr>'+
extraRows+
'<tr><td class="lbl">'+(isSinGoce?'NOMBRE:':'NOMBRE TRABAJADOR')+'</td><td colspan="3" class="val">'+e.nombre+'</td></tr>'+
'<tr><td class="lbl">'+(isSinGoce?'RUT:':'RUT TRABAJADOR:')+'</td><td colspan="3" class="val">'+e.rut+'</td></tr>'+
'<tr><td class="lbl">CARGO:</td><td colspan="3" class="val">'+(e.cargo||'')+'</td></tr>'+
'<tr><td class="lbl">SUCURSAL:</td><td colspan="3" class="val">'+(e.dpto||'DISTRIBUCION')+'</td></tr>'+
'<tr><td colspan="4" class="hdr">'+hdrText+'</td></tr>'+
'<tr><td class="dias-lbl">NÂ° DE DIAS'+(isSinGoce?' TOTAL PERMISO':'')+'</td><td colspan="3" class="dias-val">'+dias+'</td></tr>'+
'<tr><td class="fecha-lbl">'+(isSinGoce?'INICIO:':'INICIO PERMISO:')+'</td><td class="fecha-val">'+fDD(p.fecha)+'</td><td class="fecha-lbl">TERMINO:</td><td class="fecha-val">'+fDD(endD)+'</td></tr>'+
'<tr><td class="fecha-val"></td><td class="fecha-val"></td><td class="fecha-lbl">RETORNO:</td><td class="fecha-val">'+retorno+'</td></tr>'+
'<tr><td colspan="4" style="border:none;height:40px"></td></tr>'+
'<tr><td colspan="2" class="firma">_______________________</td><td colspan="2" class="firma">_______________________</td></tr>'+
'<tr><td colspan="2" class="firma-label">FIRMA COLABORADOR</td><td colspan="2" class="firma-label">FIRMA JEFATURA</td></tr>'+
'</table></body></html>';
const blob=new Blob(['\uFEFF'+html],{type:'application/vnd.ms-excel;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='Permiso_'+(isSinGoce?'SinGoce':'ConGoce')+'_'+(e.cod||e.rut)+'_'+p.fecha+'.xls';a.click();toast('ğŸ“¥ Excel generado');}
function exportVacXlsx(idx){
const v=vac[idx];if(!v)return;const e=E.find(x=>x.rut===v.rut);if(!e)return;
function fDD(d){if(!d)return'';const p=d.split('-');return p[2]+'-'+p[1]+'-'+p[0];}
const retDate=new Date(v.end+'T12:00:00');retDate.setDate(retDate.getDate()+1);
while(retDate.getDay()===0||retDate.getDay()===6)retDate.setDate(retDate.getDate()+1);
const retorno=fDD(retDate.toISOString().slice(0,10));
const html='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">'+
'<head><meta charset="UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Solicitud</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->'+
'<style>td,th{font-family:Arial;font-size:12pt;vertical-align:middle;mso-number-format:"\\@"}.title{font-size:14pt;font-weight:bold;background:#FFFF00;border:2px solid #000;padding:6px 10px}.cod{font-size:14pt;font-weight:bold;border:2px solid #000;text-align:center}.lbl{font-weight:bold;border:1px solid #000;padding:4px 8px;width:180px}.val{border:1px solid #000;padding:4px 8px}.hdr{font-weight:bold;background:#87CEEB;border:2px solid #000;padding:6px 10px}.dias-lbl{font-weight:bold;border:1px solid #000;padding:4px 8px}.dias-val{font-weight:bold;font-size:14pt;border:1px solid #000;text-align:center}.fecha-lbl{font-weight:bold;border:1px solid #000;text-align:center;padding:4px 8px}.fecha-val{border:1px solid #000;text-align:center;padding:4px 8px}.firma{text-align:center;font-size:10pt;padding-top:30px;border:none}.firma-label{text-align:center;font-weight:bold;font-size:10pt;border:none}</style></head><body>'+
'<table><col width="180"><col width="200"><col width="160"><col width="160">'+
'<tr><td colspan="3" class="title">SOLICITUD DE VACACIONES</td><td class="cod">'+(e.cod||'')+'</td></tr>'+
'<tr><td class="lbl">NOMBRE</td><td colspan="3" class="val">'+e.nombre+'</td></tr>'+
'<tr><td class="lbl">RUT:</td><td colspan="3" class="val">'+e.rut+'</td></tr>'+
'<tr><td class="lbl">CARGO:</td><td colspan="3" class="val">'+(e.cargo||'')+'</td></tr>'+
'<tr><td class="lbl">SUCURSAL:</td><td colspan="3" class="val">'+(e.dpto||'DISTRIBUCION')+'</td></tr>'+
'<tr><td colspan="4" class="hdr">SOLICITUD DE VACACIONES</td></tr>'+
'<tr><td class="dias-lbl">NÂ° DE DIAS HABILES</td><td colspan="3" class="dias-val">'+v.dias+'</td></tr>'+
'<tr><td class="fecha-lbl">INICIO:</td><td class="fecha-val">'+fDD(v.start)+'</td><td class="fecha-lbl">TERMINO:</td><td class="fecha-val">'+fDD(v.end)+'</td></tr>'+
'<tr><td class="fecha-val"></td><td class="fecha-val"></td><td class="fecha-lbl">RETORNO:</td><td class="fecha-val">'+retorno+'</td></tr>'+
'<tr><td colspan="4" style="border:none;height:40px"></td></tr>'+
'<tr><td colspan="2" class="firma">_______________________</td><td colspan="2" class="firma">_______________________</td></tr>'+
'<tr><td colspan="2" class="firma-label">FIRMA COLABORADOR</td><td colspan="2" class="firma-label">FIRMA JEFATURA</td></tr>'+
'</table></body></html>';
const blob=new Blob(['\uFEFF'+html],{type:'application/vnd.ms-excel;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='Solicitud_Vacaciones_'+(e.cod||e.rut)+'_'+v.start+'.xls';a.click();toast('ğŸ“¥ Solicitud Excel generada');}
function buildPermisosTab(emp){
const ep=permisos.filter(p=>p.rut===emp.rut).sort((a,b)=>(b.fecha||'').localeCompare(a.fecha||''));
const totalDias=ep.reduce((s,p)=>s+(p.dias||1),0);
const conGoce=ep.filter(p=>p.goce!=='SIN GOCE');const sinGoce=ep.filter(p=>p.goce==='SIN GOCE');
let h='<div style="background:var(--teal-bg);border:1px solid var(--teal);border-radius:10px;padding:14px;margin-bottom:12px">'+
'<div style="display:flex;justify-content:space-between;align-items:center">'+
'<div><div style="font-size:10px;color:var(--teal);font-weight:600">HISTORIAL DE PERMISOS</div>'+
'<div style="font-size:28px;font-weight:800;color:var(--teal-dark);font-family:var(--mono)">'+ep.length+'</div></div>'+
'<div style="text-align:right;font-size:11px;color:var(--text2)">'+
'<div>Con Goce: '+conGoce.length+' ('+conGoce.reduce((s,p)=>s+(p.dias||1),0)+'d)</div>'+
'<div>Sin Goce: '+sinGoce.length+' ('+sinGoce.reduce((s,p)=>s+(p.dias||1),0)+'d)</div>'+
'<div style="font-weight:700">Total dÃ­as: '+totalDias+'d</div></div></div></div>';
if(ep.length){h+=ep.map((p,i)=>{const origIdx=permisos.indexOf(p);
const goceColor=p.goce==='SIN GOCE'?'var(--red)':'var(--teal)';
const goceIcon=p.goce==='SIN GOCE'?'ğŸ”´':'ğŸŸ¢';
return'<div class="di" style="margin-bottom:6px;border-left:3px solid '+goceColor+'">'+
'<div style="flex:1"><div class="dn">'+goceIcon+' '+(p.tipo||p.tipoId||'Permiso')+'</div>'+
'<div class="dm">'+fd(p.fecha)+(p.end&&p.end!==p.fecha?' â†’ '+fd(p.end):'')+(p.dias?' â€” '+p.dias+'d':'')+
' â€” <span style="color:'+goceColor+';font-weight:600">'+(p.goce||'CON GOCE')+'</span></div>'+
(p.art?'<div class="dm" style="font-size:9px;color:var(--text3)">'+p.art+'</div>':'')+
(p.obs?'<div class="dm" style="font-style:italic">'+p.obs+'</div>':'')+
'</div><div style="display:flex;gap:4px;align-items:center">'+
'<button class="btn btn-d btn-sm" onclick="event.stopPropagation();exportPermisoXlsx('+origIdx+')" title="Descargar Excel">ğŸ“¥</button>'+
'<button class="btn btn-d btn-sm" onclick="event.stopPropagation();delPermiso('+origIdx+')">Ã—</button></div></div>';}).join('');}
else{h+='<div style="font-size:11px;color:var(--text3);padding:8px;text-align:center">Sin permisos registrados</div>';}
h+='<div style="margin-top:10px"><button class="btn btn-p btn-sm" onclick="clM();openPermisoForEmp(\''+emp.rut+'\')">+ Nuevo Permiso</button></div>';
return h;}
function openPermisoForEmp(rut){openPermisoGen();document.getElementById('pm-e').value=rut;}
function genPermisoFmt(e,tipo,fecha,obs){
const idx=permisos.length-1;if(idx>=0)exportPermisoXlsx(idx);else toast('Sin permiso para exportar',1);}

function printBdayCard(id){const e=E.find(x=>x.id===id);if(!e)return;
const edad=e.nacimiento&&e.nacimiento!=='nan'?new Date().getFullYear()-parseInt(e.nacimiento.slice(0,4)):'';
const w=window.open('','_blank','width=600,height=400');
w.document.write('<html><head><title>CumpleaÃ±os - '+e.nombre+'</title><style>body{font-family:Arial,sans-serif;margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#f5f5f5}@media print{body{background:white}}.card{width:500px;padding:40px;text-align:center;background:linear-gradient(135deg,#e0f2f1,#fff);border-radius:16px;border:3px solid #00897B;box-shadow:0 4px 20px rgba(0,0,0,0.1)}</style></head><body><div class="card"><div style="font-size:60px">ğŸ‚</div><div style="font-size:12px;color:#00897B;font-weight:700;margin:16px 0">FARMACIAS DEL DR. SIMI â€” CENTRO DE DISTRIBUCIÃ“N</div><div style="font-size:28px;font-weight:800;color:#333;margin:8px 0">Â¡Feliz CumpleaÃ±os!</div><div style="font-size:22px;font-weight:700;color:#00897B;margin:8px 0">'+e.nombre+'</div>'+(edad?'<div style="font-size:16px;color:#666;margin:4px 0">'+edad+' aÃ±os</div>':'')+'<div style="font-size:12px;color:#999;margin:8px 0">'+e.cargo+' â€” '+e.dpto+'</div><div style="margin-top:24px;padding:16px;background:rgba(0,137,123,0.08);border-radius:12px;font-size:14px;color:#555;line-height:1.6">Â¡Te deseamos un excelente dÃ­a!<br>Gracias por ser parte de nuestro equipo.</div><div style="margin-top:16px;font-size:10px;color:#999">'+fd(new Date().toISOString().slice(0,10))+'</div></div></body></html>');
w.document.close();w.print();}

function delPermiso(i){if(i<0||!confirm('Â¿Eliminar permiso?'))return;permisos.splice(i,1);save();refreshAll();toast('Eliminado');}

// ORGANIGRAMA
const ORG_DEFAULT=[
{id:1,cargo:'SUBGERENTE LOGISTICA',area:'ADM-TRANSPORTE',parentId:null,auth:1,order:0},
{id:2,cargo:'ASISTENTE',area:'ADM-TRANSPORTE',parentId:1,auth:1,order:0,tag:'RRHH'},
{id:3,cargo:'JEFE OPERACIONES',area:'ADM-TRANSPORTE',parentId:1,auth:1,order:1},
{id:4,cargo:'JEFE AREA',area:'ADM-TRANSPORTE',parentId:1,auth:1,order:2,tag:'TRANSPORTE'},
{id:5,cargo:'INGENIERO PROYECTOS',area:'ADM-TRANSPORTE',parentId:1,auth:1,order:3},
{id:6,cargo:'SUPERVISOR MANT',area:'CD MANTENCION',parentId:1,auth:1,order:4},
{id:7,cargo:'COORDINADOR',area:'ADM-TRANSPORTE',parentId:1,auth:1,order:5,tag:'COD'},
{id:8,cargo:'ANALISTA',area:'ADM-TRANSPORTE',parentId:3,auth:2,order:0,tag:'ABASTECIMIENTO'},
{id:9,cargo:'ANALISTA',area:'ADM-TRANSPORTE',parentId:3,auth:1,order:1,tag:'WMS'},
{id:10,cargo:'ASISTENTE',area:'ADM-TRANSPORTE',parentId:3,auth:1,order:2,tag:'WMS'},
{id:11,cargo:'JEFE AREA CD',area:'CD ISP',parentId:3,auth:1,order:3},
{id:12,cargo:'JEFE AREA CD',area:'CD SEREMI - INSUMOS',parentId:3,auth:1,order:4},
{id:13,cargo:'ASISTENTE',area:'ADM-TRANSPORTE',parentId:3,auth:3,order:5,tag:'INVENTARIO'},
{id:14,cargo:'ANALISTA',area:'ADM-TRANSPORTE',parentId:3,auth:1,order:6,tag:'INVENTARIO'},
{id:15,cargo:'ENCARGADO AREA',area:'CD ISP',parentId:11,auth:2,order:0,tag:'ALMACEN/PRE-EMB'},
{id:16,cargo:'OPERADOR APILADOR',area:'CD ISP',parentId:11,auth:6,order:1},
{id:17,cargo:'AUX BODEGA',area:'CD ISP',parentId:11,auth:12,order:2,tag:'ALMACEN'},
{id:18,cargo:'AUX BODEGA',area:'CD ISP',parentId:11,auth:25,order:3,tag:'PICKING'},
{id:19,cargo:'AUX BODEGA',area:'CD ISP',parentId:11,auth:20,order:4,tag:'ELASTICADO'},
{id:20,cargo:'AUX BODEGA',area:'CD ISP',parentId:11,auth:8,order:5,tag:'PRE-EMBARQUE'},
{id:21,cargo:'CONTROLADOR',area:'CD ISP',parentId:11,auth:3,order:6},
{id:22,cargo:'ENCARGADO AREA',area:'CD SEREMI - INSUMOS',parentId:12,auth:1,order:0,tag:'PICKING'},
{id:23,cargo:'COORDINADOR LOGISTICA',area:'CD SEREMI - INSUMOS',parentId:12,auth:1,order:1,tag:'INSUMOS'},
{id:24,cargo:'OPERADOR APILADOR',area:'CD SEREMI - INSUMOS',parentId:12,auth:2,order:2},
{id:25,cargo:'AUX BODEGA',area:'CD SEREMI - INSUMOS',parentId:12,auth:10,order:3,tag:'PICKING'},
{id:26,cargo:'AUX BODEGA',area:'CD SEREMI - INSUMOS',parentId:12,auth:5,order:4,tag:'ELASTICADO'},
{id:27,cargo:'AUX BODEGA',area:'CD SEREMI - INSUMOS',parentId:12,auth:4,order:5,tag:'PRE-EMBARQUE'},
{id:28,cargo:'AUX BODEGA INSUMOS',area:'CD SEREMI - INSUMOS',parentId:23,auth:5,order:0},
{id:29,cargo:'CONTROLADOR',area:'CD SEREMI - INSUMOS',parentId:12,auth:1,order:6},
{id:30,cargo:'AUXILIAR MANT',area:'CD MANTENCION',parentId:6,auth:2,order:0},
{id:31,cargo:'COORDINADOR DIST',area:'ADM-TRANSPORTE',parentId:4,auth:1,order:0},
{id:32,cargo:'ASISTENTE',area:'ADM-TRANSPORTE',parentId:4,auth:5,order:1,tag:'TRANSPORTE'},
{id:33,cargo:'CHOFER',area:'ADM-TRANSPORTE',parentId:4,auth:10,order:2},
{id:34,cargo:'PEONETA',area:'ADM-TRANSPORTE',parentId:4,auth:18,order:3},
{id:35,cargo:'AUX BODEGA',area:'ADM-TRANSPORTE',parentId:4,auth:4,order:4,tag:'UULL'},
{id:36,cargo:'ENCARGADO AREA',area:'ADM-XD',parentId:4,auth:1,order:5,tag:'XD'},
{id:37,cargo:'CHOFER',area:'ADM-XD',parentId:36,auth:3,order:0,tag:'XD'},
{id:38,cargo:'PEONETA',area:'ADM-XD',parentId:36,auth:6,order:1,tag:'XD'},
{id:39,cargo:'AUX BODEGA',area:'ADM-XD',parentId:36,auth:1,order:2,tag:'XD'},
{id:40,cargo:'GUARDIA',area:'ADM-XD',parentId:36,auth:1,order:3,tag:'XD'}
];
function initOrgChart(){if(!orgChart||!orgChart.length){orgChart=JSON.parse(JSON.stringify(ORG_DEFAULT));save();}}
function orgNextId(){return orgChart.length?Math.max(...orgChart.map(function(n){return n.id}))+1:1;}
function orgCountActual(node){
var count=0;
E.forEach(function(e){if(e.status==='ACTIVO'&&node.cargo&&(e.cargo||'').toUpperCase().indexOf(node.cargo.toUpperCase())>=0&&e.dpto===node.area)count++;});
return count;
}
function orgCountActualNode(node){
var count=0;
E.forEach(function(e){
if(e.status!=='ACTIVO')return;
var eCargo=(e.cargo||'').toUpperCase();
var nCargo=node.cargo.toUpperCase();
if(eCargo===nCargo&&e.dpto===node.area)count++;
});
return count;
}
function buildOrgTree(nodes,parentId){
var children=nodes.filter(function(n){return n.parentId===parentId;}).sort(function(a,b){return (a.order||0)-(b.order||0);});
return children.map(function(n){
var copy={id:n.id,cargo:n.cargo,area:n.area,parentId:n.parentId,auth:n.auth||0,order:n.order||0,tag:n.tag};
copy.actual=orgCountActualNode(n);
copy.children=buildOrgTree(nodes,n.id);
return copy;
});
}
function rOrg(){
if(!orgChart||!orgChart.length)initOrgChart();
var tree=buildOrgTree(orgChart,null);
var totAuth=0,totActual=0,totCargos=orgChart.length;
orgChart.forEach(function(n){totAuth+=(n.auth||0);totActual+=orgCountActualNode(n);});
var faltantes=Math.max(0,totAuth-totActual);
var sobrantes=Math.max(0,totActual-totAuth);
var viewEl=document.getElementById('org-view');
var compact=viewEl?viewEl.value==='compact':false;
document.getElementById('org-kpi').innerHTML=
'<div class="kc"><div class="kl">DotaciÃ³n Autorizada</div><div class="kv">'+totAuth+'</div></div>'+
'<div class="kc"><div class="kl">DotaciÃ³n Actual</div><div class="kv" style="color:var(--teal)">'+totActual+'</div></div>'+
'<div class="kc"><div class="kl">Faltantes</div><div class="kv" style="color:var(--red)">'+faltantes+'</div></div>'+
'<div class="kc"><div class="kl">Sobrantes</div><div class="kv" style="color:var(--yellow)">'+sobrantes+'</div></div>'+
'<div class="kc"><div class="kl">Total Cargos</div><div class="kv">'+totCargos+'</div></div>';
document.getElementById('org-info').textContent='DotaciÃ³n: '+totActual+'/'+totAuth+' â€” '+(totAuth>0?((totActual/totAuth)*100).toFixed(0):'0')+'% cobertura';
function renderNode(n,isRoot){
var auth=n.auth||0;var actual=n.actual||0;
var diff=actual-auth;
var cls=auth===0?'':(actual<auth?'deficit':(actual>auth?'surplus':'ok'));
var dotCls=actual<auth?'red':(actual>auth?'yellow':'green');
var tag=n.tag?'<div class="org-area">'+n.tag+'</div>':'';
var areaTag='<div class="org-area">'+n.area+'</div>';
var h='<div class="org-node'+(isRoot?' org-root':'')+'">'+
'<div class="org-box '+cls+'" draggable="true" data-oid="'+n.id+'" ondragstart="orgDragStart(event)" ondragover="orgDragOver(event)" ondragleave="orgDragLeave(event)" ondrop="orgDrop(event)" onclick="openOrgEdit('+n.id+')">'+
'<div class="org-actions">'+
'<div class="org-abtn" onclick="event.stopPropagation();openOrgAddChild('+n.id+')" title="Agregar subordinado">+</div>'+
'<div class="org-abtn" onclick="event.stopPropagation();delOrgNode('+n.id+')" title="Eliminar">\u00d7</div></div>'+
'<div class="org-cargo">'+n.cargo+'</div>'+
tag+areaTag+
'<div class="org-dot '+dotCls+'">'+actual+'/'+auth+(diff!==0?' <span style="font-size:9px">('+(diff>0?'+':'')+diff+')</span>':'')+'</div>'+
'</div>';
if(n.children&&n.children.length){
h+='<div class="org-children'+(compact?' compact':'')+'">';
n.children.forEach(function(c){h+=renderNode(c,false);});
h+='</div>';
}
h+='</div>';
return h;
}
var treeHtml='';
tree.forEach(function(t){treeHtml+=renderNode(t,true);});
document.getElementById('org-tree').innerHTML=treeHtml||'<div style="padding:40px;text-align:center;color:var(--text3)">Sin datos de organigrama. Haz click en "Reset" para cargar estructura por defecto.</div>';
}
var orgDragId=null;
function orgDragStart(ev){orgDragId=parseInt(ev.target.dataset.oid);ev.dataTransfer.effectAllowed='move';}
function orgDragOver(ev){ev.preventDefault();ev.currentTarget.classList.add('over');}
function orgDragLeave(ev){ev.currentTarget.classList.remove('over');}
function orgDrop(ev){ev.preventDefault();ev.currentTarget.classList.remove('over');
var targetId=parseInt(ev.currentTarget.dataset.oid);
if(!orgDragId||orgDragId===targetId)return;
function isDesc(pid,tid){if(pid===tid)return true;var ch=orgChart.filter(function(n){return n.parentId===pid;});return ch.some(function(c){return isDesc(c.id,tid);});}
if(isDesc(orgDragId,targetId)){toast('No puedes mover a un subordinado propio',1);return;}
var node=orgChart.find(function(n){return n.id===orgDragId;});
if(node){node.parentId=targetId;node.order=orgChart.filter(function(n){return n.parentId===targetId;}).length;
aa('ORGANIGRAMA','Movido: '+node.cargo+' bajo #'+targetId);save();rOrg();toast('\u2705 Cargo movido');}
orgDragId=null;}
function openOrgEdit(id){var n=orgChart.find(function(x){return x.id===id;});if(!n)return;
var actual=orgCountActualNode(n);
var emps=E.filter(function(e){return e.status==='ACTIVO'&&(e.cargo||'').toUpperCase()===n.cargo.toUpperCase()&&e.dpto===n.area;});
var empList=emps.length?emps.map(function(e){return '<div class="di" style="margin:2px 0;cursor:pointer" onclick="clM();openEmp('+e.id+')"><span style="font-size:12px">\ud83d\udc64</span><div style="flex:1"><div class="dn">'+e.nombre+'</div><div class="dm">'+e.cargo+' \u2014 '+e.dpto+'</div></div></div>';}).join(''):'<div style="font-size:10px;color:var(--text3);padding:4px">Sin colaboradores asignados</div>';
var parents=orgChart.filter(function(x){return x.id!==id;}).map(function(x){return '<option value="'+x.id+'"'+(x.id===n.parentId?' selected':'')+'>'+x.cargo+(x.tag?' ('+x.tag+')':'')+'</option>';}).join('');
var bgColor=actual<(n.auth||0)?'#fff5f5':(actual>(n.auth||0)?'#fffde7':'var(--teal-bg)');
var dotColor=actual<(n.auth||0)?'var(--red)':'var(--teal)';
var statusHtml=actual<(n.auth||0)?'<span style="color:var(--red);font-weight:700">Faltan '+((n.auth||0)-actual)+'</span>':(actual>(n.auth||0)?'<span style="color:#e6a700;font-weight:700">Sobran '+(actual-(n.auth||0))+'</span>':'<span style="color:var(--teal);font-weight:700">\u2705 En dotaci\u00f3n</span>');
document.getElementById('mt').textContent='\u270f\ufe0f Editar Cargo \u2014 '+n.cargo;
document.getElementById('mbd').innerHTML=
'<div class="fg2">'+
'<div class="fg full"><div class="fl">Cargo *</div><input class="fi" id="oe-cargo" value="'+n.cargo+'"></div>'+
'<div class="fg"><div class="fl">\u00c1rea / Departamento</div><select class="fi" id="oe-area">'+
['ADM-TRANSPORTE','ADM-XD','CD ISP','CD MANTENCION','CD SEREMI - INSUMOS','LICENCIA'].map(function(a){return '<option'+(a===n.area?' selected':'')+'>'+a+'</option>';}).join('')+
'</select></div>'+
'<div class="fg"><div class="fl">Etiqueta (tag)</div><input class="fi" id="oe-tag" value="'+(n.tag||'')+'" placeholder="ej: PICKING, ALMACEN..."></div>'+
'<div class="fg"><div class="fl">Dotaci\u00f3n Autorizada</div><input type="number" class="fi" id="oe-auth" value="'+(n.auth||0)+'" min="0"></div>'+
'<div class="fg"><div class="fl">Reporta a</div><select class="fi" id="oe-parent"><option value="">(Nivel superior)</option>'+parents+'</select></div>'+
'<div class="fg"><div class="fl">Orden</div><input type="number" class="fi" id="oe-order" value="'+(n.order||0)+'" min="0"></div>'+
'</div>'+
'<div style="margin:12px 0;padding:10px;background:'+bgColor+';border-radius:8px;border:1px solid var(--border)">'+
'<div style="display:flex;justify-content:space-between;align-items:center">'+
'<div><div style="font-size:10px;font-weight:600;color:var(--text3)">DOTACI\u00d3N</div>'+
'<div style="font-size:24px;font-weight:800;font-family:var(--mono);color:'+dotColor+'">'+actual+'/'+(n.auth||0)+'</div></div>'+
'<div style="text-align:right;font-size:11px">'+statusHtml+
'</div></div></div>'+
'<div style="margin-top:8px"><div class="fl">Colaboradores ('+emps.length+')</div>'+empList+'</div>'+
'<div style="margin-top:12px;display:flex;gap:6px">'+
'<button class="btn btn-p" onclick="saveOrgEdit('+id+')">\ud83d\udcbe Guardar</button>'+
'<button class="btn btn-d" onclick="delOrgNode('+id+');clM()">\ud83d\uddd1\ufe0f Eliminar</button>'+
'<button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('modal').style.display='flex';}
function saveOrgEdit(id){var n=orgChart.find(function(x){return x.id===id;});if(!n)return;
n.cargo=document.getElementById('oe-cargo').value.trim();
n.area=document.getElementById('oe-area').value;
n.tag=document.getElementById('oe-tag').value.trim()||undefined;
n.auth=parseInt(document.getElementById('oe-auth').value)||0;
var np=document.getElementById('oe-parent').value;
n.parentId=np?parseInt(np):null;
n.order=parseInt(document.getElementById('oe-order').value)||0;
aa('ORGANIGRAMA','Editado: '+n.cargo);save();clM();rOrg();toast('\u2705 Cargo actualizado');}
function openOrgAdd(){
var parents=orgChart.map(function(x){return '<option value="'+x.id+'">'+x.cargo+(x.tag?' ('+x.tag+')':'')+'</option>';}).join('');
document.getElementById('mt').textContent='\u2795 Agregar Cargo';
document.getElementById('mbd').innerHTML=
'<div class="fg2">'+
'<div class="fg full"><div class="fl">Cargo *</div><input class="fi" id="oa-cargo" placeholder="Nombre del cargo"></div>'+
'<div class="fg"><div class="fl">\u00c1rea</div><select class="fi" id="oa-area">'+
['ADM-TRANSPORTE','ADM-XD','CD ISP','CD MANTENCION','CD SEREMI - INSUMOS','LICENCIA'].map(function(a){return '<option>'+a+'</option>';}).join('')+
'</select></div>'+
'<div class="fg"><div class="fl">Tag</div><input class="fi" id="oa-tag" placeholder="ej: PICKING"></div>'+
'<div class="fg"><div class="fl">Dotaci\u00f3n Autorizada</div><input type="number" class="fi" id="oa-auth" value="1" min="0"></div>'+
'<div class="fg"><div class="fl">Reporta a</div><select class="fi" id="oa-parent"><option value="">(Sin jefe)</option>'+parents+'</select></div>'+
'</div>'+
'<div style="margin-top:12px;display:flex;gap:6px">'+
'<button class="btn btn-p" onclick="saveOrgAdd()">\ud83d\udcbe Agregar</button>'+
'<button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('modal').style.display='flex';}
function openOrgAddChild(parentId){openOrgAdd();document.getElementById('oa-parent').value=parentId;}
function saveOrgAdd(){var cargo=document.getElementById('oa-cargo').value.trim();
if(!cargo){toast('Ingresa nombre del cargo',1);return;}
var area=document.getElementById('oa-area').value;
var tag=document.getElementById('oa-tag').value.trim()||undefined;
var auth=parseInt(document.getElementById('oa-auth').value)||0;
var p=document.getElementById('oa-parent').value;
var parentId=p?parseInt(p):null;
orgChart.push({id:orgNextId(),cargo:cargo,area:area,parentId:parentId,auth:auth,order:orgChart.filter(function(n){return n.parentId===parentId;}).length,tag:tag});
aa('ORGANIGRAMA','Agregado: '+cargo);save();clM();rOrg();toast('\u2705 Cargo agregado');}
function delOrgNode(id){var n=orgChart.find(function(x){return x.id===id;});if(!n)return;
if(!confirm('\u00bfEliminar "'+n.cargo+'"? Sus subordinados subir\u00e1n un nivel.'))return;
orgChart.filter(function(x){return x.parentId===id;}).forEach(function(x){x.parentId=n.parentId;});
orgChart=orgChart.filter(function(x){return x.id!==id;});
aa('ORGANIGRAMA','Eliminado: '+n.cargo);save();rOrg();toast('\u2705 Cargo eliminado');}
function resetOrgChart(){if(!confirm('\u00bfResetear el organigrama a la estructura por defecto? Se perder\u00e1n los cambios.'))return;
orgChart=JSON.parse(JSON.stringify(ORG_DEFAULT));save();rOrg();toast('\u2705 Organigrama reseteado');}
function exportOrgImg(){
var el=document.getElementById('org-tree');
toast('\ud83d\udccb Usa Ctrl+P para imprimir o captura de pantalla');
var w=window.open('','_blank','width=1400,height=900');
var css='body{font-family:Arial,sans-serif;padding:20px;background:white}'+
'.org-node{display:flex;flex-direction:column;align-items:center;position:relative;padding-top:18px}'+
'.org-node::before{content:"";position:absolute;top:0;border-left:2px solid #00897B;height:18px}'+
'.org-children{display:flex;gap:0;justify-content:center;position:relative;padding-top:18px}'+
'.org-children::before{content:"";position:absolute;top:0;left:50%;transform:translateX(-50%);border-top:2px solid #00897B;width:calc(100% - 50px)}'+
'.org-box{border:2px solid #00897B;border-radius:8px;padding:6px 10px;min-width:100px;max-width:140px;text-align:center;font-size:9px;background:white}'+
'.org-box.deficit{border-color:#e53935;background:#fff5f5}'+
'.org-box.surplus{border-color:#e6a700;background:#fffde7}'+
'.org-box.ok{border-color:#00897B;background:#f0faf8}'+
'.org-cargo{font-weight:800;font-size:9px;color:#00695C;text-transform:uppercase;margin-bottom:2px}'+
'.org-area{font-size:7px;color:#999;margin-bottom:2px}'+
'.org-dot{font-family:monospace;font-size:11px;font-weight:800}'+
'.org-dot.red{color:#e53935}.org-dot.green{color:#00897B}.org-dot.yellow{color:#e6a700}'+
'.org-root>.org-box{border-width:3px;background:#e0f2f1}'+
'.org-actions{display:none}'+
'h1{color:#00897B;text-align:center;margin-bottom:20px}'+
'@media print{body{padding:5px}h1{font-size:16px}}';
w.document.write('<html><head><title>Organigrama Log\u00edstica \u2014 Dr. Simi</title><style>'+css+'<\/style></head><body>');
w.document.write('<h1>ORGANIGRAMA LOG\u00cdSTICA 2025 \u2014 Dr. Simi CD</h1>');
w.document.write('<div style="display:flex;justify-content:center;overflow:auto">'+el.innerHTML+'</div>');
w.document.write('<\/body><\/html>');
w.document.close();
setTimeout(function(){w.print();},500);
}

// AUDITORIA
function rAud(){
const usrSel=document.getElementById('aud-usr'),actSel=document.getElementById('aud-act');
const usrV=usrSel.value,actV=actSel.value,perV=document.getElementById('aud-per').value,qV=(document.getElementById('aud-q').value||'').toLowerCase();
const users=[...new Set(audit.map(a=>a.user))].sort();
usrSel.innerHTML='<option value="">Todos los usuarios</option>'+users.map(u=>'<option'+(u===usrV?' selected':'')+'>'+u+'</option>').join('');
const actions=[...new Set(audit.map(a=>a.action))].sort();
actSel.innerHTML='<option value="">Todas las acciones</option>'+actions.map(a=>'<option'+(a===actV?' selected':'')+'>'+a+'</option>').join('');
let fa=audit;
if(usrV)fa=fa.filter(a=>a.user===usrV);
if(actV)fa=fa.filter(a=>a.action===actV);
if(qV)fa=fa.filter(a=>(a.detail+' '+a.action+' '+a.user).toLowerCase().includes(qV));
if(perV){const now=new Date(),cutoff=new Date();
if(perV==='hoy')cutoff.setHours(0,0,0,0);
else if(perV==='7d')cutoff.setDate(now.getDate()-7);
else if(perV==='30d')cutoff.setDate(now.getDate()-30);
else if(perV==='90d')cutoff.setDate(now.getDate()-90);
fa=fa.filter(a=>new Date(a.time)>=cutoff);}
const logins=fa.filter(a=>a.action==='LOGIN').length;
const edits=fa.filter(a=>['EDIT','ALTA','BAJA','CAMBIO','LICENCIA','REINTEGRO'].includes(a.action)).length;
const docUps=fa.filter(a=>a.action.startsWith('DOC_')).length;
document.getElementById('auk').innerHTML='<div class="kc"><div class="kl">Registros</div><div class="kv">'+fa.length+'</div></div><div class="kc"><div class="kl">Logins</div><div class="kv" style="color:var(--blue)">'+logins+'</div></div><div class="kc"><div class="kl">Ediciones</div><div class="kv" style="color:var(--teal)">'+edits+'</div></div><div class="kc"><div class="kl">Docs Subidos</div><div class="kv" style="color:var(--yellow)">'+docUps+'</div></div>';
document.getElementById('aud-count').textContent=fa.length+' de '+audit.length+' registros';
const acColors={'LOGIN':'var(--blue)','BAJA':'var(--red)','ALTA':'var(--teal)','EDIT':'var(--teal)','LICENCIA':'var(--yellow)','REINTEGRO':'var(--green)','CAMBIO':'var(--purple)','DOC_CAMBIO':'var(--yellow)','DOC_BAJA':'var(--yellow)','PERMISO':'var(--purple)','BAJA_UPD':'var(--red)','VAC_DEL':'var(--red)','VACACIONES':'var(--green)'};
document.getElementById('al').innerHTML=fa.length?fa.map(a=>{const dt=new Date(a.time);const col=acColors[a.action]||'var(--blue)';return'<div class="aud"><div class="dot" style="background:'+col+'"></div><div style="flex:1"><div style="display:flex;justify-content:space-between;align-items:center"><span style="font-weight:700;color:var(--teal-dark)">'+a.user+'</span><span style="font-size:9px;color:var(--text3);font-family:var(--mono)">'+dt.toLocaleDateString('es-CL')+' '+dt.toLocaleTimeString('es-CL')+'</span></div><div><span class="badge" style="background:'+col+'15;color:'+col+';font-size:9px;padding:1px 6px;margin-right:4px">'+a.action+'</span><span style="color:var(--text2)">'+a.detail+'</span></div></div></div>';}).join(''):'<div style="color:var(--text3);padding:8px">Sin registros</div>';}
function clAud(){if(!confirm('\u00bfLimpiar todo el historial?'))return;audit=[];save();rAud();toast('Limpiado');}
function exportAudXls(){
const usrV=document.getElementById('aud-usr').value,actV=document.getElementById('aud-act').value,perV=document.getElementById('aud-per').value,qV=(document.getElementById('aud-q').value||'').toLowerCase();
let fa=audit;
if(usrV)fa=fa.filter(a=>a.user===usrV);
if(actV)fa=fa.filter(a=>a.action===actV);
if(qV)fa=fa.filter(a=>(a.detail+' '+a.action+' '+a.user).toLowerCase().includes(qV));
if(perV){const now=new Date(),cutoff=new Date();
if(perV==='hoy')cutoff.setHours(0,0,0,0);
else if(perV==='7d')cutoff.setDate(now.getDate()-7);
else if(perV==='30d')cutoff.setDate(now.getDate()-30);
else if(perV==='90d')cutoff.setDate(now.getDate()-90);
fa=fa.filter(a=>new Date(a.time)>=cutoff);}
if(!fa.length){toast('Sin datos',1);return;}
let xml='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"><Styles><Style ss:ID="hd"><Font ss:Bold="1" ss:Size="11" ss:Color="#FFFFFF"/><Interior ss:Color="#00897B" ss:Pattern="Solid"/><Alignment ss:Horizontal="Center"/></Style><Style ss:ID="dt"><NumberFormat ss:Format="yyyy-mm-dd hh:mm:ss"/></Style><Style ss:ID="login"><Interior ss:Color="#E3F2FD" ss:Pattern="Solid"/></Style></Styles>';
xml+='<Worksheet ss:Name="Auditoria"><Table><Column ss:Width="160"/><Column ss:Width="120"/><Column ss:Width="100"/><Column ss:Width="400"/>';
xml+='<Row ss:StyleID="hd"><Cell><Data ss:Type="String">FECHA Y HORA</Data></Cell><Cell><Data ss:Type="String">USUARIO</Data></Cell><Cell><Data ss:Type="String">ACCION</Data></Cell><Cell><Data ss:Type="String">DETALLE</Data></Cell></Row>';
fa.forEach(a=>{const dt=new Date(a.time);const isL=a.action==='LOGIN';
xml+='<Row'+(isL?' ss:StyleID="login"':'')+'><Cell ss:StyleID="dt"><Data ss:Type="DateTime">'+dt.toISOString().replace('Z','')+'</Data></Cell><Cell><Data ss:Type="String">'+a.user+'</Data></Cell><Cell><Data ss:Type="String">'+a.action+'</Data></Cell><Cell><Data ss:Type="String">'+(a.detail||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')+'</Data></Cell></Row>';});
xml+='</Table></Worksheet>';
xml+='<Worksheet ss:Name="Resumen Logins"><Table><Column ss:Width="160"/><Column ss:Width="120"/><Column ss:Width="100"/>';
xml+='<Row ss:StyleID="hd"><Cell><Data ss:Type="String">FECHA Y HORA</Data></Cell><Cell><Data ss:Type="String">USUARIO</Data></Cell><Cell><Data ss:Type="String">TIPO</Data></Cell></Row>';
fa.filter(a=>a.action==='LOGIN').forEach(a=>{const dt=new Date(a.time);
xml+='<Row><Cell ss:StyleID="dt"><Data ss:Type="DateTime">'+dt.toISOString().replace('Z','')+'</Data></Cell><Cell><Data ss:Type="String">'+a.user+'</Data></Cell><Cell><Data ss:Type="String">LOGIN</Data></Cell></Row>';});
xml+='</Table></Worksheet>';
xml+='<Worksheet ss:Name="Actividad por Usuario"><Table><Column ss:Width="160"/><Column ss:Width="80"/><Column ss:Width="80"/><Column ss:Width="80"/><Column ss:Width="160"/>';
xml+='<Row ss:StyleID="hd"><Cell><Data ss:Type="String">USUARIO</Data></Cell><Cell><Data ss:Type="String">LOGINS</Data></Cell><Cell><Data ss:Type="String">EDICIONES</Data></Cell><Cell><Data ss:Type="String">TOTAL</Data></Cell><Cell><Data ss:Type="String">ULTIMO ACCESO</Data></Cell></Row>';
const byUser={};fa.forEach(a=>{if(!byUser[a.user])byUser[a.user]={logins:0,edits:0,total:0,last:''};byUser[a.user].total++;if(a.action==='LOGIN'){byUser[a.user].logins++;if(a.time>byUser[a.user].last)byUser[a.user].last=a.time;}else byUser[a.user].edits++;});
Object.entries(byUser).sort((a,b)=>b[1].total-a[1].total).forEach(([u,d])=>{
xml+='<Row><Cell><Data ss:Type="String">'+u+'</Data></Cell><Cell><Data ss:Type="Number">'+d.logins+'</Data></Cell><Cell><Data ss:Type="Number">'+d.edits+'</Data></Cell><Cell><Data ss:Type="Number">'+d.total+'</Data></Cell><Cell'+(d.last?' ss:StyleID="dt"':'')+'><Data ss:Type="'+(d.last?'DateTime':'String')+'">'+(d.last?new Date(d.last).toISOString().replace('Z',''):'â€”')+'</Data></Cell></Row>';});
xml+='</Table></Worksheet></Workbook>';
const blob=new Blob([xml],{type:'application/vnd.ms-excel'});const url=URL.createObjectURL(blob);const a2=document.createElement('a');a2.href=url;a2.download='Auditoria_SIMI_'+new Date().toISOString().slice(0,10)+'.xls';a2.click();URL.revokeObjectURL(url);toast('\u2705 Excel descargado');}

// ALERTS
function rAlerts(){const al=[],v=vis(),ac=v.filter(e=>e.status==='ACTIVO');
// Licencias â€” solo empleados activos con status LICENCIA
Object.entries(lics).forEach(([rut,l])=>{const e=v.find(x=>x.rut===rut&&x.status==='LICENCIA');if(!e)return;if(l.end){const d=ddF(l.end);if(d<0)al.unshift({t:'critical',i:'ğŸ”´',x:'<strong>'+e.nombre+'</strong> â€” Lic. VENCIDA '+Math.abs(d)+'d â€” Retorno inmediato '+fd(l.end),a:'REINTEGRAR'});else if(d===0)al.unshift({t:'critical',i:'ğŸ”´',x:'<strong>'+e.nombre+'</strong> â€” Lic. VENCE HOY â€” Retorno maÃ±ana',a:'HOY'});else if(d<=3)al.unshift({t:'critical',i:'âš ï¸',x:'<strong>'+e.nombre+'</strong> â€” Lic. vence en '+d+'d â€” Retorno '+fd(l.end),a:'PRONTO'});else if(d<=7)al.push({t:'',i:'âš ï¸',x:'<strong>'+e.nombre+'</strong> â€” Lic. vence en '+d+'d â€” Retorno '+fd(l.end),a:'PrÃ³ximo'});}else al.push({t:'',i:'ğŸŸ¡',x:'<strong>'+e.nombre+'</strong> â€” Lic. sin fecha tÃ©rmino',a:'Registrar'});});
// Vacaciones pendientes â€” solo activos
vac.filter(v2=>v2.status==='PENDIENTE').forEach(v2=>{const e=ac.find(x=>x.rut===v2.rut);if(!e)return;al.push({t:'info',i:'ğŸ–ï¸',x:'<strong>'+e.nombre+'</strong> â€” Vac. pendientes ('+v2.dias+'d)',a:'Aprobar'});});
// Plazo fijo â€” solo activos
ac.filter(e=>e.tipoContrato==='PLAZO FIJO').forEach(e=>{al.push({t:'info',i:'ğŸ“‹',x:'<strong>'+e.nombre+'</strong> â€” Plazo fijo',a:fd(e.ingreso)});});
// Cambios sin docs â€” solo si el empleado sigue activo
CH.forEach(c=>{const emp=ac.find(x=>x.rut===c.rut);if(!emp)return;const ds=chDocStatus(c);if(!ds.complete){const missing=[];if(!ds.anexo)missing.push('Anexo');if(!ds.cap)missing.push('CapacitaciÃ³n');al.push({t:'',i:'ğŸ“',x:'<strong>'+c.nombre+'</strong> â€” Cambio '+fd(c.desde)+': falta '+missing.join(', '),a:'Docs pend.'});}});
// Descriptivo de cargo pendiente â€” solo activos
ac.forEach(e=>{if(!e.puesto||e.puesto==='â€”'||e.puesto===e.cargo)al.push({t:'',i:'ğŸ“',x:'<strong>'+e.nombre+'</strong> â€” Sin descriptivo de puesto asignado ('+e.cargo+')',a:'Asignar puesto'});});
// DotaciÃ³n alerts - role aware
{const ac2=vis().filter(e=>e.status==='ACTIVO');const visDptos=U&&U.filter?U.filter:null;
const byDCP={};ac2.forEach(e=>{const k=e.dpto+'|'+e.cargo+'|'+e.puesto;byDCP[k]=(byDCP[k]||0)+1;});
Object.entries(authDC).forEach(([k,v])=>{if(v>0&&!byDCP[k]){const d=k.split('|')[0];if(visDptos&&!visDptos.includes(d))return;byDCP[k]=0;}});
Object.entries(byDCP).forEach(([k,a2])=>{const aut=authDC[k]||0;const p=k.split('|');if(aut&&a2!==aut)al.unshift({t:'critical',i:'ğŸ”´',x:'<strong>'+p[2]+'</strong> ('+p[1]+', '+p[0]+'): '+(a2>aut?(a2-aut)+' sobre':(aut-a2)+' bajo')+' ('+a2+'/'+aut+')',a:'DotaciÃ³n'});});}
const h=al.map(a=>'<div class="ai '+a.t+'">'+a.i+' <span style="flex:1">'+a.x+'</span><span class="at">'+a.a+'</span></div>').join('');
document.getElementById('af').innerHTML=h||'<p style="color:var(--text3);padding:16px">âœ… Sin alertas</p>';
document.getElementById('da').innerHTML=al.length?'<div class="cc" style="border-left:3px solid var(--teal)"><h3>ğŸ”” Alertas ('+al.length+')</h3>'+al.slice(0,5).map(a=>'<div class="ai '+a.t+'">'+a.i+' <span style="flex:1">'+a.x+'</span></div>').join('')+(al.length>5?'<div style="text-align:center;margin-top:6px"><button class="btn btn-g btn-sm" onclick="nav(\'alertas\')">Ver todas</button></div>':'')+'</div>':'';
document.getElementById('ac2').textContent=al.length;}

// CONFIG
function changePw(){if(!U)return;const c=document.getElementById('pw-c').value,n=document.getElementById('pw-n').value,r=document.getElementById('pw-r').value;if(!c||!n){toast('Completa campos',1);return;}if(USERS[U.uid].pass!==c){toast('ContraseÃ±a incorrecta',1);return;}if(n!==r){toast('No coinciden',1);return;}if(n.length<4){toast('MÃ­n 4 caracteres',1);return;}USERS[U.uid].pass=n;aa('PASSWORD',U.name+' cambiÃ³ pw');save();document.getElementById('pw-c').value='';document.getElementById('pw-n').value='';document.getElementById('pw-r').value='';toast('âœ… ContraseÃ±a');}
function rVal(){
if(!U||!VAL_USERS.includes(U.uid))return;
const areaF=document.getElementById('val-area')?.value||'';
const escF=document.getElementById('val-esc')?.value||'actual';
const areas=[...new Set(E.filter(e=>e.status==='ACTIVO'||e.status==='LICENCIA').map(e=>e.dpto).filter(Boolean))].sort();
const areaDD=document.getElementById('val-area');
if(areaDD&&areaDD.options.length<=1){areas.forEach(a=>{const o=document.createElement('option');o.value=a;o.text=a;areaDD.add(o);});}
const activos0=E.filter(e=>e.status==='ACTIVO'||e.status==='LICENCIA');
const activos=areaF?activos0.filter(e=>e.dpto===areaF):activos0;
if(activos.length===0)return;
// Normalize function for fuzzy matching
function norm(s){return s.toUpperCase().replace(/\s+/g,' ').trim();}
function keywords(s){return norm(s).split(' ').filter(w=>!['DE','DEL','LA','EL','Y','E','CD'].includes(w));}
// Build unique tabulador entries (highest costo if duplicate cargo)
const tabF=TABULADOR;
const byC={};tabF.forEach(t=>{const k=norm(t.cargo);if(!byC[k]||t.cempresa>byC[k].cempresa)byC[k]={...t,normCargo:k,kw:keywords(t.cargo)};});
const uniqueTab=Object.values(byC).sort((a,b)=>b.cempresa-a.cempresa);
// Match each employee to best tabulador entry
const empMatch=new Map();// empId -> tabNormCargo
activos.forEach(e=>{
const ec=norm(e.cargo);const ek=keywords(e.cargo);
// 1) exact
let best=uniqueTab.find(t=>t.normCargo===ec);
// 2) one contains the other
if(!best)best=uniqueTab.find(t=>t.normCargo.includes(ec)||ec.includes(t.normCargo));
// 3) keyword overlap >= 60%
if(!best){let maxScore=0;uniqueTab.forEach(t=>{const overlap=ek.filter(w=>t.kw.includes(w)).length;const score=overlap/Math.max(ek.length,t.kw.length);if(score>maxScore&&score>=0.5){maxScore=score;best=t;}});}
if(best)empMatch.set(e.id||e.nombre,best.normCargo);
});
// Build rows
const rows=[];let totalPersonas=0,totalMensual=0;
uniqueTab.forEach(t=>{
const matched=activos.filter(e=>empMatch.get(e.id||e.nombre)===t.normCargo);
const qty=matched.length;const total=qty*t.cempresa;
totalPersonas+=qty;totalMensual+=total;
rows.push({...t,qty,total,nombres:matched.map(e=>e.nombre)});
});
const unmatched=activos.filter(e=>!empMatch.has(e.id||e.nombre));
// KPIs
const vk=document.getElementById('val-kpi');
if(vk)vk.innerHTML=
'<div class="kc"><div class="kl">COSTO MENSUAL NÃ“MINA</div><div class="kv" style="color:var(--teal)">$'+fN(totalMensual)+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">'+totalPersonas+' colaboradores valoriz.</div></div>'+
'<div class="kc"><div class="kl">COSTO ANUAL PROYECTADO</div><div class="kv" style="color:var(--navy)">$'+fN(totalMensual*12)+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">Base mensual Ã— 12</div></div>'+
'<div class="kc"><div class="kl">PROMEDIO COSTO/PERSONA</div><div class="kv" style="color:var(--blue)">$'+fN(totalPersonas>0?Math.round(totalMensual/totalPersonas):0)+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">Costo empresa promedio</div></div>'+
'<div class="kc"><div class="kl">SIN TABULADOR</div><div class="kv" style="color:'+(unmatched.length>0?'var(--red)':'var(--green)')+'">'+unmatched.length+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">'+(unmatched.length>0?unmatched.map(e=>e.cargo).filter((v,i,a)=>a.indexOf(v)===i).join(', '):'Todos valorizados')+'</div></div>';
// Detail table
const vt=document.getElementById('val-tb');
if(vt)vt.innerHTML=rows.filter(r=>r.qty>0).map(r=>{
const bonos=r.bcumpl+r.balmacen+r.bruta;
return'<tr style="cursor:pointer" title="'+r.nombres.join(', ')+'"><td><strong>'+r.cargo+'</strong></td><td><span class="badge b-bl">'+r.area+'</span></td><td style="font-family:var(--mono);text-align:right">$'+fN(r.sbase)+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(r.cventas)+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(bonos)+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(r.timponible)+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(r.grat)+'</td><td style="font-family:var(--mono);text-align:right;font-weight:700;color:var(--teal)">$'+fN(r.cempresa)+'</td><td style="text-align:center"><span style="background:var(--navy);color:white;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:700">'+r.qty+'</span></td><td style="font-family:var(--mono);text-align:right;font-weight:800;color:var(--navy);font-size:14px">$'+fN(r.total)+'</td></tr>';}).join('')+
(unmatched.length>0?'<tr style="background:var(--red-light,#fff0f0)"><td colspan="7"><strong style="color:var(--red)">âš ï¸ Sin tabulador asignado</strong><br><span style="font-size:10px;color:var(--text3)">'+unmatched.map(e=>e.nombre+' ('+e.cargo+')').join(', ')+'</span></td><td colspan="1" style="text-align:center;color:var(--red);font-weight:700">â€”</td><td style="text-align:center"><span style="background:var(--red);color:white;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:700">'+unmatched.length+'</span></td><td style="color:var(--red);font-weight:700;text-align:right">Sin valorizar</td></tr>':'')+
'<tr style="background:var(--surface2);font-weight:800"><td colspan="8" style="text-align:right;font-size:14px">TOTAL NÃ“MINA MENSUAL</td><td style="text-align:center;font-size:14px">'+totalPersonas+'</td><td style="text-align:right;font-size:16px;color:var(--teal);font-family:var(--mono)">$'+fN(totalMensual)+'</td></tr>';
// Area summary - by nÃ³mina department
const aSum={};
activos.forEach(e=>{const mk=empMatch.get(e.id||e.nombre);if(mk){const tab=uniqueTab.find(t=>t.normCargo===mk);if(tab){const dept=e.dpto||'SIN ÃREA';if(!aSum[dept])aSum[dept]={personas:0,mensual:0};aSum[dept].personas++;aSum[dept].mensual+=tab.cempresa;}}});
const vta=document.getElementById('val-ta');
if(vta)vta.innerHTML=Object.entries(aSum).sort((a,b)=>b[1].mensual-a[1].mensual).map(([area,d])=>{
const pct=totalMensual>0?(d.mensual/totalMensual*100).toFixed(1):'0';
return'<tr><td><strong>'+area+'</strong></td><td style="text-align:center;font-family:var(--mono);font-weight:700">'+d.personas+'</td><td style="font-family:var(--mono);text-align:right;font-weight:700;color:var(--teal)">$'+fN(d.mensual)+'</td><td style="font-family:var(--mono);text-align:right;color:var(--navy)">$'+fN(d.mensual*12)+'</td><td style="text-align:center"><div style="background:var(--surface2);border-radius:4px;height:18px;width:100%;position:relative"><div style="background:var(--teal);height:100%;width:'+pct+'%;border-radius:4px"></div><span style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700">'+pct+'%</span></div></td></tr>';}).join('')+
'<tr style="background:var(--surface2);font-weight:800"><td>TOTAL</td><td style="text-align:center;font-family:var(--mono)">'+totalPersonas+'</td><td style="text-align:right;font-family:var(--mono);color:var(--teal)">$'+fN(totalMensual)+'</td><td style="text-align:right;font-family:var(--mono);color:var(--navy)">$'+fN(totalMensual*12)+'</td><td style="text-align:center;font-weight:700">100%</td></tr>';
// Proyecciones
const vp=document.getElementById('val-proy');
if(vp){let ph='<div class="ts2"><table><thead><tr><th>CARGO</th><th>PERSONAS</th><th>S.BASE ACTUAL</th><th>COSTO EMP ACTUAL</th><th>S.BASE PROY 2026</th><th>COSTO EMP PROY</th><th>Î” MENSUAL</th><th>% AUMENTO</th></tr></thead><tbody>';
let totalDiff=0;
PROYECCIONES.forEach(p=>{
const diff=p.ce_p2-p.ce_act;
const pct=p.ce_act>0?((diff/p.ce_act)*100).toFixed(1):'â€”';
const pk=keywords(p.cargo);
const matchE=activos.filter(e=>{const ek2=keywords(e.cargo);const ov=ek2.filter(w=>pk.includes(w)).length;return ov/Math.max(ek2.length,pk.length)>=0.5;});
const qE=matchE.length;
totalDiff+=diff*qE;
ph+='<tr><td><strong>'+p.cargo+'</strong></td><td style="text-align:center;font-weight:700">'+qE+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(p.sb_act)+'</td><td style="font-family:var(--mono);text-align:right">$'+fN(p.ce_act)+'</td><td style="font-family:var(--mono);text-align:right;color:var(--navy)">$'+fN(p.sb_p2)+'</td><td style="font-family:var(--mono);text-align:right;font-weight:700;color:var(--teal)">$'+fN(p.ce_p2)+'</td><td style="font-family:var(--mono);text-align:right;color:'+(diff>0?'var(--red)':'var(--green)')+'">'+(diff>0?'+$':'-$')+fN(Math.abs(diff*qE))+'</td><td style="text-align:center"><span class="badge '+(parseFloat(pct)>5?'b-no':'b-ok')+'">'+(diff>0?'+':'')+pct+'%</span></td></tr>';});
ph+='<tr style="background:var(--surface2);font-weight:800"><td colspan="6" style="text-align:right">IMPACTO TOTAL MENSUAL PROYECCIÃ“N</td><td style="text-align:right;color:var(--red);font-family:var(--mono);font-size:14px">+$'+fN(totalDiff)+'</td><td style="text-align:center;color:var(--red);font-family:var(--mono)">+$'+fN(totalDiff*12)+'/aÃ±o</td></tr>';
ph+='</tbody></table></div>';
vp.innerHTML=ph;}
// Expansion projects â€” dynamic
const ve=document.getElementById('val-exp');
if(ve){
if(proyectos.length===0){ve.innerHTML='<div style="text-align:center;padding:30px;color:var(--text3)"><div style="font-size:36px;margin-bottom:8px">ğŸ“</div><div style="font-size:14px;font-weight:600">Sin proyectos</div><div style="font-size:11px;margin-top:4px">Crea tu primer proyecto de expansiÃ³n</div></div>';}
else{
let totalGlobal=0;
let eh='<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px">';
proyectos.forEach((p,idx)=>{
const stBadge=p.status==='aprobado'?'<span class="badge b-ok">âœ… Aprobado</span>':p.status==='evaluacion'?'<span class="badge b-lic">â³ EvaluaciÃ³n</span>':'<span class="badge b-bl">ğŸ“‹ PlanificaciÃ³n</span>';
const totalMes=p.cargos.reduce((s,c)=>s+(c.cempresa||0)*c.qty,0);
const totalPers=p.cargos.reduce((s,c)=>s+c.qty,0);
totalGlobal+=totalMes;
eh+='<div style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)">';
eh+='<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px"><div><div style="font-weight:800;font-size:14px">'+p.name+'</div><div style="font-size:10px;color:var(--text3);margin-top:2px">'+p.desc+'</div></div><button class="btn btn-d btn-sm" onclick="delProject('+idx+')" style="padding:2px 6px;font-size:9px" title="Eliminar">Ã—</button></div>';
eh+='<div style="display:flex;gap:6px;margin-bottom:10px">'+stBadge+'<span class="badge b-bl">'+totalPers+' personas</span><span class="badge b-bl">'+p.cargos.length+' cargos</span></div>';
eh+='<div style="padding:8px;background:var(--surface);border-radius:6px;text-align:center;margin-bottom:10px"><div style="font-size:9px;color:var(--text3)">COSTO MENSUAL ESTIMADO</div><div style="font-size:18px;font-weight:800;color:var(--teal);font-family:var(--mono)">$'+fN(totalMes)+'</div><div style="font-size:10px;color:var(--text3)">$'+fN(totalMes*12)+' /aÃ±o</div></div>';
eh+='<div style="display:flex;gap:6px"><button class="btn btn-p btn-sm" style="flex:1" onclick="openExpProject('+idx+')">ğŸ“Š Detalle</button><button class="btn btn-e btn-sm" style="flex:1" onclick="openEditProject('+idx+')">âœï¸ Editar</button></div>';
eh+='</div>';});
eh+='</div>';
eh+='<div style="margin-top:12px;padding:12px;background:var(--surface);border-radius:var(--radius);display:flex;justify-content:space-around;text-align:center"><div><div style="font-size:9px;color:var(--text3)">PROYECTOS</div><div style="font-size:20px;font-weight:800;color:var(--navy)">'+proyectos.length+'</div></div><div><div style="font-size:9px;color:var(--text3)">PERSONAS TOTAL</div><div style="font-size:20px;font-weight:800;color:var(--navy)">'+proyectos.reduce((s,p)=>s+p.cargos.reduce((s2,c)=>s2+c.qty,0),0)+'</div></div><div><div style="font-size:9px;color:var(--text3)">INVERSIÃ“N MENSUAL</div><div style="font-size:20px;font-weight:800;color:var(--teal);font-family:var(--mono)">$'+fN(totalGlobal)+'</div></div><div><div style="font-size:9px;color:var(--text3)">INVERSIÃ“N ANUAL</div><div style="font-size:20px;font-weight:800;color:var(--teal);font-family:var(--mono)">$'+fN(totalGlobal*12)+'</div></div></div>';
ve.innerHTML=eh;}}
}

function openNewProject(){
document.getElementById('mt').textContent='â• Crear Proyecto de ExpansiÃ³n';
const cargoOpts=TABULADOR.filter((t,i,a)=>a.findIndex(x=>x.cargo===t.cargo)===i).map(t=>'<option value="'+t.cargo+'">'+t.cargo+' ($'+fN(t.cempresa)+'/mes)</option>').join('');
let h='<div class="fg2">';
h+='<div class="fg full"><div class="fl">Nombre del Proyecto *</div><input class="fi" id="np-name" placeholder="Ej: Nuevo CD Colombia"></div>';
h+='<div class="fg full"><div class="fl">DescripciÃ³n</div><input class="fi" id="np-desc" placeholder="Breve descripciÃ³n del proyecto"></div>';
h+='<div class="fg"><div class="fl">Estado</div><select class="fi" id="np-st"><option value="planificacion">ğŸ“‹ PlanificaciÃ³n</option><option value="evaluacion">â³ EvaluaciÃ³n</option><option value="aprobado">âœ… Aprobado</option></select></div>';
h+='</div>';
h+='<div style="margin-top:16px;border-top:1px solid var(--border);padding-top:12px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><div class="fl">Cargos del Proyecto</div></div>';
h+='<div id="np-cargos-list"></div>';
h+='<div style="margin-top:10px;padding:12px;background:var(--surface);border-radius:var(--radius)">';
h+='<div style="font-size:10px;font-weight:700;color:var(--text2);margin-bottom:8px">Agregar cargo:</div>';
h+='<div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">';
h+='<select class="fi" id="np-cargo-sel" style="flex:2;min-width:180px" onchange="npCargoSelChange()"><option value="">â€” Seleccionar cargo existente â€”</option>'+cargoOpts+'<option value="__custom__">âœï¸ Cargo nuevo (personalizado)</option></select>';
h+='<input class="fi" id="np-cargo-custom" style="flex:2;min-width:150px;display:none" placeholder="Nombre del nuevo cargo">';
h+='<input class="fi" id="np-cargo-qty" type="number" min="1" value="1" style="width:60px" placeholder="Qty">';
h+='<input class="fi" id="np-cargo-ce" type="number" style="width:120px;display:none" placeholder="Costo empresa $">';
h+='<button class="btn btn-p btn-sm" onclick="npAddCargo()">+ Agregar</button>';
h+='</div>';
h+='<div id="np-cargo-preview" style="margin-top:6px;font-size:10px;color:var(--text3)"></div>';
h+='</div></div>';
h+='<div id="np-total" style="margin-top:12px;padding:10px;background:var(--navy);color:white;border-radius:var(--radius);text-align:center;display:none"><div style="font-size:10px;opacity:.7">COSTO MENSUAL ESTIMADO</div><div style="font-size:22px;font-weight:800;font-family:var(--mono)" id="np-total-v">$0</div></div>';
h+='<div style="margin-top:16px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveNewProject()">ğŸ’¾ Crear Proyecto</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('mbd').innerHTML=h;
document.getElementById('modal').style.display='flex';
window._npCargos=[];npRenderCargos();}

function npCargoSelChange(){const v=document.getElementById('np-cargo-sel').value;
const isCustom=v==='__custom__';
document.getElementById('np-cargo-custom').style.display=isCustom?'':'none';
document.getElementById('np-cargo-ce').style.display=isCustom?'':'none';
if(!isCustom&&v){const t=TABULADOR.find(x=>x.cargo===v);
document.getElementById('np-cargo-preview').textContent=t?'Costo empresa: $'+fN(t.cempresa)+'/mes (Tabulador '+t.area+')':'';}
else{document.getElementById('np-cargo-preview').textContent=isCustom?'Ingresa nombre y costo empresa manualmente':'';}}

function npAddCargo(){const sel=document.getElementById('np-cargo-sel').value;
const qty=parseInt(document.getElementById('np-cargo-qty').value)||1;
let cargo,cempresa,custom=false;
if(sel==='__custom__'){cargo=document.getElementById('np-cargo-custom').value.trim().toUpperCase();cempresa=parseInt(document.getElementById('np-cargo-ce').value)||0;custom=true;
if(!cargo){toast('Ingresa nombre del cargo',1);return;}if(!cempresa){toast('Ingresa costo empresa',1);return;}}
else if(sel){cargo=sel;const t=TABULADOR.find(x=>x.cargo===sel);cempresa=t?t.cempresa:0;custom=false;}
else{toast('Selecciona un cargo',1);return;}
const exist=window._npCargos.findIndex(c=>c.cargo===cargo);
if(exist>=0){window._npCargos[exist].qty+=qty;}
else{window._npCargos.push({cargo,qty,cempresa,custom});}
document.getElementById('np-cargo-sel').value='';document.getElementById('np-cargo-custom').value='';document.getElementById('np-cargo-custom').style.display='none';
document.getElementById('np-cargo-ce').value='';document.getElementById('np-cargo-ce').style.display='none';document.getElementById('np-cargo-qty').value='1';
document.getElementById('np-cargo-preview').textContent='';npRenderCargos();}

function npRemoveCargo(i){window._npCargos.splice(i,1);npRenderCargos();}

function npRenderCargos(){const list=document.getElementById('np-cargos-list');const total=document.getElementById('np-total');
if(!window._npCargos.length){list.innerHTML='<div style="text-align:center;padding:16px;color:var(--text3);font-size:11px">Agrega cargos al proyecto</div>';total.style.display='none';return;}
let h='<table style="width:100%;font-size:11px"><thead><tr><th style="text-align:left;padding:4px 6px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">CARGO</th><th style="text-align:center;padding:4px 6px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">QTY</th><th style="text-align:right;padding:4px 6px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">COSTO EMP.</th><th style="text-align:right;padding:4px 6px;font-size:9px;color:var(--text3);border-bottom:1px solid var(--border)">TOTAL MES</th><th style="width:30px"></th></tr></thead><tbody>';
let sum=0;
window._npCargos.forEach((c,i)=>{const t=c.cempresa*c.qty;sum+=t;
h+='<tr style="border-bottom:1px solid var(--border)"><td style="padding:5px 6px;font-weight:600">'+c.cargo+(c.custom?' <span style="font-size:8px;color:var(--yellow)">NUEVO</span>':'')+'</td><td style="padding:5px 6px;text-align:center;font-family:var(--mono)">'+c.qty+'</td><td style="padding:5px 6px;text-align:right;font-family:var(--mono);color:var(--teal)">$'+fN(c.cempresa)+'</td><td style="padding:5px 6px;text-align:right;font-family:var(--mono);font-weight:700">$'+fN(t)+'</td><td><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:12px" onclick="npRemoveCargo('+i+')">Ã—</button></td></tr>';});
h+='</tbody></table>';list.innerHTML=h;
total.style.display='';document.getElementById('np-total-v').textContent='$'+fN(sum);}

function saveNewProject(){const name=document.getElementById('np-name').value.trim();
if(!name){toast('Ingresa nombre del proyecto',1);return;}
if(!window._npCargos.length){toast('Agrega al menos un cargo',1);return;}
const p={id:'proj_'+Date.now(),name,desc:document.getElementById('np-desc').value.trim(),status:document.getElementById('np-st').value,created:new Date().toISOString().slice(0,10),cargos:JSON.parse(JSON.stringify(window._npCargos))};
proyectos.push(p);aa('PROYECTO','Creado: '+name+' ('+p.cargos.reduce((s,c)=>s+c.qty,0)+' personas)');save();clM();rVal();toast('âœ… Proyecto creado');}

function delProject(idx){const p=proyectos[idx];if(!p)return;
if(!confirm('Â¿Eliminar proyecto "'+p.name+'"?'))return;
aa('PROYECTO','Eliminado: '+p.name);proyectos.splice(idx,1);save();rVal();toast('Proyecto eliminado');}

function openExpProject(idx){const p=proyectos[idx];if(!p)return;
document.getElementById('mt').textContent='ğŸ“Š '+p.name;
const stBadge=p.status==='aprobado'?'<span class="badge b-ok">âœ… Aprobado</span>':p.status==='evaluacion'?'<span class="badge b-lic">â³ EvaluaciÃ³n</span>':'<span class="badge b-bl">ğŸ“‹ PlanificaciÃ³n</span>';
let h='<div style="padding:12px;background:var(--surface);border-radius:var(--radius);margin-bottom:12px"><div style="font-weight:700">'+p.desc+'</div><div style="display:flex;gap:6px;margin-top:6px">'+stBadge+'<span class="badge b-bl">Creado: '+p.created+'</span></div></div>';
h+='<div class="ts2" style="margin-bottom:12px"><table><thead><tr style="background:var(--navy)"><th style="color:white;text-align:left">CARGO</th><th style="color:white;text-align:center">TIPO</th><th style="color:white;text-align:right">COSTO EMP.</th><th style="color:white;text-align:center">QTY</th><th style="color:white;text-align:right">TOTAL MENSUAL</th><th style="color:white;text-align:right">TOTAL ANUAL</th></tr></thead><tbody>';
let totalMes=0;
p.cargos.forEach(c=>{const t=c.cempresa*c.qty;totalMes+=t;
h+='<tr><td style="font-weight:600">'+c.cargo+'</td><td style="text-align:center;font-size:10px">'+(c.custom?'<span style="color:var(--yellow)">Nuevo</span>':'Tabulador')+'</td><td style="font-family:var(--mono);text-align:right;color:var(--teal)">$'+fN(c.cempresa)+'</td><td style="text-align:center;font-weight:700">'+c.qty+'</td><td style="font-family:var(--mono);text-align:right;font-weight:700">$'+fN(t)+'</td><td style="font-family:var(--mono);text-align:right;color:var(--text2)">$'+fN(t*12)+'</td></tr>';});
h+='<tr style="background:var(--surface2);font-weight:800"><td colspan="3">TOTAL</td><td style="text-align:center">'+p.cargos.reduce((s,c)=>s+c.qty,0)+'</td><td style="text-align:right;color:var(--teal);font-size:14px;font-family:var(--mono)">$'+fN(totalMes)+'</td><td style="text-align:right;color:var(--navy);font-family:var(--mono)">$'+fN(totalMes*12)+'</td></tr>';
h+='</tbody></table></div>';
h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div class="kc"><div class="kl">INVERSIÃ“N MENSUAL</div><div class="kv" style="color:var(--teal);font-size:20px">$'+fN(totalMes)+'</div></div><div class="kc"><div class="kl">INVERSIÃ“N ANUAL</div><div class="kv" style="color:var(--navy);font-size:20px">$'+fN(totalMes*12)+'</div></div></div>';
document.getElementById('mbd').innerHTML=h;
document.getElementById('modal').style.display='flex';}

function openEditProject(idx){const p=proyectos[idx];if(!p)return;
document.getElementById('mt').textContent='âœï¸ Editar: '+p.name;
const cargoOpts=TABULADOR.filter((t,i,a)=>a.findIndex(x=>x.cargo===t.cargo)===i).map(t=>'<option value="'+t.cargo+'">'+t.cargo+' ($'+fN(t.cempresa)+'/mes)</option>').join('');
let h='<div class="fg2">';
h+='<div class="fg full"><div class="fl">Nombre</div><input class="fi" id="np-name" value="'+p.name+'"></div>';
h+='<div class="fg full"><div class="fl">DescripciÃ³n</div><input class="fi" id="np-desc" value="'+(p.desc||'')+'"></div>';
h+='<div class="fg"><div class="fl">Estado</div><select class="fi" id="np-st"><option value="planificacion"'+(p.status==='planificacion'?' selected':'')+'>ğŸ“‹ PlanificaciÃ³n</option><option value="evaluacion"'+(p.status==='evaluacion'?' selected':'')+'>â³ EvaluaciÃ³n</option><option value="aprobado"'+(p.status==='aprobado'?' selected':'')+'>âœ… Aprobado</option></select></div>';
h+='</div>';
h+='<div style="margin-top:16px;border-top:1px solid var(--border);padding-top:12px"><div class="fl" style="margin-bottom:10px">Cargos del Proyecto</div>';
h+='<div id="np-cargos-list"></div>';
h+='<div style="margin-top:10px;padding:12px;background:var(--surface);border-radius:var(--radius)">';
h+='<div style="font-size:10px;font-weight:700;color:var(--text2);margin-bottom:8px">Agregar cargo:</div>';
h+='<div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">';
h+='<select class="fi" id="np-cargo-sel" style="flex:2;min-width:180px" onchange="npCargoSelChange()"><option value="">â€” Cargo existente â€”</option>'+cargoOpts+'<option value="__custom__">âœï¸ Cargo nuevo</option></select>';
h+='<input class="fi" id="np-cargo-custom" style="flex:2;min-width:150px;display:none" placeholder="Nombre cargo">';
h+='<input class="fi" id="np-cargo-qty" type="number" min="1" value="1" style="width:60px">';
h+='<input class="fi" id="np-cargo-ce" type="number" style="width:120px;display:none" placeholder="Costo emp $">';
h+='<button class="btn btn-p btn-sm" onclick="npAddCargo()">+</button>';
h+='</div><div id="np-cargo-preview" style="margin-top:6px;font-size:10px;color:var(--text3)"></div></div></div>';
h+='<div id="np-total" style="margin-top:12px;padding:10px;background:var(--navy);color:white;border-radius:var(--radius);text-align:center;display:none"><div style="font-size:10px;opacity:.7">COSTO MENSUAL</div><div style="font-size:22px;font-weight:800;font-family:var(--mono)" id="np-total-v">$0</div></div>';
h+='<div style="margin-top:16px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveEditProject('+idx+')">ğŸ’¾ Guardar</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('mbd').innerHTML=h;
document.getElementById('modal').style.display='flex';
window._npCargos=JSON.parse(JSON.stringify(p.cargos));npRenderCargos();}

function saveEditProject(idx){const name=document.getElementById('np-name').value.trim();
if(!name){toast('Ingresa nombre',1);return;}
if(!window._npCargos.length){toast('Agrega al menos un cargo',1);return;}
proyectos[idx].name=name;proyectos[idx].desc=document.getElementById('np-desc').value.trim();
proyectos[idx].status=document.getElementById('np-st').value;
proyectos[idx].cargos=JSON.parse(JSON.stringify(window._npCargos));
aa('PROYECTO','Editado: '+name);save();clM();rVal();toast('âœ… Proyecto actualizado');}

function rConfig(){
// User list with details
const roleDesc={'ADMIN':'Administrador â€” Vista completa','SUB':'Subgerente â€” Vista completa','GESTION':'GestiÃ³n â€” NÃ³mina completa (sin valorizaciÃ³n)','JEFE':'Jefe Ãrea â€” Filtrado por dpto'};
const roleBadge={'ADMIN':'b-ok','SUB':'b-bl','GESTION':'b-lic','JEFE':'b-pu'};
document.getElementById('user-list').innerHTML=Object.entries(USERS).map(([uid,u])=>{
const lastLogin=audit.find(a=>a.user===u.name&&a.action==='LOGIN');
const lastStr=lastLogin?new Date(lastLogin.time).toLocaleString('es-CL'):'Nunca';
const loginCount=audit.filter(a=>a.user===u.name&&a.action==='LOGIN').length;
return'<div style="padding:10px;margin-bottom:6px;border:1px solid var(--border);border-radius:var(--radius);background:var(--surface)"><div style="display:flex;justify-content:space-between;align-items:center"><div style="display:flex;align-items:center;gap:8px"><div style="width:32px;height:32px;border-radius:50%;background:var(--teal-light);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--teal)">'+u.ini+'</div><div><div style="font-weight:700;font-size:13px">'+u.name+'</div><div style="font-size:10px;color:var(--text3);font-family:var(--mono)">Usuario: <strong>'+uid+'</strong> | '+u.title+'</div></div></div><div style="display:flex;align-items:center;gap:4px"><span class="badge '+roleBadge[u.role]+'">'+u.role+'</span>'+(U&&U.role==='ADMIN'?'<button class="btn btn-e btn-sm" onclick="openEditUser(\''+uid+'\')" style="padding:2px 6px;font-size:9px">âœï¸</button><button class="btn btn-d btn-sm" onclick="delUser(\''+uid+'\')" style="padding:2px 6px;font-size:9px">Ã—</button>':'')+'</div></div><div style="display:flex;gap:16px;margin-top:4px;font-size:9px;color:var(--text3)">'+(u.filter?'<span>ğŸ“‚ Dptos: '+u.filter.join(', ')+'</span>':'<span>ğŸ“‚ Todos los departamentos</span>')+'<span>ğŸ”‘ Ãšltimo acceso: '+lastStr+'</span><span>ğŸ“Š '+loginCount+' logins</span></div></div>';}).join('');
document.getElementById('cfg-e').textContent=E.length;document.getElementById('cfg-b').textContent=B.length;document.getElementById('cfg-ch').textContent=CH.length;document.getElementById('cfg-a').textContent=audit.length;document.getElementById('cfg-v').textContent=vac.length;}
function openAddUser(){document.getElementById('mt').textContent='Agregar Usuario';const ds=[...new Set(E.map(e=>e.dpto))].filter(Boolean).sort();document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg"><div class="fl">ID *</div><input class="fi" id="nu-id" placeholder="jperez"></div><div class="fg"><div class="fl">Nombre *</div><input class="fi" id="nu-nm" placeholder="Juan PÃ©rez"></div><div class="fg"><div class="fl">Iniciales</div><input class="fi" id="nu-ini" placeholder="JP" maxlength="2"></div><div class="fg"><div class="fl">Rol</div><select class="fi" id="nu-rl"><option value="JEFE">JEFE</option><option value="SUB">SUBGERENTE</option><option value="ADMIN">ADMIN</option></select></div><div class="fg"><div class="fl">ContraseÃ±a *</div><input class="fi" id="nu-pw" value="1234"></div><div class="fg"><div class="fl">TÃ­tulo</div><input class="fi" id="nu-tt" placeholder="Jefe Ãrea"></div><div class="fg full"><div class="fl">Filtro Dptos (JEFE)</div><select class="fi" id="nu-f" multiple style="height:80px">'+ds.map(d=>'<option>'+d+'</option>').join('')+'</select></div></div><div style="margin-top:14px"><button class="btn btn-p" onclick="saveNewUser()">âœ… Crear</button></div>';document.getElementById('modal').style.display='flex';}
function saveNewUser(){const uid=document.getElementById('nu-id').value.trim().toLowerCase(),nm=document.getElementById('nu-nm').value.trim();if(!uid||!nm){toast('ID y nombre obligatorios',1);return;}if(USERS[uid]){toast('ID existe',1);return;}const rl=document.getElementById('nu-rl').value;const f=rl==='JEFE'?Array.from(document.getElementById('nu-f').selectedOptions).map(o=>o.value):null;USERS[uid]={name:nm,ini:document.getElementById('nu-ini').value.toUpperCase()||nm.slice(0,2).toUpperCase(),role:rl,pass:document.getElementById('nu-pw').value||'1234',filter:f&&f.length?f:null,title:document.getElementById('nu-tt').value||rl};aa('USUARIO','Nuevo: '+uid);save();clM();rConfig();toast('âœ… Usuario');}

function openEditUser(uid){const u=USERS[uid];if(!u)return;document.getElementById('mt').textContent='Editar Usuario: '+u.name;const ds=[...new Set(E.map(e=>e.dpto))].filter(Boolean).sort();const curFilter=u.filter||[];
document.getElementById('mbd').innerHTML='<div class="fg2"><div class="fg"><div class="fl">ID</div><div style="font-family:var(--mono);font-weight:600;font-size:12px">'+uid+'</div></div><div class="fg"><div class="fl">Nombre</div><input class="fi" id="eu-nm" value="'+u.name+'"></div><div class="fg"><div class="fl">Iniciales</div><input class="fi" id="eu-ini" value="'+u.ini+'" maxlength="2"></div><div class="fg"><div class="fl">Rol</div><select class="fi" id="eu-rl" onchange="document.getElementById(\'eu-fg\').style.display=this.value===\'JEFE\'?\'block\':\'none\'"><option value="ADMIN"'+(u.role==='ADMIN'?' selected':'')+'>ADMIN (vista completa)</option><option value="SUB"'+(u.role==='SUB'?' selected':'')+'>SUBGERENTE (vista completa)</option><option value="GESTION"'+(u.role==='GESTION'?' selected':'')+'>GESTIÃ“N (nÃ³mina sin valorizaciÃ³n)</option><option value="JEFE"'+(u.role==='JEFE'?' selected':'')+'>JEFE (filtrado por dpto)</option></select></div><div class="fg"><div class="fl">TÃ­tulo</div><input class="fi" id="eu-tt" value="'+(u.title||'')+'"></div><div class="fg"><div class="fl">Nueva ContraseÃ±a <span style="font-weight:400;color:var(--text3)">(dejar vacÃ­o para mantener)</span></div><input class="fi" id="eu-pw" placeholder="Sin cambio"></div><div class="fg full" id="eu-fg" style="display:'+(u.role==='JEFE'?'block':'none')+'"><div class="fl">Filtro Departamentos</div><select class="fi" id="eu-f" multiple style="height:100px">'+ds.map(d=>'<option'+(curFilter.includes(d)?' selected':'')+'>'+d+'</option>').join('')+'</select><div style="font-size:9px;color:var(--text3);margin-top:2px">Ctrl+Click para selecciÃ³n mÃºltiple</div></div></div><div style="margin-top:14px;display:flex;gap:6px"><button class="btn btn-p" onclick="saveEditUser(\''+uid+'\')">ğŸ’¾ Guardar</button><button class="btn btn-g" onclick="clM()">Cancelar</button></div>';
document.getElementById('modal').style.display='flex';}

function saveEditUser(uid){const u=USERS[uid];if(!u)return;u.name=document.getElementById('eu-nm').value.trim()||u.name;u.ini=document.getElementById('eu-ini').value.toUpperCase()||u.ini;u.role=document.getElementById('eu-rl').value;u.title=document.getElementById('eu-tt').value||u.role;const pw=document.getElementById('eu-pw').value;if(pw&&pw.length>=4)u.pass=pw;else if(pw&&pw.length>0&&pw.length<4){toast('ContraseÃ±a mÃ­n 4 caracteres',1);return;}
if(u.role==='JEFE'){const f=Array.from(document.getElementById('eu-f').selectedOptions).map(o=>o.value);u.filter=f.length?f:null;}else{u.filter=null;}
aa('USUARIO','Editado: '+uid+' â†’ '+u.role);save();clM();rConfig();toast('âœ… '+u.name+' actualizado');}

function delUser(uid){if(uid===U.uid){toast('No puedes eliminarte a ti mismo',1);return;}if(!confirm('Â¿Eliminar usuario '+USERS[uid].name+'?'))return;const nm=USERS[uid].name;delete USERS[uid];aa('USUARIO','Eliminado: '+uid);save();rConfig();toast('Usuario '+nm+' eliminado');}

// FILTERS + REFRESH
function popF(){const v=vis();const ds=[...new Set(v.map(e=>e.dpto))].filter(Boolean).sort();const cs=[...new Set(v.map(e=>e.cargo))].filter(Boolean).sort();const js=[...new Set(v.map(e=>e.jefatura))].filter(Boolean).sort();document.getElementById('f-d').innerHTML='<option value="">Dptos</option>'+ds.map(d=>'<option>'+d+'</option>').join('');document.getElementById('f-c').innerHTML='<option value="">Cargos</option>'+cs.map(c=>'<option>'+c+'</option>').join('');document.getElementById('f-j').innerHTML='<option value="">Jefaturas</option>'+js.map(j=>'<option>'+j+'</option>').join('');}
// AUTO CONTRATO: PLAZO FIJO >6m1d desde ingreso â†’ INDEFINIDO
function autoContrato(){let n=0;E.forEach(e=>{if(e.status!=='ACTIVO'||e.tipoContrato==='INDEFINIDO')return;if(!e.ingreso||e.ingreso==='nan')return;const ing=new Date(e.ingreso);const lim=new Date(ing);lim.setMonth(lim.getMonth()+6);lim.setDate(lim.getDate()+1);if(new Date()>=lim){e.tipoContrato='INDEFINIDO';n++;}});if(n)save();}
function autoLicCheck(){let changed=false;const today=new Date().toISOString().slice(0,10);
Object.entries(lics).forEach(([rut,l])=>{if(!l.end)return;
const e=E.find(x=>x.rut===rut);if(!e||e.status!=='LICENCIA')return;
if(l.end<today){
licHist.push({rut,nombre:e.nombre,cargo:e.cargo,dpto:e.dpto,start:l.start,end:l.end,motivo:l.motivo,retorno:today,autoClose:true});
e.status='ACTIVO';delete lics[rut];
aa('REINTEGRO_AUTO',e.nombre+' â€” Licencia venciÃ³ '+fd(l.end)+', reintegrado automÃ¡ticamente');changed=true;}});
if(changed)save();}
function refreshAll(){autoContrato();autoLicCheck();popF();document.getElementById('nc').textContent=vis().length;rDash();rPage();rRes();rRot();rLic();rVac();rCam(CH);rBaj(B);rCal();rAud();rAlerts();rConfig();updBulk();try{rVal();}catch(e){console.error('rVal error:',e);}try{rOrg();}catch(e){console.error('rOrg error:',e);}}

document.getElementById('l-p').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});

// DARK MODE
function toggleDM(){document.body.classList.toggle('dark');const isDark=document.body.classList.contains('dark');localStorage.setItem('simi_dm',isDark?'1':'0');document.getElementById('dm-btn').textContent=isDark?'â˜€ï¸':'ğŸŒ™';}
(function(){if(localStorage.getItem('simi_dm')==='1'){document.body.classList.add('dark');document.getElementById('dm-btn').textContent='â˜€ï¸';}})();

// GLOBAL SEARCH
let gsIdx=0,gsItems=[];
function openGS(){document.getElementById('gs').classList.add('show');document.getElementById('gs-q').value='';document.getElementById('gs-q').focus();doGS('');}
function closeGS(){document.getElementById('gs').classList.remove('show');}
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();openGS();}if(e.key==='Escape')closeGS();});
function doGS(q){q=q.toLowerCase().trim();gsItems=[];
if(!q){gsItems=[{icon:'ğŸ“‹',label:'Dashboard',sub:'Panel principal',fn:()=>nav('dashboard')},{icon:'ğŸ‘¥',label:'NÃ³mina',sub:'Lista de colaboradores',fn:()=>nav('nomina')},{icon:'ğŸ“Š',label:'DotaciÃ³n',sub:'AnÃ¡lisis por Ã¡rea',fn:()=>nav('resumen')},{icon:'ğŸ“ˆ',label:'RotaciÃ³n',sub:'AnÃ¡lisis de bajas',fn:()=>nav('rotacion')},{icon:'ğŸ¥',label:'Licencias',sub:'GestiÃ³n de licencias',fn:()=>nav('licencias')},{icon:'ğŸ–ï¸',label:'Vacaciones',sub:'GestiÃ³n de vacaciones',fn:()=>nav('vacaciones')},{icon:'ğŸ“…',label:'Calendario',sub:'Eventos del mes',fn:()=>nav('calendario')},{icon:'ğŸ“‹',label:'AuditorÃ­a',sub:'Historial de acciones',fn:()=>nav('auditoria')},{icon:'ğŸ””',label:'Alertas',sub:'Centro de alertas',fn:()=>nav('alertas')},{icon:'ğŸ“Š',label:'Reportes',sub:'Generador de reportes',fn:()=>nav('reportes')},{icon:'âš™ï¸',label:'ConfiguraciÃ³n',sub:'Usuarios y datos',fn:()=>nav('config')},{icon:'ğŸ’°',label:'ValorizaciÃ³n',sub:'Costos de nÃ³mina',fn:()=>nav('valorizacion')}];}else{
E.forEach(e=>{if(`${e.nombre} ${e.rut} ${e.cod} ${e.cargo} ${e.dpto}`.toLowerCase().includes(q)){gsItems.push({icon:'ğŸ‘¤',label:e.nombre,sub:e.cargo+' â€” '+e.dpto,fn:()=>{closeGS();openEmp(e.id);}});}});
const pages=[['dashboard','Dashboard','ğŸ“‹'],['nomina','NÃ³mina','ğŸ‘¥'],['resumen','DotaciÃ³n','ğŸ“Š'],['rotacion','RotaciÃ³n','ğŸ“ˆ'],['licencias','Licencias','ğŸ¥'],['vacaciones','Vacaciones','ğŸ–ï¸'],['calendario','Calendario','ğŸ“…'],['auditoria','AuditorÃ­a','ğŸ“‹'],['alertas','Alertas','ğŸ””'],['reportes','Reportes','ğŸ“Š'],['config','ConfiguraciÃ³n','âš™ï¸']];
pages.forEach(([p,l,i])=>{if(l.toLowerCase().includes(q))gsItems.push({icon:i,label:l,sub:'Ir a secciÃ³n',fn:()=>{closeGS();nav(p);}});});
if('nuevo agregar alta crear'.includes(q))gsItems.push({icon:'â•',label:'Nuevo Colaborador',sub:'Registrar alta',fn:()=>{closeGS();openAdd();}});
if('vacaciones solicitar'.includes(q))gsItems.push({icon:'ğŸ–ï¸',label:'Nueva Solicitud Vacaciones',sub:'Registrar',fn:()=>{closeGS();openVacReq();}});}
gsIdx=0;renderGS();}
function renderGS(){const el=document.getElementById('gs-r');el.innerHTML=gsItems.slice(0,15).map((it,i)=>'<div class="gs-item'+(i===gsIdx?' sel':'')+'" onclick="gsItems['+i+'].fn();closeGS()" onmouseenter="gsIdx='+i+';renderGS()"><div class="gs-icon">'+it.icon+'</div><div class="gs-main"><div>'+it.label+'</div><div class="gs-sub">'+it.sub+'</div></div></div>').join('')||'<div class="gs-hint">Sin resultados</div>';}
function gsKey(e){if(e.key==='ArrowDown'){e.preventDefault();gsIdx=Math.min(gsIdx+1,gsItems.length-1);renderGS();}else if(e.key==='ArrowUp'){e.preventDefault();gsIdx=Math.max(gsIdx-1,0);renderGS();}else if(e.key==='Enter'&&gsItems[gsIdx]){gsItems[gsIdx].fn();closeGS();}}

// IMPORT BACKUP
function importBackup(inp){const f=inp.files[0];if(!f)return;const r=new FileReader();r.onload=function(){try{const d=JSON.parse(r.result);if(d.E){_applyData(d);if(d.USERS)USERS=d.USERS;initAuthDC();save();refreshAll();toast('âœ… Backup importado ('+E.length+' colaboradores)');}else toast('Formato invÃ¡lido',1);}catch(ex){toast('Error al leer JSON',1);}};r.readAsText(f);}

// REPORTES
function genReport(){const v=vis(),ac=v.filter(e=>e.status==='ACTIVO'),li=v.filter(e=>e.status==='LICENCIA');
const rs=document.getElementById('rp-s').value,re=document.getElementById('rp-e').value;
const bajasP=rs&&re?B.filter(b=>b.fecha>=rs&&b.fecha<=re):B;
const vacP=rs&&re?vac.filter(x=>x.start>=rs&&x.start<=re):vac;
const cambP=rs&&re?CH.filter(c=>c.desde>=rs&&c.desde<=re):CH;
const periodoTxt=rs&&re?fd(rs)+' â€” '+fd(re):'Todo el historial';

// Dept breakdown
const byDpto={};ac.forEach(e=>{byDpto[e.dpto]=(byDpto[e.dpto]||0)+1;});
const byCargo={};ac.forEach(e=>{byCargo[e.cargo]=(byCargo[e.cargo]||0)+1;});
const byTC={};ac.forEach(e=>{byTC[e.tipoContrato]=(byTC[e.tipoContrato]||0)+1;});

// AntigÃ¼edad distribution
const ant={'<1a':0,'1-3a':0,'3-5a':0,'5-10a':0,'>10a':0};
ac.forEach(e=>{const s=sen(e.ingreso);if(s.y<1)ant['<1a']++;else if(s.y<3)ant['1-3a']++;else if(s.y<5)ant['3-5a']++;else if(s.y<10)ant['5-10a']++;else ant['>10a']++;});

// Vacation usage
const vacDUsed=vac.filter(x=>x.status==='APROBADA').reduce((s,x)=>s+x.dias,0);

const mxD=Math.max(...Object.values(byDpto),1);
const mxC=Math.max(...Object.values(byCargo),1);

let html='<div class="rpt-card"><h3>ğŸ“Š Resumen General â€” '+periodoTxt+'</h3><div class="rpt-grid">';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--teal)">'+ac.length+'</div><div class="rl">Activos</div></div>';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--yellow)">'+li.length+'</div><div class="rl">Licencias</div></div>';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--red)">'+bajasP.length+'</div><div class="rl">Bajas perÃ­odo</div></div>';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--blue)">'+cambP.length+'</div><div class="rl">Cambios cargo</div></div>';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--green)">'+vacP.length+'</div><div class="rl">Vacaciones</div></div>';
html+='<div class="rpt-stat"><div class="rv" style="color:var(--teal)">'+vacDUsed+'</div><div class="rl">DÃ­as vac. usados</div></div>';
html+='</div></div>';

html+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">';
html+='<div class="rpt-card"><h3>Por Departamento</h3>'+Object.entries(byDpto).sort((a,b)=>b[1]-a[1]).map(([d,n])=>'<div class="br"><div class="bl">'+d+'</div><div class="bt"><div class="bf" style="width:'+n/mxD*100+'%;background:var(--teal)"><span>'+n+'</span></div></div></div>').join('')+'</div>';

html+='<div class="rpt-card"><h3>Por Cargo (Top 10)</h3>'+Object.entries(byCargo).sort((a,b)=>b[1]-a[1]).slice(0,10).map(([c,n])=>{const au=getAuth(c,null)||n;const df=n-au;const dc=df>0?'var(--teal)':df<0?'var(--red)':'var(--text3)';return'<div class="br"><div class="bl">'+c+'</div><div class="bt"><div class="bf" style="width:'+n/mxC*100+'%;background:var(--teal)"><span>'+n+'</span></div></div><div class="bv" style="color:'+dc+'">'+(df>0?'+'+df:df)+'</div></div>';}).join('')+'</div>';
html+='</div>';

html+='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px">';
html+='<div class="rpt-card"><h3>Tipo Contrato</h3>'+Object.entries(byTC).map(([t,n])=>'<div class="sr"><span class="l">'+t+'</span><span class="v">'+n+' <span style="font-size:9px;color:var(--text3)">('+Math.round(n/ac.length*100)+'%)</span></span></div>').join('')+'</div>';

html+='<div class="rpt-card"><h3>AntigÃ¼edad</h3>'+Object.entries(ant).map(([r,n])=>{const p=ac.length?Math.round(n/ac.length*100):0;return'<div class="sr"><span class="l">'+r+'</span><span class="v">'+n+' <span style="font-size:9px;color:var(--text3)">('+p+'%)</span></span></div>';}).join('')+'</div>';

html+='<div class="rpt-card"><h3>Bajas PerÃ­odo</h3>';
if(bajasP.length){const bm={};bajasP.forEach(b=>{bm[b.motivo||'S/M']=(bm[b.motivo||'S/M']||0)+1;});html+=Object.entries(bm).sort((a,b)=>b[1]-a[1]).map(([m,n])=>'<div class="sr"><span class="l">'+m+'</span><span class="v" style="color:var(--red)">'+n+'</span></div>').join('');}else html+='<div style="font-size:11px;color:var(--text3)">Sin bajas</div>';
html+='</div></div>';

document.getElementById('rpt-out').innerHTML=html;aa('REPORTE','Generado: '+periodoTxt);}

function printReport(){if(!document.getElementById('rpt-out').innerHTML){genReport();}nav('reportes');setTimeout(()=>window.print(),300);}

// SPARKLINE helper for dashboard
function spark(data){if(!data||!data.length)return'';const mx=Math.max(...data,1);return'<span class="sparkline">'+data.map(v=>'<span style="height:'+Math.max(v/mx*18,1)+'px"></span>').join('')+'</span>';}

initData();

</script></body></html>
